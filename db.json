{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/bdunion.txt","path":"bdunion.txt","modified":0,"renderable":0},{"_id":"source/jd_root.txt","path":"jd_root.txt","modified":0,"renderable":0},{"_id":"source/robots.txt","path":"robots.txt","modified":0,"renderable":0},{"_id":"source/root.txt","path":"root.txt","modified":0,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/affix.js","path":"js/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/exturl.js","path":"js/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/js.cookie.js","path":"js/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/post-details.js","path":"js/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/scroll-cookie.js","path":"js/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/scrollspy.js","path":"js/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"b396c6b97de847265026126a2a73a79ff472d2e0","modified":1516082924648},{"_id":"source/bdunion.txt","hash":"8535368ebb7bf1c5fbbcf5f9741240e6e01b356c","modified":1539252493567},{"_id":"source/googlee0755d86d3b42c82.html","hash":"a2ab57e9f9126deb581cc277e56115f71ced4d0e","modified":1542784304756},{"_id":"source/jd_root.txt","hash":"119e57ede492fc6899337f363a98b6ec626a0ef6","modified":1516082924662},{"_id":"source/robots.txt","hash":"105f9bb1313862119440b3e64fd170c5547088f1","modified":1542784226419},{"_id":"source/root.txt","hash":"f97a722b622d4ae50cfc132cd42ea53996c9e75e","modified":1516082924662},{"_id":"themes/next/.all-contributorsrc","hash":"43eb0149c78e464c695f0dd758bb8c59353182b3","modified":1557368504260},{"_id":"themes/next/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1557368504261},{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1557368504263},{"_id":"themes/next/.eslintrc.json","hash":"d3c11de434171d55d70daadd3914bc33544b74b8","modified":1557368504264},{"_id":"themes/next/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1557368504265},{"_id":"themes/next/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1557368504290},{"_id":"themes/next/.gitignore","hash":"69e702b833c6aa9646ad24c45dd9cf00ab5ce6b9","modified":1557368504289},{"_id":"themes/next/.travis.yml","hash":"fb9ac54e875f6ea16d5c83db497f6bd70ae83198","modified":1557368504291},{"_id":"themes/next/LICENSE.md","hash":"0a9c7399f102b4eb0a6950dd31264be421557c7d","modified":1557368504292},{"_id":"themes/next/_config.yml","hash":"a08afdc0466a1c8d06b20ecdf0aeb7323d20441e","modified":1557371241244},{"_id":"themes/next/README.md","hash":"3f72e5a5051ca2bdaccdda684c46dc4fdb4413a6","modified":1557368504293},{"_id":"themes/next/bower.json","hash":"070292487d141982c9bef64bd32e1cb39d03d395","modified":1557368504296},{"_id":"themes/next/crowdin.yml","hash":"4a53f5985e545c635cb56b2a57ed290cb8cf8942","modified":1557368504298},{"_id":"themes/next/gulpfile.coffee","hash":"6407d9063bd88ede299ff7c2a59cf2c82e079476","modified":1557368504325},{"_id":"themes/next/package.json","hash":"d3ea523f723aafd6bebcd8a47a0d976c69dfeaf5","modified":1557368504438},{"_id":"source/404/index.html","hash":"6a41a0d83fc0d3a138f8cb976ae83d820b13881b","modified":1516085205430},{"_id":"source/_posts/0002-config-springboot-dashboard.md","hash":"fb75e73ff78e9f8fccbf695b4077db8e8daf696a","modified":1539741611001},{"_id":"source/_posts/0003-custom-async-validators-in-angular.md","hash":"ec6d6973df43542689b0b2dd03611cb860eb48db","modified":1540434518929},{"_id":"source/_posts/0001-how-to-manage-different-environments-with-angular-cli.md","hash":"d8c4945a93cb58d619d5afb33ba99add4bf194cf","modified":1539767449871},{"_id":"source/_posts/0004-a-guide-to-oauth2-grants.md","hash":"364403f3b914ae511c81e1ed874ecfc1ba0bbd5f","modified":1540533966991},{"_id":"source/_posts/0005-obtain-principal-with-custom-provider.md","hash":"53663036fdc010c39b212aa194603874de55238d","modified":1540867030293},{"_id":"source/_posts/0006-idea-maven-javadoc-charset.md","hash":"5ef9428151d2bcf71b4f10d9a2f4a098ea8375c5","modified":1542002608893},{"_id":"source/_posts/0007-spring-boot-integrate-security.md","hash":"5d5486f9ac72104aa60e452d12e2e644de603276","modified":1542002688700},{"_id":"source/_posts/0008-nginx-all.md","hash":"cdd8ae988252cfe80e41b0c90614a10d14c22193","modified":1542686120092},{"_id":"source/_posts/0009-msyql-use-double-quotes.md","hash":"6344d1d4d21b65fa910e8ce5810eb5ed324375c7","modified":1542783246971},{"_id":"source/_posts/0011-jdk-and-cglib-proxy.md","hash":"8492f72534db8b3d457ccfa64d2ec7958e9696c9","modified":1543820480962},{"_id":"source/_posts/0010-spring-cloud-zuul-integrate-static-resource.md","hash":"1f4366b925b5bdd8aba5f6b14e036c15797e32d9","modified":1543230056842},{"_id":"source/_posts/0012-custom-material-paginator-label.md","hash":"32f5037f85b5211ccaf21ee61a2e51b05b63c37b","modified":1543820370119},{"_id":"source/_posts/0013-angular-output-input-analysis.md","hash":"2ed9048dbab6a4679b237f6a7c2624e91bb08e82","modified":1543888922369},{"_id":"source/_posts/0014-create-npm-repository-with-nexus.md","hash":"d06e2e158e1fee6bc0f15d85a3a036f1f966a932","modified":1545379478590},{"_id":"source/_posts/0015-angular-font-awesome.md","hash":"3918896739a9d7c53af8f6f8e5c453a757f35930","modified":1555905724768},{"_id":"source/_posts/0015-如何用Angular6创建各种动画效果.md","hash":"cef64ae352d79e191cc4c284f8a7fd56f11a4120","modified":1550195019886},{"_id":"source/_posts/0016-面向对象.md","hash":"9a478b0518ddbc5881798b2207c71323c26a9e29","modified":1550736750756},{"_id":"source/_posts/0017-Accurate assessment of working hours.md","hash":"8718e0065358e38ae7396ae1a4f97686fb0b80b1","modified":1555905724770},{"_id":"source/_posts/HashMap.md","hash":"2cf9f0e4f9ffe1d21653058173aa84c6ee644a86","modified":1516936666033},{"_id":"source/_posts/Keepalived.md","hash":"096789d64dc23d594a1c066f3790bbd2ae0d8940","modified":1516082924649},{"_id":"source/_posts/0018-使用 Docker 部署 Spring Boot.md","hash":"8dc7d398952c41ca9292ae6eb50580d40018972d","modified":1557371843749},{"_id":"source/_posts/VS code调试Angular.md","hash":"4fe4ac7495739463b437a9d9c2726e468a4d4125","modified":1539311791278},{"_id":"source/_posts/about-me.md","hash":"ec38ca3e95861f5ffdeb56f8e67fe0a835206d8a","modified":1550195035336},{"_id":"source/_posts/auto-deploy-traivs.md","hash":"4677a2aabea1408235dcb59b9d72404c24bd9c8b","modified":1516082924650},{"_id":"source/_posts/build-angular-desktop-apps-with-electron.md","hash":"db8647b7eb2269734bb6457247c442ec914bd946","modified":1539654770175},{"_id":"source/_posts/build-spring-on-win10.md","hash":"66fa51765449c812b7c50eb0b82bc5594d002f82","modified":1539313566313},{"_id":"source/_posts/display-real-time-data-in-angular.md","hash":"077573797eca6fa2e9d7d30921e405c9b0be9a9f","modified":1539262523037},{"_id":"source/_posts/firewalld.md","hash":"77a20d56063a3ef5be8509edccc94ebfe7f02933","modified":1516936650953},{"_id":"source/_posts/front-framework.md","hash":"b8758b13cf9a01a5c1637087643679eaab3f3c71","modified":1516082924650},{"_id":"source/_posts/future-of-java-each-version.md","hash":"121cf6300612360ea3aadf6e6e64d41a4472b463","modified":1530507431341},{"_id":"source/_posts/how-to-import-springboot.md","hash":"6de80c9bdc2ab4d5ff7f329654dfab221a6b4e59","modified":1539586907136},{"_id":"source/_posts/how-to-monitor-java-garbage-collection.md","hash":"8f5023907ef19c6bbf9614c4cb285f2573a3287e","modified":1539262507506},{"_id":"source/_posts/java-history.md","hash":"2a5f7cdc7e6dd8486e65aab6cb8dceabd99b79b5","modified":1530062688138},{"_id":"source/_posts/javascript-rule.md","hash":"2931bc6c4ddbf052e49ef2cedfb5fdeb929514ec","modified":1516082924658},{"_id":"source/_posts/jdk-delayqueue.md","hash":"110927caefeb5677ed7ef20f81d11a031f0444c8","modified":1539262541834},{"_id":"source/_posts/jdk-profile.md","hash":"dc2f2acdbe36528eae356d0dc78e819182576447","modified":1516082924658},{"_id":"source/_posts/linux-command.md","hash":"3f96e4c3fcf9fb87e50493fe4fd88550ba46f6b7","modified":1539587296911},{"_id":"source/_posts/linux-profile.md","hash":"01c028671f1d3992959aec549ec46263c7c8c9ff","modified":1516936711357},{"_id":"source/_posts/logback-xml.md","hash":"4bc9d0f3fa8f0e29eaad4d01cd9497a94f60b676","modified":1516936720646},{"_id":"source/_posts/online-question-resolve.md","hash":"65ba80b67fd9f39586d584f863a2bff1ae49f40f","modified":1522915201693},{"_id":"source/_posts/mysql-password.md","hash":"6b6ad6ed34de84f8c0e4f6e3d945544acf05a9b7","modified":1539316387347},{"_id":"source/_posts/rocketmq-architecture.md","hash":"1d7287571b8988cd595275fdafeadfbc1de70259","modified":1523259510484},{"_id":"source/_posts/rocketmq-quickstart.md","hash":"54e6d30c09aba17d6b87bf38eed77058c83cd84e","modified":1516082924660},{"_id":"source/_posts/spring-annotation.md","hash":"c98e29f6993015e08db97956eb4a3b3e1d096e3d","modified":1516937073008},{"_id":"source/_posts/spring.md","hash":"8522ef8383ffbcdc57b7fba2521a33c0a1b58c66","modified":1516082924660},{"_id":"source/_posts/squid.md","hash":"39fe1100781756bc20a3887f2fdbd625cdfebc17","modified":1516937833908},{"_id":"source/_posts/vue.md","hash":"2bd1c8efe266acb2138e392ba9c3c319d2f41065","modified":1516082924661},{"_id":"source/_posts/webupload.md","hash":"9258172eadbcca747b0055b3a8d99dc407812ef3","modified":1516946045105},{"_id":"source/about/index.md","hash":"d7f0b5d39c89e55ae1b77e85f7fa1f031f9b9946","modified":1516082924661},{"_id":"source/categories/index.md","hash":"38bc73214d5de5fdcbab2c12b7ec3321b049b1bb","modified":1516936990880},{"_id":"source/tags/index.md","hash":"38dbc6a430676e4c3706796b6ffea851cd3b460c","modified":1516082924662},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1557368504227},{"_id":"themes/next/.git/config","hash":"7f8b507977a695e25b27d4c2e8aaed71410536bf","modified":1557368504244},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1557368410541},{"_id":"themes/next/.git/index","hash":"0e89509331d43321f8358c28dea06f52efe67729","modified":1557368508283},{"_id":"themes/next/.git/packed-refs","hash":"071a85ddf7fe2fd4c736d1f311d94c2cd0402c73","modified":1557368504215},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"f7ddb7faed8031a9f40eae4ee7bb48c1bc50fd14","modified":1557368504267},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"78756d8a45b22bdaa51f12b06907bff44afee83e","modified":1557368504269},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"1e212fe229bd659726b4a3bcf4b5b14e0310ba3a","modified":1557368504270},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"66e529edef048f3fab87d9670fa8999f483292bf","modified":1557368504276},{"_id":"themes/next/.github/auto_assign.yml","hash":"9fe0dbe3f6edc59bf10ea25b14eba0e92e2c8f42","modified":1557368504277},{"_id":"themes/next/.github/config.yml","hash":"cbd06d0c40afa9fdf056765120e9085826b00d20","modified":1557368504278},{"_id":"themes/next/.github/eslint-disable-bot.yml","hash":"e06053d417579ed967a94166deb6bda5ce41d805","modified":1557368504279},{"_id":"themes/next/.github/lock.yml","hash":"4f1070097b614b24050f238694127e3573ce8472","modified":1557368504280},{"_id":"themes/next/.github/mergeable.yml","hash":"1105a6eb0d4ee1b1bf1554c5c51a47160abed62a","modified":1557368504281},{"_id":"themes/next/.github/release-drafter.yml","hash":"0f826b5ea4646008e2e147dca8b4842ecf96d093","modified":1557368504283},{"_id":"themes/next/.github/stale.yml","hash":"85975c43d606c39b91c0ad32197154be9d482a09","modified":1557368504284},{"_id":"themes/next/.github/support.yml","hash":"7ce2722d6904c31a086444c422dc49b6aa310651","modified":1557368504286},{"_id":"themes/next/.github/topissuebot.yml","hash":"5091c3bc6f3df303d16d853ce65a302601c1e875","modified":1557368504287},{"_id":"themes/next/.github/weekly-digest.yml","hash":"6db3bcad65c3156de298f6a3ffd3ba887af4aa4f","modified":1557368504288},{"_id":"themes/next/docs/AGPL3.md","hash":"f463f95b169d64983f59fa6f3e4b6760290a0e6b","modified":1557368504300},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"1e49c08b446678336b2eacc8bf581faca969f34b","modified":1557368504301},{"_id":"themes/next/docs/AUTHORS.md","hash":"51a0a13da55ff3d596970b2f9ab4531c6b2211f2","modified":1557368504303},{"_id":"themes/next/docs/DATA-FILES.md","hash":"9a1895c0a0db705c4c48f512e86917f9af1ec3fb","modified":1557368504303},{"_id":"themes/next/docs/INSTALLATION.md","hash":"b74ef6fedf76cdb156e2265759ee0a789ddd49cc","modified":1557368504305},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"721a1aa9feed1b580ab99af8e69ed22699121e88","modified":1557368504306},{"_id":"themes/next/docs/LICENSE.txt","hash":"ae5ad07e4f4106bad55535dba042221539e6c7f9","modified":1557368504308},{"_id":"themes/next/docs/MATH.md","hash":"7d0330c250082a86897d1c96fbb4ef5df59538af","modified":1557368504309},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"c9f2ed8e15c137b1885d9ca8b7197d9f457971e9","modified":1557368504310},{"_id":"themes/next/languages/de.yml","hash":"79b3221344da335743b5ef5a82efa9338d64feb0","modified":1557368504327},{"_id":"themes/next/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1557368504328},{"_id":"themes/next/languages/en.yml","hash":"d66b8b48840443a4f9c72c7696a21e292f685a47","modified":1557368504329},{"_id":"themes/next/languages/es.yml","hash":"db1a9f2af477212544c830c2dd986400e26ddd6a","modified":1557368504330},{"_id":"themes/next/languages/fa.yml","hash":"3227072c7e1bfb16ec0517394b60632f4be921dd","modified":1557368504330},{"_id":"themes/next/languages/fr.yml","hash":"2429c90dad5bb865e3a969be2b373f19b3a77b3b","modified":1557368504331},{"_id":"themes/next/languages/id.yml","hash":"f3302a4dfdc9be38a52d6e081411574b1ea01671","modified":1557368504333},{"_id":"themes/next/languages/it.yml","hash":"31eb878b53d60ff47e3e534cdd7a839c8801ac6e","modified":1557368504333},{"_id":"themes/next/languages/ja.yml","hash":"3f25eca504ee5a519987b4402731f1bb7f5191c9","modified":1557368504334},{"_id":"themes/next/languages/ko.yml","hash":"75f2fe142f76bf623e34ed3570598226f55f2b8b","modified":1557368504335},{"_id":"themes/next/languages/nl.yml","hash":"08f16ce395dacc88847fc30dc6b985ce22fb8948","modified":1557368504336},{"_id":"themes/next/languages/pt-BR.yml","hash":"c7de8b77f44e75be4f04423088a1c891537aa601","modified":1557368504337},{"_id":"themes/next/languages/pt.yml","hash":"ca5072c967e5eb1178ffed91827459eda6e4e6e2","modified":1557368504338},{"_id":"themes/next/languages/ru.yml","hash":"720b92a9ec075b68737d296b1f29ad8e01151c85","modified":1557368504339},{"_id":"themes/next/languages/tr.yml","hash":"6d2f53d3687a7a46c67c78ab47908accd8812add","modified":1557368504340},{"_id":"themes/next/languages/uk.yml","hash":"6320439c6e9ff81e5b8f8129ca16e9a744b37032","modified":1557368504341},{"_id":"themes/next/languages/vi.yml","hash":"e2f0dd7f020a36aa6b73ed4d00dcc4259a7e5e9d","modified":1557368504341},{"_id":"themes/next/languages/zh-CN.yml","hash":"069f15da910d6f9756be448167c07ea5aa5dc346","modified":1557368504342},{"_id":"themes/next/languages/zh-HK.yml","hash":"c22113c4a6c748c18093dae56da5a9e8c5b963cd","modified":1557368504343},{"_id":"themes/next/languages/zh-TW.yml","hash":"dbf4dd87716babb2db4f5332fae9ec190a6f636a","modified":1557368504345},{"_id":"themes/next/layout/_layout.swig","hash":"ba786b1baba49021928e2e508da53f2fd1369b3f","modified":1557368504349},{"_id":"themes/next/layout/archive.swig","hash":"61bc56e77e653684fc834f63dcbdadf18687c748","modified":1557368504432},{"_id":"themes/next/layout/category.swig","hash":"ad0ac6a1ff341f8eab9570e7fb443962948c5f9d","modified":1557368504432},{"_id":"themes/next/layout/index.swig","hash":"bdcc9f57adef49706b16b107791cacecbc23c1dc","modified":1557368504433},{"_id":"themes/next/layout/page.swig","hash":"5d06ee8f477ffc39932d0251aa792ffcaf8faf14","modified":1557368504434},{"_id":"themes/next/layout/post.swig","hash":"af74e97d57cf00cde6f8dbd4364f27910915454e","modified":1557368504435},{"_id":"themes/next/layout/schedule.swig","hash":"e79f43df0e9a6cf48bbf00882de48c5a58080247","modified":1557368504436},{"_id":"themes/next/layout/tag.swig","hash":"283519d4d5b67814412863a3e0212bac18bcc5a0","modified":1557368504437},{"_id":"themes/next/scripts/merge-configs.js","hash":"5f96f63e86825fd7028c2522e4111103e261a758","modified":1557368504443},{"_id":"themes/next/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1557368504444},{"_id":"themes/next/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1557368504622},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1557368504624},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1557368504623},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1557368504567},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1557368410544},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1557368410546},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1557368410549},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1557368410550},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1557368410552},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1557368410554},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"18be3eb275c1decd3614e139f5a311b75f1b0ab8","modified":1557368410557},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1557368410559},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1557368410561},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1557368410562},{"_id":"themes/next/.git/logs/HEAD","hash":"c0d77a5a0fb3d3f80e78686adf52e02d2bce4f50","modified":1557368504234},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1557368410565},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"795b8ddb251da8e2327299d5f7dbf446fb9867c6","modified":1557368504272},{"_id":"themes/next/.github/ISSUE_TEMPLATE/custom-issue-template.md","hash":"245917ffaa296bc2d9a85444acf639077ca25944","modified":1557368504273},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"59b2b45e151972bbe08582cde22f398e58832765","modified":1557368504274},{"_id":"themes/next/.github/ISSUE_TEMPLATE/non-english.md","hash":"ae22e700b7c63c60746321719a20d34022ad78d9","modified":1557368504275},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"a51de08657f5946f4028b11373280ddc04639525","modified":1557368504311},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"7b2963daac19b0c14f98ebef375d5fbce8fc3f44","modified":1557368504312},{"_id":"themes/next/docs/ru/README.md","hash":"aeb95129ab1da9ec41786bfa86dc32c739ee6358","modified":1557368504314},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"1a4e41adcf5831057f3f7b3025ed4a5ef7c442b4","modified":1557368504315},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"aaf25d304793344e2d026062768c93005723f5c6","modified":1557368504316},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"018a259694f4a8c7c384e1f323531442cba5fbf3","modified":1557368504317},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"508caa37443407860d03f4d8bd56b007585125ef","modified":1557368504318},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"67f4a987e7db0ab1ce1ea4c311f2961df07b6681","modified":1557368504319},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"baca12cc24be082f1db28c7f283493569666321c","modified":1557368504320},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"b17fc344ff61603f83387c0f9b2b2189aae81d50","modified":1557368504321},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"db2797f161e1e7a4987cbfa3d1be682266dfbba6","modified":1557368504322},{"_id":"themes/next/docs/zh-CN/README.md","hash":"4016948fdb971e4f905efb7a5bb3add3dd58e7a8","modified":1557368504323},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"2095d1214a4e519a1d31b67b41c89080fa3285d3","modified":1557368504324},{"_id":"themes/next/layout/_custom/head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1557370798226},{"_id":"themes/next/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1557368504347},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1557368504348},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"891ab67815969dd8736cb22fbbb3f791b8fff4e4","modified":1557368504353},{"_id":"themes/next/layout/_macro/post.swig","hash":"14d275e353256ce5b44e20566b5986b349669747","modified":1557371756873},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"480d93619479dcfcbec6906803bb38b2dfbeae53","modified":1557370741996},{"_id":"themes/next/layout/_partials/comments.swig","hash":"d0b9e841d55c974d02f43823a06a2627f8e46431","modified":1557368504356},{"_id":"themes/next/layout/_partials/footer.swig","hash":"9a79dde1412b1b1473380e8b6cacfe1930ed321b","modified":1557368504357},{"_id":"themes/next/layout/_partials/github-banner.swig","hash":"1ad13269b43b900356f3bdab7947d6a86f035a2c","modified":1557368504358},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"914155d5d758306cff405beefd4a07973fd8fc77","modified":1557368504369},{"_id":"themes/next/layout/_partials/post-edit.swig","hash":"dee345054d564dd56f74bb143942d3edd1cb8150","modified":1557368504370},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"cccd93d30787675010b1a74ef02eb5b813ec1d96","modified":1557368504382},{"_id":"themes/next/layout/_scripts/exturl.swig","hash":"c2e8f4b3a2bf991320ecc827dcdc227399ad5b51","modified":1557368504383},{"_id":"themes/next/layout/_scripts/next-boot.swig","hash":"50c3ae6b50f173ae70f8c3312f7c6da1097eb9b6","modified":1557368504384},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"efb3404a3303622f3be60944d9d1926972c5c248","modified":1557368504385},{"_id":"themes/next/layout/_scripts/scroll-cookie.swig","hash":"8a992b7fe42b9c1a5eb9d937b0827aed91586d94","modified":1557368504391},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"4130f995f0c4f81a44266194ecae9df96fad174c","modified":1557368504392},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"87bcb495f7ddd81cc3fe2c2a886e51c08053019b","modified":1557368504407},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"4b93dc7ac0573c402aabcb5c933bbcb893b07c51","modified":1557368504407},{"_id":"themes/next/layout/_third-party/chatra.swig","hash":"87182367d7954457cb2498bbfa9445c03c2d619e","modified":1557368504408},{"_id":"themes/next/layout/_third-party/copy-code.swig","hash":"e0d65688661875200cb4dd401fc5ac833c697f91","modified":1557368504417},{"_id":"themes/next/layout/_third-party/mermaid.swig","hash":"80dfc0879866e6512cb67590a3b2d8741a66f980","modified":1557368504421},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"7db4ad4a8dd5420dad2f6890f5299945df0af970","modified":1557368504421},{"_id":"themes/next/layout/_third-party/pangu.swig","hash":"76f5933925670044ec65b454295ba7e0a8439986","modified":1557368504422},{"_id":"themes/next/layout/_third-party/pdf.swig","hash":"4ae61c7efb16e962385bfe522a38c4d29cdcccbe","modified":1557368504423},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"7cc1294a5fbedf3502688248a433c358339e5ae0","modified":1557368504424},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"c476dc3693a9dd0be2d136a45b0d7fdef55d4d92","modified":1557368504425},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"882cd0b68c493af1b6d945660f9c21085e006ffc","modified":1557368504426},{"_id":"themes/next/layout/_third-party/tidio.swig","hash":"b44010cd577e4d063c3406772938c4b117ec7b7b","modified":1557368504430},{"_id":"themes/next/scripts/filters/exturl.js","hash":"b19c7c1021e57367b3b3bbf5678381017ed5667d","modified":1557368504439},{"_id":"themes/next/scripts/helpers/engine.js","hash":"cdb6152582313268d970ffeef99b4a8a7850f034","modified":1557368504441},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"a40ce6bc852bb4bff8b9f984fa064741dd151e96","modified":1557368504442},{"_id":"themes/next/scripts/tags/button.js","hash":"95a520f6529424a03c7ead6dbfd5e626d672febb","modified":1557368504446},{"_id":"themes/next/scripts/tags/full-image.js","hash":"a6b2264215c555c553b2c5db85fa90678798d0d5","modified":1557368504448},{"_id":"themes/next/scripts/tags/exturl.js","hash":"f9f25905adecfb8be49def4ff3b0b8bbc6955d84","modified":1557368504447},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"4519ab8e6898f2ee90d05cde060375462b937a7d","modified":1557368504446},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"23d839333422375e85d44e476f554faf49973a3c","modified":1557368504449},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"ab4a82a7246265717556c7a42f897430340b88cf","modified":1557368504450},{"_id":"themes/next/scripts/tags/label.js","hash":"fc83f4e1be2c34e81cb79938f4f99973eba1ea60","modified":1557368504451},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"81134494ff0134c0dae1b3815caf6606fccd4e46","modified":1557368504452},{"_id":"themes/next/scripts/tags/note.js","hash":"1fdf4f95810fdb983bfd5ad4c4f13fedd4ea2f8d","modified":1557368504453},{"_id":"themes/next/scripts/tags/pdf.js","hash":"ab995f0fc60d60f637220e2651111b775b8a06de","modified":1557368504453},{"_id":"themes/next/scripts/tags/tabs.js","hash":"72a5adbd8f300bee1d0c289367598ca06b2bed17","modified":1557368504454},{"_id":"themes/next/scripts/tags/video.js","hash":"944293fec96e568d9b09bc1280d5dbc9ee1bbd17","modified":1557368504455},{"_id":"themes/next/source/css/main.styl","hash":"5e7d28bc539e84f8b03e68df82292f7fc0f2d023","modified":1557368504567},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1557368504569},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1557368504570},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1557368504571},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1557368504572},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1557368504573},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1557368504574},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1557368504575},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1557368504576},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1557368504577},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1557368504578},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1557368504579},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1557368504580},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1557368504580},{"_id":"themes/next/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1557368504581},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1557368504583},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1557368504582},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1557368504584},{"_id":"themes/next/source/images/searchicon.png","hash":"025d64ba0160a3a2257dd2b3032b5f7c9dd9b82b","modified":1557368504585},{"_id":"themes/next/source/js/affix.js","hash":"ad343aa406fd8181b5f310434817ce98fc2219e3","modified":1557368504586},{"_id":"themes/next/source/js/algolia-search.js","hash":"84906eeae57bd06744dd20160b93eacf658f97e2","modified":1557368504587},{"_id":"themes/next/source/js/exturl.js","hash":"c48aa4b3c0e578a807fd3661e6cd4f3890777437","modified":1557368504588},{"_id":"themes/next/source/js/js.cookie.js","hash":"f11e84def0352b7dd6393f1b83e55a40ab468686","modified":1557368504589},{"_id":"themes/next/source/js/motion.js","hash":"d0a6d9dbcc57159e54bbb1f683b86632ae0b78f0","modified":1557368504590},{"_id":"themes/next/source/js/next-boot.js","hash":"696a0c2cf158001576d56b48195ec8e39e835b47","modified":1557368504591},{"_id":"themes/next/source/js/post-details.js","hash":"7d309b771e86c7e22ce11cc25625481ef7d5985c","modified":1557368504592},{"_id":"themes/next/source/js/scroll-cookie.js","hash":"c4867626afab749404daf321367f9b6b8e223f69","modified":1557368504595},{"_id":"themes/next/source/js/scrollspy.js","hash":"68d3690152c89e7adb08bb35ec28dbda2bd93686","modified":1557368504596},{"_id":"themes/next/source/js/utils.js","hash":"fed16cd4fa5fac8cb4a63633d1840792a056f2be","modified":1557368504597},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1557368504534},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1557368504534},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1557368504537},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1557368504563},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1557368504566},{"_id":"themes/next/.git/refs/heads/master","hash":"d591ec996e3ef9ea7b8660103296d85235048ca2","modified":1557368504233},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"4eb8e222dc337211efb0d3bbdb5e29af3e6ecdb8","modified":1557368504351},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"25aea3d764b952f3f6d28ab86d7212d138e892df","modified":1557368504352},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"b57bf9c865bed0f22157176a8085de168a1aef77","modified":1557368504360},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"fd079a414ca0f42f4cddd00247a9d5a5f58c4d8e","modified":1557368504360},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"466e69a4b4fbdc57f33e60a16b0d87e494385e21","modified":1557368504361},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"03f669356bbaa70144b743f3312178e1981ac3a8","modified":1557368504363},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"c909f6e96373c151dea325bcddfdd8c9522421b6","modified":1557368504364},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"39c4ad0e36b7c1260da98ba345f7bd72a2ac0f2e","modified":1557368504365},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"e015c7d9b84062b60b15b36be3ef11929dd10943","modified":1557368504366},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"2b905ddd5dea8558c3fd95aacad241da6b6800f4","modified":1557368504367},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"f46699a9daa5fef599733cbab35cb75cf7a05444","modified":1557368504368},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"be6683db6a269d83bb0441d7cf74db63a240fa8a","modified":1557368504371},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"f331ad02beea8990066d32ad6ec9f859672c3615","modified":1557368504372},{"_id":"themes/next/layout/_partials/post/reward.swig","hash":"f62b801c7999da67b4bdca9c5e373b9b5ed039dc","modified":1557368504373},{"_id":"themes/next/layout/_partials/post/wechat-subscriber.swig","hash":"fb7727e8ec63a58238a7206bf70eb273c8879993","modified":1557368504374},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"c609097b95eb6127c2784f47f2230e6e6efc0be2","modified":1557368504379},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"54b43d406cf37932e7b60f46814e864d31b1842c","modified":1557368504380},{"_id":"themes/next/layout/_partials/share/likely.swig","hash":"647e8677d1ccfb3f7918dd3ea2ff7078504a845d","modified":1557368504381},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1557368504375},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"f14e9e8c27af82f1bfe794e252dec0d7e521f503","modified":1557368504376},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1557368504377},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"31245e09ce0465b994cebd94223a531585c4eab4","modified":1557368504378},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"cf87ab778618a32119ec1c4ac2079a51385b1913","modified":1557368504386},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a62c93f19429f159bcf0c2e533ffc619aa399755","modified":1557368504388},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"3c548934b97cc426544947f7a2ae35c270b5e33f","modified":1557368504389},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"7ef07edd2a97a3774229990d2f0a6eefa31bd015","modified":1557368504389},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"828eb9c47f34090c841a2e9a0b3f31b0e4ccf40a","modified":1557368504390},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"66d562b3778dbc839f7c00103bd0099c5d61602a","modified":1557368504394},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"83dd7df11b100bae38c9faab9a478f92149a0315","modified":1557368504395},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"73576c9683d9ad9b124916dc6c660607fe7cc1fa","modified":1557368504396},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"2e1de38f44af00209129d4051b7ae307cb11ad68","modified":1557368504397},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"335005a9f8b36349f0ad0a7beeba6969c55fc7f7","modified":1557368504398},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"53202062267391353d49f269e7eb74eb87d30921","modified":1557368504399},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"8ab040fccba41675bc835973515530af8a51f8bd","modified":1557368504400},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"54d7993ae773573ee103c22802b7e98b193e1a3a","modified":1557368504400},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"623e73bedef067ac24a398ef27c8197295da872d","modified":1557368504401},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"39928f358dd13d9fc1a4641800e57be157ecd815","modified":1557368504402},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"71fb01bcad43bc9410ab19190373b9f7e59215b5","modified":1557368504403},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"d18c87d7839e7407e39acd2998bcc9e0b34611b0","modified":1557368504404},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"a22d1ea29a5ffe46199ab7d108a291a05af8d5b6","modified":1557368504405},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"4cff8bf5c42c62f7f0ac1f0d70f839dae39ba77a","modified":1557368504406},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"bc3fc9d053b3d1fc0cd3918bf9a629a6f38f6414","modified":1557368504410},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"d685df1516cb138d7a83bac5d7878a1e0fa8bc04","modified":1557368504410},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"8b4a94dd80b3bac7c5390c8a7fd377b88c2cb78e","modified":1557368504411},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"4e86e1ace90a70bb8862f5e6de9dbe7bfc046bee","modified":1557368504412},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"9a4923d2aa5182531ea7a7fb9abe824450026208","modified":1557368504413},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"b3818fd0b3028dadf341b6d0b180e1243683de6a","modified":1557368504414},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"1a5d94f5779a2ce13abc886dd78e0617f89c34b9","modified":1557368504415},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"43a20fa0e9ae2f4254f04813f9c619dd36b49ae5","modified":1557368504418},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"1b72c755101c9dfb85da13df9a0abccf37cd1dd2","modified":1557368504416},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"ea1c136f960667a0a13b334db497b9b19c41f629","modified":1557368504419},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"767ba29f258db5d2e5baf875a6f36ac1d44df6a3","modified":1557368504420},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"143ef265c96a8ea2fb93c36c5ffb9c5e940f7693","modified":1557368504428},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"078bd2d5815eb23e8c5f74467dc0042babea00ae","modified":1557368504428},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"d45ca53af17d1d83fd27f8ed0917a72f0060e1a9","modified":1557368504430},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1557368504532},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1557368504534},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"1aabac9e37a8f4451c86d09037b3a1f8b30eaf5e","modified":1557368504535},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"21a14a19149f1cb8e011c477f29dd1352675605b","modified":1557368504536},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"e9b0752f08398709e787546a246baca12b4c557f","modified":1557368504562},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"a25408534f8fe6e321db4bbf9dd03335d648fe17","modified":1557368504563},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"da7049f3d9a157abe0ecc62611edcf43605ba84d","modified":1557368504564},{"_id":"themes/next/source/js/schemes/muse.js","hash":"ccc0c5cd4ec6f8159c98990ad83f11a5c0b0234c","modified":1557368504593},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"3eea56cc9ce47bb4760930c4c69cebf847a7fbb2","modified":1557368504594},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1557368504599},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1557368504600},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1557368504601},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1557368504602},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1557368504603},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1557368504618},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1557368504620},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1557368504621},{"_id":"themes/next/source/css/_variables/base.styl","hash":"ebc95eeb8966d17cdc7dd0de009deaef1fe65064","modified":1557368504565},{"_id":"themes/next/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1557368504614},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"c0d77a5a0fb3d3f80e78686adf52e02d2bce4f50","modified":1557368504237},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1557368504225},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"5c0ca7f801859cff254d2f5b7d1a70d66ff61a8d","modified":1557368504458},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"463817cbbd804ce134cb3e7e721431cb0e1616f2","modified":1557368504459},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"9fd526db0527c71243f05e18086f937dc67b1c3e","modified":1557368504460},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1557368504460},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"997058180065d986e05df72992cc2cbfd7febd7e","modified":1557368504461},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"a4c6ee546a94fd69e5b7a1e4c054ab8cacb73d2a","modified":1557368504480},{"_id":"themes/next/source/css/_common/components/rainbow.styl","hash":"cfa64bd8ee2ff9f943673e339d69341e76fbf031","modified":1557368504496},{"_id":"themes/next/source/css/_common/components/scrollbar.styl","hash":"afdd21533db18d846e1a2663b1199761b1bd2c1e","modified":1557368504496},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"1a4ac0d119f2126ef8951897338706edce112235","modified":1557368504525},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"40144394fdfe05d400f39f6763f66f75479a2e34","modified":1557368504526},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"35c6fd7eab3779bd9e38b7ba8825ab0c67a1be7a","modified":1557368504527},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"9c6194177533619a6f6685dc7e890dcbec456241","modified":1557368504528},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"fec36a14080104b5862e9f021eab117d87c5f7c5","modified":1557368504529},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1557368504530},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"107f42aa590ec4ba0765a0bc5d735f0f09edc0ff","modified":1557368504531},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"a609ff811f2b2764f5470236fe2fb1f3aa6ccba5","modified":1557368504538},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"d0e9065b0dbbc01811259f0597d1790268b4881b","modified":1557368504540},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"8da8416213127595dfc4d2b358639194647e7bd3","modified":1557368504540},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1557368504541},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"40f266e24af4dedc9497056ab18ebcfda38dd47d","modified":1557368504542},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"06d9d00257abd28414ec0b746f866bf9911cf5ec","modified":1557368504543},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"6aee54cd5a20181e18596565356bd54c66e33823","modified":1557368504544},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"25f05ed8da68d034dce7f06e0f20f6cd55841070","modified":1557368504545},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"04706657af638f2746ae59520e6fc78577c7682c","modified":1557368504549},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"157e6915dcf5990566e463acffa71043b2651c07","modified":1557368504550},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"234b44cfd03f9c9e3e179ff5fd698ac876341913","modified":1557368504551},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"6aee54cd5a20181e18596565356bd54c66e33823","modified":1557368504552},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"5dbc0d0c897e46760e5dbee416530d485c747bba","modified":1557368504552},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"b9619c9827f969ca2e2f5878552362a7b858918f","modified":1557368504555},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"e73d6da74c5755442e831d8fd7d922c5b32bd892","modified":1557368504556},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"0b3001909f3446843b226030524ea8498d4d8997","modified":1557368504557},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"5b5e0a02a7bf63de9efcd33a4e482939cce5822d","modified":1557368504558},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"0d6f0df798449b710e1e5dbd43d470089b2a3c95","modified":1557368504559},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"adb7379f3b9001840eb38b260434e89365771a81","modified":1557368504561},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1557368504604},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1557368504605},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1557368504607},{"_id":"themes/next/.git/objects/pack/pack-3ff1860f2d88657d5cdfaa358ef938b1c6a98ef8.idx","hash":"eb5a809d50929e92052da8762ad761934a31372c","modified":1557368504175},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1557368504612},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1557368504617},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"c0d77a5a0fb3d3f80e78686adf52e02d2bce4f50","modified":1557368504225},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"2df409df04fdb52d7234876a9f6e502edd4e3929","modified":1557368504463},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"a8f4d4b86acaa34c99111b2dde5d0779cc7e0de6","modified":1557368504464},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"c9cfb4b99e1ec8ec9cf075cb761b8f7fa5fe63fd","modified":1557368504465},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1557368504466},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"33200f60bd6a8bbfc66dd49a239bcc75c2f564c1","modified":1557368504467},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"b8647d6140141b0a160607f6353e4d4594cca92e","modified":1557368504467},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"3a0efe849587b34f20d4e260028dc799215b0bb3","modified":1557368504468},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"024e8ff40ca881c6fbf45712897e22f58a3811ab","modified":1557368504470},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"9c1a082e6c1f96187a099c3f4cb5424c0c9fd06e","modified":1557368504471},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1557368504472},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"e5a5f8747fdf2ca960e4e73c081b8952afd62224","modified":1557368504473},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"fa1cea6fcc3f552d57cc7d28380a304859139bf6","modified":1557368504474},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"9a8fb61bd2d184de9d206e62ba8961d1845c5669","modified":1557368504476},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1557368504477},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"c27527cdeb9e3a9f447f7238f442a5dc33fde4e6","modified":1557368504478},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1557368504475},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"c97c819a65f6967485184399397601e5133deda6","modified":1557368504479},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"62fbbd32cf5a99ae550c45c763a2c4813a138d01","modified":1557368504481},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"f3b0d259e991ac86454ae5eac6bc94dc8691d8c9","modified":1557368504482},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"fc94dd09b4245143b452d6cf2fc4c12134d99d6d","modified":1557368504483},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a73346f999b31355075cd58637946a8950cf6f7e","modified":1557368504484},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"f14cefc99309934d4103a3aa785e1258d858813f","modified":1557368504485},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"d77f85d3af2d7090d84b28ab01c6a49f92eec647","modified":1557368504486},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"b6a241626783d2ac115d683fd59ec283af68e5bb","modified":1557368504486},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"13d365ee626c01f17ec664b3f54f51d8b9ee7cf4","modified":1557368504487},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"4aad8e36178faaa71a767af0084d578df4c09f73","modified":1557368504488},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"ccd0b1309acff0c676fdcc848a8ae2d05f0369ab","modified":1557368504489},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1557368504490},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1557368504491},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"539fc0880b2e035e8316d5d4b423703195c1b7ba","modified":1557368504492},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"c8009fd9598a661b7d23158b5121b6ac266939e9","modified":1557368504493},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"981795aad232c8bd3f52a0ed8720db696d18a234","modified":1557368504494},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"615fca7dff197a2ca3df674cf963ce70b8525985","modified":1557368504495},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"ab1776c5dc537beabb0ab81a0f04e08bebad070b","modified":1557368504499},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"a5484d8436b2b7862faf6e7309a9e7b88cdd0027","modified":1557368504498},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"03a4e75e963e3e7cc393d588b1495a88d52e0e40","modified":1557368504500},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-button.styl","hash":"b36eea093bd4b32056b5de6f370ff57e50b25a49","modified":1557368504501},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"e58bb8b7127aa21e8260493a425ec00fcb25d338","modified":1557368504502},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"7e2ba73073daaea0a18c3d67ff137dd683af7011","modified":1557368504503},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"9204c79c05d620ecd5d411cdf11e27441b6281dc","modified":1557368504504},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"0eadef0381f696de7f88d7dc5f0ddc3cd5d309b3","modified":1557368504504},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"3cb387fa70017f3c24a1a1884461d29deda54585","modified":1557368504505},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"ed3a2960ebce7396d1893bb8e08c99c7d9259140","modified":1557368504506},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"fde59300ec38868676ff5ed495b9dc9b02d07ffc","modified":1557368504507},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"2d58ad90f148e845bc7023751a7a13260600f8d6","modified":1557368504508},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1557368504509},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"b43421291bf85b589e8d0ec853e238d36ab80631","modified":1557368504510},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"020fac447d7a17c03e2802f0f724ae0738088354","modified":1557368504511},{"_id":"themes/next/source/css/_common/components/tags/pdf.styl","hash":"3baeeb51cfe123e99235ee1816d0e1f6a97c7852","modified":1557368504511},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"54c5398c7bf5b8bd9f38a9ece1dd82a9255f9a30","modified":1557368504512},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"da7a21f5a2f7dcf4c5a4788d7670159ca4132b65","modified":1557368504513},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"4305813408a1cd6aba764a7769b94b081d383d4f","modified":1557368504515},{"_id":"themes/next/source/css/_common/components/third-party/copy-code.styl","hash":"d9c244b1c3a09a7fccd3c3f732e6fb112a8cd565","modified":1557368504516},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"a01484e350ad5fc9b1fdfbfafb2ddd9687ad4d20","modified":1557368504517},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"2fbe52f955da41c7a14eb09918bf86a252e4504f","modified":1557368504518},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"2a1008f1044b450b806adc166754ba9513e68375","modified":1557368504519},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"ed8a12982c0497eeb9d7642781abeb801428f83d","modified":1557368504520},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"6880467b4f6d7b057fb8291aa10966429a0a3bff","modified":1557368504521},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"35dc9f3990fadff3ea038d4e8ac75923219886ed","modified":1557368504522},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"9801977a23268e36c5deefd270423f6f1a0c3bb2","modified":1557368504522},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"7cf42f96ba6b249c75e00dad251ebacf7de61e6c","modified":1557368504523},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1557368504546},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1557368504548},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1557368504554},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1557368504611},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1557368504610},{"_id":"themes/next/.git/objects/pack/pack-3ff1860f2d88657d5cdfaa358ef938b1c6a98ef8.pack","hash":"6c5e160004a814b81c60395385d0aeed58ae683a","modified":1557368504179},{"_id":"themes/next/.git/objects/d6/26ee798f012fa877005863389779ee0a6d95d6","hash":"1dad394f7ee9e7397149419e03d40a1812b7f528","modified":1557371981157},{"_id":"themes/next/.git/objects/b9/dee6aab3a82f909332bb98a27311754942670f","hash":"92e58b9e7b215ee5ef6f6fe168124ca2bdf45e77","modified":1557371981151},{"_id":"themes/next/.git/objects/b2/tmp_obj_uzGUDb","hash":"f98c03063250385850f1f9b51439ddf2b238c466","modified":1557372094070},{"_id":"themes/next/.git/objects/99/ad53e74df950219a260a168c51fc9e67234fb6","hash":"647b31852bab1ccd0de61752ef09d13c4821a5ef","modified":1557372094085},{"_id":"themes/next/.git/objects/9d/833c2ade26266c4531cbc563873901c0de4aaa","hash":"a2bd8bb74e23dd749a18f9f5f96b8129d096c270","modified":1557372094093}],"Category":[{"name":"Java成神之路","_id":"cjvg26t80003kgcoid578a6xj"}],"Data":[],"Page":[{"_content":"google-site-verification: googlee0755d86d3b42c82.html","source":"googlee0755d86d3b42c82.html","raw":"google-site-verification: googlee0755d86d3b42c82.html","date":"2018-11-21T07:11:44.756Z","updated":"2018-11-21T07:11:44.756Z","path":"googlee0755d86d3b42c82.html","title":"","comments":1,"layout":"page","_id":"cjvg26szl0000gcoigkt4u5e8","content":"google-site-verification: googlee0755d86d3b42c82.html","site":{"data":{}},"excerpt":"","more":"google-site-verification: googlee0755d86d3b42c82.html"},{"_content":"<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\"\n          content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>梦语仙境</title>\n</head>\n<body>\n<script type=\"text/javascript\" src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\" charset=\"utf-8\" homePageUrl=\"http://wangjianchao.cn\" homePageName=\"回到我的主页\"></script>\n</body>\n</html>","source":"404/index.html","raw":"<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\"\n          content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>梦语仙境</title>\n</head>\n<body>\n<script type=\"text/javascript\" src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\" charset=\"utf-8\" homePageUrl=\"http://wangjianchao.cn\" homePageName=\"回到我的主页\"></script>\n</body>\n</html>","date":"2018-01-16T06:46:45.446Z","updated":"2018-01-16T06:46:45.430Z","path":"404/index.html","title":"","comments":1,"layout":"page","_id":"cjvg26t160001gcoi0w04dmxg","content":"<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>梦语仙境</title>\n</head>\n<body>\n<script type=\"text/javascript\" src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\" charset=\"utf-8\" homepageurl=\"http://wangjianchao.cn\" homepagename=\"回到我的主页\"></script>\n</body>\n</html>","site":{"data":{}},"excerpt":"","more":"<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>梦语仙境</title>\n</head>\n<body>\n<script type=\"text/javascript\" src=\"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js\" charset=\"utf-8\" homepageurl=\"http://wangjianchao.cn\" homepagename=\"回到我的主页\"></script>\n</body>\n</html>"},{"title":"关于我","date":"2016-10-18T15:16:06.000Z","comments":0,"_content":"\n\n我的微博: [TinyKing](http://weibo.com/tinyking86)\n\n我的博客园：[博客园TinyKing](http://www.cnblogs.com/tinyking)\n\n我的51CTO: [TinyKing](http://tinyking.blog.51cto.com)\n\n我的微信：![TingKiny](http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg)","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2016-10-18 23:16:06\ncomments: false\n---\n\n\n我的微博: [TinyKing](http://weibo.com/tinyking86)\n\n我的博客园：[博客园TinyKing](http://www.cnblogs.com/tinyking)\n\n我的51CTO: [TinyKing](http://tinyking.blog.51cto.com)\n\n我的微信：![TingKiny](http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg)","updated":"2018-01-16T06:08:44.661Z","path":"about/index.html","layout":"page","_id":"cjvg26t1b0003gcoiskwdugb5","content":"<p>我的微博: <a href=\"http://weibo.com/tinyking86\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的博客园：<a href=\"http://www.cnblogs.com/tinyking\" target=\"_blank\" rel=\"noopener\">博客园TinyKing</a></p>\n<p>我的51CTO: <a href=\"http://tinyking.blog.51cto.com\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的微信：<img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg\" alt=\"TingKiny\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>我的微博: <a href=\"http://weibo.com/tinyking86\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的博客园：<a href=\"http://www.cnblogs.com/tinyking\" target=\"_blank\" rel=\"noopener\">博客园TinyKing</a></p>\n<p>我的51CTO: <a href=\"http://tinyking.blog.51cto.com\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的微信：<img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg\" alt=\"TingKiny\"></p>\n"},{"title":"分类","date":"2018-01-16T06:11:13.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2018-01-16 14:11:13\ntype: \"categories\"\n---","updated":"2018-01-26T03:23:10.880Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjvg26t7r003agcoisjdvt3g1","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"标签","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ntype: \"tags\"\ncomments: false\n---\n","date":"2018-01-16T06:08:44.662Z","updated":"2018-01-16T06:08:44.662Z","path":"tags/index.html","layout":"page","_id":"cjvg26t7t003cgcoizpoeo6rv","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"设置Spring Boot项目使用Run Dashboard运行","date":"2018-10-17T01:24:30.000Z","_content":"\n最近在做基于Spring cloud的微服务开发，开发过程中，要启动很多Spring Boot项目，Idea提供了`Run Dashboard`功能，来方便管理Spring Boot项目。\n\n![](http://ww1.sinaimg.cn/large/806e3151ly1fwazgrcb0yj20gc095t8t.jpg)\n\n通常Idea会自动提示是否要用`Run Dashboard`管理。\n\n如果没有自动提示，可以手动打开`view >> Tool Windows >> Run Dashboard`\n![](http://ww1.sinaimg.cn/large/806e3151ly1fwazjtuwvuj20f80gz0to.jpg)\n\n如果还没有找到`Run Dashboard`，就需要手动添加，打开workspace.xml，找到`<component name=\"RunDashboard\">`，将其设置成如下：\n\n```xml\n<component name=\"RunDashboard\">\n    <option name=\"configurationTypes\">\n        <set>\n        <option value=\"SpringBootApplicationConfigurationType\" />\n        </set>\n    </option>\n    <option name=\"ruleStates\">\n        <list>\n        <RuleState>\n            <option name=\"name\" value=\"ConfigurationTypeDashboardGroupingRule\" />\n        </RuleState>\n        <RuleState>\n            <option name=\"name\" value=\"StatusDashboardGroupingRule\" />\n        </RuleState>\n        </list>\n    </option>\n</component>\n```","source":"_posts/0002-config-springboot-dashboard.md","raw":"---\ntitle: 设置Spring Boot项目使用Run Dashboard运行\ndate: 2018-10-17 09:24:30\ntags:\n    - idea\n---\n\n最近在做基于Spring cloud的微服务开发，开发过程中，要启动很多Spring Boot项目，Idea提供了`Run Dashboard`功能，来方便管理Spring Boot项目。\n\n![](http://ww1.sinaimg.cn/large/806e3151ly1fwazgrcb0yj20gc095t8t.jpg)\n\n通常Idea会自动提示是否要用`Run Dashboard`管理。\n\n如果没有自动提示，可以手动打开`view >> Tool Windows >> Run Dashboard`\n![](http://ww1.sinaimg.cn/large/806e3151ly1fwazjtuwvuj20f80gz0to.jpg)\n\n如果还没有找到`Run Dashboard`，就需要手动添加，打开workspace.xml，找到`<component name=\"RunDashboard\">`，将其设置成如下：\n\n```xml\n<component name=\"RunDashboard\">\n    <option name=\"configurationTypes\">\n        <set>\n        <option value=\"SpringBootApplicationConfigurationType\" />\n        </set>\n    </option>\n    <option name=\"ruleStates\">\n        <list>\n        <RuleState>\n            <option name=\"name\" value=\"ConfigurationTypeDashboardGroupingRule\" />\n        </RuleState>\n        <RuleState>\n            <option name=\"name\" value=\"StatusDashboardGroupingRule\" />\n        </RuleState>\n        </list>\n    </option>\n</component>\n```","slug":"0002-config-springboot-dashboard","published":1,"updated":"2018-10-17T02:00:11.001Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t170002gcoigwoviy89","content":"<p>最近在做基于Spring cloud的微服务开发，开发过程中，要启动很多Spring Boot项目，Idea提供了<code>Run Dashboard</code>功能，来方便管理Spring Boot项目。</p>\n<p><img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fwazgrcb0yj20gc095t8t.jpg\" alt=\"\"></p>\n<p>通常Idea会自动提示是否要用<code>Run Dashboard</code>管理。</p>\n<p>如果没有自动提示，可以手动打开<code>view &gt;&gt; Tool Windows &gt;&gt; Run Dashboard</code><br><img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fwazjtuwvuj20f80gz0to.jpg\" alt=\"\"></p>\n<p>如果还没有找到<code>Run Dashboard</code>，就需要手动添加，打开workspace.xml，找到<code>&lt;component name=&quot;RunDashboard&quot;&gt;</code>，将其设置成如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">component</span> <span class=\"attr\">name</span>=<span class=\"string\">\"RunDashboard\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"configurationTypes\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">set</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">\"SpringBootApplicationConfigurationType\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">set</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ruleStates\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"ConfigurationTypeDashboardGroupingRule\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"StatusDashboardGroupingRule\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>最近在做基于Spring cloud的微服务开发，开发过程中，要启动很多Spring Boot项目，Idea提供了<code>Run Dashboard</code>功能，来方便管理Spring Boot项目。</p>\n<p><img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fwazgrcb0yj20gc095t8t.jpg\" alt=\"\"></p>\n<p>通常Idea会自动提示是否要用<code>Run Dashboard</code>管理。</p>\n<p>如果没有自动提示，可以手动打开<code>view &gt;&gt; Tool Windows &gt;&gt; Run Dashboard</code><br><img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fwazjtuwvuj20f80gz0to.jpg\" alt=\"\"></p>\n<p>如果还没有找到<code>Run Dashboard</code>，就需要手动添加，打开workspace.xml，找到<code>&lt;component name=&quot;RunDashboard&quot;&gt;</code>，将其设置成如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">component</span> <span class=\"attr\">name</span>=<span class=\"string\">\"RunDashboard\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"configurationTypes\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">set</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">value</span>=<span class=\"string\">\"SpringBootApplicationConfigurationType\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">set</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ruleStates\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"ConfigurationTypeDashboardGroupingRule\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">option</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"StatusDashboardGroupingRule\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">RuleState</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"Angular中的自定义异步验证器","date":"2018-10-25T01:24:30.000Z","_content":"\n在实际工作中，我们经常需要一个基于后端API验证值的验证器。为此，Angular提供了一种定义自定义异步验证器的简便方法。\n\n本文将介绍如何为Angular应用程序创建自定义异步验证器。\n\n通常你会调用一个真正的后端，但是在这里我们将创建一个虚拟的JSON文件，我们可以通过使用Http服务来调用它。如果正在使用Angular CLI，则可以将JSON文件放在/assets文件夹中，它将自动可用；\n\n`/assets/users.json`\n\n```json\n[\n  { \"name\": \"Paul\", \"email\": \"paul@example.com\" },\n  { \"name\": \"Ringo\", \"email\": \"ringo@example.com\" },\n  { \"name\": \"John\", \"email\": \"john@example.com\" },\n  { \"name\": \"George\", \"email\": \"george@example.com\" }\n]\n```\n\n# 注册服务\n\n接下来，让我们创建一个具有`checkEmailNotTaken`方法的服务，该方法触发对我们的JSON文件的http GET调用。这里我们使用`RxJS`的延迟运算符来模拟一些延迟：\n\n`signup.service.ts`\n\n```typescript\nimport { Injectable } from '@angular/core';\nimport { Http } from '@angular/http';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/operator/map';\nimport 'rxjs/add/operator/filter';\nimport 'rxjs/add/operator/delay';\n\n@Injectable()\nexport class SignupService {\n  constructor(private http: Http) {}\n\n  checkEmailNotTaken(email: string) {\n    return this.http\n      .get('assets/users.json')\n      .delay(1000)\n      .map(res => res.json())\n      .map(users => users.filter(user => user.email === email))\n      .map(users => !users.length);\n  }\n}\n```\n\n请注意我们如何筛选与提供给方法的用户具有相同电子邮件的用户。然后我们再次映射结果并进行测试以确保我们得到一个空置对象。\n\n在真实场景中，您可能还想使用debounceTime和distinctUntilChanged运算符的组合，如我们在创建实时搜索的帖子中所讨论的。引入一些这样的去抖动将有助于将发送到后端API的请求数量保持在最低水平。\n\n## 组件和异步验证器\n\n我们的简单组件初始化我们的反应形式并定义我们的异步验证器：*validateEmailNotTaken*。请注意我们的`FormBuilder.group`声明中的表单控件如何将异步验证器作为第三个参数。这里我们只使用一个异步验证器，但是你想在数组中包含多个异步验证器：\n\napp.component.ts\n\n```typescript\nimport { Component, OnInit } from '@angular/core';\nimport {\n  FormBuilder,\n  FormGroup,\n  Validators,\n  AbstractControl\n} from '@angular/forms';\n\nimport { SignupService } from './signup.service';\n\n@Component({ ... })\nexport class AppComponent implements OnInit {\n  myForm: FormGroup;\n\n  constructor(\n    private fb: FormBuilder,\n    private signupService: SignupService\n  ) {}\n\n  ngOnInit() {\n    this.myForm = this.fb.group({\n      name: ['', Validators.required],\n      email: [\n        '',\n        [Validators.required, Validators.email],\n        this.validateEmailNotTaken.bind(this)\n      ]\n    });\n  }\n\n  validateEmailNotTaken(control: AbstractControl) {\n    return this.signupService.checkEmailNotTaken(control.value).map(res => {\n      return res ? null : { emailTaken: true };\n    });\n  }\n}\n```\n\n我们的验证器与典型的自定义验证器非常相似。这里我们直接在组件类中定义了验证器而不是单独的文件。这样可以更轻松地访问我们注入的服务实例。另请注意我们如何绑定**此**值以确保它指向组件类。\n\n我们还可以在自己的文件中定义我们的异步验证器，以便更容易地重用和分离关注点。唯一棘手的部分是找到一种方法来提供我们的服务实例。在这里，例如，我们创建一个具有*createValidator*静态方法的类，该方法接收我们的服务实例并返回我们的验证器函数：\n\n/validators/async-email.validator.ts\n\n```\nimport { AbstractControl } from '@angular/forms';\nimport { SignupService } from '../signup.service';\n\nexport class ValidateEmailNotTaken {\n  static createValidator(signupService: SignupService) {\n    return (control: AbstractControl) => {\n      return signupService.checkEmailNotTaken(control.value).map(res => {\n        return res ? null : { emailTaken: true };\n      });\n    };\n  }\n}\n```\n\n然后，回到我们的组件中，我们导入*ValidateEmailNotTaken*类，我们可以使用这样的验证器：\n\n```\nngOnInit() {\n  this.myForm = this.fb.group({\n    name: ['', Validators.required],\n    email: [\n      '',\n      [Validators.required, Validators.email],\n      ValidateEmailNotTaken.createValidator(this.signupService)\n    ]\n  });\n}\n```\n\n## 模板\n\n在模板中，事情真的很简单：\n\napp.component.html\n\n```\n<form [formGroup]=\"myForm\">\n  <input type=\"text\" formControlName=\"name\">\n  <input type=\"email\" formControlName=\"email\">\n\n  <div *ngIf=\"myForm.get('email').status === 'PENDING'\">\n    Checking...\n  </div>\n  <div *ngIf=\"myForm.get('email').status === 'VALID'\">\n    😺 Email is available!\n  </div>\n\n  <div *ngIf=\"myForm.get('email').errors && myForm.get('email').errors.emailTaken\">\n    😢 Oh noes, this email is already taken!\n  </div>\n</form>\n```\n\n您可以看到我们根据*电子邮件*表单控件上status属性的值显示不同的消息。对于可能的值**状态**是*VALID*，*INVALID*，*PENDING*和*禁用*。如果异步验证错误输出我们的*emailTaken*错误，我们也会显示错误消息。\n\n使用异步验证器验证的表单字段在验证*待处理*时也将具有*ng-pending*类。这样可以轻松设置当前待验证字段的样式。\n\n✨你有它！使用后端API检查有效性的简便方法。\n","source":"_posts/0003-custom-async-validators-in-angular.md","raw":"---\ntitle: Angular中的自定义异步验证器\ndate: 2018-10-25 09:24:30\ntags:\n    - angular\n---\n\n在实际工作中，我们经常需要一个基于后端API验证值的验证器。为此，Angular提供了一种定义自定义异步验证器的简便方法。\n\n本文将介绍如何为Angular应用程序创建自定义异步验证器。\n\n通常你会调用一个真正的后端，但是在这里我们将创建一个虚拟的JSON文件，我们可以通过使用Http服务来调用它。如果正在使用Angular CLI，则可以将JSON文件放在/assets文件夹中，它将自动可用；\n\n`/assets/users.json`\n\n```json\n[\n  { \"name\": \"Paul\", \"email\": \"paul@example.com\" },\n  { \"name\": \"Ringo\", \"email\": \"ringo@example.com\" },\n  { \"name\": \"John\", \"email\": \"john@example.com\" },\n  { \"name\": \"George\", \"email\": \"george@example.com\" }\n]\n```\n\n# 注册服务\n\n接下来，让我们创建一个具有`checkEmailNotTaken`方法的服务，该方法触发对我们的JSON文件的http GET调用。这里我们使用`RxJS`的延迟运算符来模拟一些延迟：\n\n`signup.service.ts`\n\n```typescript\nimport { Injectable } from '@angular/core';\nimport { Http } from '@angular/http';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/operator/map';\nimport 'rxjs/add/operator/filter';\nimport 'rxjs/add/operator/delay';\n\n@Injectable()\nexport class SignupService {\n  constructor(private http: Http) {}\n\n  checkEmailNotTaken(email: string) {\n    return this.http\n      .get('assets/users.json')\n      .delay(1000)\n      .map(res => res.json())\n      .map(users => users.filter(user => user.email === email))\n      .map(users => !users.length);\n  }\n}\n```\n\n请注意我们如何筛选与提供给方法的用户具有相同电子邮件的用户。然后我们再次映射结果并进行测试以确保我们得到一个空置对象。\n\n在真实场景中，您可能还想使用debounceTime和distinctUntilChanged运算符的组合，如我们在创建实时搜索的帖子中所讨论的。引入一些这样的去抖动将有助于将发送到后端API的请求数量保持在最低水平。\n\n## 组件和异步验证器\n\n我们的简单组件初始化我们的反应形式并定义我们的异步验证器：*validateEmailNotTaken*。请注意我们的`FormBuilder.group`声明中的表单控件如何将异步验证器作为第三个参数。这里我们只使用一个异步验证器，但是你想在数组中包含多个异步验证器：\n\napp.component.ts\n\n```typescript\nimport { Component, OnInit } from '@angular/core';\nimport {\n  FormBuilder,\n  FormGroup,\n  Validators,\n  AbstractControl\n} from '@angular/forms';\n\nimport { SignupService } from './signup.service';\n\n@Component({ ... })\nexport class AppComponent implements OnInit {\n  myForm: FormGroup;\n\n  constructor(\n    private fb: FormBuilder,\n    private signupService: SignupService\n  ) {}\n\n  ngOnInit() {\n    this.myForm = this.fb.group({\n      name: ['', Validators.required],\n      email: [\n        '',\n        [Validators.required, Validators.email],\n        this.validateEmailNotTaken.bind(this)\n      ]\n    });\n  }\n\n  validateEmailNotTaken(control: AbstractControl) {\n    return this.signupService.checkEmailNotTaken(control.value).map(res => {\n      return res ? null : { emailTaken: true };\n    });\n  }\n}\n```\n\n我们的验证器与典型的自定义验证器非常相似。这里我们直接在组件类中定义了验证器而不是单独的文件。这样可以更轻松地访问我们注入的服务实例。另请注意我们如何绑定**此**值以确保它指向组件类。\n\n我们还可以在自己的文件中定义我们的异步验证器，以便更容易地重用和分离关注点。唯一棘手的部分是找到一种方法来提供我们的服务实例。在这里，例如，我们创建一个具有*createValidator*静态方法的类，该方法接收我们的服务实例并返回我们的验证器函数：\n\n/validators/async-email.validator.ts\n\n```\nimport { AbstractControl } from '@angular/forms';\nimport { SignupService } from '../signup.service';\n\nexport class ValidateEmailNotTaken {\n  static createValidator(signupService: SignupService) {\n    return (control: AbstractControl) => {\n      return signupService.checkEmailNotTaken(control.value).map(res => {\n        return res ? null : { emailTaken: true };\n      });\n    };\n  }\n}\n```\n\n然后，回到我们的组件中，我们导入*ValidateEmailNotTaken*类，我们可以使用这样的验证器：\n\n```\nngOnInit() {\n  this.myForm = this.fb.group({\n    name: ['', Validators.required],\n    email: [\n      '',\n      [Validators.required, Validators.email],\n      ValidateEmailNotTaken.createValidator(this.signupService)\n    ]\n  });\n}\n```\n\n## 模板\n\n在模板中，事情真的很简单：\n\napp.component.html\n\n```\n<form [formGroup]=\"myForm\">\n  <input type=\"text\" formControlName=\"name\">\n  <input type=\"email\" formControlName=\"email\">\n\n  <div *ngIf=\"myForm.get('email').status === 'PENDING'\">\n    Checking...\n  </div>\n  <div *ngIf=\"myForm.get('email').status === 'VALID'\">\n    😺 Email is available!\n  </div>\n\n  <div *ngIf=\"myForm.get('email').errors && myForm.get('email').errors.emailTaken\">\n    😢 Oh noes, this email is already taken!\n  </div>\n</form>\n```\n\n您可以看到我们根据*电子邮件*表单控件上status属性的值显示不同的消息。对于可能的值**状态**是*VALID*，*INVALID*，*PENDING*和*禁用*。如果异步验证错误输出我们的*emailTaken*错误，我们也会显示错误消息。\n\n使用异步验证器验证的表单字段在验证*待处理*时也将具有*ng-pending*类。这样可以轻松设置当前待验证字段的样式。\n\n✨你有它！使用后端API检查有效性的简便方法。\n","slug":"0003-custom-async-validators-in-angular","published":1,"updated":"2018-10-25T02:28:38.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1c0004gcoi3jt4jyf0","content":"<p>在实际工作中，我们经常需要一个基于后端API验证值的验证器。为此，Angular提供了一种定义自定义异步验证器的简便方法。</p>\n<p>本文将介绍如何为Angular应用程序创建自定义异步验证器。</p>\n<p>通常你会调用一个真正的后端，但是在这里我们将创建一个虚拟的JSON文件，我们可以通过使用Http服务来调用它。如果正在使用Angular CLI，则可以将JSON文件放在/assets文件夹中，它将自动可用；</p>\n<p><code>/assets/users.json</code></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Paul\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"paul@example.com\"</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Ringo\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"ringo@example.com\"</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"John\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"john@example.com\"</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"George\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"george@example.com\"</span> &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h1 id=\"注册服务\"><a href=\"#注册服务\" class=\"headerlink\" title=\"注册服务\"></a>注册服务</h1><p>接下来，让我们创建一个具有<code>checkEmailNotTaken</code>方法的服务，该方法触发对我们的JSON文件的http GET调用。这里我们使用<code>RxJS</code>的延迟运算符来模拟一些延迟：</p>\n<p><code>signup.service.ts</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Injectable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Http &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/http'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/map'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/filter'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/delay'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SignupService &#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> http: Http</span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  checkEmailNotTaken(email: <span class=\"built_in\">string</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.http</span><br><span class=\"line\">      .get(<span class=\"string\">'assets/users.json'</span>)</span><br><span class=\"line\">      .delay(<span class=\"number\">1000</span>)</span><br><span class=\"line\">      .map(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json())</span><br><span class=\"line\">      .map(<span class=\"function\"><span class=\"params\">users</span> =&gt;</span> users.filter(<span class=\"function\"><span class=\"params\">user</span> =&gt;</span> user.email === email))</span><br><span class=\"line\">      .map(<span class=\"function\"><span class=\"params\">users</span> =&gt;</span> !users.length);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请注意我们如何筛选与提供给方法的用户具有相同电子邮件的用户。然后我们再次映射结果并进行测试以确保我们得到一个空置对象。</p>\n<p>在真实场景中，您可能还想使用debounceTime和distinctUntilChanged运算符的组合，如我们在创建实时搜索的帖子中所讨论的。引入一些这样的去抖动将有助于将发送到后端API的请求数量保持在最低水平。</p>\n<h2 id=\"组件和异步验证器\"><a href=\"#组件和异步验证器\" class=\"headerlink\" title=\"组件和异步验证器\"></a>组件和异步验证器</h2><p>我们的简单组件初始化我们的反应形式并定义我们的异步验证器：<em>validateEmailNotTaken</em>。请注意我们的<code>FormBuilder.group</code>声明中的表单控件如何将异步验证器作为第三个参数。这里我们只使用一个异步验证器，但是你想在数组中包含多个异步验证器：</p>\n<p>app.component.ts</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component, OnInit &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  FormBuilder,</span><br><span class=\"line\">  FormGroup,</span><br><span class=\"line\">  Validators,</span><br><span class=\"line\">  AbstractControl</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/forms'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; SignupService &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./signup.service'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span>(&#123; ... &#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppComponent <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  myForm: FormGroup;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">    <span class=\"keyword\">private</span> fb: FormBuilder,</span></span><br><span class=\"line\"><span class=\"params\">    <span class=\"keyword\">private</span> signupService: SignupService</span></span><br><span class=\"line\"><span class=\"params\">  </span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.myForm = <span class=\"keyword\">this</span>.fb.group(&#123;</span><br><span class=\"line\">      name: [<span class=\"string\">''</span>, Validators.required],</span><br><span class=\"line\">      email: [</span><br><span class=\"line\">        <span class=\"string\">''</span>,</span><br><span class=\"line\">        [Validators.required, Validators.email],</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.validateEmailNotTaken.bind(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  validateEmailNotTaken(control: AbstractControl) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.signupService.checkEmailNotTaken(control.value).map(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> res ? <span class=\"literal\">null</span> : &#123; emailTaken: <span class=\"literal\">true</span> &#125;;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们的验证器与典型的自定义验证器非常相似。这里我们直接在组件类中定义了验证器而不是单独的文件。这样可以更轻松地访问我们注入的服务实例。另请注意我们如何绑定<strong>此</strong>值以确保它指向组件类。</p>\n<p>我们还可以在自己的文件中定义我们的异步验证器，以便更容易地重用和分离关注点。唯一棘手的部分是找到一种方法来提供我们的服务实例。在这里，例如，我们创建一个具有<em>createValidator</em>静态方法的类，该方法接收我们的服务实例并返回我们的验证器函数：</p>\n<p>/validators/async-email.validator.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; AbstractControl &#125; from &apos;@angular/forms&apos;;</span><br><span class=\"line\">import &#123; SignupService &#125; from &apos;../signup.service&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">export class ValidateEmailNotTaken &#123;</span><br><span class=\"line\">  static createValidator(signupService: SignupService) &#123;</span><br><span class=\"line\">    return (control: AbstractControl) =&gt; &#123;</span><br><span class=\"line\">      return signupService.checkEmailNotTaken(control.value).map(res =&gt; &#123;</span><br><span class=\"line\">        return res ? null : &#123; emailTaken: true &#125;;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后，回到我们的组件中，我们导入<em>ValidateEmailNotTaken</em>类，我们可以使用这样的验证器：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ngOnInit() &#123;</span><br><span class=\"line\">  this.myForm = this.fb.group(&#123;</span><br><span class=\"line\">    name: [&apos;&apos;, Validators.required],</span><br><span class=\"line\">    email: [</span><br><span class=\"line\">      &apos;&apos;,</span><br><span class=\"line\">      [Validators.required, Validators.email],</span><br><span class=\"line\">      ValidateEmailNotTaken.createValidator(this.signupService)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"模板\"><a href=\"#模板\" class=\"headerlink\" title=\"模板\"></a>模板</h2><p>在模板中，事情真的很简单：</p>\n<p>app.component.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;form [formGroup]=&quot;myForm&quot;&gt;</span><br><span class=\"line\">  &lt;input type=&quot;text&quot; formControlName=&quot;name&quot;&gt;</span><br><span class=\"line\">  &lt;input type=&quot;email&quot; formControlName=&quot;email&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;div *ngIf=&quot;myForm.get(&apos;email&apos;).status === &apos;PENDING&apos;&quot;&gt;</span><br><span class=\"line\">    Checking...</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;div *ngIf=&quot;myForm.get(&apos;email&apos;).status === &apos;VALID&apos;&quot;&gt;</span><br><span class=\"line\">    😺 Email is available!</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;div *ngIf=&quot;myForm.get(&apos;email&apos;).errors &amp;&amp; myForm.get(&apos;email&apos;).errors.emailTaken&quot;&gt;</span><br><span class=\"line\">    😢 Oh noes, this email is already taken!</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br></pre></td></tr></table></figure>\n<p>您可以看到我们根据<em>电子邮件</em>表单控件上status属性的值显示不同的消息。对于可能的值<strong>状态</strong>是<em>VALID</em>，<em>INVALID</em>，<em>PENDING</em>和<em>禁用</em>。如果异步验证错误输出我们的<em>emailTaken</em>错误，我们也会显示错误消息。</p>\n<p>使用异步验证器验证的表单字段在验证<em>待处理</em>时也将具有<em>ng-pending</em>类。这样可以轻松设置当前待验证字段的样式。</p>\n<p>✨你有它！使用后端API检查有效性的简便方法。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在实际工作中，我们经常需要一个基于后端API验证值的验证器。为此，Angular提供了一种定义自定义异步验证器的简便方法。</p>\n<p>本文将介绍如何为Angular应用程序创建自定义异步验证器。</p>\n<p>通常你会调用一个真正的后端，但是在这里我们将创建一个虚拟的JSON文件，我们可以通过使用Http服务来调用它。如果正在使用Angular CLI，则可以将JSON文件放在/assets文件夹中，它将自动可用；</p>\n<p><code>/assets/users.json</code></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Paul\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"paul@example.com\"</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Ringo\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"ringo@example.com\"</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"John\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"john@example.com\"</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"George\"</span>, <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"george@example.com\"</span> &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h1 id=\"注册服务\"><a href=\"#注册服务\" class=\"headerlink\" title=\"注册服务\"></a>注册服务</h1><p>接下来，让我们创建一个具有<code>checkEmailNotTaken</code>方法的服务，该方法触发对我们的JSON文件的http GET调用。这里我们使用<code>RxJS</code>的延迟运算符来模拟一些延迟：</p>\n<p><code>signup.service.ts</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Injectable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Http &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/http'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/map'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/filter'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/delay'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SignupService &#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> http: Http</span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  checkEmailNotTaken(email: <span class=\"built_in\">string</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.http</span><br><span class=\"line\">      .get(<span class=\"string\">'assets/users.json'</span>)</span><br><span class=\"line\">      .delay(<span class=\"number\">1000</span>)</span><br><span class=\"line\">      .map(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json())</span><br><span class=\"line\">      .map(<span class=\"function\"><span class=\"params\">users</span> =&gt;</span> users.filter(<span class=\"function\"><span class=\"params\">user</span> =&gt;</span> user.email === email))</span><br><span class=\"line\">      .map(<span class=\"function\"><span class=\"params\">users</span> =&gt;</span> !users.length);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请注意我们如何筛选与提供给方法的用户具有相同电子邮件的用户。然后我们再次映射结果并进行测试以确保我们得到一个空置对象。</p>\n<p>在真实场景中，您可能还想使用debounceTime和distinctUntilChanged运算符的组合，如我们在创建实时搜索的帖子中所讨论的。引入一些这样的去抖动将有助于将发送到后端API的请求数量保持在最低水平。</p>\n<h2 id=\"组件和异步验证器\"><a href=\"#组件和异步验证器\" class=\"headerlink\" title=\"组件和异步验证器\"></a>组件和异步验证器</h2><p>我们的简单组件初始化我们的反应形式并定义我们的异步验证器：<em>validateEmailNotTaken</em>。请注意我们的<code>FormBuilder.group</code>声明中的表单控件如何将异步验证器作为第三个参数。这里我们只使用一个异步验证器，但是你想在数组中包含多个异步验证器：</p>\n<p>app.component.ts</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component, OnInit &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  FormBuilder,</span><br><span class=\"line\">  FormGroup,</span><br><span class=\"line\">  Validators,</span><br><span class=\"line\">  AbstractControl</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/forms'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; SignupService &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./signup.service'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span>(&#123; ... &#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppComponent <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  myForm: FormGroup;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">    <span class=\"keyword\">private</span> fb: FormBuilder,</span></span><br><span class=\"line\"><span class=\"params\">    <span class=\"keyword\">private</span> signupService: SignupService</span></span><br><span class=\"line\"><span class=\"params\">  </span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.myForm = <span class=\"keyword\">this</span>.fb.group(&#123;</span><br><span class=\"line\">      name: [<span class=\"string\">''</span>, Validators.required],</span><br><span class=\"line\">      email: [</span><br><span class=\"line\">        <span class=\"string\">''</span>,</span><br><span class=\"line\">        [Validators.required, Validators.email],</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.validateEmailNotTaken.bind(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  validateEmailNotTaken(control: AbstractControl) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.signupService.checkEmailNotTaken(control.value).map(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> res ? <span class=\"literal\">null</span> : &#123; emailTaken: <span class=\"literal\">true</span> &#125;;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们的验证器与典型的自定义验证器非常相似。这里我们直接在组件类中定义了验证器而不是单独的文件。这样可以更轻松地访问我们注入的服务实例。另请注意我们如何绑定<strong>此</strong>值以确保它指向组件类。</p>\n<p>我们还可以在自己的文件中定义我们的异步验证器，以便更容易地重用和分离关注点。唯一棘手的部分是找到一种方法来提供我们的服务实例。在这里，例如，我们创建一个具有<em>createValidator</em>静态方法的类，该方法接收我们的服务实例并返回我们的验证器函数：</p>\n<p>/validators/async-email.validator.ts</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; AbstractControl &#125; from &apos;@angular/forms&apos;;</span><br><span class=\"line\">import &#123; SignupService &#125; from &apos;../signup.service&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">export class ValidateEmailNotTaken &#123;</span><br><span class=\"line\">  static createValidator(signupService: SignupService) &#123;</span><br><span class=\"line\">    return (control: AbstractControl) =&gt; &#123;</span><br><span class=\"line\">      return signupService.checkEmailNotTaken(control.value).map(res =&gt; &#123;</span><br><span class=\"line\">        return res ? null : &#123; emailTaken: true &#125;;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后，回到我们的组件中，我们导入<em>ValidateEmailNotTaken</em>类，我们可以使用这样的验证器：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ngOnInit() &#123;</span><br><span class=\"line\">  this.myForm = this.fb.group(&#123;</span><br><span class=\"line\">    name: [&apos;&apos;, Validators.required],</span><br><span class=\"line\">    email: [</span><br><span class=\"line\">      &apos;&apos;,</span><br><span class=\"line\">      [Validators.required, Validators.email],</span><br><span class=\"line\">      ValidateEmailNotTaken.createValidator(this.signupService)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"模板\"><a href=\"#模板\" class=\"headerlink\" title=\"模板\"></a>模板</h2><p>在模板中，事情真的很简单：</p>\n<p>app.component.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;form [formGroup]=&quot;myForm&quot;&gt;</span><br><span class=\"line\">  &lt;input type=&quot;text&quot; formControlName=&quot;name&quot;&gt;</span><br><span class=\"line\">  &lt;input type=&quot;email&quot; formControlName=&quot;email&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;div *ngIf=&quot;myForm.get(&apos;email&apos;).status === &apos;PENDING&apos;&quot;&gt;</span><br><span class=\"line\">    Checking...</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;div *ngIf=&quot;myForm.get(&apos;email&apos;).status === &apos;VALID&apos;&quot;&gt;</span><br><span class=\"line\">    😺 Email is available!</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;div *ngIf=&quot;myForm.get(&apos;email&apos;).errors &amp;&amp; myForm.get(&apos;email&apos;).errors.emailTaken&quot;&gt;</span><br><span class=\"line\">    😢 Oh noes, this email is already taken!</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br></pre></td></tr></table></figure>\n<p>您可以看到我们根据<em>电子邮件</em>表单控件上status属性的值显示不同的消息。对于可能的值<strong>状态</strong>是<em>VALID</em>，<em>INVALID</em>，<em>PENDING</em>和<em>禁用</em>。如果异步验证错误输出我们的<em>emailTaken</em>错误，我们也会显示错误消息。</p>\n<p>使用异步验证器验证的表单字段在验证<em>待处理</em>时也将具有<em>ng-pending</em>类。这样可以轻松设置当前待验证字段的样式。</p>\n<p>✨你有它！使用后端API检查有效性的简便方法。</p>\n"},{"title":"使用Angular cli管理多种环境配置","date":"2018-10-16T10:24:30.000Z","_content":"\n大多数的web应用在发布生产之前，需要在多种环境下去运行。例如，您可能需要为QA团队构建一个构建以执行某些测试，或者在您的持续集成服务器上运行特定构建。\n\n这些构建需要不同的配置：\n  - 不同的服务URLS\n  - 不同的logging选项\n  - 等等\n\nAngular CLI提供了一种环境功能，允许运行针对特定环境的构建。 例如，以下是如何运行生产构建：\n\n```\nng build --env=prod   // For Angular 2 to 5\n```\n在升级到Angular 6+后，构建命令如下：\n```\nng build --configuration=production\n```\n上面代码中的prod标志是指v6之前的.angular-cli.json的环境部分的prod（v6+则是production）属性。\n默认情况下有两个选项：dev和prod\n```json\n\"environments\": {\n  \"dev\": \"environments/environment.ts\",\n  \"prod\": \"environments/environment.prod.ts\"\n}\n```\n您可以在此处添加所需的环境。 例如，如果您需要QA构建选项，只需在.angular-cli.json中添加以下条目：\n\n```json\n\"environments\": {\n  \"dev\": \"environments/environment.ts\",\n  \"prod\": \"environments/environment.prod.ts\",\n  \"qa\": \"environments/environment.qa.ts\"\n}\n```\n对于v6 +，angular.json environments现在称为configurations。 以下是在v6之后添加新qa环境的方法：\n```json\n\"configurations\": {\n  \"production\": { ... },\n  \"qa\": {\n    \"fileReplacements\": [\n      {\n        \"replace\": \"src/environments/environment.ts\",\n        \"with\": \"src/environments/environment.qa.ts\"\n      }\n    ]\n  }\n}\n```\n然后，您必须在environments目录中创建实际文件environment.qa.ts。\n\n下面是默认的dev配置：\n```\n// The file contents for the current environment will overwrite these during build.\n// The build system defaults to the dev environment which uses `environment.ts`, but if you do\n// `ng build --env=prod` then `environment.prod.ts` will be used instead.\n// The list of which env maps to which file can be found in `.angular-cli.json`.\nexport const environment = {\n  production: false\n};\n```\n您可以在上面的environment对象中添加任何特定于环境的属性。 例如，让我们添加一个服务器URL：\n```\nexport const environment = {\n  production: false,\n  serverUrl: \"http://dev.server.mycompany.com\"\n};\n```\n然后，您需要做的就是为QA提供不同的URL，即在environment.qa.ts中定义具有正确值的相同属性：\n```\nexport const environment = {\n  production: false,\n  serverUrl: \"http://qa.server.mycompany.com\"\n};\n```\n既然已经定义了您的环境，那么如何在代码中使用这些属性？ 很简单，您只需要导入环境对象，如下所示：\n```\nimport {environment} from '../../environments/environment';\n\n\n@Injectable()\nexport class AuthService {\n\n  LOGIN_URL: string = environment.serverUrl + '/login' ;\n```\n然后，当您运行QA构建时，Angular CLI将使用environment.qa.ts来读取environment.serverUrl属性值，并且您已设置为将该构建部署到QA环境。\n","source":"_posts/0001-how-to-manage-different-environments-with-angular-cli.md","raw":"---\ntitle: 使用Angular cli管理多种环境配置\ndate: 2018-10-16 18:24:30\ntags:\n    - angular\n---\n\n大多数的web应用在发布生产之前，需要在多种环境下去运行。例如，您可能需要为QA团队构建一个构建以执行某些测试，或者在您的持续集成服务器上运行特定构建。\n\n这些构建需要不同的配置：\n  - 不同的服务URLS\n  - 不同的logging选项\n  - 等等\n\nAngular CLI提供了一种环境功能，允许运行针对特定环境的构建。 例如，以下是如何运行生产构建：\n\n```\nng build --env=prod   // For Angular 2 to 5\n```\n在升级到Angular 6+后，构建命令如下：\n```\nng build --configuration=production\n```\n上面代码中的prod标志是指v6之前的.angular-cli.json的环境部分的prod（v6+则是production）属性。\n默认情况下有两个选项：dev和prod\n```json\n\"environments\": {\n  \"dev\": \"environments/environment.ts\",\n  \"prod\": \"environments/environment.prod.ts\"\n}\n```\n您可以在此处添加所需的环境。 例如，如果您需要QA构建选项，只需在.angular-cli.json中添加以下条目：\n\n```json\n\"environments\": {\n  \"dev\": \"environments/environment.ts\",\n  \"prod\": \"environments/environment.prod.ts\",\n  \"qa\": \"environments/environment.qa.ts\"\n}\n```\n对于v6 +，angular.json environments现在称为configurations。 以下是在v6之后添加新qa环境的方法：\n```json\n\"configurations\": {\n  \"production\": { ... },\n  \"qa\": {\n    \"fileReplacements\": [\n      {\n        \"replace\": \"src/environments/environment.ts\",\n        \"with\": \"src/environments/environment.qa.ts\"\n      }\n    ]\n  }\n}\n```\n然后，您必须在environments目录中创建实际文件environment.qa.ts。\n\n下面是默认的dev配置：\n```\n// The file contents for the current environment will overwrite these during build.\n// The build system defaults to the dev environment which uses `environment.ts`, but if you do\n// `ng build --env=prod` then `environment.prod.ts` will be used instead.\n// The list of which env maps to which file can be found in `.angular-cli.json`.\nexport const environment = {\n  production: false\n};\n```\n您可以在上面的environment对象中添加任何特定于环境的属性。 例如，让我们添加一个服务器URL：\n```\nexport const environment = {\n  production: false,\n  serverUrl: \"http://dev.server.mycompany.com\"\n};\n```\n然后，您需要做的就是为QA提供不同的URL，即在environment.qa.ts中定义具有正确值的相同属性：\n```\nexport const environment = {\n  production: false,\n  serverUrl: \"http://qa.server.mycompany.com\"\n};\n```\n既然已经定义了您的环境，那么如何在代码中使用这些属性？ 很简单，您只需要导入环境对象，如下所示：\n```\nimport {environment} from '../../environments/environment';\n\n\n@Injectable()\nexport class AuthService {\n\n  LOGIN_URL: string = environment.serverUrl + '/login' ;\n```\n然后，当您运行QA构建时，Angular CLI将使用environment.qa.ts来读取environment.serverUrl属性值，并且您已设置为将该构建部署到QA环境。\n","slug":"0001-how-to-manage-different-environments-with-angular-cli","published":1,"updated":"2018-10-17T09:10:49.871Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1g0006gcoipkzpx8x9","content":"<p>大多数的web应用在发布生产之前，需要在多种环境下去运行。例如，您可能需要为QA团队构建一个构建以执行某些测试，或者在您的持续集成服务器上运行特定构建。</p>\n<p>这些构建需要不同的配置：</p>\n<ul>\n<li>不同的服务URLS</li>\n<li>不同的logging选项</li>\n<li>等等</li>\n</ul>\n<p>Angular CLI提供了一种环境功能，允许运行针对特定环境的构建。 例如，以下是如何运行生产构建：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng build --env=prod   // For Angular 2 to 5</span><br></pre></td></tr></table></figure>\n<p>在升级到Angular 6+后，构建命令如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng build --configuration=production</span><br></pre></td></tr></table></figure></p>\n<p>上面代码中的prod标志是指v6之前的.angular-cli.json的环境部分的prod（v6+则是production）属性。<br>默认情况下有两个选项：dev和prod<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"environments\": &#123;</span><br><span class=\"line\">  \"dev\": \"environments/environment.ts\",</span><br><span class=\"line\">  \"prod\": \"environments/environment.prod.ts\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>您可以在此处添加所需的环境。 例如，如果您需要QA构建选项，只需在.angular-cli.json中添加以下条目：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"environments\": &#123;</span><br><span class=\"line\">  \"dev\": \"environments/environment.ts\",</span><br><span class=\"line\">  \"prod\": \"environments/environment.prod.ts\",</span><br><span class=\"line\">  \"qa\": \"environments/environment.qa.ts\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对于v6 +，angular.json environments现在称为configurations。 以下是在v6之后添加新qa环境的方法：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"configurations\": &#123;</span><br><span class=\"line\">  \"production\": &#123; ... &#125;,</span><br><span class=\"line\">  \"qa\": &#123;</span><br><span class=\"line\">    \"fileReplacements\": [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"replace\"</span>: <span class=\"string\">\"src/environments/environment.ts\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"with\"</span>: <span class=\"string\">\"src/environments/environment.qa.ts\"</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>然后，您必须在environments目录中创建实际文件environment.qa.ts。</p>\n<p>下面是默认的dev配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// The file contents for the current environment will overwrite these during build.</span><br><span class=\"line\">// The build system defaults to the dev environment which uses `environment.ts`, but if you do</span><br><span class=\"line\">// `ng build --env=prod` then `environment.prod.ts` will be used instead.</span><br><span class=\"line\">// The list of which env maps to which file can be found in `.angular-cli.json`.</span><br><span class=\"line\">export const environment = &#123;</span><br><span class=\"line\">  production: false</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>您可以在上面的environment对象中添加任何特定于环境的属性。 例如，让我们添加一个服务器URL：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export const environment = &#123;</span><br><span class=\"line\">  production: false,</span><br><span class=\"line\">  serverUrl: &quot;http://dev.server.mycompany.com&quot;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>然后，您需要做的就是为QA提供不同的URL，即在environment.qa.ts中定义具有正确值的相同属性：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export const environment = &#123;</span><br><span class=\"line\">  production: false,</span><br><span class=\"line\">  serverUrl: &quot;http://qa.server.mycompany.com&quot;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>既然已经定义了您的环境，那么如何在代码中使用这些属性？ 很简单，您只需要导入环境对象，如下所示：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123;environment&#125; from &apos;../../environments/environment&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">@Injectable()</span><br><span class=\"line\">export class AuthService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  LOGIN_URL: string = environment.serverUrl + &apos;/login&apos; ;</span><br></pre></td></tr></table></figure></p>\n<p>然后，当您运行QA构建时，Angular CLI将使用environment.qa.ts来读取environment.serverUrl属性值，并且您已设置为将该构建部署到QA环境。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>大多数的web应用在发布生产之前，需要在多种环境下去运行。例如，您可能需要为QA团队构建一个构建以执行某些测试，或者在您的持续集成服务器上运行特定构建。</p>\n<p>这些构建需要不同的配置：</p>\n<ul>\n<li>不同的服务URLS</li>\n<li>不同的logging选项</li>\n<li>等等</li>\n</ul>\n<p>Angular CLI提供了一种环境功能，允许运行针对特定环境的构建。 例如，以下是如何运行生产构建：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng build --env=prod   // For Angular 2 to 5</span><br></pre></td></tr></table></figure>\n<p>在升级到Angular 6+后，构建命令如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng build --configuration=production</span><br></pre></td></tr></table></figure></p>\n<p>上面代码中的prod标志是指v6之前的.angular-cli.json的环境部分的prod（v6+则是production）属性。<br>默认情况下有两个选项：dev和prod<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"environments\": &#123;</span><br><span class=\"line\">  \"dev\": \"environments/environment.ts\",</span><br><span class=\"line\">  \"prod\": \"environments/environment.prod.ts\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>您可以在此处添加所需的环境。 例如，如果您需要QA构建选项，只需在.angular-cli.json中添加以下条目：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"environments\": &#123;</span><br><span class=\"line\">  \"dev\": \"environments/environment.ts\",</span><br><span class=\"line\">  \"prod\": \"environments/environment.prod.ts\",</span><br><span class=\"line\">  \"qa\": \"environments/environment.qa.ts\"</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对于v6 +，angular.json environments现在称为configurations。 以下是在v6之后添加新qa环境的方法：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"configurations\": &#123;</span><br><span class=\"line\">  \"production\": &#123; ... &#125;,</span><br><span class=\"line\">  \"qa\": &#123;</span><br><span class=\"line\">    \"fileReplacements\": [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"replace\"</span>: <span class=\"string\">\"src/environments/environment.ts\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"with\"</span>: <span class=\"string\">\"src/environments/environment.qa.ts\"</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>然后，您必须在environments目录中创建实际文件environment.qa.ts。</p>\n<p>下面是默认的dev配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// The file contents for the current environment will overwrite these during build.</span><br><span class=\"line\">// The build system defaults to the dev environment which uses `environment.ts`, but if you do</span><br><span class=\"line\">// `ng build --env=prod` then `environment.prod.ts` will be used instead.</span><br><span class=\"line\">// The list of which env maps to which file can be found in `.angular-cli.json`.</span><br><span class=\"line\">export const environment = &#123;</span><br><span class=\"line\">  production: false</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>您可以在上面的environment对象中添加任何特定于环境的属性。 例如，让我们添加一个服务器URL：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export const environment = &#123;</span><br><span class=\"line\">  production: false,</span><br><span class=\"line\">  serverUrl: &quot;http://dev.server.mycompany.com&quot;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>然后，您需要做的就是为QA提供不同的URL，即在environment.qa.ts中定义具有正确值的相同属性：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export const environment = &#123;</span><br><span class=\"line\">  production: false,</span><br><span class=\"line\">  serverUrl: &quot;http://qa.server.mycompany.com&quot;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>既然已经定义了您的环境，那么如何在代码中使用这些属性？ 很简单，您只需要导入环境对象，如下所示：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123;environment&#125; from &apos;../../environments/environment&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">@Injectable()</span><br><span class=\"line\">export class AuthService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  LOGIN_URL: string = environment.serverUrl + &apos;/login&apos; ;</span><br></pre></td></tr></table></figure></p>\n<p>然后，当您运行QA构建时，Angular CLI将使用environment.qa.ts来读取environment.serverUrl属性值，并且您已设置为将该构建部署到QA环境。</p>\n"},{"title":"Security自定义Provider如何获取更多用户信息","date":"2018-10-30T02:24:30.000Z","_content":"\n在使用Spring Security集成Oauth2.0做Auth server时，使用自定义的UserDetailsService实现时，在Controller层通过自动注入，可以获取详细的用户信息。\n\n```java\n@GetMapping(\"/user\")\npublic Principal user(Principal user) {\n  return user;\n}\n```\n\n但是，使用自定义的Provider去做账户校验时，获取的Principal就只含有用户名信息。\n\n分析原码发现\n\n```java\n// org.springframework.security.oauth2.provider.token.DefaultUserAuthenticationConverter\npublic Authentication extractAuthentication(Map<String, ?> map) {\n  if (map.containsKey(USERNAME)) {\n    Object principal = map.get(USERNAME);\n    Collection<? extends GrantedAuthority> authorities = getAuthorities(map);\n    if (userDetailsService != null) {\n      UserDetails user = userDetailsService.loadUserByUsername((String) map.get(USERNAME));\n      authorities = user.getAuthorities();\n      principal = user;\n    }\n    return new UsernamePasswordAuthenticationToken(principal, \"N/A\", authorities);\n  }\n  return null;\n}\n```\n通过jwt方式进行认证的会执行`DefaultUserAuthenticationConverter`代码，其中的userDetailsService是null，所以返回的principal就只有用户名。\n\n可以通过在创建`DefaultUserAuthenticationConverter`时，给他set上userDetailsService，这样就获取更多的信息了。\n\n如下：\n\n```java\n@Bean\npublic JwtAccessTokenConverter jwtAccessTokenConverter() {\n    JwtAccessTokenConverter jwtAccessTokenConverter = new JwtAccessTokenConverter();\n    jwtAccessTokenConverter.setSigningKey(\"demo\");\n    final AccessTokenConverter accessTokenConverter = jwtAccessTokenConverter.getAccessTokenConverter();\n    if (accessTokenConverter instanceof DefaultAccessTokenConverter) {\n        ((DefaultAccessTokenConverter) accessTokenConverter).setUserTokenConverter(userAuthenticationConverter());\n    }\n    return jwtAccessTokenConverter;\n}\n\n@Bean\npublic UserAuthenticationConverter userAuthenticationConverter() {\n    DefaultUserAuthenticationConverter defaultUserAuthenticationConverter = new DefaultUserAuthenticationConverter();\n    defaultUserAuthenticationConverter.setUserDetailsService(userDetailsService);\n    return defaultUserAuthenticationConverter;\n}\n```\n","source":"_posts/0005-obtain-principal-with-custom-provider.md","raw":"---\ntitle: Security自定义Provider如何获取更多用户信息\ndate: 2018-10-30 10:24:30\ntags:\n    - Security\n---\n\n在使用Spring Security集成Oauth2.0做Auth server时，使用自定义的UserDetailsService实现时，在Controller层通过自动注入，可以获取详细的用户信息。\n\n```java\n@GetMapping(\"/user\")\npublic Principal user(Principal user) {\n  return user;\n}\n```\n\n但是，使用自定义的Provider去做账户校验时，获取的Principal就只含有用户名信息。\n\n分析原码发现\n\n```java\n// org.springframework.security.oauth2.provider.token.DefaultUserAuthenticationConverter\npublic Authentication extractAuthentication(Map<String, ?> map) {\n  if (map.containsKey(USERNAME)) {\n    Object principal = map.get(USERNAME);\n    Collection<? extends GrantedAuthority> authorities = getAuthorities(map);\n    if (userDetailsService != null) {\n      UserDetails user = userDetailsService.loadUserByUsername((String) map.get(USERNAME));\n      authorities = user.getAuthorities();\n      principal = user;\n    }\n    return new UsernamePasswordAuthenticationToken(principal, \"N/A\", authorities);\n  }\n  return null;\n}\n```\n通过jwt方式进行认证的会执行`DefaultUserAuthenticationConverter`代码，其中的userDetailsService是null，所以返回的principal就只有用户名。\n\n可以通过在创建`DefaultUserAuthenticationConverter`时，给他set上userDetailsService，这样就获取更多的信息了。\n\n如下：\n\n```java\n@Bean\npublic JwtAccessTokenConverter jwtAccessTokenConverter() {\n    JwtAccessTokenConverter jwtAccessTokenConverter = new JwtAccessTokenConverter();\n    jwtAccessTokenConverter.setSigningKey(\"demo\");\n    final AccessTokenConverter accessTokenConverter = jwtAccessTokenConverter.getAccessTokenConverter();\n    if (accessTokenConverter instanceof DefaultAccessTokenConverter) {\n        ((DefaultAccessTokenConverter) accessTokenConverter).setUserTokenConverter(userAuthenticationConverter());\n    }\n    return jwtAccessTokenConverter;\n}\n\n@Bean\npublic UserAuthenticationConverter userAuthenticationConverter() {\n    DefaultUserAuthenticationConverter defaultUserAuthenticationConverter = new DefaultUserAuthenticationConverter();\n    defaultUserAuthenticationConverter.setUserDetailsService(userDetailsService);\n    return defaultUserAuthenticationConverter;\n}\n```\n","slug":"0005-obtain-principal-with-custom-provider","published":1,"updated":"2018-10-30T02:37:10.293Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1h0007gcoij78tkikh","content":"<p>在使用Spring Security集成Oauth2.0做Auth server时，使用自定义的UserDetailsService实现时，在Controller层通过自动注入，可以获取详细的用户信息。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping</span>(<span class=\"string\">\"/user\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Principal <span class=\"title\">user</span><span class=\"params\">(Principal user)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>但是，使用自定义的Provider去做账户校验时，获取的Principal就只含有用户名信息。</p>\n<p>分析原码发现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// org.springframework.security.oauth2.provider.token.DefaultUserAuthenticationConverter</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Authentication <span class=\"title\">extractAuthentication</span><span class=\"params\">(Map&lt;String, ?&gt; map)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (map.containsKey(USERNAME)) &#123;</span><br><span class=\"line\">    Object principal = map.get(USERNAME);</span><br><span class=\"line\">    Collection&lt;? extends GrantedAuthority&gt; authorities = getAuthorities(map);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (userDetailsService != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      UserDetails user = userDetailsService.loadUserByUsername((String) map.get(USERNAME));</span><br><span class=\"line\">      authorities = user.getAuthorities();</span><br><span class=\"line\">      principal = user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(principal, <span class=\"string\">\"N/A\"</span>, authorities);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过jwt方式进行认证的会执行<code>DefaultUserAuthenticationConverter</code>代码，其中的userDetailsService是null，所以返回的principal就只有用户名。</p>\n<p>可以通过在创建<code>DefaultUserAuthenticationConverter</code>时，给他set上userDetailsService，这样就获取更多的信息了。</p>\n<p>如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> JwtAccessTokenConverter <span class=\"title\">jwtAccessTokenConverter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    JwtAccessTokenConverter jwtAccessTokenConverter = <span class=\"keyword\">new</span> JwtAccessTokenConverter();</span><br><span class=\"line\">    jwtAccessTokenConverter.setSigningKey(<span class=\"string\">\"demo\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">final</span> AccessTokenConverter accessTokenConverter = jwtAccessTokenConverter.getAccessTokenConverter();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (accessTokenConverter <span class=\"keyword\">instanceof</span> DefaultAccessTokenConverter) &#123;</span><br><span class=\"line\">        ((DefaultAccessTokenConverter) accessTokenConverter).setUserTokenConverter(userAuthenticationConverter());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> jwtAccessTokenConverter;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> UserAuthenticationConverter <span class=\"title\">userAuthenticationConverter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    DefaultUserAuthenticationConverter defaultUserAuthenticationConverter = <span class=\"keyword\">new</span> DefaultUserAuthenticationConverter();</span><br><span class=\"line\">    defaultUserAuthenticationConverter.setUserDetailsService(userDetailsService);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> defaultUserAuthenticationConverter;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>在使用Spring Security集成Oauth2.0做Auth server时，使用自定义的UserDetailsService实现时，在Controller层通过自动注入，可以获取详细的用户信息。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping</span>(<span class=\"string\">\"/user\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Principal <span class=\"title\">user</span><span class=\"params\">(Principal user)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>但是，使用自定义的Provider去做账户校验时，获取的Principal就只含有用户名信息。</p>\n<p>分析原码发现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// org.springframework.security.oauth2.provider.token.DefaultUserAuthenticationConverter</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Authentication <span class=\"title\">extractAuthentication</span><span class=\"params\">(Map&lt;String, ?&gt; map)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (map.containsKey(USERNAME)) &#123;</span><br><span class=\"line\">    Object principal = map.get(USERNAME);</span><br><span class=\"line\">    Collection&lt;? extends GrantedAuthority&gt; authorities = getAuthorities(map);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (userDetailsService != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      UserDetails user = userDetailsService.loadUserByUsername((String) map.get(USERNAME));</span><br><span class=\"line\">      authorities = user.getAuthorities();</span><br><span class=\"line\">      principal = user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(principal, <span class=\"string\">\"N/A\"</span>, authorities);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过jwt方式进行认证的会执行<code>DefaultUserAuthenticationConverter</code>代码，其中的userDetailsService是null，所以返回的principal就只有用户名。</p>\n<p>可以通过在创建<code>DefaultUserAuthenticationConverter</code>时，给他set上userDetailsService，这样就获取更多的信息了。</p>\n<p>如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> JwtAccessTokenConverter <span class=\"title\">jwtAccessTokenConverter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    JwtAccessTokenConverter jwtAccessTokenConverter = <span class=\"keyword\">new</span> JwtAccessTokenConverter();</span><br><span class=\"line\">    jwtAccessTokenConverter.setSigningKey(<span class=\"string\">\"demo\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">final</span> AccessTokenConverter accessTokenConverter = jwtAccessTokenConverter.getAccessTokenConverter();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (accessTokenConverter <span class=\"keyword\">instanceof</span> DefaultAccessTokenConverter) &#123;</span><br><span class=\"line\">        ((DefaultAccessTokenConverter) accessTokenConverter).setUserTokenConverter(userAuthenticationConverter());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> jwtAccessTokenConverter;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> UserAuthenticationConverter <span class=\"title\">userAuthenticationConverter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    DefaultUserAuthenticationConverter defaultUserAuthenticationConverter = <span class=\"keyword\">new</span> DefaultUserAuthenticationConverter();</span><br><span class=\"line\">    defaultUserAuthenticationConverter.setUserDetailsService(userDetailsService);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> defaultUserAuthenticationConverter;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"Idea下maven package时，javadoc乱码","date":"2018-10-30T12:24:30.000Z","_content":"\n在idea中，使用maven打包应用的，javadoc在console输出乱码。解决方法如下：\n1. 设置环境变量JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8\n2. 在idea64.exe.vmoptions中设置-Dfile.encoding=UTF-8\n\n","source":"_posts/0006-idea-maven-javadoc-charset.md","raw":"---\ntitle: Idea下maven package时，javadoc乱码\ndate: 2018-10-30 20:24:30\ntags:\n    - IDE\n---\n\n在idea中，使用maven打包应用的，javadoc在console输出乱码。解决方法如下：\n1. 设置环境变量JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8\n2. 在idea64.exe.vmoptions中设置-Dfile.encoding=UTF-8\n\n","slug":"0006-idea-maven-javadoc-charset","published":1,"updated":"2018-11-12T06:03:28.893Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1i0008gcoi10qb3fnv","content":"<p>在idea中，使用maven打包应用的，javadoc在console输出乱码。解决方法如下：</p>\n<ol>\n<li>设置环境变量JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8</li>\n<li>在idea64.exe.vmoptions中设置-Dfile.encoding=UTF-8</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>在idea中，使用maven打包应用的，javadoc在console输出乱码。解决方法如下：</p>\n<ol>\n<li>设置环境变量JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8</li>\n<li>在idea64.exe.vmoptions中设置-Dfile.encoding=UTF-8</li>\n</ol>\n"},{"title":"Mysql建表语句中显示双引号","date":"2018-11-20T12:24:30.000Z","_content":"\n在工作中使用Mysql数据库，发现建表后的ddl显示表名、字段都是双引号。这样的ddl在线上工单系统无法通过，需要将双引号转成反引号(`)才行。\n\n通过执行命令`show VARIABLES like '%sql%'`发现，`sql_mode`的值是`ANSI_QUOTES`。\n\n查看my.cnf配置文件，发现有如下配置:\n\n```\n# 对本地的mysql客户端的配置\n[client]\n#default-character-set = utf8\n# 对其他远程连接的mysql客户端的配置\n[mysql]\ndefault-character-set = utf8\n# 本地mysql服务的配置\n\n[mysqld]\ndatadir=/var/lib/mysql\nsocket=/var/lib/mysql/mysql.sock\nuser=mysql\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\ncharacter-set-server = utf8\nsql_mode='ANSI_QUOTES'\ndefault-storage-engine=INNODB\n\nserver-id=1\nlog-bin=mysql-bin\nbinlog_format=MIXED\nexpire_logs_days=30\n\n[mysqld_safe]\nlog-error=/var/log/mysqld.log\n\n```\n\n将mysqld下的sql_mode配置去掉，重启服务即可。","source":"_posts/0009-msyql-use-double-quotes.md","raw":"---\ntitle: Mysql建表语句中显示双引号\ndate: 2018-11-20 20:24:30\ntags:\n    - mysql\n---\n\n在工作中使用Mysql数据库，发现建表后的ddl显示表名、字段都是双引号。这样的ddl在线上工单系统无法通过，需要将双引号转成反引号(`)才行。\n\n通过执行命令`show VARIABLES like '%sql%'`发现，`sql_mode`的值是`ANSI_QUOTES`。\n\n查看my.cnf配置文件，发现有如下配置:\n\n```\n# 对本地的mysql客户端的配置\n[client]\n#default-character-set = utf8\n# 对其他远程连接的mysql客户端的配置\n[mysql]\ndefault-character-set = utf8\n# 本地mysql服务的配置\n\n[mysqld]\ndatadir=/var/lib/mysql\nsocket=/var/lib/mysql/mysql.sock\nuser=mysql\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\ncharacter-set-server = utf8\nsql_mode='ANSI_QUOTES'\ndefault-storage-engine=INNODB\n\nserver-id=1\nlog-bin=mysql-bin\nbinlog_format=MIXED\nexpire_logs_days=30\n\n[mysqld_safe]\nlog-error=/var/log/mysqld.log\n\n```\n\n将mysqld下的sql_mode配置去掉，重启服务即可。","slug":"0009-msyql-use-double-quotes","published":1,"updated":"2018-11-21T06:54:06.971Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1k000bgcoimu0cmkjf","content":"<p>在工作中使用Mysql数据库，发现建表后的ddl显示表名、字段都是双引号。这样的ddl在线上工单系统无法通过，需要将双引号转成反引号(`)才行。</p>\n<p>通过执行命令<code>show VARIABLES like &#39;%sql%&#39;</code>发现，<code>sql_mode</code>的值是<code>ANSI_QUOTES</code>。</p>\n<p>查看my.cnf配置文件，发现有如下配置:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 对本地的mysql客户端的配置</span><br><span class=\"line\">[client]</span><br><span class=\"line\">#default-character-set = utf8</span><br><span class=\"line\"># 对其他远程连接的mysql客户端的配置</span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">default-character-set = utf8</span><br><span class=\"line\"># 本地mysql服务的配置</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir=/var/lib/mysql</span><br><span class=\"line\">socket=/var/lib/mysql/mysql.sock</span><br><span class=\"line\">user=mysql</span><br><span class=\"line\"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class=\"line\">symbolic-links=0</span><br><span class=\"line\">character-set-server = utf8</span><br><span class=\"line\">sql_mode=&apos;ANSI_QUOTES&apos;</span><br><span class=\"line\">default-storage-engine=INNODB</span><br><span class=\"line\"></span><br><span class=\"line\">server-id=1</span><br><span class=\"line\">log-bin=mysql-bin</span><br><span class=\"line\">binlog_format=MIXED</span><br><span class=\"line\">expire_logs_days=30</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\">log-error=/var/log/mysqld.log</span><br></pre></td></tr></table></figure>\n<p>将mysqld下的sql_mode配置去掉，重启服务即可。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在工作中使用Mysql数据库，发现建表后的ddl显示表名、字段都是双引号。这样的ddl在线上工单系统无法通过，需要将双引号转成反引号(`)才行。</p>\n<p>通过执行命令<code>show VARIABLES like &#39;%sql%&#39;</code>发现，<code>sql_mode</code>的值是<code>ANSI_QUOTES</code>。</p>\n<p>查看my.cnf配置文件，发现有如下配置:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 对本地的mysql客户端的配置</span><br><span class=\"line\">[client]</span><br><span class=\"line\">#default-character-set = utf8</span><br><span class=\"line\"># 对其他远程连接的mysql客户端的配置</span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">default-character-set = utf8</span><br><span class=\"line\"># 本地mysql服务的配置</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir=/var/lib/mysql</span><br><span class=\"line\">socket=/var/lib/mysql/mysql.sock</span><br><span class=\"line\">user=mysql</span><br><span class=\"line\"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class=\"line\">symbolic-links=0</span><br><span class=\"line\">character-set-server = utf8</span><br><span class=\"line\">sql_mode=&apos;ANSI_QUOTES&apos;</span><br><span class=\"line\">default-storage-engine=INNODB</span><br><span class=\"line\"></span><br><span class=\"line\">server-id=1</span><br><span class=\"line\">log-bin=mysql-bin</span><br><span class=\"line\">binlog_format=MIXED</span><br><span class=\"line\">expire_logs_days=30</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\">log-error=/var/log/mysqld.log</span><br></pre></td></tr></table></figure>\n<p>将mysqld下的sql_mode配置去掉，重启服务即可。</p>\n"},{"title":"动态代理：JDK动态代理和CGLIB代理的区别","date":"2018-11-26T10:24:30.000Z","_content":"\n> 作者：Big_Monkey\n> 原文地址: [动态代理：JDK动态代理和CGLIB代理的区别](https://www.cnblogs.com/bigmonkeys/p/7823268.html)\n\n代理模式：代理类和被代理类实现共同的接口（或继承），代理类中存有被代理类的索引，实际执行时通过调用代理类的方法，实际执行的是被代理类的方法。\n\n![](http://img.hb.aicdn.com/29f71c9def992be7b94c3566c6a7fd03bdcb93df32f3-49dKXs_fw658)\n\n而AOP，是通过动态代理实现的。\n\n一、简单来说：\n\n　　JDK动态代理只能对实现了接口的类生成代理，而不能针对类\n\n　　CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法（继承）\n\n二、Spring在选择用JDK还是CGLiB的依据：\n\n   (1)当Bean实现接口时，Spring就会用JDK的动态代理\n\n   (2)当Bean没有实现接口时，Spring使用CGlib是实现\n\n　  (3)可以强制使用CGlib（在spring配置中加入<aop:aspectj-autoproxy proxy-target-class=\"true\"/>）\n\n三、CGlib比JDK快？\n\n　 (1)使用CGLib实现动态代理，CGLib底层采用ASM字节码生成框架，使用字节码技术生成代理类，比使用Java反射效率要高。唯一需要注意的是，CGLib不能对声明为final的方法进行代理，因为CGLib原理是动态生成被代理类的子类。\n\n　 (2)在对JDK动态代理与CGlib动态代理的代码实验中看，1W次执行下，JDK7及8的动态代理性能比CGlib要好20%左右。","source":"_posts/0011-jdk-and-cglib-proxy.md","raw":"---\ntitle: 动态代理：JDK动态代理和CGLIB代理的区别\ndate: 2018-11-26 18:24:30\ntags:\n    - Java\n---\n\n> 作者：Big_Monkey\n> 原文地址: [动态代理：JDK动态代理和CGLIB代理的区别](https://www.cnblogs.com/bigmonkeys/p/7823268.html)\n\n代理模式：代理类和被代理类实现共同的接口（或继承），代理类中存有被代理类的索引，实际执行时通过调用代理类的方法，实际执行的是被代理类的方法。\n\n![](http://img.hb.aicdn.com/29f71c9def992be7b94c3566c6a7fd03bdcb93df32f3-49dKXs_fw658)\n\n而AOP，是通过动态代理实现的。\n\n一、简单来说：\n\n　　JDK动态代理只能对实现了接口的类生成代理，而不能针对类\n\n　　CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法（继承）\n\n二、Spring在选择用JDK还是CGLiB的依据：\n\n   (1)当Bean实现接口时，Spring就会用JDK的动态代理\n\n   (2)当Bean没有实现接口时，Spring使用CGlib是实现\n\n　  (3)可以强制使用CGlib（在spring配置中加入<aop:aspectj-autoproxy proxy-target-class=\"true\"/>）\n\n三、CGlib比JDK快？\n\n　 (1)使用CGLib实现动态代理，CGLib底层采用ASM字节码生成框架，使用字节码技术生成代理类，比使用Java反射效率要高。唯一需要注意的是，CGLib不能对声明为final的方法进行代理，因为CGLib原理是动态生成被代理类的子类。\n\n　 (2)在对JDK动态代理与CGlib动态代理的代码实验中看，1W次执行下，JDK7及8的动态代理性能比CGlib要好20%左右。","slug":"0011-jdk-and-cglib-proxy","published":1,"updated":"2018-12-03T07:01:20.962Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1l000cgcoiq4olvuy1","content":"<blockquote>\n<p>作者：Big_Monkey<br>原文地址: <a href=\"https://www.cnblogs.com/bigmonkeys/p/7823268.html\" target=\"_blank\" rel=\"noopener\">动态代理：JDK动态代理和CGLIB代理的区别</a></p>\n</blockquote>\n<p>代理模式：代理类和被代理类实现共同的接口（或继承），代理类中存有被代理类的索引，实际执行时通过调用代理类的方法，实际执行的是被代理类的方法。</p>\n<p><img src=\"http://img.hb.aicdn.com/29f71c9def992be7b94c3566c6a7fd03bdcb93df32f3-49dKXs_fw658\" alt=\"\"></p>\n<p>而AOP，是通过动态代理实现的。</p>\n<p>一、简单来说：</p>\n<p>　　JDK动态代理只能对实现了接口的类生成代理，而不能针对类</p>\n<p>　　CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法（继承）</p>\n<p>二、Spring在选择用JDK还是CGLiB的依据：</p>\n<p>   (1)当Bean实现接口时，Spring就会用JDK的动态代理</p>\n<p>   (2)当Bean没有实现接口时，Spring使用CGlib是实现</p>\n<p>　  (3)可以强制使用CGlib（在spring配置中加入&lt;aop:aspectj-autoproxy proxy-target-class=”true”/&gt;）</p>\n<p>三、CGlib比JDK快？</p>\n<p>　 (1)使用CGLib实现动态代理，CGLib底层采用ASM字节码生成框架，使用字节码技术生成代理类，比使用Java反射效率要高。唯一需要注意的是，CGLib不能对声明为final的方法进行代理，因为CGLib原理是动态生成被代理类的子类。</p>\n<p>　 (2)在对JDK动态代理与CGlib动态代理的代码实验中看，1W次执行下，JDK7及8的动态代理性能比CGlib要好20%左右。</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>作者：Big_Monkey<br>原文地址: <a href=\"https://www.cnblogs.com/bigmonkeys/p/7823268.html\" target=\"_blank\" rel=\"noopener\">动态代理：JDK动态代理和CGLIB代理的区别</a></p>\n</blockquote>\n<p>代理模式：代理类和被代理类实现共同的接口（或继承），代理类中存有被代理类的索引，实际执行时通过调用代理类的方法，实际执行的是被代理类的方法。</p>\n<p><img src=\"http://img.hb.aicdn.com/29f71c9def992be7b94c3566c6a7fd03bdcb93df32f3-49dKXs_fw658\" alt=\"\"></p>\n<p>而AOP，是通过动态代理实现的。</p>\n<p>一、简单来说：</p>\n<p>　　JDK动态代理只能对实现了接口的类生成代理，而不能针对类</p>\n<p>　　CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法（继承）</p>\n<p>二、Spring在选择用JDK还是CGLiB的依据：</p>\n<p>   (1)当Bean实现接口时，Spring就会用JDK的动态代理</p>\n<p>   (2)当Bean没有实现接口时，Spring使用CGlib是实现</p>\n<p>　  (3)可以强制使用CGlib（在spring配置中加入&lt;aop:aspectj-autoproxy proxy-target-class=”true”/&gt;）</p>\n<p>三、CGlib比JDK快？</p>\n<p>　 (1)使用CGLib实现动态代理，CGLib底层采用ASM字节码生成框架，使用字节码技术生成代理类，比使用Java反射效率要高。唯一需要注意的是，CGLib不能对声明为final的方法进行代理，因为CGLib原理是动态生成被代理类的子类。</p>\n<p>　 (2)在对JDK动态代理与CGlib动态代理的代码实验中看，1W次执行下，JDK7及8的动态代理性能比CGlib要好20%左右。</p>\n"},{"title":"Spring Cloud Zuul集成静态资源","date":"2018-11-23T06:24:30.000Z","_content":"\n项目中需要将前端的静态资源打包集成到zuul中，直接将静态资源放到zuul项目的/src/main/resources/static下，通过浏览器访问，发现无法访问。原因是zuul对所有的请求都进行了路由转发。\n\n一开始的配置如下：\n\n```\nzuul:\n    servlet-path: /\n    sensitive-headers:\n```\n\n在这种配置下，zuul对于后台其他restful服务进行的自动转发：\n\n如eureka中注册了a服务，当访问`/a/service`时，zuul自动将该请求转发到a服务上。\n\n通过修改配置，实现了静态资源的集成，配置如下：\n\n```\nzuul:\n# servlet-path: /\n    sensitive-headers:\n    ignored-services: '*'\n    routes:\n        a: /a/**\n        b: /b/**\n```\n\n禁用zuul的自动路由配置，通过指定路由，去掉`serlvet-path`\n\n实现集成静态资源。\n","source":"_posts/0010-spring-cloud-zuul-integrate-static-resource.md","raw":"---\ntitle: Spring Cloud Zuul集成静态资源\ndate: 2018-11-23 14:24:30\ntags:\n    - zuul\n    - spring cloud\n---\n\n项目中需要将前端的静态资源打包集成到zuul中，直接将静态资源放到zuul项目的/src/main/resources/static下，通过浏览器访问，发现无法访问。原因是zuul对所有的请求都进行了路由转发。\n\n一开始的配置如下：\n\n```\nzuul:\n    servlet-path: /\n    sensitive-headers:\n```\n\n在这种配置下，zuul对于后台其他restful服务进行的自动转发：\n\n如eureka中注册了a服务，当访问`/a/service`时，zuul自动将该请求转发到a服务上。\n\n通过修改配置，实现了静态资源的集成，配置如下：\n\n```\nzuul:\n# servlet-path: /\n    sensitive-headers:\n    ignored-services: '*'\n    routes:\n        a: /a/**\n        b: /b/**\n```\n\n禁用zuul的自动路由配置，通过指定路由，去掉`serlvet-path`\n\n实现集成静态资源。\n","slug":"0010-spring-cloud-zuul-integrate-static-resource","published":1,"updated":"2018-11-26T11:00:56.842Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1n000egcoiexnzkab5","content":"<p>项目中需要将前端的静态资源打包集成到zuul中，直接将静态资源放到zuul项目的/src/main/resources/static下，通过浏览器访问，发现无法访问。原因是zuul对所有的请求都进行了路由转发。</p>\n<p>一开始的配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zuul:</span><br><span class=\"line\">    servlet-path: /</span><br><span class=\"line\">    sensitive-headers:</span><br></pre></td></tr></table></figure>\n<p>在这种配置下，zuul对于后台其他restful服务进行的自动转发：</p>\n<p>如eureka中注册了a服务，当访问<code>/a/service</code>时，zuul自动将该请求转发到a服务上。</p>\n<p>通过修改配置，实现了静态资源的集成，配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zuul:</span><br><span class=\"line\"># servlet-path: /</span><br><span class=\"line\">    sensitive-headers:</span><br><span class=\"line\">    ignored-services: &apos;*&apos;</span><br><span class=\"line\">    routes:</span><br><span class=\"line\">        a: /a/**</span><br><span class=\"line\">        b: /b/**</span><br></pre></td></tr></table></figure>\n<p>禁用zuul的自动路由配置，通过指定路由，去掉<code>serlvet-path</code></p>\n<p>实现集成静态资源。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>项目中需要将前端的静态资源打包集成到zuul中，直接将静态资源放到zuul项目的/src/main/resources/static下，通过浏览器访问，发现无法访问。原因是zuul对所有的请求都进行了路由转发。</p>\n<p>一开始的配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zuul:</span><br><span class=\"line\">    servlet-path: /</span><br><span class=\"line\">    sensitive-headers:</span><br></pre></td></tr></table></figure>\n<p>在这种配置下，zuul对于后台其他restful服务进行的自动转发：</p>\n<p>如eureka中注册了a服务，当访问<code>/a/service</code>时，zuul自动将该请求转发到a服务上。</p>\n<p>通过修改配置，实现了静态资源的集成，配置如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zuul:</span><br><span class=\"line\"># servlet-path: /</span><br><span class=\"line\">    sensitive-headers:</span><br><span class=\"line\">    ignored-services: &apos;*&apos;</span><br><span class=\"line\">    routes:</span><br><span class=\"line\">        a: /a/**</span><br><span class=\"line\">        b: /b/**</span><br></pre></td></tr></table></figure>\n<p>禁用zuul的自动路由配置，通过指定路由，去掉<code>serlvet-path</code></p>\n<p>实现集成静态资源。</p>\n"},{"title":"Angular material中自定义分页信息","date":"2018-12-03T06:44:01.000Z","_content":"\n在项目开发中，用到了Material的分页组件，需要对该组件进行汉化。\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fxtkeefsycj20gt065jrd.jpg)\n\n首先创建自定义汉化类：\n\n```typescript\nimport {MatPaginatorIntl} from '@angular/material';\n\nexport class MatPaginatorIntlCro extends MatPaginatorIntl  {\n  /** A label for the page size selector. */\n  itemsPerPageLabel = '每页条数: ';\n  /** A label for the button that increments the current page. */\n  nextPageLabel = '下一页';\n  /** A label for the button that decrements the current page. */\n  previousPageLabel = '上一页';\n  /** A label for the button that moves to the first page. */\n  firstPageLabel = '首页';\n  /** A label for the button that moves to the last page. */\n  lastPageLabel = '尾页';\n  /** A label for the range of items within the current page and the length of the whole list. */\n  getRangeLabel =  (page: number, pageSize: number, length: number) => {\n    if (length === 0 || pageSize === 0) {\n      return '0 od' + length;\n    }\n\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex = startIndex < length\n                      ? Math.min(startIndex + pageSize, length)\n                      : startIndex + pageSize;\n    return `第${startIndex + 1}-${endIndex}条, 总共${length}条`;\n  }\n}\n```\n\n在`app.module.ts`中声明该Provider：\n```typescript\n providers: [\n    {provide: MatPaginatorIntl, useClass: MatPaginatorIntlCro }\n    ]\n```\n这样在再使用分页组件时，相关信息将显示中文。","source":"_posts/0012-custom-material-paginator-label.md","raw":"---\ntitle: Angular material中自定义分页信息\ndate: 2018-12-03 14:44:01\ntags:\n    - angular\n---\n\n在项目开发中，用到了Material的分页组件，需要对该组件进行汉化。\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fxtkeefsycj20gt065jrd.jpg)\n\n首先创建自定义汉化类：\n\n```typescript\nimport {MatPaginatorIntl} from '@angular/material';\n\nexport class MatPaginatorIntlCro extends MatPaginatorIntl  {\n  /** A label for the page size selector. */\n  itemsPerPageLabel = '每页条数: ';\n  /** A label for the button that increments the current page. */\n  nextPageLabel = '下一页';\n  /** A label for the button that decrements the current page. */\n  previousPageLabel = '上一页';\n  /** A label for the button that moves to the first page. */\n  firstPageLabel = '首页';\n  /** A label for the button that moves to the last page. */\n  lastPageLabel = '尾页';\n  /** A label for the range of items within the current page and the length of the whole list. */\n  getRangeLabel =  (page: number, pageSize: number, length: number) => {\n    if (length === 0 || pageSize === 0) {\n      return '0 od' + length;\n    }\n\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex = startIndex < length\n                      ? Math.min(startIndex + pageSize, length)\n                      : startIndex + pageSize;\n    return `第${startIndex + 1}-${endIndex}条, 总共${length}条`;\n  }\n}\n```\n\n在`app.module.ts`中声明该Provider：\n```typescript\n providers: [\n    {provide: MatPaginatorIntl, useClass: MatPaginatorIntlCro }\n    ]\n```\n这样在再使用分页组件时，相关信息将显示中文。","slug":"0012-custom-material-paginator-label","published":1,"updated":"2018-12-03T06:59:30.119Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1o000ggcoi2tsa3s24","content":"<p>在项目开发中，用到了Material的分页组件，需要对该组件进行汉化。</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fxtkeefsycj20gt065jrd.jpg\" alt=\"\"></p>\n<p>首先创建自定义汉化类：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;MatPaginatorIntl&#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/material'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> MatPaginatorIntlCro <span class=\"keyword\">extends</span> MatPaginatorIntl  &#123;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the page size selector. */</span></span><br><span class=\"line\">  itemsPerPageLabel = <span class=\"string\">'每页条数: '</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that increments the current page. */</span></span><br><span class=\"line\">  nextPageLabel = <span class=\"string\">'下一页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that decrements the current page. */</span></span><br><span class=\"line\">  previousPageLabel = <span class=\"string\">'上一页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that moves to the first page. */</span></span><br><span class=\"line\">  firstPageLabel = <span class=\"string\">'首页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that moves to the last page. */</span></span><br><span class=\"line\">  lastPageLabel = <span class=\"string\">'尾页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the range of items within the current page and the length of the whole list. */</span></span><br><span class=\"line\">  getRangeLabel =  <span class=\"function\">(<span class=\"params\">page: <span class=\"built_in\">number</span>, pageSize: <span class=\"built_in\">number</span>, length: <span class=\"built_in\">number</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (length === <span class=\"number\">0</span> || pageSize === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'0 od'</span> + length;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    length = <span class=\"built_in\">Math</span>.max(length, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> startIndex = page * pageSize;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> endIndex = startIndex &lt; length</span><br><span class=\"line\">                      ? <span class=\"built_in\">Math</span>.min(startIndex + pageSize, length)</span><br><span class=\"line\">                      : startIndex + pageSize;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`第<span class=\"subst\">$&#123;startIndex + 1&#125;</span>-<span class=\"subst\">$&#123;endIndex&#125;</span>条, 总共<span class=\"subst\">$&#123;length&#125;</span>条`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在<code>app.module.ts</code>中声明该Provider：<br><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">providers: [</span><br><span class=\"line\">   &#123;provide: MatPaginatorIntl, useClass: MatPaginatorIntlCro &#125;</span><br><span class=\"line\">   ]</span><br></pre></td></tr></table></figure></p>\n<p>这样在再使用分页组件时，相关信息将显示中文。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在项目开发中，用到了Material的分页组件，需要对该组件进行汉化。</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fxtkeefsycj20gt065jrd.jpg\" alt=\"\"></p>\n<p>首先创建自定义汉化类：</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;MatPaginatorIntl&#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/material'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> MatPaginatorIntlCro <span class=\"keyword\">extends</span> MatPaginatorIntl  &#123;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the page size selector. */</span></span><br><span class=\"line\">  itemsPerPageLabel = <span class=\"string\">'每页条数: '</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that increments the current page. */</span></span><br><span class=\"line\">  nextPageLabel = <span class=\"string\">'下一页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that decrements the current page. */</span></span><br><span class=\"line\">  previousPageLabel = <span class=\"string\">'上一页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that moves to the first page. */</span></span><br><span class=\"line\">  firstPageLabel = <span class=\"string\">'首页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the button that moves to the last page. */</span></span><br><span class=\"line\">  lastPageLabel = <span class=\"string\">'尾页'</span>;</span><br><span class=\"line\">  <span class=\"comment\">/** A label for the range of items within the current page and the length of the whole list. */</span></span><br><span class=\"line\">  getRangeLabel =  <span class=\"function\">(<span class=\"params\">page: <span class=\"built_in\">number</span>, pageSize: <span class=\"built_in\">number</span>, length: <span class=\"built_in\">number</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (length === <span class=\"number\">0</span> || pageSize === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'0 od'</span> + length;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    length = <span class=\"built_in\">Math</span>.max(length, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> startIndex = page * pageSize;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> endIndex = startIndex &lt; length</span><br><span class=\"line\">                      ? <span class=\"built_in\">Math</span>.min(startIndex + pageSize, length)</span><br><span class=\"line\">                      : startIndex + pageSize;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`第<span class=\"subst\">$&#123;startIndex + 1&#125;</span>-<span class=\"subst\">$&#123;endIndex&#125;</span>条, 总共<span class=\"subst\">$&#123;length&#125;</span>条`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在<code>app.module.ts</code>中声明该Provider：<br><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">providers: [</span><br><span class=\"line\">   &#123;provide: MatPaginatorIntl, useClass: MatPaginatorIntlCro &#125;</span><br><span class=\"line\">   ]</span><br></pre></td></tr></table></figure></p>\n<p>这样在再使用分页组件时，相关信息将显示中文。</p>\n"},{"title":"Angular的@Output与@Input浅析","date":"2018-12-04T01:44:01.000Z","_content":"\n# @Output与@Input理解\nOutput和Input是两个装饰器，是Angular2专门用来实现跨组件通讯，双向绑定等操作所用的。\n\n## @Input\n\nComponent本身是一种支持 nest 的结构，Child和Parent之间，如果Parent需要把数据传输给child并在child自己的页面中显示，则需要在Child的对应 directive 标示为 input。\n\n例如：\n```\n@Input() name: string;\n```\n\n我们通过一个例子来分析下`@Input`的流程。\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fxtu0ia0t7j216m0pgjwe.jpg)\n\n流程：\n1. child_component.ts内有students，并且是被@Input标记的，那么这个属性就作为输入属性\n2. 在parent_component.html内直接使用了students，那是因为在parent.module.ts内将child组件import进来了\n3. [students]这种形式叫属性绑定，绑定的值为school.schoolStudents属性\n4. Angular会把schoolStudents的值赋值给students，然后影响到子组件的显示\n\n所以我们可以总结，child_component中有数据要显示，但是这个数据的来源是通过parent_component.html中通过属性绑定的形式作为child组件的输入，要想child组件内的students属性能够成功赋值，那么必须使用@Input。\n\n`@Input`还可以使用typescript的get set存取器的方式来设置属性\n```\nprivate _name: string;\n\n@Input get name() {return this._name;}\nset(name:string) {this._name = name;}\n```\n\n## @Output\nOutput的数据流方向与input是相反的，所以那就是child控制parent的数据显示，input是parent控制child的数据显示。\n\n**注意**\nAngular 2中，@Output的实现必须使用EventEmitter来实现。 \n并且当你使用了tslint之后，变量不能加on，但是可以通过加入这样一段注释\n\n```\n// tslint:disable-next-line:no-output-on-prefix\n@Output() onRemoveElement = new EventEmitter<Element>();\n```\n\n形如：\n```\n// 要将EventEmitter先import进来。\nimport { Component, Input, Output, EventEmitter } from '@angular/core';\n...\n@Output() mySignal = new EventEmitter<boolean>();\n```\n\nEventEmitter();中间的boolean参数是你需要传递数据的类型，当然可以是基本类型，也可以是自定义类型。\n\n我们还是老样子，通过一个例子来分析一下吧。 \n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fxtu7s2pydj218a0ueq92.jpg)\n\n我们通过这张图可以看到，整个事件的流程，那我们来分析一下：\n\nchild组件内有一个Output customClick的事件，事件的数据类型是number\nchild组件内有一个onClicked方法，这个是应用在html中button控件的click事件中，通过(click)=”onClicked()”进行方法绑定\nparent组件内有一个public的属性showMsg,Angular的ts类默认不写关键字就是public。\n\nparent组件内有一个onCustomClicked方法，这个也是要用在html中的，是和child组件内的output标记的customClick事件进行绑定的\n步骤为child的html的button按钮被点击->onClicked方法被调用->emit(99)触发customClick->Angular通过Output数据流识别出发生变化并通知parent的html中(customClick)->onCustomClicked(event)被调用，event)被调用，event为数据99->改变了showMsg属性值->影响到了parent的html中的显示由1变为99。\n\n**小知识：**\n\n其实双向绑定就是这么实现的，只是将input和output一起使用即可达到目的。\n","source":"_posts/0013-angular-output-input-analysis.md","raw":"---\ntitle: Angular的@Output与@Input浅析\ndate: 2018-12-04 09:44:01\ntags:\n    - angular\n---\n\n# @Output与@Input理解\nOutput和Input是两个装饰器，是Angular2专门用来实现跨组件通讯，双向绑定等操作所用的。\n\n## @Input\n\nComponent本身是一种支持 nest 的结构，Child和Parent之间，如果Parent需要把数据传输给child并在child自己的页面中显示，则需要在Child的对应 directive 标示为 input。\n\n例如：\n```\n@Input() name: string;\n```\n\n我们通过一个例子来分析下`@Input`的流程。\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fxtu0ia0t7j216m0pgjwe.jpg)\n\n流程：\n1. child_component.ts内有students，并且是被@Input标记的，那么这个属性就作为输入属性\n2. 在parent_component.html内直接使用了students，那是因为在parent.module.ts内将child组件import进来了\n3. [students]这种形式叫属性绑定，绑定的值为school.schoolStudents属性\n4. Angular会把schoolStudents的值赋值给students，然后影响到子组件的显示\n\n所以我们可以总结，child_component中有数据要显示，但是这个数据的来源是通过parent_component.html中通过属性绑定的形式作为child组件的输入，要想child组件内的students属性能够成功赋值，那么必须使用@Input。\n\n`@Input`还可以使用typescript的get set存取器的方式来设置属性\n```\nprivate _name: string;\n\n@Input get name() {return this._name;}\nset(name:string) {this._name = name;}\n```\n\n## @Output\nOutput的数据流方向与input是相反的，所以那就是child控制parent的数据显示，input是parent控制child的数据显示。\n\n**注意**\nAngular 2中，@Output的实现必须使用EventEmitter来实现。 \n并且当你使用了tslint之后，变量不能加on，但是可以通过加入这样一段注释\n\n```\n// tslint:disable-next-line:no-output-on-prefix\n@Output() onRemoveElement = new EventEmitter<Element>();\n```\n\n形如：\n```\n// 要将EventEmitter先import进来。\nimport { Component, Input, Output, EventEmitter } from '@angular/core';\n...\n@Output() mySignal = new EventEmitter<boolean>();\n```\n\nEventEmitter();中间的boolean参数是你需要传递数据的类型，当然可以是基本类型，也可以是自定义类型。\n\n我们还是老样子，通过一个例子来分析一下吧。 \n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fxtu7s2pydj218a0ueq92.jpg)\n\n我们通过这张图可以看到，整个事件的流程，那我们来分析一下：\n\nchild组件内有一个Output customClick的事件，事件的数据类型是number\nchild组件内有一个onClicked方法，这个是应用在html中button控件的click事件中，通过(click)=”onClicked()”进行方法绑定\nparent组件内有一个public的属性showMsg,Angular的ts类默认不写关键字就是public。\n\nparent组件内有一个onCustomClicked方法，这个也是要用在html中的，是和child组件内的output标记的customClick事件进行绑定的\n步骤为child的html的button按钮被点击->onClicked方法被调用->emit(99)触发customClick->Angular通过Output数据流识别出发生变化并通知parent的html中(customClick)->onCustomClicked(event)被调用，event)被调用，event为数据99->改变了showMsg属性值->影响到了parent的html中的显示由1变为99。\n\n**小知识：**\n\n其实双向绑定就是这么实现的，只是将input和output一起使用即可达到目的。\n","slug":"0013-angular-output-input-analysis","published":1,"updated":"2018-12-04T02:02:02.369Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1q000igcoi6pd41z6l","content":"<h1 id=\"Output与-Input理解\"><a href=\"#Output与-Input理解\" class=\"headerlink\" title=\"@Output与@Input理解\"></a>@Output与@Input理解</h1><p>Output和Input是两个装饰器，是Angular2专门用来实现跨组件通讯，双向绑定等操作所用的。</p>\n<h2 id=\"Input\"><a href=\"#Input\" class=\"headerlink\" title=\"@Input\"></a>@Input</h2><p>Component本身是一种支持 nest 的结构，Child和Parent之间，如果Parent需要把数据传输给child并在child自己的页面中显示，则需要在Child的对应 directive 标示为 input。</p>\n<p>例如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Input() name: string;</span><br></pre></td></tr></table></figure></p>\n<p>我们通过一个例子来分析下<code>@Input</code>的流程。</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fxtu0ia0t7j216m0pgjwe.jpg\" alt=\"\"></p>\n<p>流程：</p>\n<ol>\n<li>child_component.ts内有students，并且是被@Input标记的，那么这个属性就作为输入属性</li>\n<li>在parent_component.html内直接使用了students，那是因为在parent.module.ts内将child组件import进来了</li>\n<li>[students]这种形式叫属性绑定，绑定的值为school.schoolStudents属性</li>\n<li>Angular会把schoolStudents的值赋值给students，然后影响到子组件的显示</li>\n</ol>\n<p>所以我们可以总结，child_component中有数据要显示，但是这个数据的来源是通过parent_component.html中通过属性绑定的形式作为child组件的输入，要想child组件内的students属性能够成功赋值，那么必须使用@Input。</p>\n<p><code>@Input</code>还可以使用typescript的get set存取器的方式来设置属性<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private _name: string;</span><br><span class=\"line\"></span><br><span class=\"line\">@Input get name() &#123;return this._name;&#125;</span><br><span class=\"line\">set(name:string) &#123;this._name = name;&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Output\"><a href=\"#Output\" class=\"headerlink\" title=\"@Output\"></a>@Output</h2><p>Output的数据流方向与input是相反的，所以那就是child控制parent的数据显示，input是parent控制child的数据显示。</p>\n<p><strong>注意</strong><br>Angular 2中，@Output的实现必须使用EventEmitter来实现。<br>并且当你使用了tslint之后，变量不能加on，但是可以通过加入这样一段注释</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// tslint:disable-next-line:no-output-on-prefix</span><br><span class=\"line\">@Output() onRemoveElement = new EventEmitter&lt;Element&gt;();</span><br></pre></td></tr></table></figure>\n<p>形如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 要将EventEmitter先import进来。</span><br><span class=\"line\">import &#123; Component, Input, Output, EventEmitter &#125; from &apos;@angular/core&apos;;</span><br><span class=\"line\">...</span><br><span class=\"line\">@Output() mySignal = new EventEmitter&lt;boolean&gt;();</span><br></pre></td></tr></table></figure></p>\n<p>EventEmitter();中间的boolean参数是你需要传递数据的类型，当然可以是基本类型，也可以是自定义类型。</p>\n<p>我们还是老样子，通过一个例子来分析一下吧。 </p>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fxtu7s2pydj218a0ueq92.jpg\" alt=\"\"></p>\n<p>我们通过这张图可以看到，整个事件的流程，那我们来分析一下：</p>\n<p>child组件内有一个Output customClick的事件，事件的数据类型是number<br>child组件内有一个onClicked方法，这个是应用在html中button控件的click事件中，通过(click)=”onClicked()”进行方法绑定<br>parent组件内有一个public的属性showMsg,Angular的ts类默认不写关键字就是public。</p>\n<p>parent组件内有一个onCustomClicked方法，这个也是要用在html中的，是和child组件内的output标记的customClick事件进行绑定的<br>步骤为child的html的button按钮被点击-&gt;onClicked方法被调用-&gt;emit(99)触发customClick-&gt;Angular通过Output数据流识别出发生变化并通知parent的html中(customClick)-&gt;onCustomClicked(event)被调用，event)被调用，event为数据99-&gt;改变了showMsg属性值-&gt;影响到了parent的html中的显示由1变为99。</p>\n<p><strong>小知识：</strong></p>\n<p>其实双向绑定就是这么实现的，只是将input和output一起使用即可达到目的。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Output与-Input理解\"><a href=\"#Output与-Input理解\" class=\"headerlink\" title=\"@Output与@Input理解\"></a>@Output与@Input理解</h1><p>Output和Input是两个装饰器，是Angular2专门用来实现跨组件通讯，双向绑定等操作所用的。</p>\n<h2 id=\"Input\"><a href=\"#Input\" class=\"headerlink\" title=\"@Input\"></a>@Input</h2><p>Component本身是一种支持 nest 的结构，Child和Parent之间，如果Parent需要把数据传输给child并在child自己的页面中显示，则需要在Child的对应 directive 标示为 input。</p>\n<p>例如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Input() name: string;</span><br></pre></td></tr></table></figure></p>\n<p>我们通过一个例子来分析下<code>@Input</code>的流程。</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fxtu0ia0t7j216m0pgjwe.jpg\" alt=\"\"></p>\n<p>流程：</p>\n<ol>\n<li>child_component.ts内有students，并且是被@Input标记的，那么这个属性就作为输入属性</li>\n<li>在parent_component.html内直接使用了students，那是因为在parent.module.ts内将child组件import进来了</li>\n<li>[students]这种形式叫属性绑定，绑定的值为school.schoolStudents属性</li>\n<li>Angular会把schoolStudents的值赋值给students，然后影响到子组件的显示</li>\n</ol>\n<p>所以我们可以总结，child_component中有数据要显示，但是这个数据的来源是通过parent_component.html中通过属性绑定的形式作为child组件的输入，要想child组件内的students属性能够成功赋值，那么必须使用@Input。</p>\n<p><code>@Input</code>还可以使用typescript的get set存取器的方式来设置属性<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private _name: string;</span><br><span class=\"line\"></span><br><span class=\"line\">@Input get name() &#123;return this._name;&#125;</span><br><span class=\"line\">set(name:string) &#123;this._name = name;&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Output\"><a href=\"#Output\" class=\"headerlink\" title=\"@Output\"></a>@Output</h2><p>Output的数据流方向与input是相反的，所以那就是child控制parent的数据显示，input是parent控制child的数据显示。</p>\n<p><strong>注意</strong><br>Angular 2中，@Output的实现必须使用EventEmitter来实现。<br>并且当你使用了tslint之后，变量不能加on，但是可以通过加入这样一段注释</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// tslint:disable-next-line:no-output-on-prefix</span><br><span class=\"line\">@Output() onRemoveElement = new EventEmitter&lt;Element&gt;();</span><br></pre></td></tr></table></figure>\n<p>形如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 要将EventEmitter先import进来。</span><br><span class=\"line\">import &#123; Component, Input, Output, EventEmitter &#125; from &apos;@angular/core&apos;;</span><br><span class=\"line\">...</span><br><span class=\"line\">@Output() mySignal = new EventEmitter&lt;boolean&gt;();</span><br></pre></td></tr></table></figure></p>\n<p>EventEmitter();中间的boolean参数是你需要传递数据的类型，当然可以是基本类型，也可以是自定义类型。</p>\n<p>我们还是老样子，通过一个例子来分析一下吧。 </p>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fxtu7s2pydj218a0ueq92.jpg\" alt=\"\"></p>\n<p>我们通过这张图可以看到，整个事件的流程，那我们来分析一下：</p>\n<p>child组件内有一个Output customClick的事件，事件的数据类型是number<br>child组件内有一个onClicked方法，这个是应用在html中button控件的click事件中，通过(click)=”onClicked()”进行方法绑定<br>parent组件内有一个public的属性showMsg,Angular的ts类默认不写关键字就是public。</p>\n<p>parent组件内有一个onCustomClicked方法，这个也是要用在html中的，是和child组件内的output标记的customClick事件进行绑定的<br>步骤为child的html的button按钮被点击-&gt;onClicked方法被调用-&gt;emit(99)触发customClick-&gt;Angular通过Output数据流识别出发生变化并通知parent的html中(customClick)-&gt;onCustomClicked(event)被调用，event)被调用，event为数据99-&gt;改变了showMsg属性值-&gt;影响到了parent的html中的显示由1变为99。</p>\n<p><strong>小知识：</strong></p>\n<p>其实双向绑定就是这么实现的，只是将input和output一起使用即可达到目的。</p>\n"},{"title":"【Nexus系列】之npm私服库配置","date":"2018-12-21T07:44:01.000Z","_content":"\n\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyd08s62ypj20xc0dwwmr.jpg)\n\n# 创建Repository\nNexus Repository Manager 3 可以用于多种类型的包管理。 因工作需要，需要配置基于Nexus 3的npm包管理。\n\n\n> Nexus默认账号: admin/admin123\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fycz6n4q9cj20xr0hrac9.jpg)\n\n1. 选择配置页面\n2. 选择左侧的Repositories\n3. 点击Create repository功能\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fycz8kaf4jj20gk0o7ta9.jpg)\n\n这样就会看到Nexus 3支持的repository类型。对于Java开发者maven2的应该就很熟悉了。\n\n仔细观察会发现，每一种repository都包含三种类型可以创建, group, hosted,proxy。下面分别对每种做说明：\n\n- proxy\n\n根据proxy名字，就可以想象的出这种类型的repository是用来坐代理的。比如我们在建Maven私服，需要和中央库连通，此时就需要用proxy来创建repository。见Nexus模式的maven-central库。\n\n- hosted\n\n这种repository可以简单的理解为用于私有的，内部的repository。我们工作中开发的一些工具，组件库等不方便放到中央库，但是却又需要在公司内部共享，就需要创建hosted类型的repository，用于发布公司内部的组件。见maven-releases, maven-snapshots。\n\n- group\n\n最后来说说group类型。其实这种类型是一种虚拟的repository，用于将proxy和hosted类型的repository组合成一个，方便使用者使用。如maven-public, 在里面既包含了maven-central，同时也包含了maven-releases, maven-snapshots,这样，不管是网上中央库的jar包，还是我们自己发布的jar都可以通过maven-public来获取到。\n\n结合maven repository配置的经验，对于npm repository也采用同样的套路配置。\n\n1. 配置proxy库\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyczoph1jbj20kj0dbdgk.jpg)\n在proxy类型的配置界面，发现里面的Name、Remote storage是必填的。Name可以随便填。Remote storage需要填类似maven中央库的地址，这里npm的选择淘宝的私服地址`https://registry.npm.taobao.org`\n\n2. 配置hosted库\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyczsmhcnbj20is0i6wf5.jpg)\n\nhosted库配置比较简单，只需要填写name就可以了。\n\n3. 配置Group库\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fycztxee51j20l50l1mxw.jpg)\n\n在group配置中，name同样是必须的。此外还多了一个members的配置，将左侧的npm-hosted,npm-proxy添加到右侧的members中，这样就可以通过group同时访问npm-hosted,npm-proxy中的资源了。\n\n\n\n# 发布到npm私服\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyczztbu5ij20k009jgp4.jpg)\n\n首先，需要配置权限，将npm Bearer Token Realm启用。\n\n配置本机的npm登陆\n```\nnpm login --registry=http://localhost:8888/repository/npm-hosted/\n```\n然后输入用户名密码，邮箱，成功后会在`.npmrc`文件中生成一条记录\n\n```\n//localhost:8888/repository/npm-hosted/:_authToken=NpmToken.16b06a38-cae5-32ca-8a5f-2310ef16e156\n```\n在确保项目有 package.json 前提下，执行：\n\n```\nnpm publish  --registry=http://localhost:8888/repository/npm-hosted/\n\n```\n即可在私服中查询到已发的npm组件\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyd02la9jnj21h60ez3zv.jpg)\n\n\n---\n\n> Author ：笑笑粑粑  \n> 曾用网名：TinyKing  \n> 微信公众号：Java码农  \n> 知乎专栏： [爱笑笑爱分享](https://zhuanlan.zhihu.com/tinyking)  \n> 个人博客： [爱笑笑，爱生活](https://www.wangjianchao.cn/)  \n> 自我评价： 一个爱好广泛的CRUD程序猿 \\^_^   ","source":"_posts/0014-create-npm-repository-with-nexus.md","raw":"---\ntitle: 【Nexus系列】之npm私服库配置\ndate: 2018-12-21 15:44:01\ntags:\n    - npm\n    - Nexus\n---\n\n\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyd08s62ypj20xc0dwwmr.jpg)\n\n# 创建Repository\nNexus Repository Manager 3 可以用于多种类型的包管理。 因工作需要，需要配置基于Nexus 3的npm包管理。\n\n\n> Nexus默认账号: admin/admin123\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fycz6n4q9cj20xr0hrac9.jpg)\n\n1. 选择配置页面\n2. 选择左侧的Repositories\n3. 点击Create repository功能\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fycz8kaf4jj20gk0o7ta9.jpg)\n\n这样就会看到Nexus 3支持的repository类型。对于Java开发者maven2的应该就很熟悉了。\n\n仔细观察会发现，每一种repository都包含三种类型可以创建, group, hosted,proxy。下面分别对每种做说明：\n\n- proxy\n\n根据proxy名字，就可以想象的出这种类型的repository是用来坐代理的。比如我们在建Maven私服，需要和中央库连通，此时就需要用proxy来创建repository。见Nexus模式的maven-central库。\n\n- hosted\n\n这种repository可以简单的理解为用于私有的，内部的repository。我们工作中开发的一些工具，组件库等不方便放到中央库，但是却又需要在公司内部共享，就需要创建hosted类型的repository，用于发布公司内部的组件。见maven-releases, maven-snapshots。\n\n- group\n\n最后来说说group类型。其实这种类型是一种虚拟的repository，用于将proxy和hosted类型的repository组合成一个，方便使用者使用。如maven-public, 在里面既包含了maven-central，同时也包含了maven-releases, maven-snapshots,这样，不管是网上中央库的jar包，还是我们自己发布的jar都可以通过maven-public来获取到。\n\n结合maven repository配置的经验，对于npm repository也采用同样的套路配置。\n\n1. 配置proxy库\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyczoph1jbj20kj0dbdgk.jpg)\n在proxy类型的配置界面，发现里面的Name、Remote storage是必填的。Name可以随便填。Remote storage需要填类似maven中央库的地址，这里npm的选择淘宝的私服地址`https://registry.npm.taobao.org`\n\n2. 配置hosted库\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyczsmhcnbj20is0i6wf5.jpg)\n\nhosted库配置比较简单，只需要填写name就可以了。\n\n3. 配置Group库\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fycztxee51j20l50l1mxw.jpg)\n\n在group配置中，name同样是必须的。此外还多了一个members的配置，将左侧的npm-hosted,npm-proxy添加到右侧的members中，这样就可以通过group同时访问npm-hosted,npm-proxy中的资源了。\n\n\n\n# 发布到npm私服\n\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyczztbu5ij20k009jgp4.jpg)\n\n首先，需要配置权限，将npm Bearer Token Realm启用。\n\n配置本机的npm登陆\n```\nnpm login --registry=http://localhost:8888/repository/npm-hosted/\n```\n然后输入用户名密码，邮箱，成功后会在`.npmrc`文件中生成一条记录\n\n```\n//localhost:8888/repository/npm-hosted/:_authToken=NpmToken.16b06a38-cae5-32ca-8a5f-2310ef16e156\n```\n在确保项目有 package.json 前提下，执行：\n\n```\nnpm publish  --registry=http://localhost:8888/repository/npm-hosted/\n\n```\n即可在私服中查询到已发的npm组件\n![](https://ws1.sinaimg.cn/large/806e3151ly1fyd02la9jnj21h60ez3zv.jpg)\n\n\n---\n\n> Author ：笑笑粑粑  \n> 曾用网名：TinyKing  \n> 微信公众号：Java码农  \n> 知乎专栏： [爱笑笑爱分享](https://zhuanlan.zhihu.com/tinyking)  \n> 个人博客： [爱笑笑，爱生活](https://www.wangjianchao.cn/)  \n> 自我评价： 一个爱好广泛的CRUD程序猿 \\^_^   ","slug":"0014-create-npm-repository-with-nexus","published":1,"updated":"2018-12-21T08:04:38.590Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1q000kgcoi06de6c1c","content":"<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyd08s62ypj20xc0dwwmr.jpg\" alt=\"\"></p>\n<h1 id=\"创建Repository\"><a href=\"#创建Repository\" class=\"headerlink\" title=\"创建Repository\"></a>创建Repository</h1><p>Nexus Repository Manager 3 可以用于多种类型的包管理。 因工作需要，需要配置基于Nexus 3的npm包管理。</p>\n<blockquote>\n<p>Nexus默认账号: admin/admin123</p>\n</blockquote>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fycz6n4q9cj20xr0hrac9.jpg\" alt=\"\"></p>\n<ol>\n<li>选择配置页面</li>\n<li>选择左侧的Repositories</li>\n<li>点击Create repository功能</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fycz8kaf4jj20gk0o7ta9.jpg\" alt=\"\"></p>\n<p>这样就会看到Nexus 3支持的repository类型。对于Java开发者maven2的应该就很熟悉了。</p>\n<p>仔细观察会发现，每一种repository都包含三种类型可以创建, group, hosted,proxy。下面分别对每种做说明：</p>\n<ul>\n<li>proxy</li>\n</ul>\n<p>根据proxy名字，就可以想象的出这种类型的repository是用来坐代理的。比如我们在建Maven私服，需要和中央库连通，此时就需要用proxy来创建repository。见Nexus模式的maven-central库。</p>\n<ul>\n<li>hosted</li>\n</ul>\n<p>这种repository可以简单的理解为用于私有的，内部的repository。我们工作中开发的一些工具，组件库等不方便放到中央库，但是却又需要在公司内部共享，就需要创建hosted类型的repository，用于发布公司内部的组件。见maven-releases, maven-snapshots。</p>\n<ul>\n<li>group</li>\n</ul>\n<p>最后来说说group类型。其实这种类型是一种虚拟的repository，用于将proxy和hosted类型的repository组合成一个，方便使用者使用。如maven-public, 在里面既包含了maven-central，同时也包含了maven-releases, maven-snapshots,这样，不管是网上中央库的jar包，还是我们自己发布的jar都可以通过maven-public来获取到。</p>\n<p>结合maven repository配置的经验，对于npm repository也采用同样的套路配置。</p>\n<ol>\n<li>配置proxy库</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyczoph1jbj20kj0dbdgk.jpg\" alt=\"\"><br>在proxy类型的配置界面，发现里面的Name、Remote storage是必填的。Name可以随便填。Remote storage需要填类似maven中央库的地址，这里npm的选择淘宝的私服地址<code>https://registry.npm.taobao.org</code></p>\n<ol start=\"2\">\n<li>配置hosted库<br><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyczsmhcnbj20is0i6wf5.jpg\" alt=\"\"></li>\n</ol>\n<p>hosted库配置比较简单，只需要填写name就可以了。</p>\n<ol start=\"3\">\n<li>配置Group库</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fycztxee51j20l50l1mxw.jpg\" alt=\"\"></p>\n<p>在group配置中，name同样是必须的。此外还多了一个members的配置，将左侧的npm-hosted,npm-proxy添加到右侧的members中，这样就可以通过group同时访问npm-hosted,npm-proxy中的资源了。</p>\n<h1 id=\"发布到npm私服\"><a href=\"#发布到npm私服\" class=\"headerlink\" title=\"发布到npm私服\"></a>发布到npm私服</h1><p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyczztbu5ij20k009jgp4.jpg\" alt=\"\"></p>\n<p>首先，需要配置权限，将npm Bearer Token Realm启用。</p>\n<p>配置本机的npm登陆<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm login --registry=http://localhost:8888/repository/npm-hosted/</span><br></pre></td></tr></table></figure></p>\n<p>然后输入用户名密码，邮箱，成功后会在<code>.npmrc</code>文件中生成一条记录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//localhost:8888/repository/npm-hosted/:_authToken=NpmToken.16b06a38-cae5-32ca-8a5f-2310ef16e156</span><br></pre></td></tr></table></figure>\n<p>在确保项目有 package.json 前提下，执行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm publish  --registry=http://localhost:8888/repository/npm-hosted/</span><br></pre></td></tr></table></figure>\n<p>即可在私服中查询到已发的npm组件<br><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyd02la9jnj21h60ez3zv.jpg\" alt=\"\"></p>\n<hr>\n<blockquote>\n<p>Author ：笑笑粑粑<br>曾用网名：TinyKing<br>微信公众号：Java码农<br>知乎专栏： <a href=\"https://zhuanlan.zhihu.com/tinyking\" target=\"_blank\" rel=\"noopener\">爱笑笑爱分享</a><br>个人博客： <a href=\"https://www.wangjianchao.cn/\" target=\"_blank\" rel=\"noopener\">爱笑笑，爱生活</a><br>自我评价： 一个爱好广泛的CRUD程序猿 \\^_^   </p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyd08s62ypj20xc0dwwmr.jpg\" alt=\"\"></p>\n<h1 id=\"创建Repository\"><a href=\"#创建Repository\" class=\"headerlink\" title=\"创建Repository\"></a>创建Repository</h1><p>Nexus Repository Manager 3 可以用于多种类型的包管理。 因工作需要，需要配置基于Nexus 3的npm包管理。</p>\n<blockquote>\n<p>Nexus默认账号: admin/admin123</p>\n</blockquote>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fycz6n4q9cj20xr0hrac9.jpg\" alt=\"\"></p>\n<ol>\n<li>选择配置页面</li>\n<li>选择左侧的Repositories</li>\n<li>点击Create repository功能</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fycz8kaf4jj20gk0o7ta9.jpg\" alt=\"\"></p>\n<p>这样就会看到Nexus 3支持的repository类型。对于Java开发者maven2的应该就很熟悉了。</p>\n<p>仔细观察会发现，每一种repository都包含三种类型可以创建, group, hosted,proxy。下面分别对每种做说明：</p>\n<ul>\n<li>proxy</li>\n</ul>\n<p>根据proxy名字，就可以想象的出这种类型的repository是用来坐代理的。比如我们在建Maven私服，需要和中央库连通，此时就需要用proxy来创建repository。见Nexus模式的maven-central库。</p>\n<ul>\n<li>hosted</li>\n</ul>\n<p>这种repository可以简单的理解为用于私有的，内部的repository。我们工作中开发的一些工具，组件库等不方便放到中央库，但是却又需要在公司内部共享，就需要创建hosted类型的repository，用于发布公司内部的组件。见maven-releases, maven-snapshots。</p>\n<ul>\n<li>group</li>\n</ul>\n<p>最后来说说group类型。其实这种类型是一种虚拟的repository，用于将proxy和hosted类型的repository组合成一个，方便使用者使用。如maven-public, 在里面既包含了maven-central，同时也包含了maven-releases, maven-snapshots,这样，不管是网上中央库的jar包，还是我们自己发布的jar都可以通过maven-public来获取到。</p>\n<p>结合maven repository配置的经验，对于npm repository也采用同样的套路配置。</p>\n<ol>\n<li>配置proxy库</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyczoph1jbj20kj0dbdgk.jpg\" alt=\"\"><br>在proxy类型的配置界面，发现里面的Name、Remote storage是必填的。Name可以随便填。Remote storage需要填类似maven中央库的地址，这里npm的选择淘宝的私服地址<code>https://registry.npm.taobao.org</code></p>\n<ol start=\"2\">\n<li>配置hosted库<br><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyczsmhcnbj20is0i6wf5.jpg\" alt=\"\"></li>\n</ol>\n<p>hosted库配置比较简单，只需要填写name就可以了。</p>\n<ol start=\"3\">\n<li>配置Group库</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fycztxee51j20l50l1mxw.jpg\" alt=\"\"></p>\n<p>在group配置中，name同样是必须的。此外还多了一个members的配置，将左侧的npm-hosted,npm-proxy添加到右侧的members中，这样就可以通过group同时访问npm-hosted,npm-proxy中的资源了。</p>\n<h1 id=\"发布到npm私服\"><a href=\"#发布到npm私服\" class=\"headerlink\" title=\"发布到npm私服\"></a>发布到npm私服</h1><p><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyczztbu5ij20k009jgp4.jpg\" alt=\"\"></p>\n<p>首先，需要配置权限，将npm Bearer Token Realm启用。</p>\n<p>配置本机的npm登陆<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm login --registry=http://localhost:8888/repository/npm-hosted/</span><br></pre></td></tr></table></figure></p>\n<p>然后输入用户名密码，邮箱，成功后会在<code>.npmrc</code>文件中生成一条记录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//localhost:8888/repository/npm-hosted/:_authToken=NpmToken.16b06a38-cae5-32ca-8a5f-2310ef16e156</span><br></pre></td></tr></table></figure>\n<p>在确保项目有 package.json 前提下，执行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm publish  --registry=http://localhost:8888/repository/npm-hosted/</span><br></pre></td></tr></table></figure>\n<p>即可在私服中查询到已发的npm组件<br><img src=\"https://ws1.sinaimg.cn/large/806e3151ly1fyd02la9jnj21h60ez3zv.jpg\" alt=\"\"></p>\n<hr>\n<blockquote>\n<p>Author ：笑笑粑粑<br>曾用网名：TinyKing<br>微信公众号：Java码农<br>知乎专栏： <a href=\"https://zhuanlan.zhihu.com/tinyking\" target=\"_blank\" rel=\"noopener\">爱笑笑爱分享</a><br>个人博客： <a href=\"https://www.wangjianchao.cn/\" target=\"_blank\" rel=\"noopener\">爱笑笑，爱生活</a><br>自我评价： 一个爱好广泛的CRUD程序猿 \\^_^   </p>\n</blockquote>\n"},{"title":"Angular项目中集成Font Awesome图标","date":"2019-04-15T09:48:00.000Z","_content":"\n\n![素材制作.png](https://cdn.nlark.com/yuque/0/2019/png/269363/1555038251526-53b022c7-d2ea-4e41-adcd-dd4a4454c98b.png#align=left&display=inline&height=420&name=%E7%B4%A0%E6%9D%90%E5%88%B6%E4%BD%9C.png&originHeight=720&originWidth=1280&size=588090&status=done&width=746)<br /><br />通过三部操作就可以在Angular项目中使用Font Awesome图标：\n1. 安装\n1. 样式配置\n1. 使用\n\n<a name=\"e655a410\"></a>\n# 安装\n通过 `NPM` 安装，并保存到 `package.json` \n\n```\nnpm install --save font-awesome\n```\n\n<a name=\"9ae6f0a6\"></a>\n# 配置样式 css\n在 `style.css` \n\n```css\n@import '~font-awesome/css/font-awesome.css';\n```\n\n<a name=\"ca2b37d4\"></a>\n# 配置样式 scss\n在 `style.scss` \n\n```css\n$fa-font-path: \"../node_modules/font-awesome/fonts\";\n@import '~font-awesome/scss/font-awesome.scss';\n```\n\n<a name=\"1e1072c7\"></a>\n# 在Angular使用\n\n```html\n<i class=\"fa fa-area-chart\"></i>\n```\n\n<a name=\"c7feb89a\"></a>\n# 配合Angular Material \n\n```typescript\nexport class AppModule {\n  constructor(matIconRegistry: MatIconRegistry) {\n    matIconRegistry.registerFontClassAlias('fontawesome', 'fa');\n  }\n}\n```\n\n```html\n<mat-icon fontSet=\"fontawesome\" fontIcon=\"fa-area-chart\"></mat-icon>\n```\n","source":"_posts/0015-angular-font-awesome.md","raw":"---\ntitle: Angular项目中集成Font Awesome图标\ndate: 2019-04-15 17:48\ntags:\n    - Augular\n---\n\n\n![素材制作.png](https://cdn.nlark.com/yuque/0/2019/png/269363/1555038251526-53b022c7-d2ea-4e41-adcd-dd4a4454c98b.png#align=left&display=inline&height=420&name=%E7%B4%A0%E6%9D%90%E5%88%B6%E4%BD%9C.png&originHeight=720&originWidth=1280&size=588090&status=done&width=746)<br /><br />通过三部操作就可以在Angular项目中使用Font Awesome图标：\n1. 安装\n1. 样式配置\n1. 使用\n\n<a name=\"e655a410\"></a>\n# 安装\n通过 `NPM` 安装，并保存到 `package.json` \n\n```\nnpm install --save font-awesome\n```\n\n<a name=\"9ae6f0a6\"></a>\n# 配置样式 css\n在 `style.css` \n\n```css\n@import '~font-awesome/css/font-awesome.css';\n```\n\n<a name=\"ca2b37d4\"></a>\n# 配置样式 scss\n在 `style.scss` \n\n```css\n$fa-font-path: \"../node_modules/font-awesome/fonts\";\n@import '~font-awesome/scss/font-awesome.scss';\n```\n\n<a name=\"1e1072c7\"></a>\n# 在Angular使用\n\n```html\n<i class=\"fa fa-area-chart\"></i>\n```\n\n<a name=\"c7feb89a\"></a>\n# 配合Angular Material \n\n```typescript\nexport class AppModule {\n  constructor(matIconRegistry: MatIconRegistry) {\n    matIconRegistry.registerFontClassAlias('fontawesome', 'fa');\n  }\n}\n```\n\n```html\n<mat-icon fontSet=\"fontawesome\" fontIcon=\"fa-area-chart\"></mat-icon>\n```\n","slug":"0015-angular-font-awesome","published":1,"updated":"2019-04-22T04:02:04.768Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1s000ngcoi1kuwpsej","content":"<p><img src=\"https://cdn.nlark.com/yuque/0/2019/png/269363/1555038251526-53b022c7-d2ea-4e41-adcd-dd4a4454c98b.png#align=left&amp;display=inline&amp;height=420&amp;name=%E7%B4%A0%E6%9D%90%E5%88%B6%E4%BD%9C.png&amp;originHeight=720&amp;originWidth=1280&amp;size=588090&amp;status=done&amp;width=746\" alt=\"素材制作.png\"><br><br>通过三部操作就可以在Angular项目中使用Font Awesome图标：</p>\n<ol>\n<li>安装</li>\n<li>样式配置</li>\n<li>使用</li>\n</ol>\n<p><a name=\"e655a410\"></a></p>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><p>通过 <code>NPM</code> 安装，并保存到 <code>package.json</code> </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save font-awesome</span><br></pre></td></tr></table></figure>\n<p><a name=\"9ae6f0a6\"></a></p>\n<h1 id=\"配置样式-css\"><a href=\"#配置样式-css\" class=\"headerlink\" title=\"配置样式 css\"></a>配置样式 css</h1><p>在 <code>style.css</code> </p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">'~font-awesome/css/font-awesome.css'</span>;</span><br></pre></td></tr></table></figure>\n<p><a name=\"ca2b37d4\"></a></p>\n<h1 id=\"配置样式-scss\"><a href=\"#配置样式-scss\" class=\"headerlink\" title=\"配置样式 scss\"></a>配置样式 scss</h1><p>在 <code>style.scss</code> </p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$fa-font-path: \"../node_modules/font-awesome/fonts\";</span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">'~font-awesome/scss/font-awesome.scss'</span>;</span><br></pre></td></tr></table></figure>\n<p><a name=\"1e1072c7\"></a></p>\n<h1 id=\"在Angular使用\"><a href=\"#在Angular使用\" class=\"headerlink\" title=\"在Angular使用\"></a>在Angular使用</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fa fa-area-chart\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><a name=\"c7feb89a\"></a></p>\n<h1 id=\"配合Angular-Material\"><a href=\"#配合Angular-Material\" class=\"headerlink\" title=\"配合Angular Material\"></a>配合Angular Material</h1><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppModule &#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\">matIconRegistry: MatIconRegistry</span>) &#123;</span><br><span class=\"line\">    matIconRegistry.registerFontClassAlias(<span class=\"string\">'fontawesome'</span>, <span class=\"string\">'fa'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mat-icon</span> <span class=\"attr\">fontSet</span>=<span class=\"string\">\"fontawesome\"</span> <span class=\"attr\">fontIcon</span>=<span class=\"string\">\"fa-area-chart\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">mat-icon</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"https://cdn.nlark.com/yuque/0/2019/png/269363/1555038251526-53b022c7-d2ea-4e41-adcd-dd4a4454c98b.png#align=left&amp;display=inline&amp;height=420&amp;name=%E7%B4%A0%E6%9D%90%E5%88%B6%E4%BD%9C.png&amp;originHeight=720&amp;originWidth=1280&amp;size=588090&amp;status=done&amp;width=746\" alt=\"素材制作.png\"><br><br>通过三部操作就可以在Angular项目中使用Font Awesome图标：</p>\n<ol>\n<li>安装</li>\n<li>样式配置</li>\n<li>使用</li>\n</ol>\n<p><a name=\"e655a410\"></a></p>\n<h1 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h1><p>通过 <code>NPM</code> 安装，并保存到 <code>package.json</code> </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save font-awesome</span><br></pre></td></tr></table></figure>\n<p><a name=\"9ae6f0a6\"></a></p>\n<h1 id=\"配置样式-css\"><a href=\"#配置样式-css\" class=\"headerlink\" title=\"配置样式 css\"></a>配置样式 css</h1><p>在 <code>style.css</code> </p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">'~font-awesome/css/font-awesome.css'</span>;</span><br></pre></td></tr></table></figure>\n<p><a name=\"ca2b37d4\"></a></p>\n<h1 id=\"配置样式-scss\"><a href=\"#配置样式-scss\" class=\"headerlink\" title=\"配置样式 scss\"></a>配置样式 scss</h1><p>在 <code>style.scss</code> </p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$fa-font-path: \"../node_modules/font-awesome/fonts\";</span><br><span class=\"line\">@<span class=\"keyword\">import</span> <span class=\"string\">'~font-awesome/scss/font-awesome.scss'</span>;</span><br></pre></td></tr></table></figure>\n<p><a name=\"1e1072c7\"></a></p>\n<h1 id=\"在Angular使用\"><a href=\"#在Angular使用\" class=\"headerlink\" title=\"在Angular使用\"></a>在Angular使用</h1><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"fa fa-area-chart\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><a name=\"c7feb89a\"></a></p>\n<h1 id=\"配合Angular-Material\"><a href=\"#配合Angular-Material\" class=\"headerlink\" title=\"配合Angular Material\"></a>配合Angular Material</h1><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppModule &#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\">matIconRegistry: MatIconRegistry</span>) &#123;</span><br><span class=\"line\">    matIconRegistry.registerFontClassAlias(<span class=\"string\">'fontawesome'</span>, <span class=\"string\">'fa'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mat-icon</span> <span class=\"attr\">fontSet</span>=<span class=\"string\">\"fontawesome\"</span> <span class=\"attr\">fontIcon</span>=<span class=\"string\">\"fa-area-chart\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">mat-icon</span>&gt;</span></span><br></pre></td></tr></table></figure>\n"},{"title":"程序员如何精确评估开发时间？","date":"2019-04-16T12:11:01.000Z","_content":"\n> 来源：Eric_LG\n>\n> blog.csdn.net/gang544043963/article/details/83934015\n\n一个程序员能否精确评估开发时间，是一件非常重要的事情。如果你掌握了这项技能，你在别人的眼里就会是这样：\n\n- 靠谱\n- 经验十足\n- 对需求很了解\n- 延期风险小\n- 合格的软件工程师\n- 正规军，不是野路子\n\n### 评估开发时间的重要性\n\n首先，在一个项目中，所有的环节都是承上启下的，上一个环节结束的时间节点正是下一个环节开始的节点。那么在一个项目或者一次迭代正式启动前，所有的环节都应该有个时间评估。以一次APP需求迭代为例，项目计划像这样：\n\n- UI设计图 11.01 - 11.03（3工作日）\n- API接口讨论与设计 11.04（1工作日）\n- 移动端开发 11.05 - 11.15（8工作日）\n- 后端具备联调条件：11.11\n- 产品体验 11.16 - 11.17（2工作日）\n- 测试11.18 - 11.25（5工作日）\n- 发布11.26\n\n根据项目计划，各个部门自己要分配人员和时间。如果其中一个环节延期了，那么后面的各个环节都要顺延，就会造成损失。\n\n其次，对于程序员来说，一个清晰的开发计划有助于自己有条不紊地开展工作，也能避免疏漏某个功能点。评估时间的过程，也是对需求详细拆分的过程，了解要做什么，做成什么样子。在评估的过程中，根据专业知识和经验，充分预估会遇到的风险，怎样的解决方案，预留多少时间？都想好了的话，项目也就没啥风险了。\n\n然而，开发时间评估，最大的好处是程序员受益。认真地评估开发时间，会让你在开始动手写代码之前搞清楚要怎么写，每个模块的设计心理得有个谱。从宏观上拆分模块，然后详细地分解任务，具体到一个很小的功能点。这样你就能清晰地设计代码，而不是堆代码。也避免了很多时候写着写着发现不对，然后拉到重来的境地。就是要让你动手写代码之前胸有成竹！\n\n### 初学者为什么评估不准？\n\n如果你的项目经常delay，那么八成是时间评估不准。\n\n刚毕业的学生被问到什么时候可以完成的时候，脑门一拍：“三天”，实际上两个星期过去了还没完成。\n\n这里有一张表，看看你是不是这样子，对号入座：\n\n![](https://wx1.sinaimg.cn/mw690/806e3151ly1g24quvbhswj20ia0ipk5w.jpg)\n\n越是老程序员越是“胆小”，评估时间越准。\n\n### 如何精确评估开发时间\n\n最近几年，我都是以小时为单位进行时间评估的，有没有觉得有点恐怖？长期以来这样的习惯让我收获颇多。这得感谢我之前的领导，三年前强迫我们这样做，刚开始很抵触，后来才体会到其中的甜头。\n\n**1、任务拆分**\n\n拿到新需求后，对其进行充分了解，不清楚的就去问清楚，然后对其进行模块化。之后，再进行技术上的拆分。由大到小，再到细节。细到什么程度呢？细到一个按钮的实现，细到一个点击动作是要用按钮还是要用手势的定夺，最好能细到代码块的划分。\n\n这个能力是需要锻炼的，做好拆分，然后在实际开发过程中根据实际时间花销，回顾时间评估的准确性，以便让下次更准确。慢慢地，就会越来越精确，评估时间有依有据，不再是拍脑门给出的时间。下面看一个例子：\n\n![](https://wx2.sinaimg.cn/mw690/806e3151ly1g24quz2fa6j20je040gnc.jpg)\n\n**2、合理认知时间**\n\n一天工作八小时，但你不可能专注地连续八小时在编写代码。一天的工作中，有开会、讨论、阶段性休息（刷新闻、喝咖啡、发呆）的时间开销，真正有效时间其实不足六小时，杂事多的话可能是四五个小时。\n\n**3、预留buffer(缓冲区)**\n\n首先明确，预留buffer不是让你随便增加预估量，而是要明确知道buffer是给那些事情用的。要考虑到一下几点：\n\n首先是沟通时间，你开发的时候不可能是闷着头一直写代码。要和UI设计师沟通，要和产品经理沟通，有可能还需要和组内的人沟通技术上的事情，以及和别的技术小组对接的问题。\n\n等待时间。如果牵扯多部门协作，会有很多等待时间，因为你不能保证别的部门就能准确按照计划时间完成的。虽然等待过程中你可以安排其他任务，但你不能保证其他任务就能刚好填充等待时间，更何况任务切换也需要时间成本。\n\n突发状况。例如，bug修改、需求微调、对接人请假。\n\n不确定时间。和其他部门有交集的工作，最好多预留buffer。比如移动端和后台联调。后端信誓旦旦给你说11.11号可以进行联调，这次联调总共5个接口。如果你简单地认为他们给你提供的接口没问题，并且能顺利请求回来数据，预计一天联调时间足以，那你就等着delay吧。11.10号你已经准备好了所有联调准备，如果数据能正确返回，你的解析功能都是OK的，因为你之前用假数据已经处理的好好的。到了11号，你请求第一个接口就报错了，然后在即时通讯软件上问他们怎么回事，半个小时后给你回了“不好意思，地址变了，你用这个试试”。又错了……。终于回来数据了，然后发现缺少两个字段……。就这样，第一个接口调通已经快下班了。（当然很多后端技术人员也是很靠谱的，举这个例子只是为了让多考虑）\n\n以上是可能会出现的状况，实际中有可能只是出现了一部分，这要根据实际情况而定。并不是让你能多预留buffer就多留，毕竟每个项目的时间都是很紧张的。一般buffer留在15%-25%。\n\n**4、回头看**\n\n在实际开发过程中，测量实际花费时间，并与估算相比较。如果有些地方相差较大，就要看差在哪里，然后在下次预估中避免相同的差错。\n\n### 总结\n\n编程经验不等同于估算经验。一个不被包含在估算流程中的开发者将不会擅长估算。同样，如果实际的时间花费不被测量和用于与估算比较，那么将没有反馈来学习。\n\n最后，每个程序员都应该具备估算的技能。为磨练这个技能，接手每个任务时，先决定你要做什么。然后在开始之前估算任务所需时间。最后测量实际花费时间，并与估算相比较。同样比较你实际完成的与计划完成的。这样你将会既提高你对一个任务包含细节的理解，同样也提高了你的估算技能。\n\n尽管进行了精确估算，也不能保证每个项目都会100%精确。偶尔会遇到一些突发情况和没预估到的风险是不可避免的。那么面对风险，有一些原则可以帮助你：\n\n- 报风险时间置前，如果开发开始或者任何过程有可能导致项目延期或者需求无法实现的时候就报警，不要等加班能实现或者存在侥幸心理；\n- 对于不确定的需求，一定要沟通到位；\n- 涉及到交互细节，必须提前沟通好，充分明确细节；\n- 技术可行性方案提前调查清楚。\n\n\n完结~~~~~~~","source":"_posts/0017-Accurate assessment of working hours.md","raw":"---\ntitle: 程序员如何精确评估开发时间？\ndate: 2019-04-16 20:11:01\n---\n\n> 来源：Eric_LG\n>\n> blog.csdn.net/gang544043963/article/details/83934015\n\n一个程序员能否精确评估开发时间，是一件非常重要的事情。如果你掌握了这项技能，你在别人的眼里就会是这样：\n\n- 靠谱\n- 经验十足\n- 对需求很了解\n- 延期风险小\n- 合格的软件工程师\n- 正规军，不是野路子\n\n### 评估开发时间的重要性\n\n首先，在一个项目中，所有的环节都是承上启下的，上一个环节结束的时间节点正是下一个环节开始的节点。那么在一个项目或者一次迭代正式启动前，所有的环节都应该有个时间评估。以一次APP需求迭代为例，项目计划像这样：\n\n- UI设计图 11.01 - 11.03（3工作日）\n- API接口讨论与设计 11.04（1工作日）\n- 移动端开发 11.05 - 11.15（8工作日）\n- 后端具备联调条件：11.11\n- 产品体验 11.16 - 11.17（2工作日）\n- 测试11.18 - 11.25（5工作日）\n- 发布11.26\n\n根据项目计划，各个部门自己要分配人员和时间。如果其中一个环节延期了，那么后面的各个环节都要顺延，就会造成损失。\n\n其次，对于程序员来说，一个清晰的开发计划有助于自己有条不紊地开展工作，也能避免疏漏某个功能点。评估时间的过程，也是对需求详细拆分的过程，了解要做什么，做成什么样子。在评估的过程中，根据专业知识和经验，充分预估会遇到的风险，怎样的解决方案，预留多少时间？都想好了的话，项目也就没啥风险了。\n\n然而，开发时间评估，最大的好处是程序员受益。认真地评估开发时间，会让你在开始动手写代码之前搞清楚要怎么写，每个模块的设计心理得有个谱。从宏观上拆分模块，然后详细地分解任务，具体到一个很小的功能点。这样你就能清晰地设计代码，而不是堆代码。也避免了很多时候写着写着发现不对，然后拉到重来的境地。就是要让你动手写代码之前胸有成竹！\n\n### 初学者为什么评估不准？\n\n如果你的项目经常delay，那么八成是时间评估不准。\n\n刚毕业的学生被问到什么时候可以完成的时候，脑门一拍：“三天”，实际上两个星期过去了还没完成。\n\n这里有一张表，看看你是不是这样子，对号入座：\n\n![](https://wx1.sinaimg.cn/mw690/806e3151ly1g24quvbhswj20ia0ipk5w.jpg)\n\n越是老程序员越是“胆小”，评估时间越准。\n\n### 如何精确评估开发时间\n\n最近几年，我都是以小时为单位进行时间评估的，有没有觉得有点恐怖？长期以来这样的习惯让我收获颇多。这得感谢我之前的领导，三年前强迫我们这样做，刚开始很抵触，后来才体会到其中的甜头。\n\n**1、任务拆分**\n\n拿到新需求后，对其进行充分了解，不清楚的就去问清楚，然后对其进行模块化。之后，再进行技术上的拆分。由大到小，再到细节。细到什么程度呢？细到一个按钮的实现，细到一个点击动作是要用按钮还是要用手势的定夺，最好能细到代码块的划分。\n\n这个能力是需要锻炼的，做好拆分，然后在实际开发过程中根据实际时间花销，回顾时间评估的准确性，以便让下次更准确。慢慢地，就会越来越精确，评估时间有依有据，不再是拍脑门给出的时间。下面看一个例子：\n\n![](https://wx2.sinaimg.cn/mw690/806e3151ly1g24quz2fa6j20je040gnc.jpg)\n\n**2、合理认知时间**\n\n一天工作八小时，但你不可能专注地连续八小时在编写代码。一天的工作中，有开会、讨论、阶段性休息（刷新闻、喝咖啡、发呆）的时间开销，真正有效时间其实不足六小时，杂事多的话可能是四五个小时。\n\n**3、预留buffer(缓冲区)**\n\n首先明确，预留buffer不是让你随便增加预估量，而是要明确知道buffer是给那些事情用的。要考虑到一下几点：\n\n首先是沟通时间，你开发的时候不可能是闷着头一直写代码。要和UI设计师沟通，要和产品经理沟通，有可能还需要和组内的人沟通技术上的事情，以及和别的技术小组对接的问题。\n\n等待时间。如果牵扯多部门协作，会有很多等待时间，因为你不能保证别的部门就能准确按照计划时间完成的。虽然等待过程中你可以安排其他任务，但你不能保证其他任务就能刚好填充等待时间，更何况任务切换也需要时间成本。\n\n突发状况。例如，bug修改、需求微调、对接人请假。\n\n不确定时间。和其他部门有交集的工作，最好多预留buffer。比如移动端和后台联调。后端信誓旦旦给你说11.11号可以进行联调，这次联调总共5个接口。如果你简单地认为他们给你提供的接口没问题，并且能顺利请求回来数据，预计一天联调时间足以，那你就等着delay吧。11.10号你已经准备好了所有联调准备，如果数据能正确返回，你的解析功能都是OK的，因为你之前用假数据已经处理的好好的。到了11号，你请求第一个接口就报错了，然后在即时通讯软件上问他们怎么回事，半个小时后给你回了“不好意思，地址变了，你用这个试试”。又错了……。终于回来数据了，然后发现缺少两个字段……。就这样，第一个接口调通已经快下班了。（当然很多后端技术人员也是很靠谱的，举这个例子只是为了让多考虑）\n\n以上是可能会出现的状况，实际中有可能只是出现了一部分，这要根据实际情况而定。并不是让你能多预留buffer就多留，毕竟每个项目的时间都是很紧张的。一般buffer留在15%-25%。\n\n**4、回头看**\n\n在实际开发过程中，测量实际花费时间，并与估算相比较。如果有些地方相差较大，就要看差在哪里，然后在下次预估中避免相同的差错。\n\n### 总结\n\n编程经验不等同于估算经验。一个不被包含在估算流程中的开发者将不会擅长估算。同样，如果实际的时间花费不被测量和用于与估算比较，那么将没有反馈来学习。\n\n最后，每个程序员都应该具备估算的技能。为磨练这个技能，接手每个任务时，先决定你要做什么。然后在开始之前估算任务所需时间。最后测量实际花费时间，并与估算相比较。同样比较你实际完成的与计划完成的。这样你将会既提高你对一个任务包含细节的理解，同样也提高了你的估算技能。\n\n尽管进行了精确估算，也不能保证每个项目都会100%精确。偶尔会遇到一些突发情况和没预估到的风险是不可避免的。那么面对风险，有一些原则可以帮助你：\n\n- 报风险时间置前，如果开发开始或者任何过程有可能导致项目延期或者需求无法实现的时候就报警，不要等加班能实现或者存在侥幸心理；\n- 对于不确定的需求，一定要沟通到位；\n- 涉及到交互细节，必须提前沟通好，充分明确细节；\n- 技术可行性方案提前调查清楚。\n\n\n完结~~~~~~~","slug":"0017-Accurate assessment of working hours","published":1,"updated":"2019-04-22T04:02:04.770Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1t000pgcoifgjx251v","content":"<blockquote>\n<p>来源：Eric_LG</p>\n<p>blog.csdn.net/gang544043963/article/details/83934015</p>\n</blockquote>\n<p>一个程序员能否精确评估开发时间，是一件非常重要的事情。如果你掌握了这项技能，你在别人的眼里就会是这样：</p>\n<ul>\n<li>靠谱</li>\n<li>经验十足</li>\n<li>对需求很了解</li>\n<li>延期风险小</li>\n<li>合格的软件工程师</li>\n<li>正规军，不是野路子</li>\n</ul>\n<h3 id=\"评估开发时间的重要性\"><a href=\"#评估开发时间的重要性\" class=\"headerlink\" title=\"评估开发时间的重要性\"></a>评估开发时间的重要性</h3><p>首先，在一个项目中，所有的环节都是承上启下的，上一个环节结束的时间节点正是下一个环节开始的节点。那么在一个项目或者一次迭代正式启动前，所有的环节都应该有个时间评估。以一次APP需求迭代为例，项目计划像这样：</p>\n<ul>\n<li>UI设计图 11.01 - 11.03（3工作日）</li>\n<li>API接口讨论与设计 11.04（1工作日）</li>\n<li>移动端开发 11.05 - 11.15（8工作日）</li>\n<li>后端具备联调条件：11.11</li>\n<li>产品体验 11.16 - 11.17（2工作日）</li>\n<li>测试11.18 - 11.25（5工作日）</li>\n<li>发布11.26</li>\n</ul>\n<p>根据项目计划，各个部门自己要分配人员和时间。如果其中一个环节延期了，那么后面的各个环节都要顺延，就会造成损失。</p>\n<p>其次，对于程序员来说，一个清晰的开发计划有助于自己有条不紊地开展工作，也能避免疏漏某个功能点。评估时间的过程，也是对需求详细拆分的过程，了解要做什么，做成什么样子。在评估的过程中，根据专业知识和经验，充分预估会遇到的风险，怎样的解决方案，预留多少时间？都想好了的话，项目也就没啥风险了。</p>\n<p>然而，开发时间评估，最大的好处是程序员受益。认真地评估开发时间，会让你在开始动手写代码之前搞清楚要怎么写，每个模块的设计心理得有个谱。从宏观上拆分模块，然后详细地分解任务，具体到一个很小的功能点。这样你就能清晰地设计代码，而不是堆代码。也避免了很多时候写着写着发现不对，然后拉到重来的境地。就是要让你动手写代码之前胸有成竹！</p>\n<h3 id=\"初学者为什么评估不准？\"><a href=\"#初学者为什么评估不准？\" class=\"headerlink\" title=\"初学者为什么评估不准？\"></a>初学者为什么评估不准？</h3><p>如果你的项目经常delay，那么八成是时间评估不准。</p>\n<p>刚毕业的学生被问到什么时候可以完成的时候，脑门一拍：“三天”，实际上两个星期过去了还没完成。</p>\n<p>这里有一张表，看看你是不是这样子，对号入座：</p>\n<p><img src=\"https://wx1.sinaimg.cn/mw690/806e3151ly1g24quvbhswj20ia0ipk5w.jpg\" alt=\"\"></p>\n<p>越是老程序员越是“胆小”，评估时间越准。</p>\n<h3 id=\"如何精确评估开发时间\"><a href=\"#如何精确评估开发时间\" class=\"headerlink\" title=\"如何精确评估开发时间\"></a>如何精确评估开发时间</h3><p>最近几年，我都是以小时为单位进行时间评估的，有没有觉得有点恐怖？长期以来这样的习惯让我收获颇多。这得感谢我之前的领导，三年前强迫我们这样做，刚开始很抵触，后来才体会到其中的甜头。</p>\n<p><strong>1、任务拆分</strong></p>\n<p>拿到新需求后，对其进行充分了解，不清楚的就去问清楚，然后对其进行模块化。之后，再进行技术上的拆分。由大到小，再到细节。细到什么程度呢？细到一个按钮的实现，细到一个点击动作是要用按钮还是要用手势的定夺，最好能细到代码块的划分。</p>\n<p>这个能力是需要锻炼的，做好拆分，然后在实际开发过程中根据实际时间花销，回顾时间评估的准确性，以便让下次更准确。慢慢地，就会越来越精确，评估时间有依有据，不再是拍脑门给出的时间。下面看一个例子：</p>\n<p><img src=\"https://wx2.sinaimg.cn/mw690/806e3151ly1g24quz2fa6j20je040gnc.jpg\" alt=\"\"></p>\n<p><strong>2、合理认知时间</strong></p>\n<p>一天工作八小时，但你不可能专注地连续八小时在编写代码。一天的工作中，有开会、讨论、阶段性休息（刷新闻、喝咖啡、发呆）的时间开销，真正有效时间其实不足六小时，杂事多的话可能是四五个小时。</p>\n<p><strong>3、预留buffer(缓冲区)</strong></p>\n<p>首先明确，预留buffer不是让你随便增加预估量，而是要明确知道buffer是给那些事情用的。要考虑到一下几点：</p>\n<p>首先是沟通时间，你开发的时候不可能是闷着头一直写代码。要和UI设计师沟通，要和产品经理沟通，有可能还需要和组内的人沟通技术上的事情，以及和别的技术小组对接的问题。</p>\n<p>等待时间。如果牵扯多部门协作，会有很多等待时间，因为你不能保证别的部门就能准确按照计划时间完成的。虽然等待过程中你可以安排其他任务，但你不能保证其他任务就能刚好填充等待时间，更何况任务切换也需要时间成本。</p>\n<p>突发状况。例如，bug修改、需求微调、对接人请假。</p>\n<p>不确定时间。和其他部门有交集的工作，最好多预留buffer。比如移动端和后台联调。后端信誓旦旦给你说11.11号可以进行联调，这次联调总共5个接口。如果你简单地认为他们给你提供的接口没问题，并且能顺利请求回来数据，预计一天联调时间足以，那你就等着delay吧。11.10号你已经准备好了所有联调准备，如果数据能正确返回，你的解析功能都是OK的，因为你之前用假数据已经处理的好好的。到了11号，你请求第一个接口就报错了，然后在即时通讯软件上问他们怎么回事，半个小时后给你回了“不好意思，地址变了，你用这个试试”。又错了……。终于回来数据了，然后发现缺少两个字段……。就这样，第一个接口调通已经快下班了。（当然很多后端技术人员也是很靠谱的，举这个例子只是为了让多考虑）</p>\n<p>以上是可能会出现的状况，实际中有可能只是出现了一部分，这要根据实际情况而定。并不是让你能多预留buffer就多留，毕竟每个项目的时间都是很紧张的。一般buffer留在15%-25%。</p>\n<p><strong>4、回头看</strong></p>\n<p>在实际开发过程中，测量实际花费时间，并与估算相比较。如果有些地方相差较大，就要看差在哪里，然后在下次预估中避免相同的差错。</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>编程经验不等同于估算经验。一个不被包含在估算流程中的开发者将不会擅长估算。同样，如果实际的时间花费不被测量和用于与估算比较，那么将没有反馈来学习。</p>\n<p>最后，每个程序员都应该具备估算的技能。为磨练这个技能，接手每个任务时，先决定你要做什么。然后在开始之前估算任务所需时间。最后测量实际花费时间，并与估算相比较。同样比较你实际完成的与计划完成的。这样你将会既提高你对一个任务包含细节的理解，同样也提高了你的估算技能。</p>\n<p>尽管进行了精确估算，也不能保证每个项目都会100%精确。偶尔会遇到一些突发情况和没预估到的风险是不可避免的。那么面对风险，有一些原则可以帮助你：</p>\n<ul>\n<li>报风险时间置前，如果开发开始或者任何过程有可能导致项目延期或者需求无法实现的时候就报警，不要等加班能实现或者存在侥幸心理；</li>\n<li>对于不确定的需求，一定要沟通到位；</li>\n<li>涉及到交互细节，必须提前沟通好，充分明确细节；</li>\n<li>技术可行性方案提前调查清楚。</li>\n</ul>\n<p>完结<del>~</del>~~</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>来源：Eric_LG</p>\n<p>blog.csdn.net/gang544043963/article/details/83934015</p>\n</blockquote>\n<p>一个程序员能否精确评估开发时间，是一件非常重要的事情。如果你掌握了这项技能，你在别人的眼里就会是这样：</p>\n<ul>\n<li>靠谱</li>\n<li>经验十足</li>\n<li>对需求很了解</li>\n<li>延期风险小</li>\n<li>合格的软件工程师</li>\n<li>正规军，不是野路子</li>\n</ul>\n<h3 id=\"评估开发时间的重要性\"><a href=\"#评估开发时间的重要性\" class=\"headerlink\" title=\"评估开发时间的重要性\"></a>评估开发时间的重要性</h3><p>首先，在一个项目中，所有的环节都是承上启下的，上一个环节结束的时间节点正是下一个环节开始的节点。那么在一个项目或者一次迭代正式启动前，所有的环节都应该有个时间评估。以一次APP需求迭代为例，项目计划像这样：</p>\n<ul>\n<li>UI设计图 11.01 - 11.03（3工作日）</li>\n<li>API接口讨论与设计 11.04（1工作日）</li>\n<li>移动端开发 11.05 - 11.15（8工作日）</li>\n<li>后端具备联调条件：11.11</li>\n<li>产品体验 11.16 - 11.17（2工作日）</li>\n<li>测试11.18 - 11.25（5工作日）</li>\n<li>发布11.26</li>\n</ul>\n<p>根据项目计划，各个部门自己要分配人员和时间。如果其中一个环节延期了，那么后面的各个环节都要顺延，就会造成损失。</p>\n<p>其次，对于程序员来说，一个清晰的开发计划有助于自己有条不紊地开展工作，也能避免疏漏某个功能点。评估时间的过程，也是对需求详细拆分的过程，了解要做什么，做成什么样子。在评估的过程中，根据专业知识和经验，充分预估会遇到的风险，怎样的解决方案，预留多少时间？都想好了的话，项目也就没啥风险了。</p>\n<p>然而，开发时间评估，最大的好处是程序员受益。认真地评估开发时间，会让你在开始动手写代码之前搞清楚要怎么写，每个模块的设计心理得有个谱。从宏观上拆分模块，然后详细地分解任务，具体到一个很小的功能点。这样你就能清晰地设计代码，而不是堆代码。也避免了很多时候写着写着发现不对，然后拉到重来的境地。就是要让你动手写代码之前胸有成竹！</p>\n<h3 id=\"初学者为什么评估不准？\"><a href=\"#初学者为什么评估不准？\" class=\"headerlink\" title=\"初学者为什么评估不准？\"></a>初学者为什么评估不准？</h3><p>如果你的项目经常delay，那么八成是时间评估不准。</p>\n<p>刚毕业的学生被问到什么时候可以完成的时候，脑门一拍：“三天”，实际上两个星期过去了还没完成。</p>\n<p>这里有一张表，看看你是不是这样子，对号入座：</p>\n<p><img src=\"https://wx1.sinaimg.cn/mw690/806e3151ly1g24quvbhswj20ia0ipk5w.jpg\" alt=\"\"></p>\n<p>越是老程序员越是“胆小”，评估时间越准。</p>\n<h3 id=\"如何精确评估开发时间\"><a href=\"#如何精确评估开发时间\" class=\"headerlink\" title=\"如何精确评估开发时间\"></a>如何精确评估开发时间</h3><p>最近几年，我都是以小时为单位进行时间评估的，有没有觉得有点恐怖？长期以来这样的习惯让我收获颇多。这得感谢我之前的领导，三年前强迫我们这样做，刚开始很抵触，后来才体会到其中的甜头。</p>\n<p><strong>1、任务拆分</strong></p>\n<p>拿到新需求后，对其进行充分了解，不清楚的就去问清楚，然后对其进行模块化。之后，再进行技术上的拆分。由大到小，再到细节。细到什么程度呢？细到一个按钮的实现，细到一个点击动作是要用按钮还是要用手势的定夺，最好能细到代码块的划分。</p>\n<p>这个能力是需要锻炼的，做好拆分，然后在实际开发过程中根据实际时间花销，回顾时间评估的准确性，以便让下次更准确。慢慢地，就会越来越精确，评估时间有依有据，不再是拍脑门给出的时间。下面看一个例子：</p>\n<p><img src=\"https://wx2.sinaimg.cn/mw690/806e3151ly1g24quz2fa6j20je040gnc.jpg\" alt=\"\"></p>\n<p><strong>2、合理认知时间</strong></p>\n<p>一天工作八小时，但你不可能专注地连续八小时在编写代码。一天的工作中，有开会、讨论、阶段性休息（刷新闻、喝咖啡、发呆）的时间开销，真正有效时间其实不足六小时，杂事多的话可能是四五个小时。</p>\n<p><strong>3、预留buffer(缓冲区)</strong></p>\n<p>首先明确，预留buffer不是让你随便增加预估量，而是要明确知道buffer是给那些事情用的。要考虑到一下几点：</p>\n<p>首先是沟通时间，你开发的时候不可能是闷着头一直写代码。要和UI设计师沟通，要和产品经理沟通，有可能还需要和组内的人沟通技术上的事情，以及和别的技术小组对接的问题。</p>\n<p>等待时间。如果牵扯多部门协作，会有很多等待时间，因为你不能保证别的部门就能准确按照计划时间完成的。虽然等待过程中你可以安排其他任务，但你不能保证其他任务就能刚好填充等待时间，更何况任务切换也需要时间成本。</p>\n<p>突发状况。例如，bug修改、需求微调、对接人请假。</p>\n<p>不确定时间。和其他部门有交集的工作，最好多预留buffer。比如移动端和后台联调。后端信誓旦旦给你说11.11号可以进行联调，这次联调总共5个接口。如果你简单地认为他们给你提供的接口没问题，并且能顺利请求回来数据，预计一天联调时间足以，那你就等着delay吧。11.10号你已经准备好了所有联调准备，如果数据能正确返回，你的解析功能都是OK的，因为你之前用假数据已经处理的好好的。到了11号，你请求第一个接口就报错了，然后在即时通讯软件上问他们怎么回事，半个小时后给你回了“不好意思，地址变了，你用这个试试”。又错了……。终于回来数据了，然后发现缺少两个字段……。就这样，第一个接口调通已经快下班了。（当然很多后端技术人员也是很靠谱的，举这个例子只是为了让多考虑）</p>\n<p>以上是可能会出现的状况，实际中有可能只是出现了一部分，这要根据实际情况而定。并不是让你能多预留buffer就多留，毕竟每个项目的时间都是很紧张的。一般buffer留在15%-25%。</p>\n<p><strong>4、回头看</strong></p>\n<p>在实际开发过程中，测量实际花费时间，并与估算相比较。如果有些地方相差较大，就要看差在哪里，然后在下次预估中避免相同的差错。</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>编程经验不等同于估算经验。一个不被包含在估算流程中的开发者将不会擅长估算。同样，如果实际的时间花费不被测量和用于与估算比较，那么将没有反馈来学习。</p>\n<p>最后，每个程序员都应该具备估算的技能。为磨练这个技能，接手每个任务时，先决定你要做什么。然后在开始之前估算任务所需时间。最后测量实际花费时间，并与估算相比较。同样比较你实际完成的与计划完成的。这样你将会既提高你对一个任务包含细节的理解，同样也提高了你的估算技能。</p>\n<p>尽管进行了精确估算，也不能保证每个项目都会100%精确。偶尔会遇到一些突发情况和没预估到的风险是不可避免的。那么面对风险，有一些原则可以帮助你：</p>\n<ul>\n<li>报风险时间置前，如果开发开始或者任何过程有可能导致项目延期或者需求无法实现的时候就报警，不要等加班能实现或者存在侥幸心理；</li>\n<li>对于不确定的需求，一定要沟通到位；</li>\n<li>涉及到交互细节，必须提前沟通好，充分明确细节；</li>\n<li>技术可行性方案提前调查清楚。</li>\n</ul>\n<p>完结<del>~</del>~~</p>\n"},{"title":"HashMap","date":"2016-07-19T01:06:30.000Z","_content":"\n> 代码基于JDK 1.8\n\n\n## 基数知识\nMap是保存了Key-Value键值对的数据集合接口。HashMap是基于HashCode的Map实现。因为基于Key的HashCode进行存储，所以HashMap中Key都是唯一的。\n- **HashMap中Key，Value均可以为null。**\n\n## 源码解析\n\n### 类声明\n```java\npublic class HashMap<K, V> extends AbstractMap<K,V> implements Map<K, V>, Cloneable, Serializable {\n    // ...\n}\n```\n* `Map` -  `AbstractMap<K,V>`本身实现了`Map<K,V>`接口，在这里再次强调了`HashMap`实现了`Map`\n* `Cloneable`  实现了克隆接口\n* `Serializable`  实现了序列化接口\n\n### 数据结构\n```java\n/**\n * table, 在初次使用时进行初始化, 必要时进行大小调整。\n * 在分配大小时，长度总是 2的幂\n */\ntransient Node<K,V>[] table;\n\n\n// Node静态内部类，链表数据结构\nstatic class Node<K, V> implements Map.Entry<K, V> {\n    final int hash;\n    final K key;\n    V value;\n    Node<K, V> next;\n    Node(int hash, K key, V value, Node<K,V> next) {\n        this.hash = hash;\n        this.key = key;\n        this.value = value;\n        this.next = next;\n    }\n}\n```\n\n\n上面代码描述了`HashMap`的底层数据结构：`数组` + `链表`。 \n>*在1.8中，增加了红黑树，带详细研究...*\n\n### 构造函数\n对于构造函数，提供了多个重载，以方便创建实例：\n```java\npublic HashMap()\npublic HashMap(int initialCapacity)\npublic HashMap(int initialCapacity, float loadFactor)\npublic HashMap(Map<? extends K, ? extends V> m)\n```\n在构造函数中，`initialCapacity`和`loadFactor`两个参数对map的性能有很大的影响。\n* `initialCapacity`: 初始化大小， 即`table`数组的长度，如果此值太小，可能会因引起`table`频繁调整数组大小，如果太大，实际内容很少，则造成资源浪费，默认 1 << 4。\n* `loadFactor`: 加载因子，取值范围（0,1）的浮点数，如果此值太小，可能会因引起`table`频繁调整数组大小，如果太大，`table`大小很长时间不调整，调整时内容移动大。默认值0.75\n\n```java\ni = (n - 1) & h;\n```\n计算key在table中的索引,h为key的hashcode，n为当前table的大小。\n\nHashMap为非线程安全Map，其中key和value均可以为null。","source":"_posts/HashMap.md","raw":"---\ntitle: HashMap\ndate: 2016-07-19 09:06:30\ntags: [Java]\n---\n\n> 代码基于JDK 1.8\n\n\n## 基数知识\nMap是保存了Key-Value键值对的数据集合接口。HashMap是基于HashCode的Map实现。因为基于Key的HashCode进行存储，所以HashMap中Key都是唯一的。\n- **HashMap中Key，Value均可以为null。**\n\n## 源码解析\n\n### 类声明\n```java\npublic class HashMap<K, V> extends AbstractMap<K,V> implements Map<K, V>, Cloneable, Serializable {\n    // ...\n}\n```\n* `Map` -  `AbstractMap<K,V>`本身实现了`Map<K,V>`接口，在这里再次强调了`HashMap`实现了`Map`\n* `Cloneable`  实现了克隆接口\n* `Serializable`  实现了序列化接口\n\n### 数据结构\n```java\n/**\n * table, 在初次使用时进行初始化, 必要时进行大小调整。\n * 在分配大小时，长度总是 2的幂\n */\ntransient Node<K,V>[] table;\n\n\n// Node静态内部类，链表数据结构\nstatic class Node<K, V> implements Map.Entry<K, V> {\n    final int hash;\n    final K key;\n    V value;\n    Node<K, V> next;\n    Node(int hash, K key, V value, Node<K,V> next) {\n        this.hash = hash;\n        this.key = key;\n        this.value = value;\n        this.next = next;\n    }\n}\n```\n\n\n上面代码描述了`HashMap`的底层数据结构：`数组` + `链表`。 \n>*在1.8中，增加了红黑树，带详细研究...*\n\n### 构造函数\n对于构造函数，提供了多个重载，以方便创建实例：\n```java\npublic HashMap()\npublic HashMap(int initialCapacity)\npublic HashMap(int initialCapacity, float loadFactor)\npublic HashMap(Map<? extends K, ? extends V> m)\n```\n在构造函数中，`initialCapacity`和`loadFactor`两个参数对map的性能有很大的影响。\n* `initialCapacity`: 初始化大小， 即`table`数组的长度，如果此值太小，可能会因引起`table`频繁调整数组大小，如果太大，实际内容很少，则造成资源浪费，默认 1 << 4。\n* `loadFactor`: 加载因子，取值范围（0,1）的浮点数，如果此值太小，可能会因引起`table`频繁调整数组大小，如果太大，`table`大小很长时间不调整，调整时内容移动大。默认值0.75\n\n```java\ni = (n - 1) & h;\n```\n计算key在table中的索引,h为key的hashcode，n为当前table的大小。\n\nHashMap为非线程安全Map，其中key和value均可以为null。","slug":"HashMap","published":1,"updated":"2018-01-26T03:17:46.033Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1u000sgcoilepbpcm2","content":"<blockquote>\n<p>代码基于JDK 1.8</p>\n</blockquote>\n<h2 id=\"基数知识\"><a href=\"#基数知识\" class=\"headerlink\" title=\"基数知识\"></a>基数知识</h2><p>Map是保存了Key-Value键值对的数据集合接口。HashMap是基于HashCode的Map实现。因为基于Key的HashCode进行存储，所以HashMap中Key都是唯一的。</p>\n<ul>\n<li><strong>HashMap中Key，Value均可以为null。</strong></li>\n</ul>\n<h2 id=\"源码解析\"><a href=\"#源码解析\" class=\"headerlink\" title=\"源码解析\"></a>源码解析</h2><h3 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HashMap</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">AbstractMap</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt;, <span class=\"title\">Cloneable</span>, <span class=\"title\">Serializable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>Map</code> -  <code>AbstractMap&lt;K,V&gt;</code>本身实现了<code>Map&lt;K,V&gt;</code>接口，在这里再次强调了<code>HashMap</code>实现了<code>Map</code></li>\n<li><code>Cloneable</code>  实现了克隆接口</li>\n<li><code>Serializable</code>  实现了序列化接口</li>\n</ul>\n<h3 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * table, 在初次使用时进行初始化, 必要时进行大小调整。</span></span><br><span class=\"line\"><span class=\"comment\"> * 在分配大小时，长度总是 2的幂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Node静态内部类，链表数据结构</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> hash;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> K key;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    Node&lt;K, V&gt; next;</span><br><span class=\"line\">    Node(<span class=\"keyword\">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hash = hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.key = key;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.next = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面代码描述了<code>HashMap</code>的底层数据结构：<code>数组</code> + <code>链表</code>。 </p>\n<blockquote>\n<p><em>在1.8中，增加了红黑树，带详细研究…</em></p>\n</blockquote>\n<h3 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h3><p>对于构造函数，提供了多个重载，以方便创建实例：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity)</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity, <span class=\"keyword\">float</span> loadFactor)</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span></span></span><br></pre></td></tr></table></figure></p>\n<p>在构造函数中，<code>initialCapacity</code>和<code>loadFactor</code>两个参数对map的性能有很大的影响。</p>\n<ul>\n<li><code>initialCapacity</code>: 初始化大小， 即<code>table</code>数组的长度，如果此值太小，可能会因引起<code>table</code>频繁调整数组大小，如果太大，实际内容很少，则造成资源浪费，默认 1 &lt;&lt; 4。</li>\n<li><code>loadFactor</code>: 加载因子，取值范围（0,1）的浮点数，如果此值太小，可能会因引起<code>table</code>频繁调整数组大小，如果太大，<code>table</code>大小很长时间不调整，调整时内容移动大。默认值0.75</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = (n - <span class=\"number\">1</span>) &amp; h;</span><br></pre></td></tr></table></figure>\n<p>计算key在table中的索引,h为key的hashcode，n为当前table的大小。</p>\n<p>HashMap为非线程安全Map，其中key和value均可以为null。</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>代码基于JDK 1.8</p>\n</blockquote>\n<h2 id=\"基数知识\"><a href=\"#基数知识\" class=\"headerlink\" title=\"基数知识\"></a>基数知识</h2><p>Map是保存了Key-Value键值对的数据集合接口。HashMap是基于HashCode的Map实现。因为基于Key的HashCode进行存储，所以HashMap中Key都是唯一的。</p>\n<ul>\n<li><strong>HashMap中Key，Value均可以为null。</strong></li>\n</ul>\n<h2 id=\"源码解析\"><a href=\"#源码解析\" class=\"headerlink\" title=\"源码解析\"></a>源码解析</h2><h3 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HashMap</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">AbstractMap</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt;, <span class=\"title\">Cloneable</span>, <span class=\"title\">Serializable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>Map</code> -  <code>AbstractMap&lt;K,V&gt;</code>本身实现了<code>Map&lt;K,V&gt;</code>接口，在这里再次强调了<code>HashMap</code>实现了<code>Map</code></li>\n<li><code>Cloneable</code>  实现了克隆接口</li>\n<li><code>Serializable</code>  实现了序列化接口</li>\n</ul>\n<h3 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * table, 在初次使用时进行初始化, 必要时进行大小调整。</span></span><br><span class=\"line\"><span class=\"comment\"> * 在分配大小时，长度总是 2的幂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Node静态内部类，链表数据结构</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> hash;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> K key;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    Node&lt;K, V&gt; next;</span><br><span class=\"line\">    Node(<span class=\"keyword\">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hash = hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.key = key;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.next = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面代码描述了<code>HashMap</code>的底层数据结构：<code>数组</code> + <code>链表</code>。 </p>\n<blockquote>\n<p><em>在1.8中，增加了红黑树，带详细研究…</em></p>\n</blockquote>\n<h3 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h3><p>对于构造函数，提供了多个重载，以方便创建实例：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity)</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity, <span class=\"keyword\">float</span> loadFactor)</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span></span></span><br></pre></td></tr></table></figure></p>\n<p>在构造函数中，<code>initialCapacity</code>和<code>loadFactor</code>两个参数对map的性能有很大的影响。</p>\n<ul>\n<li><code>initialCapacity</code>: 初始化大小， 即<code>table</code>数组的长度，如果此值太小，可能会因引起<code>table</code>频繁调整数组大小，如果太大，实际内容很少，则造成资源浪费，默认 1 &lt;&lt; 4。</li>\n<li><code>loadFactor</code>: 加载因子，取值范围（0,1）的浮点数，如果此值太小，可能会因引起<code>table</code>频繁调整数组大小，如果太大，<code>table</code>大小很长时间不调整，调整时内容移动大。默认值0.75</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = (n - <span class=\"number\">1</span>) &amp; h;</span><br></pre></td></tr></table></figure>\n<p>计算key在table中的索引,h为key的hashcode，n为当前table的大小。</p>\n<p>HashMap为非线程安全Map，其中key和value均可以为null。</p>\n"},{"title":"Keepalived 简单配置","date":"2017-04-21T05:10:50.000Z","_content":"\n> 参考文档 http://wenku.baidu.com/view/8e38022d2af90242a895e532.html\n\n\n## 安装\n\n解压文件\n```bash\ntar -xvf keepalived-x.x.x.tar.gz\n```\n进入文件夹`keepalived-x.x.x`\n\n```\n./configure\n\nmake && make install \n```\n\n在安装过程中需要注意以下几点：\n\n- gcc环境\n- openssl环境\n- root权限\n\n\n## 配置\n\n```bash\n# cp /usr/local/etc/rc.d/init.d/keepalived /etc/rc.d/init.d/ \n# cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/ \n# mkdir /etc/keepalived  \n# cp /usr/local/etc/keepalived/keepalived.conf /etc/keepalived/ \n# cp /usr/local/sbin/keepalived /usr/sbin/ \n```\n\n做成系统启动服务方便管理. \n\n```bash\n# vi /etc/rc.local   \n/etc/init.d/keepalived start \n```\n增加上面一行。\n\n修改配置`/etc/keepalived/keepalived.conf`\n\n\n```config\n! Configuation File for keepalived\n\nglobal_defs {\n    notification_email {\n        acassen@firewall.loc    # 邮件地址，当异常时发邮件通知。可以是多个，每个一行\n        \n    }\n    notification_email_from Alexandre.Cassen@firewall.loc\n    smtp_server 192.168.200.1\n    smtp_connect_timeout 30\n    router_id LVS_DEVEL\n    vrrp_skip_check_adv_addr\n    vrrp_strict\n}\n\nvrrp_instance VI_1 {\n    state MASTER    # 从机设为BACKUP\n    interface   eth0   # 网卡接口\n    mcast_src_ip 10.0.0.131  # 默认没有这项，加上这项后服务好用了\n    priority  100  # 优先级，从机小与主机\n    advert_int 1  \n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    virtual_ipaddress {\n        10.0.0.111   # 虚拟ip设置，可以是多个，主从一致\n    }\n}\n\n```","source":"_posts/Keepalived.md","raw":"---\ntitle: Keepalived 简单配置\ndate: 2017-04-21 13:10:50\ntags:\n---\n\n> 参考文档 http://wenku.baidu.com/view/8e38022d2af90242a895e532.html\n\n\n## 安装\n\n解压文件\n```bash\ntar -xvf keepalived-x.x.x.tar.gz\n```\n进入文件夹`keepalived-x.x.x`\n\n```\n./configure\n\nmake && make install \n```\n\n在安装过程中需要注意以下几点：\n\n- gcc环境\n- openssl环境\n- root权限\n\n\n## 配置\n\n```bash\n# cp /usr/local/etc/rc.d/init.d/keepalived /etc/rc.d/init.d/ \n# cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/ \n# mkdir /etc/keepalived  \n# cp /usr/local/etc/keepalived/keepalived.conf /etc/keepalived/ \n# cp /usr/local/sbin/keepalived /usr/sbin/ \n```\n\n做成系统启动服务方便管理. \n\n```bash\n# vi /etc/rc.local   \n/etc/init.d/keepalived start \n```\n增加上面一行。\n\n修改配置`/etc/keepalived/keepalived.conf`\n\n\n```config\n! Configuation File for keepalived\n\nglobal_defs {\n    notification_email {\n        acassen@firewall.loc    # 邮件地址，当异常时发邮件通知。可以是多个，每个一行\n        \n    }\n    notification_email_from Alexandre.Cassen@firewall.loc\n    smtp_server 192.168.200.1\n    smtp_connect_timeout 30\n    router_id LVS_DEVEL\n    vrrp_skip_check_adv_addr\n    vrrp_strict\n}\n\nvrrp_instance VI_1 {\n    state MASTER    # 从机设为BACKUP\n    interface   eth0   # 网卡接口\n    mcast_src_ip 10.0.0.131  # 默认没有这项，加上这项后服务好用了\n    priority  100  # 优先级，从机小与主机\n    advert_int 1  \n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    virtual_ipaddress {\n        10.0.0.111   # 虚拟ip设置，可以是多个，主从一致\n    }\n}\n\n```","slug":"Keepalived","published":1,"updated":"2018-01-16T06:08:44.649Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1v000ugcoijcjozhq9","content":"<blockquote>\n<p>参考文档 <a href=\"http://wenku.baidu.com/view/8e38022d2af90242a895e532.html\" target=\"_blank\" rel=\"noopener\">http://wenku.baidu.com/view/8e38022d2af90242a895e532.html</a></p>\n</blockquote>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>解压文件<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf keepalived-x.x.x.tar.gz</span><br></pre></td></tr></table></figure></p>\n<p>进入文件夹<code>keepalived-x.x.x</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure</span><br><span class=\"line\"></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<p>在安装过程中需要注意以下几点：</p>\n<ul>\n<li>gcc环境</li>\n<li>openssl环境</li>\n<li>root权限</li>\n</ul>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cp /usr/local/etc/rc.d/init.d/keepalived /etc/rc.d/init.d/ </span></span><br><span class=\"line\"><span class=\"comment\"># cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/ </span></span><br><span class=\"line\"><span class=\"comment\"># mkdir /etc/keepalived  </span></span><br><span class=\"line\"><span class=\"comment\"># cp /usr/local/etc/keepalived/keepalived.conf /etc/keepalived/ </span></span><br><span class=\"line\"><span class=\"comment\"># cp /usr/local/sbin/keepalived /usr/sbin/</span></span><br></pre></td></tr></table></figure>\n<p>做成系统启动服务方便管理. </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vi /etc/rc.local   </span></span><br><span class=\"line\">/etc/init.d/keepalived start</span><br></pre></td></tr></table></figure>\n<p>增加上面一行。</p>\n<p>修改配置<code>/etc/keepalived/keepalived.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">! Configuation File for keepalived</span><br><span class=\"line\"></span><br><span class=\"line\">global_defs &#123;</span><br><span class=\"line\">    notification_email &#123;</span><br><span class=\"line\">        acassen@firewall.loc    # 邮件地址，当异常时发邮件通知。可以是多个，每个一行</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class=\"line\">    smtp_server 192.168.200.1</span><br><span class=\"line\">    smtp_connect_timeout 30</span><br><span class=\"line\">    router_id LVS_DEVEL</span><br><span class=\"line\">    vrrp_skip_check_adv_addr</span><br><span class=\"line\">    vrrp_strict</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">vrrp_instance VI_1 &#123;</span><br><span class=\"line\">    state MASTER    # 从机设为BACKUP</span><br><span class=\"line\">    interface   eth0   # 网卡接口</span><br><span class=\"line\">    mcast_src_ip 10.0.0.131  # 默认没有这项，加上这项后服务好用了</span><br><span class=\"line\">    priority  100  # 优先级，从机小与主机</span><br><span class=\"line\">    advert_int 1  </span><br><span class=\"line\">    authentication &#123;</span><br><span class=\"line\">        auth_type PASS</span><br><span class=\"line\">        auth_pass 1111</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    virtual_ipaddress &#123;</span><br><span class=\"line\">        10.0.0.111   # 虚拟ip设置，可以是多个，主从一致</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>参考文档 <a href=\"http://wenku.baidu.com/view/8e38022d2af90242a895e532.html\" target=\"_blank\" rel=\"noopener\">http://wenku.baidu.com/view/8e38022d2af90242a895e532.html</a></p>\n</blockquote>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>解压文件<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf keepalived-x.x.x.tar.gz</span><br></pre></td></tr></table></figure></p>\n<p>进入文件夹<code>keepalived-x.x.x</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure</span><br><span class=\"line\"></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<p>在安装过程中需要注意以下几点：</p>\n<ul>\n<li>gcc环境</li>\n<li>openssl环境</li>\n<li>root权限</li>\n</ul>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cp /usr/local/etc/rc.d/init.d/keepalived /etc/rc.d/init.d/ </span></span><br><span class=\"line\"><span class=\"comment\"># cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/ </span></span><br><span class=\"line\"><span class=\"comment\"># mkdir /etc/keepalived  </span></span><br><span class=\"line\"><span class=\"comment\"># cp /usr/local/etc/keepalived/keepalived.conf /etc/keepalived/ </span></span><br><span class=\"line\"><span class=\"comment\"># cp /usr/local/sbin/keepalived /usr/sbin/</span></span><br></pre></td></tr></table></figure>\n<p>做成系统启动服务方便管理. </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vi /etc/rc.local   </span></span><br><span class=\"line\">/etc/init.d/keepalived start</span><br></pre></td></tr></table></figure>\n<p>增加上面一行。</p>\n<p>修改配置<code>/etc/keepalived/keepalived.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">! Configuation File for keepalived</span><br><span class=\"line\"></span><br><span class=\"line\">global_defs &#123;</span><br><span class=\"line\">    notification_email &#123;</span><br><span class=\"line\">        acassen@firewall.loc    # 邮件地址，当异常时发邮件通知。可以是多个，每个一行</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class=\"line\">    smtp_server 192.168.200.1</span><br><span class=\"line\">    smtp_connect_timeout 30</span><br><span class=\"line\">    router_id LVS_DEVEL</span><br><span class=\"line\">    vrrp_skip_check_adv_addr</span><br><span class=\"line\">    vrrp_strict</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">vrrp_instance VI_1 &#123;</span><br><span class=\"line\">    state MASTER    # 从机设为BACKUP</span><br><span class=\"line\">    interface   eth0   # 网卡接口</span><br><span class=\"line\">    mcast_src_ip 10.0.0.131  # 默认没有这项，加上这项后服务好用了</span><br><span class=\"line\">    priority  100  # 优先级，从机小与主机</span><br><span class=\"line\">    advert_int 1  </span><br><span class=\"line\">    authentication &#123;</span><br><span class=\"line\">        auth_type PASS</span><br><span class=\"line\">        auth_pass 1111</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    virtual_ipaddress &#123;</span><br><span class=\"line\">        10.0.0.111   # 虚拟ip设置，可以是多个，主从一致</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"vs code调试Angular","date":"2018-07-10T02:49:46.000Z","_content":"\n# vs code调试Angular\n为了调试客户端Angular代码，需要安装[Debugger for Chrome](https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-chrome) Chrome扩展应用\n\n打开vs code的扩展应用视图(`Ctrl+Shift+X`), 搜索`chrome`。\n\n![image](https://code.visualstudio.com/assets/docs/nodejs/reactjs/debugger-for-chrome.png)\n\n点击`Install`，等安装完成后点击`Reload`，重新加载扩展应用使新安装的应用生效。\n\n## 设置断点\n\n在`app.component.ts`中设置断点，断点显示为红色原点。\n\n![image](https://code.visualstudio.com/assets/docs/nodejs/angular/breakpoint.png)\n\n## 配置Chrome debugger\n首先配置调试器。打开调试视图(`Ctrl+Shift+D`)，点击设置按钮，创建调试器配置文件`launch.json`。环境选择`Chrome`，会在`.vscode`文件夹下生成一个`launch.json`文件。\n\n修改url端口号，将`8080`修改为`4200`，如下：\n\n```json\n{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"type\": \"chrome\",\n            \"request\": \"launch\",\n            \"name\": \"Launch Chrome against localhost\",\n            \"url\": \"http://localhost:4200\",\n            \"webRoot\": \"${workspaceFolder}\"\n        }\n    ]\n}\n```\n\n`F5`或绿色三角运行调试器，会打开一个新的浏览器实例。\n\n![image](https://code.visualstudio.com/assets/docs/nodejs/angular/hit-breakpoint.png)\n\n可以用`F10`单步调试。还可以查看变量信息，栈信息。\n![image](https://code.visualstudio.com/assets/docs/nodejs/angular/debug-variable.png)\n\n","source":"_posts/VS code调试Angular.md","raw":"---\ntitle: vs code调试Angular\ndate: 2018-07-10 10:49:46\ntags:\n    - Angular\n    - VS Code\n    - Chrome\n---\n\n# vs code调试Angular\n为了调试客户端Angular代码，需要安装[Debugger for Chrome](https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-chrome) Chrome扩展应用\n\n打开vs code的扩展应用视图(`Ctrl+Shift+X`), 搜索`chrome`。\n\n![image](https://code.visualstudio.com/assets/docs/nodejs/reactjs/debugger-for-chrome.png)\n\n点击`Install`，等安装完成后点击`Reload`，重新加载扩展应用使新安装的应用生效。\n\n## 设置断点\n\n在`app.component.ts`中设置断点，断点显示为红色原点。\n\n![image](https://code.visualstudio.com/assets/docs/nodejs/angular/breakpoint.png)\n\n## 配置Chrome debugger\n首先配置调试器。打开调试视图(`Ctrl+Shift+D`)，点击设置按钮，创建调试器配置文件`launch.json`。环境选择`Chrome`，会在`.vscode`文件夹下生成一个`launch.json`文件。\n\n修改url端口号，将`8080`修改为`4200`，如下：\n\n```json\n{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"type\": \"chrome\",\n            \"request\": \"launch\",\n            \"name\": \"Launch Chrome against localhost\",\n            \"url\": \"http://localhost:4200\",\n            \"webRoot\": \"${workspaceFolder}\"\n        }\n    ]\n}\n```\n\n`F5`或绿色三角运行调试器，会打开一个新的浏览器实例。\n\n![image](https://code.visualstudio.com/assets/docs/nodejs/angular/hit-breakpoint.png)\n\n可以用`F10`单步调试。还可以查看变量信息，栈信息。\n![image](https://code.visualstudio.com/assets/docs/nodejs/angular/debug-variable.png)\n\n","slug":"VS code调试Angular","published":1,"updated":"2018-10-12T02:36:31.278Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1w000vgcoi60dwpuz6","content":"<h1 id=\"vs-code调试Angular\"><a href=\"#vs-code调试Angular\" class=\"headerlink\" title=\"vs code调试Angular\"></a>vs code调试Angular</h1><p>为了调试客户端Angular代码，需要安装<a href=\"https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-chrome\" target=\"_blank\" rel=\"noopener\">Debugger for Chrome</a> Chrome扩展应用</p>\n<p>打开vs code的扩展应用视图(<code>Ctrl+Shift+X</code>), 搜索<code>chrome</code>。</p>\n<p><img src=\"https://code.visualstudio.com/assets/docs/nodejs/reactjs/debugger-for-chrome.png\" alt=\"image\"></p>\n<p>点击<code>Install</code>，等安装完成后点击<code>Reload</code>，重新加载扩展应用使新安装的应用生效。</p>\n<h2 id=\"设置断点\"><a href=\"#设置断点\" class=\"headerlink\" title=\"设置断点\"></a>设置断点</h2><p>在<code>app.component.ts</code>中设置断点，断点显示为红色原点。</p>\n<p><img src=\"https://code.visualstudio.com/assets/docs/nodejs/angular/breakpoint.png\" alt=\"image\"></p>\n<h2 id=\"配置Chrome-debugger\"><a href=\"#配置Chrome-debugger\" class=\"headerlink\" title=\"配置Chrome debugger\"></a>配置Chrome debugger</h2><p>首先配置调试器。打开调试视图(<code>Ctrl+Shift+D</code>)，点击设置按钮，创建调试器配置文件<code>launch.json</code>。环境选择<code>Chrome</code>，会在<code>.vscode</code>文件夹下生成一个<code>launch.json</code>文件。</p>\n<p>修改url端口号，将<code>8080</code>修改为<code>4200</code>，如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"configurations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"chrome\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"request\"</span>: <span class=\"string\">\"launch\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Launch Chrome against localhost\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"url\"</span>: <span class=\"string\">\"http://localhost:4200\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"webRoot\"</span>: <span class=\"string\">\"$&#123;workspaceFolder&#125;\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>F5</code>或绿色三角运行调试器，会打开一个新的浏览器实例。</p>\n<p><img src=\"https://code.visualstudio.com/assets/docs/nodejs/angular/hit-breakpoint.png\" alt=\"image\"></p>\n<p>可以用<code>F10</code>单步调试。还可以查看变量信息，栈信息。<br><img src=\"https://code.visualstudio.com/assets/docs/nodejs/angular/debug-variable.png\" alt=\"image\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"vs-code调试Angular\"><a href=\"#vs-code调试Angular\" class=\"headerlink\" title=\"vs code调试Angular\"></a>vs code调试Angular</h1><p>为了调试客户端Angular代码，需要安装<a href=\"https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-chrome\" target=\"_blank\" rel=\"noopener\">Debugger for Chrome</a> Chrome扩展应用</p>\n<p>打开vs code的扩展应用视图(<code>Ctrl+Shift+X</code>), 搜索<code>chrome</code>。</p>\n<p><img src=\"https://code.visualstudio.com/assets/docs/nodejs/reactjs/debugger-for-chrome.png\" alt=\"image\"></p>\n<p>点击<code>Install</code>，等安装完成后点击<code>Reload</code>，重新加载扩展应用使新安装的应用生效。</p>\n<h2 id=\"设置断点\"><a href=\"#设置断点\" class=\"headerlink\" title=\"设置断点\"></a>设置断点</h2><p>在<code>app.component.ts</code>中设置断点，断点显示为红色原点。</p>\n<p><img src=\"https://code.visualstudio.com/assets/docs/nodejs/angular/breakpoint.png\" alt=\"image\"></p>\n<h2 id=\"配置Chrome-debugger\"><a href=\"#配置Chrome-debugger\" class=\"headerlink\" title=\"配置Chrome debugger\"></a>配置Chrome debugger</h2><p>首先配置调试器。打开调试视图(<code>Ctrl+Shift+D</code>)，点击设置按钮，创建调试器配置文件<code>launch.json</code>。环境选择<code>Chrome</code>，会在<code>.vscode</code>文件夹下生成一个<code>launch.json</code>文件。</p>\n<p>修改url端口号，将<code>8080</code>修改为<code>4200</code>，如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"configurations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"chrome\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"request\"</span>: <span class=\"string\">\"launch\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Launch Chrome against localhost\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"url\"</span>: <span class=\"string\">\"http://localhost:4200\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"webRoot\"</span>: <span class=\"string\">\"$&#123;workspaceFolder&#125;\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>F5</code>或绿色三角运行调试器，会打开一个新的浏览器实例。</p>\n<p><img src=\"https://code.visualstudio.com/assets/docs/nodejs/angular/hit-breakpoint.png\" alt=\"image\"></p>\n<p>可以用<code>F10</code>单步调试。还可以查看变量信息，栈信息。<br><img src=\"https://code.visualstudio.com/assets/docs/nodejs/angular/debug-variable.png\" alt=\"image\"></p>\n"},{"title":"关于我","date":"2017-05-10T01:16:06.000Z","comments":0,"_content":"\n\n我的微博: [TinyKing](http://weibo.com/tinyking86)\n\n我的博客园：[博客园TinyKing](http://www.cnblogs.com/tinyking)\n\n我的51CTO: [TinyKing](http://tinyking.blog.51cto.com)\n\n我的微信：<img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg\" width=\"200\">","source":"_posts/about-me.md","raw":"---\ntitle: 关于我\ndate: 2017-05-10 09:16:06\ncomments: false\n---\n\n\n我的微博: [TinyKing](http://weibo.com/tinyking86)\n\n我的博客园：[博客园TinyKing](http://www.cnblogs.com/tinyking)\n\n我的51CTO: [TinyKing](http://tinyking.blog.51cto.com)\n\n我的微信：<img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg\" width=\"200\">","slug":"about-me","published":1,"updated":"2019-02-15T01:43:55.336Z","layout":"post","photos":[],"link":"","_id":"cjvg26t1x000ygcoijq8dnajx","content":"<p>我的微博: <a href=\"http://weibo.com/tinyking86\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的博客园：<a href=\"http://www.cnblogs.com/tinyking\" target=\"_blank\" rel=\"noopener\">博客园TinyKing</a></p>\n<p>我的51CTO: <a href=\"http://tinyking.blog.51cto.com\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的微信：<img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg\" width=\"200\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>我的微博: <a href=\"http://weibo.com/tinyking86\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的博客园：<a href=\"http://www.cnblogs.com/tinyking\" target=\"_blank\" rel=\"noopener\">博客园TinyKing</a></p>\n<p>我的51CTO: <a href=\"http://tinyking.blog.51cto.com\" target=\"_blank\" rel=\"noopener\">TinyKing</a></p>\n<p>我的微信：<img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fffzr8uu0zj20e80e8my0.jpg\" width=\"200\"></p>\n"},{"title":"基于Traivs的自动部署","date":"2016-10-19T01:06:30.000Z","_content":"\n","source":"_posts/auto-deploy-traivs.md","raw":"---\ntitle: 基于Traivs的自动部署\ndate: 2016-10-19 09:06:30\ntags: \n    - travis\n    - github\n---\n\n","slug":"auto-deploy-traivs","published":1,"updated":"2018-01-16T06:08:44.650Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1y000zgcoi7x18y3n5","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"win10下手动编译Spring","date":"2018-10-12T01:06:30.000Z","_content":"\n\n在windows下执行`gradlew.bat build`发生异常，如下：\n![image](http://img.hb.aicdn.com/6257b1a43c17c6eba97c52034c6f398c459788305765-exykoC_fw658)\n\n原因是执行gradle编译时，没有生成`xxx-schema.zip`文件。\n\n通过修改task schemaZip,将文件路径分符由Unix系统的`/`修改为windows系统的`\\\\`.\n\n```\ntask schemaZip(type: Zip) {\n\tgroup = \"Distribution\"\n\tbaseName = \"spring-framework\"\n\tclassifier = \"schema\"\n\tdescription = \"Builds -${classifier} archive containing all \" +\n\t\t\t\"XSDs for deployment at http://springframework.org/schema.\"\n\tduplicatesStrategy 'exclude'\n\tmoduleProjects.each { subproject ->\n\t\tdef Properties schemas = new Properties();\n\n\t\tsubproject.sourceSets.main.resources.find {\n\t\t\tit.path.endsWith(\"META-INF\\\\spring.schemas\")\n\t\t}?.withInputStream { schemas.load(it) }\n\n\t\tfor (def key : schemas.keySet()) {\n\t\t\tdef shortName = key.replaceAll(/http.*schema.(.*).spring-.*/, '$1')\n\t\t\tassert shortName != key\n\t\t\tFile xsdFile = subproject.sourceSets.main.resources.find {\n\t\t\t\tit.path.endsWith(schemas.get(key).replaceAll('\\\\/', '\\\\\\\\'))\n\t\t\t}\n\t\t\tassert xsdFile != null\n\t\t\tinto (shortName) {\n\t\t\t\tfrom xsdFile.path\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n> [参考stackoverflow](https://stackoverflow.com/questions/34916981/build-spring-framework-source-code-encounter-an-error)","source":"_posts/build-spring-on-win10.md","raw":"---\ntitle: win10下手动编译Spring\ndate: 2018-10-12 09:06:30\ntags: \n    - Spring\n    - gradle\n---\n\n\n在windows下执行`gradlew.bat build`发生异常，如下：\n![image](http://img.hb.aicdn.com/6257b1a43c17c6eba97c52034c6f398c459788305765-exykoC_fw658)\n\n原因是执行gradle编译时，没有生成`xxx-schema.zip`文件。\n\n通过修改task schemaZip,将文件路径分符由Unix系统的`/`修改为windows系统的`\\\\`.\n\n```\ntask schemaZip(type: Zip) {\n\tgroup = \"Distribution\"\n\tbaseName = \"spring-framework\"\n\tclassifier = \"schema\"\n\tdescription = \"Builds -${classifier} archive containing all \" +\n\t\t\t\"XSDs for deployment at http://springframework.org/schema.\"\n\tduplicatesStrategy 'exclude'\n\tmoduleProjects.each { subproject ->\n\t\tdef Properties schemas = new Properties();\n\n\t\tsubproject.sourceSets.main.resources.find {\n\t\t\tit.path.endsWith(\"META-INF\\\\spring.schemas\")\n\t\t}?.withInputStream { schemas.load(it) }\n\n\t\tfor (def key : schemas.keySet()) {\n\t\t\tdef shortName = key.replaceAll(/http.*schema.(.*).spring-.*/, '$1')\n\t\t\tassert shortName != key\n\t\t\tFile xsdFile = subproject.sourceSets.main.resources.find {\n\t\t\t\tit.path.endsWith(schemas.get(key).replaceAll('\\\\/', '\\\\\\\\'))\n\t\t\t}\n\t\t\tassert xsdFile != null\n\t\t\tinto (shortName) {\n\t\t\t\tfrom xsdFile.path\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n> [参考stackoverflow](https://stackoverflow.com/questions/34916981/build-spring-framework-source-code-encounter-an-error)","slug":"build-spring-on-win10","published":1,"updated":"2018-10-12T03:06:06.313Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t1z0011gcoi75d2w47w","content":"<p>在windows下执行<code>gradlew.bat build</code>发生异常，如下：<br><img src=\"http://img.hb.aicdn.com/6257b1a43c17c6eba97c52034c6f398c459788305765-exykoC_fw658\" alt=\"image\"></p>\n<p>原因是执行gradle编译时，没有生成<code>xxx-schema.zip</code>文件。</p>\n<p>通过修改task schemaZip,将文件路径分符由Unix系统的<code>/</code>修改为windows系统的<code>\\\\</code>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">task schemaZip(type: Zip) &#123;</span><br><span class=\"line\">\tgroup = &quot;Distribution&quot;</span><br><span class=\"line\">\tbaseName = &quot;spring-framework&quot;</span><br><span class=\"line\">\tclassifier = &quot;schema&quot;</span><br><span class=\"line\">\tdescription = &quot;Builds -$&#123;classifier&#125; archive containing all &quot; +</span><br><span class=\"line\">\t\t\t&quot;XSDs for deployment at http://springframework.org/schema.&quot;</span><br><span class=\"line\">\tduplicatesStrategy &apos;exclude&apos;</span><br><span class=\"line\">\tmoduleProjects.each &#123; subproject -&gt;</span><br><span class=\"line\">\t\tdef Properties schemas = new Properties();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tsubproject.sourceSets.main.resources.find &#123;</span><br><span class=\"line\">\t\t\tit.path.endsWith(&quot;META-INF\\\\spring.schemas&quot;)</span><br><span class=\"line\">\t\t&#125;?.withInputStream &#123; schemas.load(it) &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tfor (def key : schemas.keySet()) &#123;</span><br><span class=\"line\">\t\t\tdef shortName = key.replaceAll(/http.*schema.(.*).spring-.*/, &apos;$1&apos;)</span><br><span class=\"line\">\t\t\tassert shortName != key</span><br><span class=\"line\">\t\t\tFile xsdFile = subproject.sourceSets.main.resources.find &#123;</span><br><span class=\"line\">\t\t\t\tit.path.endsWith(schemas.get(key).replaceAll(&apos;\\\\/&apos;, &apos;\\\\\\\\&apos;))</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tassert xsdFile != null</span><br><span class=\"line\">\t\t\tinto (shortName) &#123;</span><br><span class=\"line\">\t\t\t\tfrom xsdFile.path</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/34916981/build-spring-framework-source-code-encounter-an-error\" target=\"_blank\" rel=\"noopener\">参考stackoverflow</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>在windows下执行<code>gradlew.bat build</code>发生异常，如下：<br><img src=\"http://img.hb.aicdn.com/6257b1a43c17c6eba97c52034c6f398c459788305765-exykoC_fw658\" alt=\"image\"></p>\n<p>原因是执行gradle编译时，没有生成<code>xxx-schema.zip</code>文件。</p>\n<p>通过修改task schemaZip,将文件路径分符由Unix系统的<code>/</code>修改为windows系统的<code>\\\\</code>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">task schemaZip(type: Zip) &#123;</span><br><span class=\"line\">\tgroup = &quot;Distribution&quot;</span><br><span class=\"line\">\tbaseName = &quot;spring-framework&quot;</span><br><span class=\"line\">\tclassifier = &quot;schema&quot;</span><br><span class=\"line\">\tdescription = &quot;Builds -$&#123;classifier&#125; archive containing all &quot; +</span><br><span class=\"line\">\t\t\t&quot;XSDs for deployment at http://springframework.org/schema.&quot;</span><br><span class=\"line\">\tduplicatesStrategy &apos;exclude&apos;</span><br><span class=\"line\">\tmoduleProjects.each &#123; subproject -&gt;</span><br><span class=\"line\">\t\tdef Properties schemas = new Properties();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tsubproject.sourceSets.main.resources.find &#123;</span><br><span class=\"line\">\t\t\tit.path.endsWith(&quot;META-INF\\\\spring.schemas&quot;)</span><br><span class=\"line\">\t\t&#125;?.withInputStream &#123; schemas.load(it) &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tfor (def key : schemas.keySet()) &#123;</span><br><span class=\"line\">\t\t\tdef shortName = key.replaceAll(/http.*schema.(.*).spring-.*/, &apos;$1&apos;)</span><br><span class=\"line\">\t\t\tassert shortName != key</span><br><span class=\"line\">\t\t\tFile xsdFile = subproject.sourceSets.main.resources.find &#123;</span><br><span class=\"line\">\t\t\t\tit.path.endsWith(schemas.get(key).replaceAll(&apos;\\\\/&apos;, &apos;\\\\\\\\&apos;))</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tassert xsdFile != null</span><br><span class=\"line\">\t\t\tinto (shortName) &#123;</span><br><span class=\"line\">\t\t\t\tfrom xsdFile.path</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><a href=\"https://stackoverflow.com/questions/34916981/build-spring-framework-source-code-encounter-an-error\" target=\"_blank\" rel=\"noopener\">参考stackoverflow</a></p>\n</blockquote>\n"},{"title":"Display real-time data in Angular","date":"2018-06-28T02:49:46.000Z","_content":"\n\n> [原文地址](https://fullstack-developer.academy/display-real-time-data-in-angular/)\n\nIn this article, we'll be taking a look at two ways to display real-time data in an Angular application. We'll discuss how to push real-time data via a service. One approach will be using sockets while the other will be using the Angular AsyncPipe and Observables.\n\n## Setting the scene\nOften in an application, we work with a backend API service. We create a component, we call an Angular service which in turn calls an API. That API call returns some data and that data is then displayed in the template of the component. This is a very simple scenario. But what happens when data that arrives is updated frequently - think about stock symbols and their values, an online radio that needs to display a new artist & song title. We somehow need to update the component when the data changes at the API level.\n\n## Async Pipe & Observables\nThe first approach that we'll take a look doesn't require any modification at the API level. In light of this, we'll be using the `Async Pipe`. Pipes in Angular work just as pipes work in Linux. They accept an input and produce an output. What the output is going to be is determined by the pipe's functionality. This pipe accepts a promise or an observable as an input, and it can update the template whenever the promise is resolved or when the observable emits some new value. As with all pipes, we need to apply the pipe in the template.\n\nLet's assume that we have a list of products returned by an API and that we have the following service available:\n\n```typescript\n// api.service.ts\nimport { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\n@Injectable()\nexport class ApiService {\n\n  constructor(private http: HttpClient) { }\n\n  getProducts() {\n    return this.http.get('http://localhost:3000/api/products');\n  }\n}\n```\nThe code above is straightforward - we specify the `getProducts()` method that returns the HTTP GET call.\n\nIt's time to consume this service in the component. And what we'll do here is create an Observable and assign the result of the `getProducts()` method to it. Furthermore, we'll make that call every 1 second, so if there's an update at the API level, we can refresh the template:\n\n```typescript\n// some.component.ts\nimport { Component, OnInit, OnDestroy, Input } from '@angular/core';\nimport { ApiService } from './../api.service';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/observable/interval';\nimport 'rxjs/add/operator/startWith';\nimport 'rxjs/add/operator/switchMap';\n\n@Component({\n  selector: 'app-products',\n  templateUrl: './products.component.html',\n  styleUrls: ['./products.component.css']\n})\n\nexport class ProductsComponent implements OnInit {\n  @Input() products$: Observable<any>;\n  constructor(private api: ApiService) { }\n\n  ngOnInit() {\n    this.products$ = Observable      \n                        .interval(1000)\n                        .startWith(0).switchMap(() => this.api.getProducts());\n  }\n}\n```\n\nAnd last but not least, we need to apply the async pipe in our template:\n\n```html\n<!-- some.component.html -->\n<ul>\n  <li *ngFor=\"let product of products$ | async\">{{ product.prod_name }} for {{ product.price | currency:'£'}}</li>\n</ul>\n```\nThis way, if we push a new item to the API (or remove one or multiple item(s)) the updates are going to be visible in the component in 1 second.\n\n## Sockets\nAnother approach to creating a component and a service that accepts push data from the server is by implementing sockets. To achieve such functionality, changes need to be performed both at the API and the Client side as well.\n\n## API level modifications\nAt the API level, we need to enable sockets, and one of the most used packages that developers use is `socket.io` which can be installed via `npm i socket.io`.\n\nHere's an implementation of the server using Restify and Socket.io:\n\n```typescript\nconst restify = require('restify');\nconst server = restify.createServer();\nconst products = require('./products');\nconst io = require('socket.io')(server.server);\n\nlet sockets = new Set();\nconst corsMiddleware = require('restify-cors-middleware');\nconst port = 3000;\nconst cors = corsMiddleware({origins: ['*'],});\nserver.use(restify.plugins.bodyParser());\nserver.pre(cors.preflight);\nserver.use(cors.actual);\nio.on('connection', socket => {\n  sockets.add(socket);\n  socket.emit('data', { data: products });\n  socket.on('clientData', data => console.log(data));\n  socket.on('disconnect', () => sockets.delete(socket));\n});\n\nserver.get('/', (request, response, next) => {\n  response.end();\n  next();\n});\n\nserver.post('/api/products', (request, response) => {\n  const product = request.body;\n  products.push(product);\n  for (const socket of sockets) {\n    console.log(`Emitting value: ${products}`);\n    socket.emit('data', { data: products });\n  }\n  response.json(products);\n});\n  \nserver.listen(port, () => console.info(`Server is up on ${port}.`));\n```\n\n> Note how Restify requires us to use `server.server` when requiring `socket.io`.\n\nThe above code may look complex; however, it is a straightforward implementation. The required `products` file contains an array of objects which represent some data. On the first connection to the server we send data to the requester as well as making sure that we store the socket in a JavaScript `Set`:\n\n```typescript\nio.on('connection', socket => {\n  sockets.add(socket);\n  socket.emit('data', { data: products });\n  socket.on('clientData', data => console.log(data));\n  socket.on('disconnect', () => sockets.delete(socket));\n});\n```\nWhen a new product is added (in this case it's just a simple push to the `products` array), then we again, emit the updated array to all the clients who are connected:\n\n```typescript\nserver.post('/api/products', (request, response) => {\n  const product = request.body;\n  products.push(product);\n  for (const socket of sockets) {\n    console.log(`Emitting value: ${products}`);\n    socket.emit('data', { data: products });\n  }\n  response.json(products);\n});\n```\n\n> Note, that in this article we're only going through the basics and henceforth the API is kept at an elementary level.\n\n# Client side modifications\nAt the client side - from our Angular application - we also need to connect to the socket, and for this, we'll be using a package called `socket.io-client` along with its typing. Both of these can be installed via npm: `npm i socket.io-client @types/socket.io-client`.\n\nOnce installed we can update our Angular service:\n\n```typescript\n// api.service.ts\nimport { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport * as socketIo from 'socket.io-client';\nimport { Observer } from 'rxjs/Observer';\nimport { Observable } from 'rxjs/Observable';\n@Injectable()\nexport class ApiService {\n\n  observer: Observer<any>;\n\n  getProducts() {\n    const socket = socketIo('http://localhost:3000/');\n    socket.on('data', response => {\n      return this.observer.next(response.data);\n    });\n    return this.createObservable();\n  }\n\n  createObservable() {\n    return new Observable(observer => this.observer = observer);\n  }\n}\n```\nHere we are creating an observer first, then connect to the socket server running on port 3000 (or whatever port we have specified for the API). If data is emitted from the socket server (which happens on the first load as well as when someone adds a new product), an observable is created. This is what gets passed on to the component and then to the template which still utilises the async pipe - the rest of the code does not change.\n\nAdding a new product will also now mean that the list of products is updated.\n\n# Conclusion\nIn this article, we had a look at two ways to achieve real-time data updates in Angular components.","source":"_posts/display-real-time-data-in-angular.md","raw":"---\ntitle: Display real-time data in Angular\ndate: 2018-06-28 10:49:46\ntags:\n    - Angular\n---\n\n\n> [原文地址](https://fullstack-developer.academy/display-real-time-data-in-angular/)\n\nIn this article, we'll be taking a look at two ways to display real-time data in an Angular application. We'll discuss how to push real-time data via a service. One approach will be using sockets while the other will be using the Angular AsyncPipe and Observables.\n\n## Setting the scene\nOften in an application, we work with a backend API service. We create a component, we call an Angular service which in turn calls an API. That API call returns some data and that data is then displayed in the template of the component. This is a very simple scenario. But what happens when data that arrives is updated frequently - think about stock symbols and their values, an online radio that needs to display a new artist & song title. We somehow need to update the component when the data changes at the API level.\n\n## Async Pipe & Observables\nThe first approach that we'll take a look doesn't require any modification at the API level. In light of this, we'll be using the `Async Pipe`. Pipes in Angular work just as pipes work in Linux. They accept an input and produce an output. What the output is going to be is determined by the pipe's functionality. This pipe accepts a promise or an observable as an input, and it can update the template whenever the promise is resolved or when the observable emits some new value. As with all pipes, we need to apply the pipe in the template.\n\nLet's assume that we have a list of products returned by an API and that we have the following service available:\n\n```typescript\n// api.service.ts\nimport { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\n@Injectable()\nexport class ApiService {\n\n  constructor(private http: HttpClient) { }\n\n  getProducts() {\n    return this.http.get('http://localhost:3000/api/products');\n  }\n}\n```\nThe code above is straightforward - we specify the `getProducts()` method that returns the HTTP GET call.\n\nIt's time to consume this service in the component. And what we'll do here is create an Observable and assign the result of the `getProducts()` method to it. Furthermore, we'll make that call every 1 second, so if there's an update at the API level, we can refresh the template:\n\n```typescript\n// some.component.ts\nimport { Component, OnInit, OnDestroy, Input } from '@angular/core';\nimport { ApiService } from './../api.service';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/observable/interval';\nimport 'rxjs/add/operator/startWith';\nimport 'rxjs/add/operator/switchMap';\n\n@Component({\n  selector: 'app-products',\n  templateUrl: './products.component.html',\n  styleUrls: ['./products.component.css']\n})\n\nexport class ProductsComponent implements OnInit {\n  @Input() products$: Observable<any>;\n  constructor(private api: ApiService) { }\n\n  ngOnInit() {\n    this.products$ = Observable      \n                        .interval(1000)\n                        .startWith(0).switchMap(() => this.api.getProducts());\n  }\n}\n```\n\nAnd last but not least, we need to apply the async pipe in our template:\n\n```html\n<!-- some.component.html -->\n<ul>\n  <li *ngFor=\"let product of products$ | async\">{{ product.prod_name }} for {{ product.price | currency:'£'}}</li>\n</ul>\n```\nThis way, if we push a new item to the API (or remove one or multiple item(s)) the updates are going to be visible in the component in 1 second.\n\n## Sockets\nAnother approach to creating a component and a service that accepts push data from the server is by implementing sockets. To achieve such functionality, changes need to be performed both at the API and the Client side as well.\n\n## API level modifications\nAt the API level, we need to enable sockets, and one of the most used packages that developers use is `socket.io` which can be installed via `npm i socket.io`.\n\nHere's an implementation of the server using Restify and Socket.io:\n\n```typescript\nconst restify = require('restify');\nconst server = restify.createServer();\nconst products = require('./products');\nconst io = require('socket.io')(server.server);\n\nlet sockets = new Set();\nconst corsMiddleware = require('restify-cors-middleware');\nconst port = 3000;\nconst cors = corsMiddleware({origins: ['*'],});\nserver.use(restify.plugins.bodyParser());\nserver.pre(cors.preflight);\nserver.use(cors.actual);\nio.on('connection', socket => {\n  sockets.add(socket);\n  socket.emit('data', { data: products });\n  socket.on('clientData', data => console.log(data));\n  socket.on('disconnect', () => sockets.delete(socket));\n});\n\nserver.get('/', (request, response, next) => {\n  response.end();\n  next();\n});\n\nserver.post('/api/products', (request, response) => {\n  const product = request.body;\n  products.push(product);\n  for (const socket of sockets) {\n    console.log(`Emitting value: ${products}`);\n    socket.emit('data', { data: products });\n  }\n  response.json(products);\n});\n  \nserver.listen(port, () => console.info(`Server is up on ${port}.`));\n```\n\n> Note how Restify requires us to use `server.server` when requiring `socket.io`.\n\nThe above code may look complex; however, it is a straightforward implementation. The required `products` file contains an array of objects which represent some data. On the first connection to the server we send data to the requester as well as making sure that we store the socket in a JavaScript `Set`:\n\n```typescript\nio.on('connection', socket => {\n  sockets.add(socket);\n  socket.emit('data', { data: products });\n  socket.on('clientData', data => console.log(data));\n  socket.on('disconnect', () => sockets.delete(socket));\n});\n```\nWhen a new product is added (in this case it's just a simple push to the `products` array), then we again, emit the updated array to all the clients who are connected:\n\n```typescript\nserver.post('/api/products', (request, response) => {\n  const product = request.body;\n  products.push(product);\n  for (const socket of sockets) {\n    console.log(`Emitting value: ${products}`);\n    socket.emit('data', { data: products });\n  }\n  response.json(products);\n});\n```\n\n> Note, that in this article we're only going through the basics and henceforth the API is kept at an elementary level.\n\n# Client side modifications\nAt the client side - from our Angular application - we also need to connect to the socket, and for this, we'll be using a package called `socket.io-client` along with its typing. Both of these can be installed via npm: `npm i socket.io-client @types/socket.io-client`.\n\nOnce installed we can update our Angular service:\n\n```typescript\n// api.service.ts\nimport { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport * as socketIo from 'socket.io-client';\nimport { Observer } from 'rxjs/Observer';\nimport { Observable } from 'rxjs/Observable';\n@Injectable()\nexport class ApiService {\n\n  observer: Observer<any>;\n\n  getProducts() {\n    const socket = socketIo('http://localhost:3000/');\n    socket.on('data', response => {\n      return this.observer.next(response.data);\n    });\n    return this.createObservable();\n  }\n\n  createObservable() {\n    return new Observable(observer => this.observer = observer);\n  }\n}\n```\nHere we are creating an observer first, then connect to the socket server running on port 3000 (or whatever port we have specified for the API). If data is emitted from the socket server (which happens on the first load as well as when someone adds a new product), an observable is created. This is what gets passed on to the component and then to the template which still utilises the async pipe - the rest of the code does not change.\n\nAdding a new product will also now mean that the list of products is updated.\n\n# Conclusion\nIn this article, we had a look at two ways to achieve real-time data updates in Angular components.","slug":"display-real-time-data-in-angular","published":1,"updated":"2018-10-11T12:55:23.037Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t200013gcoih2vpjbb0","content":"<blockquote>\n<p><a href=\"https://fullstack-developer.academy/display-real-time-data-in-angular/\" target=\"_blank\" rel=\"noopener\">原文地址</a></p>\n</blockquote>\n<p>In this article, we’ll be taking a look at two ways to display real-time data in an Angular application. We’ll discuss how to push real-time data via a service. One approach will be using sockets while the other will be using the Angular AsyncPipe and Observables.</p>\n<h2 id=\"Setting-the-scene\"><a href=\"#Setting-the-scene\" class=\"headerlink\" title=\"Setting the scene\"></a>Setting the scene</h2><p>Often in an application, we work with a backend API service. We create a component, we call an Angular service which in turn calls an API. That API call returns some data and that data is then displayed in the template of the component. This is a very simple scenario. But what happens when data that arrives is updated frequently - think about stock symbols and their values, an online radio that needs to display a new artist &amp; song title. We somehow need to update the component when the data changes at the API level.</p>\n<h2 id=\"Async-Pipe-amp-Observables\"><a href=\"#Async-Pipe-amp-Observables\" class=\"headerlink\" title=\"Async Pipe &amp; Observables\"></a>Async Pipe &amp; Observables</h2><p>The first approach that we’ll take a look doesn’t require any modification at the API level. In light of this, we’ll be using the <code>Async Pipe</code>. Pipes in Angular work just as pipes work in Linux. They accept an input and produce an output. What the output is going to be is determined by the pipe’s functionality. This pipe accepts a promise or an observable as an input, and it can update the template whenever the promise is resolved or when the observable emits some new value. As with all pipes, we need to apply the pipe in the template.</p>\n<p>Let’s assume that we have a list of products returned by an API and that we have the following service available:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// api.service.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Injectable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; HttpClient &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/common/http'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> ApiService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> http: HttpClient</span>) &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  getProducts() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.http.get(<span class=\"string\">'http://localhost:3000/api/products'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The code above is straightforward - we specify the <code>getProducts()</code> method that returns the HTTP GET call.</p>\n<p>It’s time to consume this service in the component. And what we’ll do here is create an Observable and assign the result of the <code>getProducts()</code> method to it. Furthermore, we’ll make that call every 1 second, so if there’s an update at the API level, we can refresh the template:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// some.component.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component, OnInit, OnDestroy, Input &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ApiService &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./../api.service'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/observable/interval'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/startWith'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/switchMap'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'app-products'</span>,</span><br><span class=\"line\">  templateUrl: <span class=\"string\">'./products.component.html'</span>,</span><br><span class=\"line\">  styleUrls: [<span class=\"string\">'./products.component.css'</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> ProductsComponent <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"meta\">@Input</span>() products$: Observable&lt;<span class=\"built_in\">any</span>&gt;;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> api: ApiService</span>) &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.products$ = Observable      </span><br><span class=\"line\">                        .interval(<span class=\"number\">1000</span>)</span><br><span class=\"line\">                        .startWith(<span class=\"number\">0</span>).switchMap(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">this</span>.api.getProducts());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>And last but not least, we need to apply the async pipe in our template:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- some.component.html --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> *<span class=\"attr\">ngFor</span>=<span class=\"string\">\"let product of products$ | async\"</span>&gt;</span>&#123;&#123; product.prod_name &#125;&#125; for &#123;&#123; product.price | currency:'£'&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>This way, if we push a new item to the API (or remove one or multiple item(s)) the updates are going to be visible in the component in 1 second.</p>\n<h2 id=\"Sockets\"><a href=\"#Sockets\" class=\"headerlink\" title=\"Sockets\"></a>Sockets</h2><p>Another approach to creating a component and a service that accepts push data from the server is by implementing sockets. To achieve such functionality, changes need to be performed both at the API and the Client side as well.</p>\n<h2 id=\"API-level-modifications\"><a href=\"#API-level-modifications\" class=\"headerlink\" title=\"API level modifications\"></a>API level modifications</h2><p>At the API level, we need to enable sockets, and one of the most used packages that developers use is <code>socket.io</code> which can be installed via <code>npm i socket.io</code>.</p>\n<p>Here’s an implementation of the server using Restify and Socket.io:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> restify = <span class=\"built_in\">require</span>(<span class=\"string\">'restify'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> server = restify.createServer();</span><br><span class=\"line\"><span class=\"keyword\">const</span> products = <span class=\"built_in\">require</span>(<span class=\"string\">'./products'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> io = <span class=\"built_in\">require</span>(<span class=\"string\">'socket.io'</span>)(server.server);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> sockets = <span class=\"keyword\">new</span> Set();</span><br><span class=\"line\"><span class=\"keyword\">const</span> corsMiddleware = <span class=\"built_in\">require</span>(<span class=\"string\">'restify-cors-middleware'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = <span class=\"number\">3000</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> cors = corsMiddleware(&#123;origins: [<span class=\"string\">'*'</span>],&#125;);</span><br><span class=\"line\">server.use(restify.plugins.bodyParser());</span><br><span class=\"line\">server.pre(cors.preflight);</span><br><span class=\"line\">server.use(cors.actual);</span><br><span class=\"line\">io.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"params\">socket</span> =&gt;</span> &#123;</span><br><span class=\"line\">  sockets.add(socket);</span><br><span class=\"line\">  socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  socket.on(<span class=\"string\">'clientData'</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> <span class=\"built_in\">console</span>.log(data));</span><br><span class=\"line\">  socket.on(<span class=\"string\">'disconnect'</span>, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> sockets.delete(socket));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.get(<span class=\"string\">'/'</span>, <span class=\"function\">(<span class=\"params\">request, response, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  response.end();</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.post(<span class=\"string\">'/api/products'</span>, <span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> product = request.body;</span><br><span class=\"line\">  products.push(product);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> socket of sockets) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`Emitting value: <span class=\"subst\">$&#123;products&#125;</span>`</span>);</span><br><span class=\"line\">    socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  response.json(products);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">  </span><br><span class=\"line\">server.listen(port, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"built_in\">console</span>.info(<span class=\"string\">`Server is up on <span class=\"subst\">$&#123;port&#125;</span>.`</span>));</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Note how Restify requires us to use <code>server.server</code> when requiring <code>socket.io</code>.</p>\n</blockquote>\n<p>The above code may look complex; however, it is a straightforward implementation. The required <code>products</code> file contains an array of objects which represent some data. On the first connection to the server we send data to the requester as well as making sure that we store the socket in a JavaScript <code>Set</code>:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">io.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"params\">socket</span> =&gt;</span> &#123;</span><br><span class=\"line\">  sockets.add(socket);</span><br><span class=\"line\">  socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  socket.on(<span class=\"string\">'clientData'</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> <span class=\"built_in\">console</span>.log(data));</span><br><span class=\"line\">  socket.on(<span class=\"string\">'disconnect'</span>, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> sockets.delete(socket));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>When a new product is added (in this case it’s just a simple push to the <code>products</code> array), then we again, emit the updated array to all the clients who are connected:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.post(<span class=\"string\">'/api/products'</span>, <span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> product = request.body;</span><br><span class=\"line\">  products.push(product);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> socket of sockets) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`Emitting value: <span class=\"subst\">$&#123;products&#125;</span>`</span>);</span><br><span class=\"line\">    socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  response.json(products);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Note, that in this article we’re only going through the basics and henceforth the API is kept at an elementary level.</p>\n</blockquote>\n<h1 id=\"Client-side-modifications\"><a href=\"#Client-side-modifications\" class=\"headerlink\" title=\"Client side modifications\"></a>Client side modifications</h1><p>At the client side - from our Angular application - we also need to connect to the socket, and for this, we’ll be using a package called <code>socket.io-client</code> along with its typing. Both of these can be installed via npm: <code>npm i socket.io-client @types/socket.io-client</code>.</p>\n<p>Once installed we can update our Angular service:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// api.service.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Injectable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; HttpClient &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/common/http'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> socketIo <span class=\"keyword\">from</span> <span class=\"string\">'socket.io-client'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observer &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observer'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> ApiService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  observer: Observer&lt;<span class=\"built_in\">any</span>&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">  getProducts() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> socket = socketIo(<span class=\"string\">'http://localhost:3000/'</span>);</span><br><span class=\"line\">    socket.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"params\">response</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observer.next(response.data);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.createObservable();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  createObservable() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Observable(<span class=\"function\"><span class=\"params\">observer</span> =&gt;</span> <span class=\"keyword\">this</span>.observer = observer);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Here we are creating an observer first, then connect to the socket server running on port 3000 (or whatever port we have specified for the API). If data is emitted from the socket server (which happens on the first load as well as when someone adds a new product), an observable is created. This is what gets passed on to the component and then to the template which still utilises the async pipe - the rest of the code does not change.</p>\n<p>Adding a new product will also now mean that the list of products is updated.</p>\n<h1 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h1><p>In this article, we had a look at two ways to achieve real-time data updates in Angular components.</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><a href=\"https://fullstack-developer.academy/display-real-time-data-in-angular/\" target=\"_blank\" rel=\"noopener\">原文地址</a></p>\n</blockquote>\n<p>In this article, we’ll be taking a look at two ways to display real-time data in an Angular application. We’ll discuss how to push real-time data via a service. One approach will be using sockets while the other will be using the Angular AsyncPipe and Observables.</p>\n<h2 id=\"Setting-the-scene\"><a href=\"#Setting-the-scene\" class=\"headerlink\" title=\"Setting the scene\"></a>Setting the scene</h2><p>Often in an application, we work with a backend API service. We create a component, we call an Angular service which in turn calls an API. That API call returns some data and that data is then displayed in the template of the component. This is a very simple scenario. But what happens when data that arrives is updated frequently - think about stock symbols and their values, an online radio that needs to display a new artist &amp; song title. We somehow need to update the component when the data changes at the API level.</p>\n<h2 id=\"Async-Pipe-amp-Observables\"><a href=\"#Async-Pipe-amp-Observables\" class=\"headerlink\" title=\"Async Pipe &amp; Observables\"></a>Async Pipe &amp; Observables</h2><p>The first approach that we’ll take a look doesn’t require any modification at the API level. In light of this, we’ll be using the <code>Async Pipe</code>. Pipes in Angular work just as pipes work in Linux. They accept an input and produce an output. What the output is going to be is determined by the pipe’s functionality. This pipe accepts a promise or an observable as an input, and it can update the template whenever the promise is resolved or when the observable emits some new value. As with all pipes, we need to apply the pipe in the template.</p>\n<p>Let’s assume that we have a list of products returned by an API and that we have the following service available:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// api.service.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Injectable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; HttpClient &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/common/http'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> ApiService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> http: HttpClient</span>) &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  getProducts() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.http.get(<span class=\"string\">'http://localhost:3000/api/products'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The code above is straightforward - we specify the <code>getProducts()</code> method that returns the HTTP GET call.</p>\n<p>It’s time to consume this service in the component. And what we’ll do here is create an Observable and assign the result of the <code>getProducts()</code> method to it. Furthermore, we’ll make that call every 1 second, so if there’s an update at the API level, we can refresh the template:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// some.component.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component, OnInit, OnDestroy, Input &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ApiService &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./../api.service'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/observable/interval'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/startWith'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/switchMap'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'app-products'</span>,</span><br><span class=\"line\">  templateUrl: <span class=\"string\">'./products.component.html'</span>,</span><br><span class=\"line\">  styleUrls: [<span class=\"string\">'./products.component.css'</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> ProductsComponent <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"meta\">@Input</span>() products$: Observable&lt;<span class=\"built_in\">any</span>&gt;;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> api: ApiService</span>) &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.products$ = Observable      </span><br><span class=\"line\">                        .interval(<span class=\"number\">1000</span>)</span><br><span class=\"line\">                        .startWith(<span class=\"number\">0</span>).switchMap(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">this</span>.api.getProducts());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>And last but not least, we need to apply the async pipe in our template:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- some.component.html --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> *<span class=\"attr\">ngFor</span>=<span class=\"string\">\"let product of products$ | async\"</span>&gt;</span>&#123;&#123; product.prod_name &#125;&#125; for &#123;&#123; product.price | currency:'£'&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>This way, if we push a new item to the API (or remove one or multiple item(s)) the updates are going to be visible in the component in 1 second.</p>\n<h2 id=\"Sockets\"><a href=\"#Sockets\" class=\"headerlink\" title=\"Sockets\"></a>Sockets</h2><p>Another approach to creating a component and a service that accepts push data from the server is by implementing sockets. To achieve such functionality, changes need to be performed both at the API and the Client side as well.</p>\n<h2 id=\"API-level-modifications\"><a href=\"#API-level-modifications\" class=\"headerlink\" title=\"API level modifications\"></a>API level modifications</h2><p>At the API level, we need to enable sockets, and one of the most used packages that developers use is <code>socket.io</code> which can be installed via <code>npm i socket.io</code>.</p>\n<p>Here’s an implementation of the server using Restify and Socket.io:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> restify = <span class=\"built_in\">require</span>(<span class=\"string\">'restify'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> server = restify.createServer();</span><br><span class=\"line\"><span class=\"keyword\">const</span> products = <span class=\"built_in\">require</span>(<span class=\"string\">'./products'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> io = <span class=\"built_in\">require</span>(<span class=\"string\">'socket.io'</span>)(server.server);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> sockets = <span class=\"keyword\">new</span> Set();</span><br><span class=\"line\"><span class=\"keyword\">const</span> corsMiddleware = <span class=\"built_in\">require</span>(<span class=\"string\">'restify-cors-middleware'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = <span class=\"number\">3000</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> cors = corsMiddleware(&#123;origins: [<span class=\"string\">'*'</span>],&#125;);</span><br><span class=\"line\">server.use(restify.plugins.bodyParser());</span><br><span class=\"line\">server.pre(cors.preflight);</span><br><span class=\"line\">server.use(cors.actual);</span><br><span class=\"line\">io.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"params\">socket</span> =&gt;</span> &#123;</span><br><span class=\"line\">  sockets.add(socket);</span><br><span class=\"line\">  socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  socket.on(<span class=\"string\">'clientData'</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> <span class=\"built_in\">console</span>.log(data));</span><br><span class=\"line\">  socket.on(<span class=\"string\">'disconnect'</span>, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> sockets.delete(socket));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.get(<span class=\"string\">'/'</span>, <span class=\"function\">(<span class=\"params\">request, response, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  response.end();</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.post(<span class=\"string\">'/api/products'</span>, <span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> product = request.body;</span><br><span class=\"line\">  products.push(product);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> socket of sockets) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`Emitting value: <span class=\"subst\">$&#123;products&#125;</span>`</span>);</span><br><span class=\"line\">    socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  response.json(products);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">  </span><br><span class=\"line\">server.listen(port, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"built_in\">console</span>.info(<span class=\"string\">`Server is up on <span class=\"subst\">$&#123;port&#125;</span>.`</span>));</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Note how Restify requires us to use <code>server.server</code> when requiring <code>socket.io</code>.</p>\n</blockquote>\n<p>The above code may look complex; however, it is a straightforward implementation. The required <code>products</code> file contains an array of objects which represent some data. On the first connection to the server we send data to the requester as well as making sure that we store the socket in a JavaScript <code>Set</code>:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">io.on(<span class=\"string\">'connection'</span>, <span class=\"function\"><span class=\"params\">socket</span> =&gt;</span> &#123;</span><br><span class=\"line\">  sockets.add(socket);</span><br><span class=\"line\">  socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  socket.on(<span class=\"string\">'clientData'</span>, <span class=\"function\"><span class=\"params\">data</span> =&gt;</span> <span class=\"built_in\">console</span>.log(data));</span><br><span class=\"line\">  socket.on(<span class=\"string\">'disconnect'</span>, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> sockets.delete(socket));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>When a new product is added (in this case it’s just a simple push to the <code>products</code> array), then we again, emit the updated array to all the clients who are connected:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.post(<span class=\"string\">'/api/products'</span>, <span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> product = request.body;</span><br><span class=\"line\">  products.push(product);</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> socket of sockets) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">`Emitting value: <span class=\"subst\">$&#123;products&#125;</span>`</span>);</span><br><span class=\"line\">    socket.emit(<span class=\"string\">'data'</span>, &#123; data: products &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  response.json(products);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Note, that in this article we’re only going through the basics and henceforth the API is kept at an elementary level.</p>\n</blockquote>\n<h1 id=\"Client-side-modifications\"><a href=\"#Client-side-modifications\" class=\"headerlink\" title=\"Client side modifications\"></a>Client side modifications</h1><p>At the client side - from our Angular application - we also need to connect to the socket, and for this, we’ll be using a package called <code>socket.io-client</code> along with its typing. Both of these can be installed via npm: <code>npm i socket.io-client @types/socket.io-client</code>.</p>\n<p>Once installed we can update our Angular service:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// api.service.ts</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Injectable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; HttpClient &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/common/http'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> socketIo <span class=\"keyword\">from</span> <span class=\"string\">'socket.io-client'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observer &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observer'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> ApiService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  observer: Observer&lt;<span class=\"built_in\">any</span>&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">  getProducts() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> socket = socketIo(<span class=\"string\">'http://localhost:3000/'</span>);</span><br><span class=\"line\">    socket.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"params\">response</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observer.next(response.data);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.createObservable();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  createObservable() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Observable(<span class=\"function\"><span class=\"params\">observer</span> =&gt;</span> <span class=\"keyword\">this</span>.observer = observer);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Here we are creating an observer first, then connect to the socket server running on port 3000 (or whatever port we have specified for the API). If data is emitted from the socket server (which happens on the first load as well as when someone adds a new product), an observable is created. This is what gets passed on to the component and then to the template which still utilises the async pipe - the rest of the code does not change.</p>\n<p>Adding a new product will also now mean that the list of products is updated.</p>\n<h1 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h1><p>In this article, we had a look at two ways to achieve real-time data updates in Angular components.</p>\n"},{"title":"CentOS7使用firewalld打开关闭防火墙与端口","date":"2017-04-21T05:10:50.000Z","_content":"\n1、firewalld的基本使用\n\n启动： systemctl start firewalld\n\n查看状态： systemctl status firewalld \n\n停止： systemctl disable firewalld\n\n禁用： systemctl stop firewalld\n \n2.systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。\n\n启动一个服务：systemctl start firewalld.service\n\n关闭一个服务：systemctl stop firewalld.service\n\n重启一个服务：systemctl restart firewalld.service\n\n显示一个服务的状态：systemctl status firewalld.service\n\n在开机时启用一个服务：systemctl enable firewalld.service\n\n在开机时禁用一个服务：systemctl disable firewalld.service\n\n查看服务是否开机启动：systemctl is-enabled firewalld.service\n\n查看已启动的服务列表：systemctl list-unit-files|grep enabled\n\n查看启动失败的服务列表：systemctl --failed\n\n3.配置firewalld-cmd\n\n\n查看版本： firewall-cmd --version\n\n查看帮助： firewall-cmd --help\n\n显示状态： firewall-cmd --state\n\n查看所有打开的端口： firewall-cmd \n--zone=public --list-ports\n\n更新防火墙规则： firewall-cmd --reload\n\n查看区域信息:  firewall-cmd \n--get-active-zones\n\n查看指定接口所属区域： firewall-cmd \n--get-zone-of-interface=eth0\n\n拒绝所有包：firewall-cmd --panic-on\n\n取消拒绝状态： firewall-cmd --panic-off\n\n查看是否拒绝： firewall-cmd --query-panic\n \n那怎么开启一个端口呢\n添加\n\nfirewall-cmd --zone=public \n--add-port=80/tcp --permanent    \n（--permanent永久生效，没有此参数重启后失\n效）\n\n重新载入\n\nfirewall-cmd --reload\n\n查看\n\nfirewall-cmd --zone= public \n--query-port=80/tcp\n\n删除\n\nfirewall-cmd --zone= public \n--remove-port=80/tcp --permanent","source":"_posts/firewalld.md","raw":"---\ntitle: CentOS7使用firewalld打开关闭防火墙与端口\ndate: 2017-04-21 13:10:50\ntags: [Linux]\n---\n\n1、firewalld的基本使用\n\n启动： systemctl start firewalld\n\n查看状态： systemctl status firewalld \n\n停止： systemctl disable firewalld\n\n禁用： systemctl stop firewalld\n \n2.systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。\n\n启动一个服务：systemctl start firewalld.service\n\n关闭一个服务：systemctl stop firewalld.service\n\n重启一个服务：systemctl restart firewalld.service\n\n显示一个服务的状态：systemctl status firewalld.service\n\n在开机时启用一个服务：systemctl enable firewalld.service\n\n在开机时禁用一个服务：systemctl disable firewalld.service\n\n查看服务是否开机启动：systemctl is-enabled firewalld.service\n\n查看已启动的服务列表：systemctl list-unit-files|grep enabled\n\n查看启动失败的服务列表：systemctl --failed\n\n3.配置firewalld-cmd\n\n\n查看版本： firewall-cmd --version\n\n查看帮助： firewall-cmd --help\n\n显示状态： firewall-cmd --state\n\n查看所有打开的端口： firewall-cmd \n--zone=public --list-ports\n\n更新防火墙规则： firewall-cmd --reload\n\n查看区域信息:  firewall-cmd \n--get-active-zones\n\n查看指定接口所属区域： firewall-cmd \n--get-zone-of-interface=eth0\n\n拒绝所有包：firewall-cmd --panic-on\n\n取消拒绝状态： firewall-cmd --panic-off\n\n查看是否拒绝： firewall-cmd --query-panic\n \n那怎么开启一个端口呢\n添加\n\nfirewall-cmd --zone=public \n--add-port=80/tcp --permanent    \n（--permanent永久生效，没有此参数重启后失\n效）\n\n重新载入\n\nfirewall-cmd --reload\n\n查看\n\nfirewall-cmd --zone= public \n--query-port=80/tcp\n\n删除\n\nfirewall-cmd --zone= public \n--remove-port=80/tcp --permanent","slug":"firewalld","published":1,"updated":"2018-01-26T03:17:30.953Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t210015gcoii007fprg","content":"<p>1、firewalld的基本使用</p>\n<p>启动： systemctl start firewalld</p>\n<p>查看状态： systemctl status firewalld </p>\n<p>停止： systemctl disable firewalld</p>\n<p>禁用： systemctl stop firewalld</p>\n<p>2.systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。</p>\n<p>启动一个服务：systemctl start firewalld.service</p>\n<p>关闭一个服务：systemctl stop firewalld.service</p>\n<p>重启一个服务：systemctl restart firewalld.service</p>\n<p>显示一个服务的状态：systemctl status firewalld.service</p>\n<p>在开机时启用一个服务：systemctl enable firewalld.service</p>\n<p>在开机时禁用一个服务：systemctl disable firewalld.service</p>\n<p>查看服务是否开机启动：systemctl is-enabled firewalld.service</p>\n<p>查看已启动的服务列表：systemctl list-unit-files|grep enabled</p>\n<p>查看启动失败的服务列表：systemctl –failed</p>\n<p>3.配置firewalld-cmd</p>\n<p>查看版本： firewall-cmd –version</p>\n<p>查看帮助： firewall-cmd –help</p>\n<p>显示状态： firewall-cmd –state</p>\n<p>查看所有打开的端口： firewall-cmd<br>–zone=public –list-ports</p>\n<p>更新防火墙规则： firewall-cmd –reload</p>\n<p>查看区域信息:  firewall-cmd<br>–get-active-zones</p>\n<p>查看指定接口所属区域： firewall-cmd<br>–get-zone-of-interface=eth0</p>\n<p>拒绝所有包：firewall-cmd –panic-on</p>\n<p>取消拒绝状态： firewall-cmd –panic-off</p>\n<p>查看是否拒绝： firewall-cmd –query-panic</p>\n<p>那怎么开启一个端口呢<br>添加</p>\n<p>firewall-cmd –zone=public<br>–add-port=80/tcp –permanent<br>（–permanent永久生效，没有此参数重启后失<br>效）</p>\n<p>重新载入</p>\n<p>firewall-cmd –reload</p>\n<p>查看</p>\n<p>firewall-cmd –zone= public<br>–query-port=80/tcp</p>\n<p>删除</p>\n<p>firewall-cmd –zone= public<br>–remove-port=80/tcp –permanent</p>\n","site":{"data":{}},"excerpt":"","more":"<p>1、firewalld的基本使用</p>\n<p>启动： systemctl start firewalld</p>\n<p>查看状态： systemctl status firewalld </p>\n<p>停止： systemctl disable firewalld</p>\n<p>禁用： systemctl stop firewalld</p>\n<p>2.systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。</p>\n<p>启动一个服务：systemctl start firewalld.service</p>\n<p>关闭一个服务：systemctl stop firewalld.service</p>\n<p>重启一个服务：systemctl restart firewalld.service</p>\n<p>显示一个服务的状态：systemctl status firewalld.service</p>\n<p>在开机时启用一个服务：systemctl enable firewalld.service</p>\n<p>在开机时禁用一个服务：systemctl disable firewalld.service</p>\n<p>查看服务是否开机启动：systemctl is-enabled firewalld.service</p>\n<p>查看已启动的服务列表：systemctl list-unit-files|grep enabled</p>\n<p>查看启动失败的服务列表：systemctl –failed</p>\n<p>3.配置firewalld-cmd</p>\n<p>查看版本： firewall-cmd –version</p>\n<p>查看帮助： firewall-cmd –help</p>\n<p>显示状态： firewall-cmd –state</p>\n<p>查看所有打开的端口： firewall-cmd<br>–zone=public –list-ports</p>\n<p>更新防火墙规则： firewall-cmd –reload</p>\n<p>查看区域信息:  firewall-cmd<br>–get-active-zones</p>\n<p>查看指定接口所属区域： firewall-cmd<br>–get-zone-of-interface=eth0</p>\n<p>拒绝所有包：firewall-cmd –panic-on</p>\n<p>取消拒绝状态： firewall-cmd –panic-off</p>\n<p>查看是否拒绝： firewall-cmd –query-panic</p>\n<p>那怎么开启一个端口呢<br>添加</p>\n<p>firewall-cmd –zone=public<br>–add-port=80/tcp –permanent<br>（–permanent永久生效，没有此参数重启后失<br>效）</p>\n<p>重新载入</p>\n<p>firewall-cmd –reload</p>\n<p>查看</p>\n<p>firewall-cmd –zone= public<br>–query-port=80/tcp</p>\n<p>删除</p>\n<p>firewall-cmd –zone= public<br>–remove-port=80/tcp –permanent</p>\n"},{"title":"前端框架","date":"2016-10-19T05:30:00.000Z","_content":"\n## Semantic UI\n\nSemantic UI—完全语义化的前端界面开发框架，跟 Bootstrap 和 Foundation 比起来，还是有些不同的，在功能特性上、布局设计上、用户体验上均存在很多差异。\n\nSemantic UI 特点：\n\n- 文档和演示非常完善\n- 易于学习和使用\n- 配备网格布局\n- 支持 Sass 和 LESS 动态样式语言\n- 有一些非常实用的附加配置，例如inverted类。\n- 对于社区贡献来说是比较开放的。\n- 有一个非常好的按钮实现，情态动词，和进度条。\n- 在许多功能上使用图标字体。\n\n\nSemantic UI 对浏览器的支持：\n\n- Last 2 Versions FF, Chrome, IE (aka 10+)\n- Safari 6\n- IE 9+ (Browser prefix only)\n- Android 4\n- Blackberry 10\n\n![Semantic UI](http://static.oschina.net/uploads/space/2013/1008/140748_1T9v_119807.jpg)\n\n\n## Bootstrap\n\nBootstrap是快速开发Web应用程序的前端工具包。它是一个CSS和HTML的集合，它使用了最新的浏览器技术，给你的Web开发提供了时尚的版式，表单，buttons，表格，网格系统等等。\n\n\n\n## EasyUI\njQuery EasyUI 为网页开发提供了一堆的常用UI组件，包括菜单、对话框、布局、窗帘、表格、表单等等组件。\n\n下图是一个具有布局效果的窗口：\n\n\n\n## Extjs\n\nExtJS 主要用来开发RIA富客户端的AJAX应用，主要用于创建前端用户界面，与后台技术无关的前端ajax框架。因此，可以把ExtJS用在.Net、Java、Php等各种开发语言开发的应用中。ExtJs最开始基于YUI技术，由开发人员 JackSlocum开发，通过参考JavaSwing等机制来组织可视化组件，无论从UI界面上CSS样式的应用，到数据解析上的异常处理，都可算是一 款不可多得的JavaScript客户端技术的精品。\n\n\n\nExt的UI组件模型和开发理念脱胎、成型于Yahoo组件库YUI和Java平台上Swing两者，并为开发者屏蔽了大量跨浏览器方面的处理。相对来说，EXT要比开发者直接针对DOM、W3C对象模型开发UI组件轻松。\n\n特点如下：\n\n- 高性能, customizable UI widgets\n- Well designed, documented and extensible Component model\n- Commercial and Open Source licenses available\n- \n\n\n## Amaze UI\n\n Amaze UI是国内首款Html5开源跨屏前端框架，优秀开源前端框架，拥有丰富的CSS+JS组件。轻量级高性能开源框架，以移动优先（Mobile first）为理念，从小屏逐步扩展到大屏，最终实现所有屏幕适配，适应移动互联潮流；面向 HTML5 开发，使用 CSS3 来做动画交互，平滑、高效，更适合移动设备，让 Web 应用更快速载；含近 20 个 CSS 组件、10 个 JS 组件，更有 17 款包含近 60 个主题的 Web 组件，可快速构建界面出色、体验优秀的跨屏页面，大幅提升开发效率；相比国外框架，Amaze UI 关注中文排版，根据用户代理调整字体，实现更好的中文排版效果；兼顾国内主流浏览器及 App 内置浏览器兼容支持。","source":"_posts/front-framework.md","raw":"---\ntitle: 前端框架\ndate: 2016-10-19 13:30\ntags: [framework]\n---\n\n## Semantic UI\n\nSemantic UI—完全语义化的前端界面开发框架，跟 Bootstrap 和 Foundation 比起来，还是有些不同的，在功能特性上、布局设计上、用户体验上均存在很多差异。\n\nSemantic UI 特点：\n\n- 文档和演示非常完善\n- 易于学习和使用\n- 配备网格布局\n- 支持 Sass 和 LESS 动态样式语言\n- 有一些非常实用的附加配置，例如inverted类。\n- 对于社区贡献来说是比较开放的。\n- 有一个非常好的按钮实现，情态动词，和进度条。\n- 在许多功能上使用图标字体。\n\n\nSemantic UI 对浏览器的支持：\n\n- Last 2 Versions FF, Chrome, IE (aka 10+)\n- Safari 6\n- IE 9+ (Browser prefix only)\n- Android 4\n- Blackberry 10\n\n![Semantic UI](http://static.oschina.net/uploads/space/2013/1008/140748_1T9v_119807.jpg)\n\n\n## Bootstrap\n\nBootstrap是快速开发Web应用程序的前端工具包。它是一个CSS和HTML的集合，它使用了最新的浏览器技术，给你的Web开发提供了时尚的版式，表单，buttons，表格，网格系统等等。\n\n\n\n## EasyUI\njQuery EasyUI 为网页开发提供了一堆的常用UI组件，包括菜单、对话框、布局、窗帘、表格、表单等等组件。\n\n下图是一个具有布局效果的窗口：\n\n\n\n## Extjs\n\nExtJS 主要用来开发RIA富客户端的AJAX应用，主要用于创建前端用户界面，与后台技术无关的前端ajax框架。因此，可以把ExtJS用在.Net、Java、Php等各种开发语言开发的应用中。ExtJs最开始基于YUI技术，由开发人员 JackSlocum开发，通过参考JavaSwing等机制来组织可视化组件，无论从UI界面上CSS样式的应用，到数据解析上的异常处理，都可算是一 款不可多得的JavaScript客户端技术的精品。\n\n\n\nExt的UI组件模型和开发理念脱胎、成型于Yahoo组件库YUI和Java平台上Swing两者，并为开发者屏蔽了大量跨浏览器方面的处理。相对来说，EXT要比开发者直接针对DOM、W3C对象模型开发UI组件轻松。\n\n特点如下：\n\n- 高性能, customizable UI widgets\n- Well designed, documented and extensible Component model\n- Commercial and Open Source licenses available\n- \n\n\n## Amaze UI\n\n Amaze UI是国内首款Html5开源跨屏前端框架，优秀开源前端框架，拥有丰富的CSS+JS组件。轻量级高性能开源框架，以移动优先（Mobile first）为理念，从小屏逐步扩展到大屏，最终实现所有屏幕适配，适应移动互联潮流；面向 HTML5 开发，使用 CSS3 来做动画交互，平滑、高效，更适合移动设备，让 Web 应用更快速载；含近 20 个 CSS 组件、10 个 JS 组件，更有 17 款包含近 60 个主题的 Web 组件，可快速构建界面出色、体验优秀的跨屏页面，大幅提升开发效率；相比国外框架，Amaze UI 关注中文排版，根据用户代理调整字体，实现更好的中文排版效果；兼顾国内主流浏览器及 App 内置浏览器兼容支持。","slug":"front-framework","published":1,"updated":"2018-01-16T06:08:44.650Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t220016gcoicr586x6s","content":"<h2 id=\"Semantic-UI\"><a href=\"#Semantic-UI\" class=\"headerlink\" title=\"Semantic UI\"></a>Semantic UI</h2><p>Semantic UI—完全语义化的前端界面开发框架，跟 Bootstrap 和 Foundation 比起来，还是有些不同的，在功能特性上、布局设计上、用户体验上均存在很多差异。</p>\n<p>Semantic UI 特点：</p>\n<ul>\n<li>文档和演示非常完善</li>\n<li>易于学习和使用</li>\n<li>配备网格布局</li>\n<li>支持 Sass 和 LESS 动态样式语言</li>\n<li>有一些非常实用的附加配置，例如inverted类。</li>\n<li>对于社区贡献来说是比较开放的。</li>\n<li>有一个非常好的按钮实现，情态动词，和进度条。</li>\n<li>在许多功能上使用图标字体。</li>\n</ul>\n<p>Semantic UI 对浏览器的支持：</p>\n<ul>\n<li>Last 2 Versions FF, Chrome, IE (aka 10+)</li>\n<li>Safari 6</li>\n<li>IE 9+ (Browser prefix only)</li>\n<li>Android 4</li>\n<li>Blackberry 10</li>\n</ul>\n<p><img src=\"http://static.oschina.net/uploads/space/2013/1008/140748_1T9v_119807.jpg\" alt=\"Semantic UI\"></p>\n<h2 id=\"Bootstrap\"><a href=\"#Bootstrap\" class=\"headerlink\" title=\"Bootstrap\"></a>Bootstrap</h2><p>Bootstrap是快速开发Web应用程序的前端工具包。它是一个CSS和HTML的集合，它使用了最新的浏览器技术，给你的Web开发提供了时尚的版式，表单，buttons，表格，网格系统等等。</p>\n<h2 id=\"EasyUI\"><a href=\"#EasyUI\" class=\"headerlink\" title=\"EasyUI\"></a>EasyUI</h2><p>jQuery EasyUI 为网页开发提供了一堆的常用UI组件，包括菜单、对话框、布局、窗帘、表格、表单等等组件。</p>\n<p>下图是一个具有布局效果的窗口：</p>\n<h2 id=\"Extjs\"><a href=\"#Extjs\" class=\"headerlink\" title=\"Extjs\"></a>Extjs</h2><p>ExtJS 主要用来开发RIA富客户端的AJAX应用，主要用于创建前端用户界面，与后台技术无关的前端ajax框架。因此，可以把ExtJS用在.Net、Java、Php等各种开发语言开发的应用中。ExtJs最开始基于YUI技术，由开发人员 JackSlocum开发，通过参考JavaSwing等机制来组织可视化组件，无论从UI界面上CSS样式的应用，到数据解析上的异常处理，都可算是一 款不可多得的JavaScript客户端技术的精品。</p>\n<p>Ext的UI组件模型和开发理念脱胎、成型于Yahoo组件库YUI和Java平台上Swing两者，并为开发者屏蔽了大量跨浏览器方面的处理。相对来说，EXT要比开发者直接针对DOM、W3C对象模型开发UI组件轻松。</p>\n<p>特点如下：</p>\n<ul>\n<li>高性能, customizable UI widgets</li>\n<li>Well designed, documented and extensible Component model</li>\n<li>Commercial and Open Source licenses available</li>\n<li></li>\n</ul>\n<h2 id=\"Amaze-UI\"><a href=\"#Amaze-UI\" class=\"headerlink\" title=\"Amaze UI\"></a>Amaze UI</h2><p> Amaze UI是国内首款Html5开源跨屏前端框架，优秀开源前端框架，拥有丰富的CSS+JS组件。轻量级高性能开源框架，以移动优先（Mobile first）为理念，从小屏逐步扩展到大屏，最终实现所有屏幕适配，适应移动互联潮流；面向 HTML5 开发，使用 CSS3 来做动画交互，平滑、高效，更适合移动设备，让 Web 应用更快速载；含近 20 个 CSS 组件、10 个 JS 组件，更有 17 款包含近 60 个主题的 Web 组件，可快速构建界面出色、体验优秀的跨屏页面，大幅提升开发效率；相比国外框架，Amaze UI 关注中文排版，根据用户代理调整字体，实现更好的中文排版效果；兼顾国内主流浏览器及 App 内置浏览器兼容支持。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Semantic-UI\"><a href=\"#Semantic-UI\" class=\"headerlink\" title=\"Semantic UI\"></a>Semantic UI</h2><p>Semantic UI—完全语义化的前端界面开发框架，跟 Bootstrap 和 Foundation 比起来，还是有些不同的，在功能特性上、布局设计上、用户体验上均存在很多差异。</p>\n<p>Semantic UI 特点：</p>\n<ul>\n<li>文档和演示非常完善</li>\n<li>易于学习和使用</li>\n<li>配备网格布局</li>\n<li>支持 Sass 和 LESS 动态样式语言</li>\n<li>有一些非常实用的附加配置，例如inverted类。</li>\n<li>对于社区贡献来说是比较开放的。</li>\n<li>有一个非常好的按钮实现，情态动词，和进度条。</li>\n<li>在许多功能上使用图标字体。</li>\n</ul>\n<p>Semantic UI 对浏览器的支持：</p>\n<ul>\n<li>Last 2 Versions FF, Chrome, IE (aka 10+)</li>\n<li>Safari 6</li>\n<li>IE 9+ (Browser prefix only)</li>\n<li>Android 4</li>\n<li>Blackberry 10</li>\n</ul>\n<p><img src=\"http://static.oschina.net/uploads/space/2013/1008/140748_1T9v_119807.jpg\" alt=\"Semantic UI\"></p>\n<h2 id=\"Bootstrap\"><a href=\"#Bootstrap\" class=\"headerlink\" title=\"Bootstrap\"></a>Bootstrap</h2><p>Bootstrap是快速开发Web应用程序的前端工具包。它是一个CSS和HTML的集合，它使用了最新的浏览器技术，给你的Web开发提供了时尚的版式，表单，buttons，表格，网格系统等等。</p>\n<h2 id=\"EasyUI\"><a href=\"#EasyUI\" class=\"headerlink\" title=\"EasyUI\"></a>EasyUI</h2><p>jQuery EasyUI 为网页开发提供了一堆的常用UI组件，包括菜单、对话框、布局、窗帘、表格、表单等等组件。</p>\n<p>下图是一个具有布局效果的窗口：</p>\n<h2 id=\"Extjs\"><a href=\"#Extjs\" class=\"headerlink\" title=\"Extjs\"></a>Extjs</h2><p>ExtJS 主要用来开发RIA富客户端的AJAX应用，主要用于创建前端用户界面，与后台技术无关的前端ajax框架。因此，可以把ExtJS用在.Net、Java、Php等各种开发语言开发的应用中。ExtJs最开始基于YUI技术，由开发人员 JackSlocum开发，通过参考JavaSwing等机制来组织可视化组件，无论从UI界面上CSS样式的应用，到数据解析上的异常处理，都可算是一 款不可多得的JavaScript客户端技术的精品。</p>\n<p>Ext的UI组件模型和开发理念脱胎、成型于Yahoo组件库YUI和Java平台上Swing两者，并为开发者屏蔽了大量跨浏览器方面的处理。相对来说，EXT要比开发者直接针对DOM、W3C对象模型开发UI组件轻松。</p>\n<p>特点如下：</p>\n<ul>\n<li>高性能, customizable UI widgets</li>\n<li>Well designed, documented and extensible Component model</li>\n<li>Commercial and Open Source licenses available</li>\n<li></li>\n</ul>\n<h2 id=\"Amaze-UI\"><a href=\"#Amaze-UI\" class=\"headerlink\" title=\"Amaze UI\"></a>Amaze UI</h2><p> Amaze UI是国内首款Html5开源跨屏前端框架，优秀开源前端框架，拥有丰富的CSS+JS组件。轻量级高性能开源框架，以移动优先（Mobile first）为理念，从小屏逐步扩展到大屏，最终实现所有屏幕适配，适应移动互联潮流；面向 HTML5 开发，使用 CSS3 来做动画交互，平滑、高效，更适合移动设备，让 Web 应用更快速载；含近 20 个 CSS 组件、10 个 JS 组件，更有 17 款包含近 60 个主题的 Web 组件，可快速构建界面出色、体验优秀的跨屏页面，大幅提升开发效率；相比国外框架，Amaze UI 关注中文排版，根据用户代理调整字体，实现更好的中文排版效果；兼顾国内主流浏览器及 App 内置浏览器兼容支持。</p>\n"},{"title":"Java各版本特性","date":"2018-06-06T16:00:00.000Z","_content":"\n# Java 5\n1. 泛型Generics\n2. 枚举类型Enumeration\n3. 自动装箱（自动类型包装和解包）autoboxing & unboxing\n4. 可变参数varargs（varargs number of arguments）\n5. Annotations\n6. 新的迭代语句\n7. 静态导入\n8. 新的格式化方法\n9. 新的线程模型和并发库\n\n# Java 6\n1. 引入一个支持脚本引擎的新框架\n2. UI的增强\n3. 对WebService支持的增强\n4. 一系列的安全相关的增强\n5. JDBC 4.0\n6. Compiler API\n7. 通用的Annotations支持\n\n\n# Java 7\n1. switch中可以使用字符串\n2. 泛型实例化类型自动推断\n3. 语法上支持集合，而不一定是数组\n4. 新增了一些取环境信息的工具方法\n5. Boolean类型反转，空指针安全，参与为运算\n6. 两个char间的equals\n7. 安全的加减乘除\n8. Map集合支持并发请求\n\n\n\n\n# Java 8\n1. Lambda表达式\n\n2. 默认方法\n\n3. 静态方法\n\n4. 优化了HashMap以及ConcurrentHashMap\n将HashMap原来的数组+链表的结构优化成了数组+链表+红黑树的结构，减少了hash碰撞造成的链表长度过长，时间复杂度过高的问题，ConcurrentHashMap则改进了原先的分段锁的方式，采用transient volatile HashEntry<K,V>[] table来保存数据。\n\n5. JVM\nPermGen空间被移除了，取而代之的是Metaspace。JVM选项-XX:PermSize与-XX:MaxPermSize分别被-XX:MetaSpaceSize与-XX:MaxMetaspaceSize所代替。\n6. 新增原子性操作类LongAdder\n\n7. 新增StampedLock\n\n# Java 9\n1. jshell\n2. 私有接口方法\n3. 更改了HTTP调动的相关API\n4. 集合工厂方法\n5. 改进了Stream API\n\n","source":"_posts/future-of-java-each-version.md","raw":"---\ntitle: Java各版本特性\ndate: 2018-06-07\ntags: [Java]\n---\n\n# Java 5\n1. 泛型Generics\n2. 枚举类型Enumeration\n3. 自动装箱（自动类型包装和解包）autoboxing & unboxing\n4. 可变参数varargs（varargs number of arguments）\n5. Annotations\n6. 新的迭代语句\n7. 静态导入\n8. 新的格式化方法\n9. 新的线程模型和并发库\n\n# Java 6\n1. 引入一个支持脚本引擎的新框架\n2. UI的增强\n3. 对WebService支持的增强\n4. 一系列的安全相关的增强\n5. JDBC 4.0\n6. Compiler API\n7. 通用的Annotations支持\n\n\n# Java 7\n1. switch中可以使用字符串\n2. 泛型实例化类型自动推断\n3. 语法上支持集合，而不一定是数组\n4. 新增了一些取环境信息的工具方法\n5. Boolean类型反转，空指针安全，参与为运算\n6. 两个char间的equals\n7. 安全的加减乘除\n8. Map集合支持并发请求\n\n\n\n\n# Java 8\n1. Lambda表达式\n\n2. 默认方法\n\n3. 静态方法\n\n4. 优化了HashMap以及ConcurrentHashMap\n将HashMap原来的数组+链表的结构优化成了数组+链表+红黑树的结构，减少了hash碰撞造成的链表长度过长，时间复杂度过高的问题，ConcurrentHashMap则改进了原先的分段锁的方式，采用transient volatile HashEntry<K,V>[] table来保存数据。\n\n5. JVM\nPermGen空间被移除了，取而代之的是Metaspace。JVM选项-XX:PermSize与-XX:MaxPermSize分别被-XX:MetaSpaceSize与-XX:MaxMetaspaceSize所代替。\n6. 新增原子性操作类LongAdder\n\n7. 新增StampedLock\n\n# Java 9\n1. jshell\n2. 私有接口方法\n3. 更改了HTTP调动的相关API\n4. 集合工厂方法\n5. 改进了Stream API\n\n","slug":"future-of-java-each-version","published":1,"updated":"2018-07-02T04:57:11.341Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t230018gcoi8m3mskeg","content":"<h1 id=\"Java-5\"><a href=\"#Java-5\" class=\"headerlink\" title=\"Java 5\"></a>Java 5</h1><ol>\n<li>泛型Generics</li>\n<li>枚举类型Enumeration</li>\n<li>自动装箱（自动类型包装和解包）autoboxing &amp; unboxing</li>\n<li>可变参数varargs（varargs number of arguments）</li>\n<li>Annotations</li>\n<li>新的迭代语句</li>\n<li>静态导入</li>\n<li>新的格式化方法</li>\n<li>新的线程模型和并发库</li>\n</ol>\n<h1 id=\"Java-6\"><a href=\"#Java-6\" class=\"headerlink\" title=\"Java 6\"></a>Java 6</h1><ol>\n<li>引入一个支持脚本引擎的新框架</li>\n<li>UI的增强</li>\n<li>对WebService支持的增强</li>\n<li>一系列的安全相关的增强</li>\n<li>JDBC 4.0</li>\n<li>Compiler API</li>\n<li>通用的Annotations支持</li>\n</ol>\n<h1 id=\"Java-7\"><a href=\"#Java-7\" class=\"headerlink\" title=\"Java 7\"></a>Java 7</h1><ol>\n<li>switch中可以使用字符串</li>\n<li>泛型实例化类型自动推断</li>\n<li>语法上支持集合，而不一定是数组</li>\n<li>新增了一些取环境信息的工具方法</li>\n<li>Boolean类型反转，空指针安全，参与为运算</li>\n<li>两个char间的equals</li>\n<li>安全的加减乘除</li>\n<li>Map集合支持并发请求</li>\n</ol>\n<h1 id=\"Java-8\"><a href=\"#Java-8\" class=\"headerlink\" title=\"Java 8\"></a>Java 8</h1><ol>\n<li><p>Lambda表达式</p>\n</li>\n<li><p>默认方法</p>\n</li>\n<li><p>静态方法</p>\n</li>\n<li><p>优化了HashMap以及ConcurrentHashMap<br>将HashMap原来的数组+链表的结构优化成了数组+链表+红黑树的结构，减少了hash碰撞造成的链表长度过长，时间复杂度过高的问题，ConcurrentHashMap则改进了原先的分段锁的方式，采用transient volatile HashEntry&lt;K,V&gt;[] table来保存数据。</p>\n</li>\n<li><p>JVM<br>PermGen空间被移除了，取而代之的是Metaspace。JVM选项-XX:PermSize与-XX:MaxPermSize分别被-XX:MetaSpaceSize与-XX:MaxMetaspaceSize所代替。</p>\n</li>\n<li><p>新增原子性操作类LongAdder</p>\n</li>\n<li><p>新增StampedLock</p>\n</li>\n</ol>\n<h1 id=\"Java-9\"><a href=\"#Java-9\" class=\"headerlink\" title=\"Java 9\"></a>Java 9</h1><ol>\n<li>jshell</li>\n<li>私有接口方法</li>\n<li>更改了HTTP调动的相关API</li>\n<li>集合工厂方法</li>\n<li>改进了Stream API</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Java-5\"><a href=\"#Java-5\" class=\"headerlink\" title=\"Java 5\"></a>Java 5</h1><ol>\n<li>泛型Generics</li>\n<li>枚举类型Enumeration</li>\n<li>自动装箱（自动类型包装和解包）autoboxing &amp; unboxing</li>\n<li>可变参数varargs（varargs number of arguments）</li>\n<li>Annotations</li>\n<li>新的迭代语句</li>\n<li>静态导入</li>\n<li>新的格式化方法</li>\n<li>新的线程模型和并发库</li>\n</ol>\n<h1 id=\"Java-6\"><a href=\"#Java-6\" class=\"headerlink\" title=\"Java 6\"></a>Java 6</h1><ol>\n<li>引入一个支持脚本引擎的新框架</li>\n<li>UI的增强</li>\n<li>对WebService支持的增强</li>\n<li>一系列的安全相关的增强</li>\n<li>JDBC 4.0</li>\n<li>Compiler API</li>\n<li>通用的Annotations支持</li>\n</ol>\n<h1 id=\"Java-7\"><a href=\"#Java-7\" class=\"headerlink\" title=\"Java 7\"></a>Java 7</h1><ol>\n<li>switch中可以使用字符串</li>\n<li>泛型实例化类型自动推断</li>\n<li>语法上支持集合，而不一定是数组</li>\n<li>新增了一些取环境信息的工具方法</li>\n<li>Boolean类型反转，空指针安全，参与为运算</li>\n<li>两个char间的equals</li>\n<li>安全的加减乘除</li>\n<li>Map集合支持并发请求</li>\n</ol>\n<h1 id=\"Java-8\"><a href=\"#Java-8\" class=\"headerlink\" title=\"Java 8\"></a>Java 8</h1><ol>\n<li><p>Lambda表达式</p>\n</li>\n<li><p>默认方法</p>\n</li>\n<li><p>静态方法</p>\n</li>\n<li><p>优化了HashMap以及ConcurrentHashMap<br>将HashMap原来的数组+链表的结构优化成了数组+链表+红黑树的结构，减少了hash碰撞造成的链表长度过长，时间复杂度过高的问题，ConcurrentHashMap则改进了原先的分段锁的方式，采用transient volatile HashEntry&lt;K,V&gt;[] table来保存数据。</p>\n</li>\n<li><p>JVM<br>PermGen空间被移除了，取而代之的是Metaspace。JVM选项-XX:PermSize与-XX:MaxPermSize分别被-XX:MetaSpaceSize与-XX:MaxMetaspaceSize所代替。</p>\n</li>\n<li><p>新增原子性操作类LongAdder</p>\n</li>\n<li><p>新增StampedLock</p>\n</li>\n</ol>\n<h1 id=\"Java-9\"><a href=\"#Java-9\" class=\"headerlink\" title=\"Java 9\"></a>Java 9</h1><ol>\n<li>jshell</li>\n<li>私有接口方法</li>\n<li>更改了HTTP调动的相关API</li>\n<li>集合工厂方法</li>\n<li>改进了Stream API</li>\n</ol>\n"},{"title":"Spring Boot依赖引入的多种方式","date":"2018-10-15T01:06:30.000Z","_content":"\n使用Spring Boot开发，不可避免的会面临Maven依赖包版本的管理。\n\n有如下几种方式可以管理Spring Boot的版本。\n\n## 1. 使用parent继承\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>com.example</groupId>\n    <artifactId>myproject</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.0.0.RELEASE</version>\n    </parent>\n\n    <!-- Additional lines to be added here... -->\n\n</project>\n```\n\n使用parent继承的方式，简单、方便使用。但是有的时候项目又需要继承其他的parent，这个时候parent继承的方式就满足不了需求了。不过不用担心，还有其他方式。\n\n## 2.使用import方式\n\n```xml\n<dependencyManagement>\n        <dependencies>\n        <dependency>\n            <!-- Import dependency management from Spring Boot -->\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-dependencies</artifactId>\n            <version>2.0.0.RELEASE</version>\n            <type>pom</type>\n            <scope>import</scope>\n        </dependency>\n    </dependencies>\n</dependencyManagement>\n```\n在parent的pom文件中，声明dependencyManagement，这样在实际的项目pom文件中，直接声明需要的spring boot包就可以，不需要填写version属性。\n\n还有一种是使用maven plugin。\n\n## 3.使用Spring boot Maven插件\n```xml\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-maven-plugin</artifactId>\n        </plugin>\n    </plugins>\n</build>\n```\nspring boot依赖管理，根据不同的实际需求，选择不同的管理方式，可以大大提高效率。\n","source":"_posts/how-to-import-springboot.md","raw":"---\ntitle: Spring Boot依赖引入的多种方式\ndate: 2018-10-15 09:06:30\ntags: [Java]\n---\n\n使用Spring Boot开发，不可避免的会面临Maven依赖包版本的管理。\n\n有如下几种方式可以管理Spring Boot的版本。\n\n## 1. 使用parent继承\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>com.example</groupId>\n    <artifactId>myproject</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.0.0.RELEASE</version>\n    </parent>\n\n    <!-- Additional lines to be added here... -->\n\n</project>\n```\n\n使用parent继承的方式，简单、方便使用。但是有的时候项目又需要继承其他的parent，这个时候parent继承的方式就满足不了需求了。不过不用担心，还有其他方式。\n\n## 2.使用import方式\n\n```xml\n<dependencyManagement>\n        <dependencies>\n        <dependency>\n            <!-- Import dependency management from Spring Boot -->\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-dependencies</artifactId>\n            <version>2.0.0.RELEASE</version>\n            <type>pom</type>\n            <scope>import</scope>\n        </dependency>\n    </dependencies>\n</dependencyManagement>\n```\n在parent的pom文件中，声明dependencyManagement，这样在实际的项目pom文件中，直接声明需要的spring boot包就可以，不需要填写version属性。\n\n还有一种是使用maven plugin。\n\n## 3.使用Spring boot Maven插件\n```xml\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-maven-plugin</artifactId>\n        </plugin>\n    </plugins>\n</build>\n```\nspring boot依赖管理，根据不同的实际需求，选择不同的管理方式，可以大大提高效率。\n","slug":"how-to-import-springboot","published":1,"updated":"2018-10-15T07:01:47.136Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t24001agcoisffax5em","content":"<p>使用Spring Boot开发，不可避免的会面临Maven依赖包版本的管理。</p>\n<p>有如下几种方式可以管理Spring Boot的版本。</p>\n<h2 id=\"1-使用parent继承\"><a href=\"#1-使用parent继承\" class=\"headerlink\" title=\"1. 使用parent继承\"></a>1. 使用parent继承</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.example<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>myproject<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Additional lines to be added here... --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>使用parent继承的方式，简单、方便使用。但是有的时候项目又需要继承其他的parent，这个时候parent继承的方式就满足不了需求了。不过不用担心，还有其他方式。</p>\n<h2 id=\"2-使用import方式\"><a href=\"#2-使用import方式\" class=\"headerlink\" title=\"2.使用import方式\"></a>2.使用import方式</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Import dependency management from Spring Boot --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在parent的pom文件中，声明dependencyManagement，这样在实际的项目pom文件中，直接声明需要的spring boot包就可以，不需要填写version属性。</p>\n<p>还有一种是使用maven plugin。</p>\n<h2 id=\"3-使用Spring-boot-Maven插件\"><a href=\"#3-使用Spring-boot-Maven插件\" class=\"headerlink\" title=\"3.使用Spring boot Maven插件\"></a>3.使用Spring boot Maven插件</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>spring boot依赖管理，根据不同的实际需求，选择不同的管理方式，可以大大提高效率。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>使用Spring Boot开发，不可避免的会面临Maven依赖包版本的管理。</p>\n<p>有如下几种方式可以管理Spring Boot的版本。</p>\n<h2 id=\"1-使用parent继承\"><a href=\"#1-使用parent继承\" class=\"headerlink\" title=\"1. 使用parent继承\"></a>1. 使用parent继承</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.example<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>myproject<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Additional lines to be added here... --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>使用parent继承的方式，简单、方便使用。但是有的时候项目又需要继承其他的parent，这个时候parent继承的方式就满足不了需求了。不过不用担心，还有其他方式。</p>\n<h2 id=\"2-使用import方式\"><a href=\"#2-使用import方式\" class=\"headerlink\" title=\"2.使用import方式\"></a>2.使用import方式</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Import dependency management from Spring Boot --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在parent的pom文件中，声明dependencyManagement，这样在实际的项目pom文件中，直接声明需要的spring boot包就可以，不需要填写version属性。</p>\n<p>还有一种是使用maven plugin。</p>\n<h2 id=\"3-使用Spring-boot-Maven插件\"><a href=\"#3-使用Spring-boot-Maven插件\" class=\"headerlink\" title=\"3.使用Spring boot Maven插件\"></a>3.使用Spring boot Maven插件</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>spring boot依赖管理，根据不同的实际需求，选择不同的管理方式，可以大大提高效率。</p>\n"},{"title":"how to monitor java garbage collection","date":"2018-06-27T02:49:46.000Z","_content":"\n> [原文](https://www.cubrid.org/blog/how-to-monitor-java-garbage-collection)\n\n\n# What is GC Monitoring?\n**Garbage Collection Monitoring** refers to the _process of figuring out how JVM is running GC_. For example, we can find out:\n\n1. When an object in young has moved to old and by how much,\n2. or wehn `stop-the-world` has occurred and for how long.\n\nGC Monitoring is carried out to see _if JVM is running GC efficiently_, and _to check if additional GC tuning is necessary_. Based on this information, the application can be edited or GC method can be changed (**GC tuning**).\n\n# How to Monitor GC?\n\nThere are different ways to monitor GC, but the only difference is how the GC operation information is shown. GC is done by JVM, and since the GC monitoring tools disclose the GC information provided by JVM, you will get the same results on matter how you monitor GC. Therefore, you do not need to learn all methods to monitor GC, but since it only requires a little amount of time to learn each GC monitoring method, knowing a few of them can help you use the right one for different situations and environments.\n\nThe tools or JVM options listed below cannot be used universally regardless of the HVM vendor. This is because there is no need for a \"standard\" for disclosing GC information. In this example we will use **HotSpot JVM** (Oracle JVM). Since NHN is using Oracle(Sun) JVM, there should be no difficulties in applying the tools or JVM options that we are explaining here.\n\nFirst, the GC monitoring methods can be separated into **CUI** and **GUI** depending on the access interface. The typical CUI GC monitoring method involves using a separate CUI application called \"**jstat**\", or selecting a JVM option called \"**verbosegc**\" when running JVM.\n\nGUI GC monitoring is done by using a separate GUI application, and three most commonly used applications would be \"jconsole\", \"jvisualvm\" and \"Visual GC\".\n\nLet's learn more about each method.\n\n# jstat\n\n**jstat** is a monitoring tool in HotSpot JVM. Other monitoring tools for HotSpot JVM are **jps** and **jstatd**. Sometimes, you need all three tools to monitor a Java application.\n\n**jstat** does not provide only the GC operation information display. It also provides class loader operation information or Just-in-Time compiler operation information. Among all the information jstat can provide, in this article we will only cover its functionality to monitor GC operating information.\n\n**jstat** is located in `$JDK_HOME/bin`, so if java or javac can run without setting a separate directory from the command line, so can jstat.\n\nYou can try running the following in the command line.\n\n\n```\n$> jstat –gc  $<vmid$> 1000\n \nS0C       S1C       S0U    S1U      EC         EU          OC         OU         PC         PU         YGC     YGCT    FGC      FGCT     GCT\n3008.0   3072.0    0.0     1511.1   343360.0   46383.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588\n3008.0   3072.0    0.0     1511.1   343360.0   47530.9     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588\n3008.0   3072.0    0.0     1511.1   343360.0   47793.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588\n \n$>\n```\n\nJust like in the example, the real type data will be output along with the following columns:\n\n**`S0C    S1C     S0U     S1U    EC     EU     OC     OU     PC`**.\n\n**vmid** (Virtual Machine ID), as its name implies, is the ID for the VM. Java applications running either on a local machine or on a remote machine can be specified using vmid. The vmid for Java application running on a local machine is called **lvmid** (Local vmid), and usually is PID. To find out the lvmid, you can write the PID value using a **ps** command or Windows task manager, but we suggest **jps** because PID and lvmid does not always match. **jps** stands for Java PS. **jps** shows vmids and main method information. Just like ps shows PIDs and process names.\n\nFind out the vmid of the Java application that you want to monitor by using jps, then use it as a parameter in jstat. If you use jps alone, only bootstrap information will show when several WAS instances are running in one equipment. We suggest that you use `ps -ef | grep java` command along with jps.\n\nGC performance data needs constant observation, therefore when running jstat, try to output the GC monitoring information on a regular basis. \n\nFor example, running \"`jstat –gc <vmid> 1000`\" (or 1s) will display the GC monitoring data on the console every 1 second. \"`jstat –gc <vmid> 1000 10`\" will display the GC monitoring information once every 1 second for 10 times in total.\n\nThere are many options other than `-gc`, among which GC related ones are listed below.\n\n\nOption Name\t| Description\n----|----------\ngc|\tIt shows the current size for each heap area and its current usage (Ede, survivor, old, etc.), total number of GC performed, and the accumulated time for GC operations.\ngccapactiy|\tIt shows the minimum size (ms) and maximum size (mx) of each heap area, current size, and the number of GC performed for each area. (Does not show current usage and accumulated time for GC operations.)\ngccause|\tIt shows the \"information provided by -gcutil\" + reason for the last GC and the reason for the current GC.\ngcnew|\tShows the GC performance data for the new area.\ngcnewcapacity|\tShows statistics for the size of new area.\ngcold|\tShows the GC performance data for the old area.\ngcoldcapacity|\tShows statistics for the size of old area.\ngcpermcapacity|\tShows statistics for the permanent area.\ngcutil|\tShows the usage for each heap area in percentage. Also shows the total number of GC performed and the accumulated time for GC operations.\n\n\n\n","source":"_posts/how-to-monitor-java-garbage-collection.md","raw":"---\ntitle: how to monitor java garbage collection\ndate: 2018-06-27 10:49:46\ntags:\n    - Java\n    - GC\n---\n\n> [原文](https://www.cubrid.org/blog/how-to-monitor-java-garbage-collection)\n\n\n# What is GC Monitoring?\n**Garbage Collection Monitoring** refers to the _process of figuring out how JVM is running GC_. For example, we can find out:\n\n1. When an object in young has moved to old and by how much,\n2. or wehn `stop-the-world` has occurred and for how long.\n\nGC Monitoring is carried out to see _if JVM is running GC efficiently_, and _to check if additional GC tuning is necessary_. Based on this information, the application can be edited or GC method can be changed (**GC tuning**).\n\n# How to Monitor GC?\n\nThere are different ways to monitor GC, but the only difference is how the GC operation information is shown. GC is done by JVM, and since the GC monitoring tools disclose the GC information provided by JVM, you will get the same results on matter how you monitor GC. Therefore, you do not need to learn all methods to monitor GC, but since it only requires a little amount of time to learn each GC monitoring method, knowing a few of them can help you use the right one for different situations and environments.\n\nThe tools or JVM options listed below cannot be used universally regardless of the HVM vendor. This is because there is no need for a \"standard\" for disclosing GC information. In this example we will use **HotSpot JVM** (Oracle JVM). Since NHN is using Oracle(Sun) JVM, there should be no difficulties in applying the tools or JVM options that we are explaining here.\n\nFirst, the GC monitoring methods can be separated into **CUI** and **GUI** depending on the access interface. The typical CUI GC monitoring method involves using a separate CUI application called \"**jstat**\", or selecting a JVM option called \"**verbosegc**\" when running JVM.\n\nGUI GC monitoring is done by using a separate GUI application, and three most commonly used applications would be \"jconsole\", \"jvisualvm\" and \"Visual GC\".\n\nLet's learn more about each method.\n\n# jstat\n\n**jstat** is a monitoring tool in HotSpot JVM. Other monitoring tools for HotSpot JVM are **jps** and **jstatd**. Sometimes, you need all three tools to monitor a Java application.\n\n**jstat** does not provide only the GC operation information display. It also provides class loader operation information or Just-in-Time compiler operation information. Among all the information jstat can provide, in this article we will only cover its functionality to monitor GC operating information.\n\n**jstat** is located in `$JDK_HOME/bin`, so if java or javac can run without setting a separate directory from the command line, so can jstat.\n\nYou can try running the following in the command line.\n\n\n```\n$> jstat –gc  $<vmid$> 1000\n \nS0C       S1C       S0U    S1U      EC         EU          OC         OU         PC         PU         YGC     YGCT    FGC      FGCT     GCT\n3008.0   3072.0    0.0     1511.1   343360.0   46383.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588\n3008.0   3072.0    0.0     1511.1   343360.0   47530.9     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588\n3008.0   3072.0    0.0     1511.1   343360.0   47793.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588\n \n$>\n```\n\nJust like in the example, the real type data will be output along with the following columns:\n\n**`S0C    S1C     S0U     S1U    EC     EU     OC     OU     PC`**.\n\n**vmid** (Virtual Machine ID), as its name implies, is the ID for the VM. Java applications running either on a local machine or on a remote machine can be specified using vmid. The vmid for Java application running on a local machine is called **lvmid** (Local vmid), and usually is PID. To find out the lvmid, you can write the PID value using a **ps** command or Windows task manager, but we suggest **jps** because PID and lvmid does not always match. **jps** stands for Java PS. **jps** shows vmids and main method information. Just like ps shows PIDs and process names.\n\nFind out the vmid of the Java application that you want to monitor by using jps, then use it as a parameter in jstat. If you use jps alone, only bootstrap information will show when several WAS instances are running in one equipment. We suggest that you use `ps -ef | grep java` command along with jps.\n\nGC performance data needs constant observation, therefore when running jstat, try to output the GC monitoring information on a regular basis. \n\nFor example, running \"`jstat –gc <vmid> 1000`\" (or 1s) will display the GC monitoring data on the console every 1 second. \"`jstat –gc <vmid> 1000 10`\" will display the GC monitoring information once every 1 second for 10 times in total.\n\nThere are many options other than `-gc`, among which GC related ones are listed below.\n\n\nOption Name\t| Description\n----|----------\ngc|\tIt shows the current size for each heap area and its current usage (Ede, survivor, old, etc.), total number of GC performed, and the accumulated time for GC operations.\ngccapactiy|\tIt shows the minimum size (ms) and maximum size (mx) of each heap area, current size, and the number of GC performed for each area. (Does not show current usage and accumulated time for GC operations.)\ngccause|\tIt shows the \"information provided by -gcutil\" + reason for the last GC and the reason for the current GC.\ngcnew|\tShows the GC performance data for the new area.\ngcnewcapacity|\tShows statistics for the size of new area.\ngcold|\tShows the GC performance data for the old area.\ngcoldcapacity|\tShows statistics for the size of old area.\ngcpermcapacity|\tShows statistics for the permanent area.\ngcutil|\tShows the usage for each heap area in percentage. Also shows the total number of GC performed and the accumulated time for GC operations.\n\n\n\n","slug":"how-to-monitor-java-garbage-collection","published":1,"updated":"2018-10-11T12:55:07.506Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t25001cgcoik62pyvlm","content":"<blockquote>\n<p><a href=\"https://www.cubrid.org/blog/how-to-monitor-java-garbage-collection\" target=\"_blank\" rel=\"noopener\">原文</a></p>\n</blockquote>\n<h1 id=\"What-is-GC-Monitoring\"><a href=\"#What-is-GC-Monitoring\" class=\"headerlink\" title=\"What is GC Monitoring?\"></a>What is GC Monitoring?</h1><p><strong>Garbage Collection Monitoring</strong> refers to the <em>process of figuring out how JVM is running GC</em>. For example, we can find out:</p>\n<ol>\n<li>When an object in young has moved to old and by how much,</li>\n<li>or wehn <code>stop-the-world</code> has occurred and for how long.</li>\n</ol>\n<p>GC Monitoring is carried out to see <em>if JVM is running GC efficiently</em>, and <em>to check if additional GC tuning is necessary</em>. Based on this information, the application can be edited or GC method can be changed (<strong>GC tuning</strong>).</p>\n<h1 id=\"How-to-Monitor-GC\"><a href=\"#How-to-Monitor-GC\" class=\"headerlink\" title=\"How to Monitor GC?\"></a>How to Monitor GC?</h1><p>There are different ways to monitor GC, but the only difference is how the GC operation information is shown. GC is done by JVM, and since the GC monitoring tools disclose the GC information provided by JVM, you will get the same results on matter how you monitor GC. Therefore, you do not need to learn all methods to monitor GC, but since it only requires a little amount of time to learn each GC monitoring method, knowing a few of them can help you use the right one for different situations and environments.</p>\n<p>The tools or JVM options listed below cannot be used universally regardless of the HVM vendor. This is because there is no need for a “standard” for disclosing GC information. In this example we will use <strong>HotSpot JVM</strong> (Oracle JVM). Since NHN is using Oracle(Sun) JVM, there should be no difficulties in applying the tools or JVM options that we are explaining here.</p>\n<p>First, the GC monitoring methods can be separated into <strong>CUI</strong> and <strong>GUI</strong> depending on the access interface. The typical CUI GC monitoring method involves using a separate CUI application called “<strong>jstat</strong>“, or selecting a JVM option called “<strong>verbosegc</strong>“ when running JVM.</p>\n<p>GUI GC monitoring is done by using a separate GUI application, and three most commonly used applications would be “jconsole”, “jvisualvm” and “Visual GC”.</p>\n<p>Let’s learn more about each method.</p>\n<h1 id=\"jstat\"><a href=\"#jstat\" class=\"headerlink\" title=\"jstat\"></a>jstat</h1><p><strong>jstat</strong> is a monitoring tool in HotSpot JVM. Other monitoring tools for HotSpot JVM are <strong>jps</strong> and <strong>jstatd</strong>. Sometimes, you need all three tools to monitor a Java application.</p>\n<p><strong>jstat</strong> does not provide only the GC operation information display. It also provides class loader operation information or Just-in-Time compiler operation information. Among all the information jstat can provide, in this article we will only cover its functionality to monitor GC operating information.</p>\n<p><strong>jstat</strong> is located in <code>$JDK_HOME/bin</code>, so if java or javac can run without setting a separate directory from the command line, so can jstat.</p>\n<p>You can try running the following in the command line.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$&gt; jstat –gc  $&lt;vmid$&gt; 1000</span><br><span class=\"line\"> </span><br><span class=\"line\">S0C       S1C       S0U    S1U      EC         EU          OC         OU         PC         PU         YGC     YGCT    FGC      FGCT     GCT</span><br><span class=\"line\">3008.0   3072.0    0.0     1511.1   343360.0   46383.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588</span><br><span class=\"line\">3008.0   3072.0    0.0     1511.1   343360.0   47530.9     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588</span><br><span class=\"line\">3008.0   3072.0    0.0     1511.1   343360.0   47793.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588</span><br><span class=\"line\"> </span><br><span class=\"line\">$&gt;</span><br></pre></td></tr></table></figure>\n<p>Just like in the example, the real type data will be output along with the following columns:</p>\n<p><strong><code>S0C    S1C     S0U     S1U    EC     EU     OC     OU     PC</code></strong>.</p>\n<p><strong>vmid</strong> (Virtual Machine ID), as its name implies, is the ID for the VM. Java applications running either on a local machine or on a remote machine can be specified using vmid. The vmid for Java application running on a local machine is called <strong>lvmid</strong> (Local vmid), and usually is PID. To find out the lvmid, you can write the PID value using a <strong>ps</strong> command or Windows task manager, but we suggest <strong>jps</strong> because PID and lvmid does not always match. <strong>jps</strong> stands for Java PS. <strong>jps</strong> shows vmids and main method information. Just like ps shows PIDs and process names.</p>\n<p>Find out the vmid of the Java application that you want to monitor by using jps, then use it as a parameter in jstat. If you use jps alone, only bootstrap information will show when several WAS instances are running in one equipment. We suggest that you use <code>ps -ef | grep java</code> command along with jps.</p>\n<p>GC performance data needs constant observation, therefore when running jstat, try to output the GC monitoring information on a regular basis. </p>\n<p>For example, running “<code>jstat –gc &lt;vmid&gt; 1000</code>“ (or 1s) will display the GC monitoring data on the console every 1 second. “<code>jstat –gc &lt;vmid&gt; 1000 10</code>“ will display the GC monitoring information once every 1 second for 10 times in total.</p>\n<p>There are many options other than <code>-gc</code>, among which GC related ones are listed below.</p>\n<table>\n<thead>\n<tr>\n<th>Option Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>gc</td>\n<td>It shows the current size for each heap area and its current usage (Ede, survivor, old, etc.), total number of GC performed, and the accumulated time for GC operations.</td>\n</tr>\n<tr>\n<td>gccapactiy</td>\n<td>It shows the minimum size (ms) and maximum size (mx) of each heap area, current size, and the number of GC performed for each area. (Does not show current usage and accumulated time for GC operations.)</td>\n</tr>\n<tr>\n<td>gccause</td>\n<td>It shows the “information provided by -gcutil” + reason for the last GC and the reason for the current GC.</td>\n</tr>\n<tr>\n<td>gcnew</td>\n<td>Shows the GC performance data for the new area.</td>\n</tr>\n<tr>\n<td>gcnewcapacity</td>\n<td>Shows statistics for the size of new area.</td>\n</tr>\n<tr>\n<td>gcold</td>\n<td>Shows the GC performance data for the old area.</td>\n</tr>\n<tr>\n<td>gcoldcapacity</td>\n<td>Shows statistics for the size of old area.</td>\n</tr>\n<tr>\n<td>gcpermcapacity</td>\n<td>Shows statistics for the permanent area.</td>\n</tr>\n<tr>\n<td>gcutil</td>\n<td>Shows the usage for each heap area in percentage. Also shows the total number of GC performed and the accumulated time for GC operations.</td>\n</tr>\n</tbody>\n</table>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><a href=\"https://www.cubrid.org/blog/how-to-monitor-java-garbage-collection\" target=\"_blank\" rel=\"noopener\">原文</a></p>\n</blockquote>\n<h1 id=\"What-is-GC-Monitoring\"><a href=\"#What-is-GC-Monitoring\" class=\"headerlink\" title=\"What is GC Monitoring?\"></a>What is GC Monitoring?</h1><p><strong>Garbage Collection Monitoring</strong> refers to the <em>process of figuring out how JVM is running GC</em>. For example, we can find out:</p>\n<ol>\n<li>When an object in young has moved to old and by how much,</li>\n<li>or wehn <code>stop-the-world</code> has occurred and for how long.</li>\n</ol>\n<p>GC Monitoring is carried out to see <em>if JVM is running GC efficiently</em>, and <em>to check if additional GC tuning is necessary</em>. Based on this information, the application can be edited or GC method can be changed (<strong>GC tuning</strong>).</p>\n<h1 id=\"How-to-Monitor-GC\"><a href=\"#How-to-Monitor-GC\" class=\"headerlink\" title=\"How to Monitor GC?\"></a>How to Monitor GC?</h1><p>There are different ways to monitor GC, but the only difference is how the GC operation information is shown. GC is done by JVM, and since the GC monitoring tools disclose the GC information provided by JVM, you will get the same results on matter how you monitor GC. Therefore, you do not need to learn all methods to monitor GC, but since it only requires a little amount of time to learn each GC monitoring method, knowing a few of them can help you use the right one for different situations and environments.</p>\n<p>The tools or JVM options listed below cannot be used universally regardless of the HVM vendor. This is because there is no need for a “standard” for disclosing GC information. In this example we will use <strong>HotSpot JVM</strong> (Oracle JVM). Since NHN is using Oracle(Sun) JVM, there should be no difficulties in applying the tools or JVM options that we are explaining here.</p>\n<p>First, the GC monitoring methods can be separated into <strong>CUI</strong> and <strong>GUI</strong> depending on the access interface. The typical CUI GC monitoring method involves using a separate CUI application called “<strong>jstat</strong>“, or selecting a JVM option called “<strong>verbosegc</strong>“ when running JVM.</p>\n<p>GUI GC monitoring is done by using a separate GUI application, and three most commonly used applications would be “jconsole”, “jvisualvm” and “Visual GC”.</p>\n<p>Let’s learn more about each method.</p>\n<h1 id=\"jstat\"><a href=\"#jstat\" class=\"headerlink\" title=\"jstat\"></a>jstat</h1><p><strong>jstat</strong> is a monitoring tool in HotSpot JVM. Other monitoring tools for HotSpot JVM are <strong>jps</strong> and <strong>jstatd</strong>. Sometimes, you need all three tools to monitor a Java application.</p>\n<p><strong>jstat</strong> does not provide only the GC operation information display. It also provides class loader operation information or Just-in-Time compiler operation information. Among all the information jstat can provide, in this article we will only cover its functionality to monitor GC operating information.</p>\n<p><strong>jstat</strong> is located in <code>$JDK_HOME/bin</code>, so if java or javac can run without setting a separate directory from the command line, so can jstat.</p>\n<p>You can try running the following in the command line.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$&gt; jstat –gc  $&lt;vmid$&gt; 1000</span><br><span class=\"line\"> </span><br><span class=\"line\">S0C       S1C       S0U    S1U      EC         EU          OC         OU         PC         PU         YGC     YGCT    FGC      FGCT     GCT</span><br><span class=\"line\">3008.0   3072.0    0.0     1511.1   343360.0   46383.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588</span><br><span class=\"line\">3008.0   3072.0    0.0     1511.1   343360.0   47530.9     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588</span><br><span class=\"line\">3008.0   3072.0    0.0     1511.1   343360.0   47793.0     699072.0   283690.2   75392.0    41064.3    2540    18.454    4      1.133    19.588</span><br><span class=\"line\"> </span><br><span class=\"line\">$&gt;</span><br></pre></td></tr></table></figure>\n<p>Just like in the example, the real type data will be output along with the following columns:</p>\n<p><strong><code>S0C    S1C     S0U     S1U    EC     EU     OC     OU     PC</code></strong>.</p>\n<p><strong>vmid</strong> (Virtual Machine ID), as its name implies, is the ID for the VM. Java applications running either on a local machine or on a remote machine can be specified using vmid. The vmid for Java application running on a local machine is called <strong>lvmid</strong> (Local vmid), and usually is PID. To find out the lvmid, you can write the PID value using a <strong>ps</strong> command or Windows task manager, but we suggest <strong>jps</strong> because PID and lvmid does not always match. <strong>jps</strong> stands for Java PS. <strong>jps</strong> shows vmids and main method information. Just like ps shows PIDs and process names.</p>\n<p>Find out the vmid of the Java application that you want to monitor by using jps, then use it as a parameter in jstat. If you use jps alone, only bootstrap information will show when several WAS instances are running in one equipment. We suggest that you use <code>ps -ef | grep java</code> command along with jps.</p>\n<p>GC performance data needs constant observation, therefore when running jstat, try to output the GC monitoring information on a regular basis. </p>\n<p>For example, running “<code>jstat –gc &lt;vmid&gt; 1000</code>“ (or 1s) will display the GC monitoring data on the console every 1 second. “<code>jstat –gc &lt;vmid&gt; 1000 10</code>“ will display the GC monitoring information once every 1 second for 10 times in total.</p>\n<p>There are many options other than <code>-gc</code>, among which GC related ones are listed below.</p>\n<table>\n<thead>\n<tr>\n<th>Option Name</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>gc</td>\n<td>It shows the current size for each heap area and its current usage (Ede, survivor, old, etc.), total number of GC performed, and the accumulated time for GC operations.</td>\n</tr>\n<tr>\n<td>gccapactiy</td>\n<td>It shows the minimum size (ms) and maximum size (mx) of each heap area, current size, and the number of GC performed for each area. (Does not show current usage and accumulated time for GC operations.)</td>\n</tr>\n<tr>\n<td>gccause</td>\n<td>It shows the “information provided by -gcutil” + reason for the last GC and the reason for the current GC.</td>\n</tr>\n<tr>\n<td>gcnew</td>\n<td>Shows the GC performance data for the new area.</td>\n</tr>\n<tr>\n<td>gcnewcapacity</td>\n<td>Shows statistics for the size of new area.</td>\n</tr>\n<tr>\n<td>gcold</td>\n<td>Shows the GC performance data for the old area.</td>\n</tr>\n<tr>\n<td>gcoldcapacity</td>\n<td>Shows statistics for the size of old area.</td>\n</tr>\n<tr>\n<td>gcpermcapacity</td>\n<td>Shows statistics for the permanent area.</td>\n</tr>\n<tr>\n<td>gcutil</td>\n<td>Shows the usage for each heap area in percentage. Also shows the total number of GC performed and the accumulated time for GC operations.</td>\n</tr>\n</tbody>\n</table>\n"},{"title":"JavaScript编程规范","date":"2017-04-21T05:10:50.000Z","_content":"\n## 背景\nJavaScript是一种客户端脚本语言，Web工程都会用到它，这份指南列出了编写JavaScript时需要遵守的规则。\n\n## JavaScript语言规范\n\n### 变量\n声明变量必须加上var\n关键字:\n```\nvar a1 = 1;\nvar b1 = 11;\n```\n\n当你没有写var\n，变量就会暴露在全局上下文中，这样很可能会和现有的变量冲突。另外，如果没有加上，很难明确该变量的作用域是什么，变量很可能在局部作用域中，很容易泄漏到Document或者Window中，所以务必用var\n变量。\n\n### 常量\n常量的形式如：`NAMES_LIKE_THIS`，即使用大写字符，并用下划线分割，你也可用`@const`标记来指明它是一个常量，但请不要使用`const`关键字。\n对于基本类型的常量，只需要转换命名：\n```\n/**\n * The number of seconds of minute.\n * @type {number}\n */\neflag.example.SECONDES_IN_A_MINUTE = 60;\n```\n对于非基本类型，使用`@const`\n标记：\n```\n/**\n * The number of seconds in each of the given units.\n * @type {Object.<number>}\n * @const\n */\neflag.example.SECONDS_TABLE = {minute: 60,hour: 60 * 60,day: 60 * 60 * 24}\n```\n至于关键字`const`，因为IE不能识别，所以不要使用。\n\n### 分号\n总是使用分号。 如果仅依靠语句间的隐式分割，有时会很麻烦，使用分号，你自己更能清楚那里是语句的起止。\n行末分号：\n```\nvar foo = 1,bar = 2,baz = 3;\nvar obj = {foo: 1,bar: 2,baz: 3};\n```\n### 单引号(`''`)和双引号(`\"\"`)\n由于JavaScript对于单引号和双引号都可以识别为字符串，但为了统一规范，所以在JavaScript中字符串的定义要求使用单引号：\n```\nvar val = 'a';\n```\n同样，html中属性使用的是双引号：\n```\n<input type=\"text\">\n```\n在JavaScript中动态生成html标签时：\n```\nvar _input = '<input type=\"text\">';\n```\n### 空格\n参数和括号间五空格：\n```\nfunction fn(arg1, arg2){}\n```\n冒号后面有空格\n```\n{foo: 1,bar: 2,baz: 3}\n```\n条件语句有空格\n```\nif (true) {}\nwhile (true) {}\nswitch(v){}\n```\n### Tips and Tricks\n\n### True和False布尔表达式\n下面的布尔表达式都会返回`false`：\n```\nnull\nundefined\n''\n空字符串\n0\n```\n数字`0` 但小心下面的，可都返回`true`：\n```\n'0'\n字符串0\n[]\n空数组\n{}\n空对象\n```\n如果你想检查字符串是否为`null`或`空`：\n```\nif (y != null && y != '') {}\n```\n写成这样会更好：\n```\nif (y) {}\n```\n### 条件（三元）操作符(`?:`)\n三元操作符用于替代下面的代码：\n```\nif (val != 0) {\n  return foo();\n} else {\n  return bar();\n}\n```\n你可以写成：\n```\nreturn val ? foo() : bar();\n```\n在生成HTML代码时也是很有用的：\n```\nvar html = '<input type=\"checkbox\"' + (isChecked ? ' checked' : '')+ (isEnabled ? '' : ' disabled')+ ' name=\"foo\">';\n```\n### `&&`和`||`\n\n二元布尔操作符是可短路的，只有在必要的时候才会计算到最后一项。 `||`被称作为`default`操作符，因为可以这样：\n```\n/**\n * @param {*=} opt_win\n */\nfunction foo(opt_win) {\n  var win;\n  if (opt_win) {\n    win = opt_win;\n  } else {\n    win = window;\n  }\n// ...\n}\n```\n你可以使用它来简化上面的代码：\n```\n/**\n * @param {*=} opt_win\n */\nfunction foo(opt_win) {\n  var win = opt_win || window;\n  // ...\n}\n```\n### 使用`join()`来创建字符串\n通常是这样使用的：\n```\nfunction listHtml(items) {\n  var html = '<div class=\"foo\"';\n  for (var i = 0; i < items.length; i++) {\n    if (i > 0) {\n      html += ',';\n    }\n    html += itemHtml(items[i]);\n  }\n  html += '</div>';\n  return html;\n}\n```\n但这样在IE下非常慢，可以用下面的方式：\n```\nfunction listHtml(items) {\n  var html = [];\n  for (var i = 0; i < items.length; i++) {\n    html[i] = itemHtml(items[i]);\n  }\n  return '<div class=\"foo\">' + html.join(', ') + '</div>';\n}\n```\n你也可以使用数组作为字符串构造器，然后通过`myArray.join('')`\n转换成字符串，不过由于赋值操作快于数组的`push()`，所以尽量使用复制操作。","source":"_posts/javascript-rule.md","raw":"---\ntitle: JavaScript编程规范\ndate: 2017-04-21 13:10:50\ntags:\n---\n\n## 背景\nJavaScript是一种客户端脚本语言，Web工程都会用到它，这份指南列出了编写JavaScript时需要遵守的规则。\n\n## JavaScript语言规范\n\n### 变量\n声明变量必须加上var\n关键字:\n```\nvar a1 = 1;\nvar b1 = 11;\n```\n\n当你没有写var\n，变量就会暴露在全局上下文中，这样很可能会和现有的变量冲突。另外，如果没有加上，很难明确该变量的作用域是什么，变量很可能在局部作用域中，很容易泄漏到Document或者Window中，所以务必用var\n变量。\n\n### 常量\n常量的形式如：`NAMES_LIKE_THIS`，即使用大写字符，并用下划线分割，你也可用`@const`标记来指明它是一个常量，但请不要使用`const`关键字。\n对于基本类型的常量，只需要转换命名：\n```\n/**\n * The number of seconds of minute.\n * @type {number}\n */\neflag.example.SECONDES_IN_A_MINUTE = 60;\n```\n对于非基本类型，使用`@const`\n标记：\n```\n/**\n * The number of seconds in each of the given units.\n * @type {Object.<number>}\n * @const\n */\neflag.example.SECONDS_TABLE = {minute: 60,hour: 60 * 60,day: 60 * 60 * 24}\n```\n至于关键字`const`，因为IE不能识别，所以不要使用。\n\n### 分号\n总是使用分号。 如果仅依靠语句间的隐式分割，有时会很麻烦，使用分号，你自己更能清楚那里是语句的起止。\n行末分号：\n```\nvar foo = 1,bar = 2,baz = 3;\nvar obj = {foo: 1,bar: 2,baz: 3};\n```\n### 单引号(`''`)和双引号(`\"\"`)\n由于JavaScript对于单引号和双引号都可以识别为字符串，但为了统一规范，所以在JavaScript中字符串的定义要求使用单引号：\n```\nvar val = 'a';\n```\n同样，html中属性使用的是双引号：\n```\n<input type=\"text\">\n```\n在JavaScript中动态生成html标签时：\n```\nvar _input = '<input type=\"text\">';\n```\n### 空格\n参数和括号间五空格：\n```\nfunction fn(arg1, arg2){}\n```\n冒号后面有空格\n```\n{foo: 1,bar: 2,baz: 3}\n```\n条件语句有空格\n```\nif (true) {}\nwhile (true) {}\nswitch(v){}\n```\n### Tips and Tricks\n\n### True和False布尔表达式\n下面的布尔表达式都会返回`false`：\n```\nnull\nundefined\n''\n空字符串\n0\n```\n数字`0` 但小心下面的，可都返回`true`：\n```\n'0'\n字符串0\n[]\n空数组\n{}\n空对象\n```\n如果你想检查字符串是否为`null`或`空`：\n```\nif (y != null && y != '') {}\n```\n写成这样会更好：\n```\nif (y) {}\n```\n### 条件（三元）操作符(`?:`)\n三元操作符用于替代下面的代码：\n```\nif (val != 0) {\n  return foo();\n} else {\n  return bar();\n}\n```\n你可以写成：\n```\nreturn val ? foo() : bar();\n```\n在生成HTML代码时也是很有用的：\n```\nvar html = '<input type=\"checkbox\"' + (isChecked ? ' checked' : '')+ (isEnabled ? '' : ' disabled')+ ' name=\"foo\">';\n```\n### `&&`和`||`\n\n二元布尔操作符是可短路的，只有在必要的时候才会计算到最后一项。 `||`被称作为`default`操作符，因为可以这样：\n```\n/**\n * @param {*=} opt_win\n */\nfunction foo(opt_win) {\n  var win;\n  if (opt_win) {\n    win = opt_win;\n  } else {\n    win = window;\n  }\n// ...\n}\n```\n你可以使用它来简化上面的代码：\n```\n/**\n * @param {*=} opt_win\n */\nfunction foo(opt_win) {\n  var win = opt_win || window;\n  // ...\n}\n```\n### 使用`join()`来创建字符串\n通常是这样使用的：\n```\nfunction listHtml(items) {\n  var html = '<div class=\"foo\"';\n  for (var i = 0; i < items.length; i++) {\n    if (i > 0) {\n      html += ',';\n    }\n    html += itemHtml(items[i]);\n  }\n  html += '</div>';\n  return html;\n}\n```\n但这样在IE下非常慢，可以用下面的方式：\n```\nfunction listHtml(items) {\n  var html = [];\n  for (var i = 0; i < items.length; i++) {\n    html[i] = itemHtml(items[i]);\n  }\n  return '<div class=\"foo\">' + html.join(', ') + '</div>';\n}\n```\n你也可以使用数组作为字符串构造器，然后通过`myArray.join('')`\n转换成字符串，不过由于赋值操作快于数组的`push()`，所以尽量使用复制操作。","slug":"javascript-rule","published":1,"updated":"2018-01-16T06:08:44.658Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t26001fgcoi52t181en","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>JavaScript是一种客户端脚本语言，Web工程都会用到它，这份指南列出了编写JavaScript时需要遵守的规则。</p>\n<h2 id=\"JavaScript语言规范\"><a href=\"#JavaScript语言规范\" class=\"headerlink\" title=\"JavaScript语言规范\"></a>JavaScript语言规范</h2><h3 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h3><p>声明变量必须加上var<br>关键字:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var a1 = 1;</span><br><span class=\"line\">var b1 = 11;</span><br></pre></td></tr></table></figure></p>\n<p>当你没有写var<br>，变量就会暴露在全局上下文中，这样很可能会和现有的变量冲突。另外，如果没有加上，很难明确该变量的作用域是什么，变量很可能在局部作用域中，很容易泄漏到Document或者Window中，所以务必用var<br>变量。</p>\n<h3 id=\"常量\"><a href=\"#常量\" class=\"headerlink\" title=\"常量\"></a>常量</h3><p>常量的形式如：<code>NAMES_LIKE_THIS</code>，即使用大写字符，并用下划线分割，你也可用<code>@const</code>标记来指明它是一个常量，但请不要使用<code>const</code>关键字。<br>对于基本类型的常量，只需要转换命名：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * The number of seconds of minute.</span><br><span class=\"line\"> * @type &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">eflag.example.SECONDES_IN_A_MINUTE = 60;</span><br></pre></td></tr></table></figure></p>\n<p>对于非基本类型，使用<code>@const</code><br>标记：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * The number of seconds in each of the given units.</span><br><span class=\"line\"> * @type &#123;Object.&lt;number&gt;&#125;</span><br><span class=\"line\"> * @const</span><br><span class=\"line\"> */</span><br><span class=\"line\">eflag.example.SECONDS_TABLE = &#123;minute: 60,hour: 60 * 60,day: 60 * 60 * 24&#125;</span><br></pre></td></tr></table></figure></p>\n<p>至于关键字<code>const</code>，因为IE不能识别，所以不要使用。</p>\n<h3 id=\"分号\"><a href=\"#分号\" class=\"headerlink\" title=\"分号\"></a>分号</h3><p>总是使用分号。 如果仅依靠语句间的隐式分割，有时会很麻烦，使用分号，你自己更能清楚那里是语句的起止。<br>行末分号：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var foo = 1,bar = 2,baz = 3;</span><br><span class=\"line\">var obj = &#123;foo: 1,bar: 2,baz: 3&#125;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"单引号-39-39-和双引号-quot-quot\"><a href=\"#单引号-39-39-和双引号-quot-quot\" class=\"headerlink\" title=\"单引号(&#39;&#39;)和双引号(&quot;&quot;)\"></a>单引号(<code>&#39;&#39;</code>)和双引号(<code>&quot;&quot;</code>)</h3><p>由于JavaScript对于单引号和双引号都可以识别为字符串，但为了统一规范，所以在JavaScript中字符串的定义要求使用单引号：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var val = &apos;a&apos;;</span><br></pre></td></tr></table></figure></p>\n<p>同样，html中属性使用的是双引号：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input type=&quot;text&quot;&gt;</span><br></pre></td></tr></table></figure></p>\n<p>在JavaScript中动态生成html标签时：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var _input = &apos;&lt;input type=&quot;text&quot;&gt;&apos;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"空格\"><a href=\"#空格\" class=\"headerlink\" title=\"空格\"></a>空格</h3><p>参数和括号间五空格：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function fn(arg1, arg2)&#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>冒号后面有空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;foo: 1,bar: 2,baz: 3&#125;</span><br></pre></td></tr></table></figure></p>\n<p>条件语句有空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (true) &#123;&#125;</span><br><span class=\"line\">while (true) &#123;&#125;</span><br><span class=\"line\">switch(v)&#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"Tips-and-Tricks\"><a href=\"#Tips-and-Tricks\" class=\"headerlink\" title=\"Tips and Tricks\"></a>Tips and Tricks</h3><h3 id=\"True和False布尔表达式\"><a href=\"#True和False布尔表达式\" class=\"headerlink\" title=\"True和False布尔表达式\"></a>True和False布尔表达式</h3><p>下面的布尔表达式都会返回<code>false</code>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">null</span><br><span class=\"line\">undefined</span><br><span class=\"line\">&apos;&apos;</span><br><span class=\"line\">空字符串</span><br><span class=\"line\">0</span><br></pre></td></tr></table></figure></p>\n<p>数字<code>0</code> 但小心下面的，可都返回<code>true</code>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&apos;0&apos;</span><br><span class=\"line\">字符串0</span><br><span class=\"line\">[]</span><br><span class=\"line\">空数组</span><br><span class=\"line\">&#123;&#125;</span><br><span class=\"line\">空对象</span><br></pre></td></tr></table></figure></p>\n<p>如果你想检查字符串是否为<code>null</code>或<code>空</code>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (y != null &amp;&amp; y != &apos;&apos;) &#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>写成这样会更好：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (y) &#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"条件（三元）操作符\"><a href=\"#条件（三元）操作符\" class=\"headerlink\" title=\"条件（三元）操作符(?:)\"></a>条件（三元）操作符(<code>?:</code>)</h3><p>三元操作符用于替代下面的代码：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (val != 0) &#123;</span><br><span class=\"line\">  return foo();</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">  return bar();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>你可以写成：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">return val ? foo() : bar();</span><br></pre></td></tr></table></figure></p>\n<p>在生成HTML代码时也是很有用的：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var html = &apos;&lt;input type=&quot;checkbox&quot;&apos; + (isChecked ? &apos; checked&apos; : &apos;&apos;)+ (isEnabled ? &apos;&apos; : &apos; disabled&apos;)+ &apos; name=&quot;foo&quot;&gt;&apos;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"amp-amp-和\"><a href=\"#amp-amp-和\" class=\"headerlink\" title=\"&amp;&amp;和||\"></a><code>&amp;&amp;</code>和<code>||</code></h3><p>二元布尔操作符是可短路的，只有在必要的时候才会计算到最后一项。 <code>||</code>被称作为<code>default</code>操作符，因为可以这样：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;*=&#125; opt_win</span><br><span class=\"line\"> */</span><br><span class=\"line\">function foo(opt_win) &#123;</span><br><span class=\"line\">  var win;</span><br><span class=\"line\">  if (opt_win) &#123;</span><br><span class=\"line\">    win = opt_win;</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    win = window;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">// ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>你可以使用它来简化上面的代码：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;*=&#125; opt_win</span><br><span class=\"line\"> */</span><br><span class=\"line\">function foo(opt_win) &#123;</span><br><span class=\"line\">  var win = opt_win || window;</span><br><span class=\"line\">  // ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"使用join-来创建字符串\"><a href=\"#使用join-来创建字符串\" class=\"headerlink\" title=\"使用join()来创建字符串\"></a>使用<code>join()</code>来创建字符串</h3><p>通常是这样使用的：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function listHtml(items) &#123;</span><br><span class=\"line\">  var html = &apos;&lt;div class=&quot;foo&quot;&apos;;</span><br><span class=\"line\">  for (var i = 0; i &lt; items.length; i++) &#123;</span><br><span class=\"line\">    if (i &gt; 0) &#123;</span><br><span class=\"line\">      html += &apos;,&apos;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    html += itemHtml(items[i]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  html += &apos;&lt;/div&gt;&apos;;</span><br><span class=\"line\">  return html;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>但这样在IE下非常慢，可以用下面的方式：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function listHtml(items) &#123;</span><br><span class=\"line\">  var html = [];</span><br><span class=\"line\">  for (var i = 0; i &lt; items.length; i++) &#123;</span><br><span class=\"line\">    html[i] = itemHtml(items[i]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return &apos;&lt;div class=&quot;foo&quot;&gt;&apos; + html.join(&apos;, &apos;) + &apos;&lt;/div&gt;&apos;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>你也可以使用数组作为字符串构造器，然后通过<code>myArray.join(&#39;&#39;)</code><br>转换成字符串，不过由于赋值操作快于数组的<code>push()</code>，所以尽量使用复制操作。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>JavaScript是一种客户端脚本语言，Web工程都会用到它，这份指南列出了编写JavaScript时需要遵守的规则。</p>\n<h2 id=\"JavaScript语言规范\"><a href=\"#JavaScript语言规范\" class=\"headerlink\" title=\"JavaScript语言规范\"></a>JavaScript语言规范</h2><h3 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h3><p>声明变量必须加上var<br>关键字:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var a1 = 1;</span><br><span class=\"line\">var b1 = 11;</span><br></pre></td></tr></table></figure></p>\n<p>当你没有写var<br>，变量就会暴露在全局上下文中，这样很可能会和现有的变量冲突。另外，如果没有加上，很难明确该变量的作用域是什么，变量很可能在局部作用域中，很容易泄漏到Document或者Window中，所以务必用var<br>变量。</p>\n<h3 id=\"常量\"><a href=\"#常量\" class=\"headerlink\" title=\"常量\"></a>常量</h3><p>常量的形式如：<code>NAMES_LIKE_THIS</code>，即使用大写字符，并用下划线分割，你也可用<code>@const</code>标记来指明它是一个常量，但请不要使用<code>const</code>关键字。<br>对于基本类型的常量，只需要转换命名：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * The number of seconds of minute.</span><br><span class=\"line\"> * @type &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">eflag.example.SECONDES_IN_A_MINUTE = 60;</span><br></pre></td></tr></table></figure></p>\n<p>对于非基本类型，使用<code>@const</code><br>标记：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * The number of seconds in each of the given units.</span><br><span class=\"line\"> * @type &#123;Object.&lt;number&gt;&#125;</span><br><span class=\"line\"> * @const</span><br><span class=\"line\"> */</span><br><span class=\"line\">eflag.example.SECONDS_TABLE = &#123;minute: 60,hour: 60 * 60,day: 60 * 60 * 24&#125;</span><br></pre></td></tr></table></figure></p>\n<p>至于关键字<code>const</code>，因为IE不能识别，所以不要使用。</p>\n<h3 id=\"分号\"><a href=\"#分号\" class=\"headerlink\" title=\"分号\"></a>分号</h3><p>总是使用分号。 如果仅依靠语句间的隐式分割，有时会很麻烦，使用分号，你自己更能清楚那里是语句的起止。<br>行末分号：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var foo = 1,bar = 2,baz = 3;</span><br><span class=\"line\">var obj = &#123;foo: 1,bar: 2,baz: 3&#125;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"单引号-39-39-和双引号-quot-quot\"><a href=\"#单引号-39-39-和双引号-quot-quot\" class=\"headerlink\" title=\"单引号(&#39;&#39;)和双引号(&quot;&quot;)\"></a>单引号(<code>&#39;&#39;</code>)和双引号(<code>&quot;&quot;</code>)</h3><p>由于JavaScript对于单引号和双引号都可以识别为字符串，但为了统一规范，所以在JavaScript中字符串的定义要求使用单引号：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var val = &apos;a&apos;;</span><br></pre></td></tr></table></figure></p>\n<p>同样，html中属性使用的是双引号：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input type=&quot;text&quot;&gt;</span><br></pre></td></tr></table></figure></p>\n<p>在JavaScript中动态生成html标签时：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var _input = &apos;&lt;input type=&quot;text&quot;&gt;&apos;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"空格\"><a href=\"#空格\" class=\"headerlink\" title=\"空格\"></a>空格</h3><p>参数和括号间五空格：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function fn(arg1, arg2)&#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>冒号后面有空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;foo: 1,bar: 2,baz: 3&#125;</span><br></pre></td></tr></table></figure></p>\n<p>条件语句有空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (true) &#123;&#125;</span><br><span class=\"line\">while (true) &#123;&#125;</span><br><span class=\"line\">switch(v)&#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"Tips-and-Tricks\"><a href=\"#Tips-and-Tricks\" class=\"headerlink\" title=\"Tips and Tricks\"></a>Tips and Tricks</h3><h3 id=\"True和False布尔表达式\"><a href=\"#True和False布尔表达式\" class=\"headerlink\" title=\"True和False布尔表达式\"></a>True和False布尔表达式</h3><p>下面的布尔表达式都会返回<code>false</code>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">null</span><br><span class=\"line\">undefined</span><br><span class=\"line\">&apos;&apos;</span><br><span class=\"line\">空字符串</span><br><span class=\"line\">0</span><br></pre></td></tr></table></figure></p>\n<p>数字<code>0</code> 但小心下面的，可都返回<code>true</code>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&apos;0&apos;</span><br><span class=\"line\">字符串0</span><br><span class=\"line\">[]</span><br><span class=\"line\">空数组</span><br><span class=\"line\">&#123;&#125;</span><br><span class=\"line\">空对象</span><br></pre></td></tr></table></figure></p>\n<p>如果你想检查字符串是否为<code>null</code>或<code>空</code>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (y != null &amp;&amp; y != &apos;&apos;) &#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>写成这样会更好：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (y) &#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"条件（三元）操作符\"><a href=\"#条件（三元）操作符\" class=\"headerlink\" title=\"条件（三元）操作符(?:)\"></a>条件（三元）操作符(<code>?:</code>)</h3><p>三元操作符用于替代下面的代码：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (val != 0) &#123;</span><br><span class=\"line\">  return foo();</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">  return bar();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>你可以写成：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">return val ? foo() : bar();</span><br></pre></td></tr></table></figure></p>\n<p>在生成HTML代码时也是很有用的：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var html = &apos;&lt;input type=&quot;checkbox&quot;&apos; + (isChecked ? &apos; checked&apos; : &apos;&apos;)+ (isEnabled ? &apos;&apos; : &apos; disabled&apos;)+ &apos; name=&quot;foo&quot;&gt;&apos;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"amp-amp-和\"><a href=\"#amp-amp-和\" class=\"headerlink\" title=\"&amp;&amp;和||\"></a><code>&amp;&amp;</code>和<code>||</code></h3><p>二元布尔操作符是可短路的，只有在必要的时候才会计算到最后一项。 <code>||</code>被称作为<code>default</code>操作符，因为可以这样：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;*=&#125; opt_win</span><br><span class=\"line\"> */</span><br><span class=\"line\">function foo(opt_win) &#123;</span><br><span class=\"line\">  var win;</span><br><span class=\"line\">  if (opt_win) &#123;</span><br><span class=\"line\">    win = opt_win;</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    win = window;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">// ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>你可以使用它来简化上面的代码：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;*=&#125; opt_win</span><br><span class=\"line\"> */</span><br><span class=\"line\">function foo(opt_win) &#123;</span><br><span class=\"line\">  var win = opt_win || window;</span><br><span class=\"line\">  // ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"使用join-来创建字符串\"><a href=\"#使用join-来创建字符串\" class=\"headerlink\" title=\"使用join()来创建字符串\"></a>使用<code>join()</code>来创建字符串</h3><p>通常是这样使用的：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function listHtml(items) &#123;</span><br><span class=\"line\">  var html = &apos;&lt;div class=&quot;foo&quot;&apos;;</span><br><span class=\"line\">  for (var i = 0; i &lt; items.length; i++) &#123;</span><br><span class=\"line\">    if (i &gt; 0) &#123;</span><br><span class=\"line\">      html += &apos;,&apos;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    html += itemHtml(items[i]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  html += &apos;&lt;/div&gt;&apos;;</span><br><span class=\"line\">  return html;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>但这样在IE下非常慢，可以用下面的方式：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function listHtml(items) &#123;</span><br><span class=\"line\">  var html = [];</span><br><span class=\"line\">  for (var i = 0; i &lt; items.length; i++) &#123;</span><br><span class=\"line\">    html[i] = itemHtml(items[i]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return &apos;&lt;div class=&quot;foo&quot;&gt;&apos; + html.join(&apos;, &apos;) + &apos;&lt;/div&gt;&apos;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>你也可以使用数组作为字符串构造器，然后通过<code>myArray.join(&#39;&#39;)</code><br>转换成字符串，不过由于赋值操作快于数组的<code>push()</code>，所以尽量使用复制操作。</p>\n"},{"title":"Java发展史","date":"2018-06-05T16:00:00.000Z","_content":"\n![图片描述](https://segmentfault.com/img/bVbcbFO?w=220&h=209)\n\nJava创始认之一：James Gosling\n\nJava之父 -- James Gosling出生于加拿大，是一位计算机编程天才。在卡内基·梅隆大学攻读计算机博士学位时，他编写了多处理器版本的Unix操作系统。1991年，在Sun公司工作期间，James Gosling和一群技术人员创建了一个名为Oak的项目，旨在开发运行于虚拟机的编程语言，同时允许程序在电视机机顶盒等多平台上运行。后来，这项工作就演变成Java。随着互联网的普及，尤其是网景开发的网页浏览器的面世，Java成为全球最流行的开发语言。\n\n![图片描述](https://segmentfault.com/img/bVbcbF2?w=875&h=388)\n\n- 1996年1月，Sun公司发布了Java的第一个开发工具包（JDK1.0），这是Java发展历程中的重要的里程碑，标志着Java成为一种独立的开发工具。9月，约8.3万个网页应用了Java技术制作。10月，Sun公司发布了Java平台的第一个即时（JIT）编译器。\n- 1997年2月，JDK1.1面世，在随后的3周时间里，达到了22万次的下载量。4月2日，Java One会议召开，参会者逾一万人，创当时全球同类会议规模之记录。9月，Java Developer Connection社区超过10万。\n- 1998年12月8日，第二代Java平台的企业版J2EE发布。\n- 1999年6月，Sun公司发布了第二代Java平台（简称为Java2）的3个版本：J2ME（Java 2 Micro Edition， Java2平台的微型版），应用于移动、无线及有限资源的环境；J2SE（Java 2 Standard Edition, Java 2平台的标准版），应用于桌面环境；J2EE（Java 2 Enterprise Edition，Java 2平台的企业版），应用于Java的应用服务器。Java 2平台的发布，是Java发展过程中最重要的一个里程碑，标志着Java的应用开始普及。\n- 2000年5月，JDK1.3、JDK1.4和J2SE 1.3相继发布，几周后获得了Apple公司Mac OS X的工业标准的支持。\n- 2001年9月24日，J2EE1.3发布。\n- 2002年2月26日，J2SE1.4发布。自此Java的计算能力有了大幅提升。\n- 2004年9月30日，J2SE1.5发布，成为Java语言发展史上的又一里程碑。为了表示该版本的重要性，J2SE1.5更名为Java SE 5.0，代号为”Tiger“。\n- 2005年6月，在Java One大会上，Sun公司发布了Java SE 6。此时，Java的各种版本已经更名，已取消其中的数字2，如J2EE更名为JavaEE，J2SE更名为JavaSE，J2ME更名为JavaME。\n- 2006年11月13日，Java技术的发明者Sun公司宣布，将Java技术作为免费软件对外发布。\n- 2009年，甲骨文公司宣布收购Sun。\n- 2011年，甲骨文公司举行了全球性的活动，以庆祝Java7的推出，随后Java7正式发布。\n- 2014年，甲骨文公司发布了Java8正式版。\n\n\n  [1]: /img/bVbcbFO\n  [2]: /img/bVbcbF2\n","source":"_posts/java-history.md","raw":"---\ntitle: Java发展史\ndate: 2018-06-06\ntags: [Java]\n---\n\n![图片描述](https://segmentfault.com/img/bVbcbFO?w=220&h=209)\n\nJava创始认之一：James Gosling\n\nJava之父 -- James Gosling出生于加拿大，是一位计算机编程天才。在卡内基·梅隆大学攻读计算机博士学位时，他编写了多处理器版本的Unix操作系统。1991年，在Sun公司工作期间，James Gosling和一群技术人员创建了一个名为Oak的项目，旨在开发运行于虚拟机的编程语言，同时允许程序在电视机机顶盒等多平台上运行。后来，这项工作就演变成Java。随着互联网的普及，尤其是网景开发的网页浏览器的面世，Java成为全球最流行的开发语言。\n\n![图片描述](https://segmentfault.com/img/bVbcbF2?w=875&h=388)\n\n- 1996年1月，Sun公司发布了Java的第一个开发工具包（JDK1.0），这是Java发展历程中的重要的里程碑，标志着Java成为一种独立的开发工具。9月，约8.3万个网页应用了Java技术制作。10月，Sun公司发布了Java平台的第一个即时（JIT）编译器。\n- 1997年2月，JDK1.1面世，在随后的3周时间里，达到了22万次的下载量。4月2日，Java One会议召开，参会者逾一万人，创当时全球同类会议规模之记录。9月，Java Developer Connection社区超过10万。\n- 1998年12月8日，第二代Java平台的企业版J2EE发布。\n- 1999年6月，Sun公司发布了第二代Java平台（简称为Java2）的3个版本：J2ME（Java 2 Micro Edition， Java2平台的微型版），应用于移动、无线及有限资源的环境；J2SE（Java 2 Standard Edition, Java 2平台的标准版），应用于桌面环境；J2EE（Java 2 Enterprise Edition，Java 2平台的企业版），应用于Java的应用服务器。Java 2平台的发布，是Java发展过程中最重要的一个里程碑，标志着Java的应用开始普及。\n- 2000年5月，JDK1.3、JDK1.4和J2SE 1.3相继发布，几周后获得了Apple公司Mac OS X的工业标准的支持。\n- 2001年9月24日，J2EE1.3发布。\n- 2002年2月26日，J2SE1.4发布。自此Java的计算能力有了大幅提升。\n- 2004年9月30日，J2SE1.5发布，成为Java语言发展史上的又一里程碑。为了表示该版本的重要性，J2SE1.5更名为Java SE 5.0，代号为”Tiger“。\n- 2005年6月，在Java One大会上，Sun公司发布了Java SE 6。此时，Java的各种版本已经更名，已取消其中的数字2，如J2EE更名为JavaEE，J2SE更名为JavaSE，J2ME更名为JavaME。\n- 2006年11月13日，Java技术的发明者Sun公司宣布，将Java技术作为免费软件对外发布。\n- 2009年，甲骨文公司宣布收购Sun。\n- 2011年，甲骨文公司举行了全球性的活动，以庆祝Java7的推出，随后Java7正式发布。\n- 2014年，甲骨文公司发布了Java8正式版。\n\n\n  [1]: /img/bVbcbFO\n  [2]: /img/bVbcbF2\n","slug":"java-history","published":1,"updated":"2018-06-27T01:24:48.138Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t27001hgcoixofb30b3","content":"<p><img src=\"https://segmentfault.com/img/bVbcbFO?w=220&amp;h=209\" alt=\"图片描述\"></p>\n<p>Java创始认之一：James Gosling</p>\n<p>Java之父 – James Gosling出生于加拿大，是一位计算机编程天才。在卡内基·梅隆大学攻读计算机博士学位时，他编写了多处理器版本的Unix操作系统。1991年，在Sun公司工作期间，James Gosling和一群技术人员创建了一个名为Oak的项目，旨在开发运行于虚拟机的编程语言，同时允许程序在电视机机顶盒等多平台上运行。后来，这项工作就演变成Java。随着互联网的普及，尤其是网景开发的网页浏览器的面世，Java成为全球最流行的开发语言。</p>\n<p><img src=\"https://segmentfault.com/img/bVbcbF2?w=875&amp;h=388\" alt=\"图片描述\"></p>\n<ul>\n<li>1996年1月，Sun公司发布了Java的第一个开发工具包（JDK1.0），这是Java发展历程中的重要的里程碑，标志着Java成为一种独立的开发工具。9月，约8.3万个网页应用了Java技术制作。10月，Sun公司发布了Java平台的第一个即时（JIT）编译器。</li>\n<li>1997年2月，JDK1.1面世，在随后的3周时间里，达到了22万次的下载量。4月2日，Java One会议召开，参会者逾一万人，创当时全球同类会议规模之记录。9月，Java Developer Connection社区超过10万。</li>\n<li>1998年12月8日，第二代Java平台的企业版J2EE发布。</li>\n<li>1999年6月，Sun公司发布了第二代Java平台（简称为Java2）的3个版本：J2ME（Java 2 Micro Edition， Java2平台的微型版），应用于移动、无线及有限资源的环境；J2SE（Java 2 Standard Edition, Java 2平台的标准版），应用于桌面环境；J2EE（Java 2 Enterprise Edition，Java 2平台的企业版），应用于Java的应用服务器。Java 2平台的发布，是Java发展过程中最重要的一个里程碑，标志着Java的应用开始普及。</li>\n<li>2000年5月，JDK1.3、JDK1.4和J2SE 1.3相继发布，几周后获得了Apple公司Mac OS X的工业标准的支持。</li>\n<li>2001年9月24日，J2EE1.3发布。</li>\n<li>2002年2月26日，J2SE1.4发布。自此Java的计算能力有了大幅提升。</li>\n<li>2004年9月30日，J2SE1.5发布，成为Java语言发展史上的又一里程碑。为了表示该版本的重要性，J2SE1.5更名为Java SE 5.0，代号为”Tiger“。</li>\n<li>2005年6月，在Java One大会上，Sun公司发布了Java SE 6。此时，Java的各种版本已经更名，已取消其中的数字2，如J2EE更名为JavaEE，J2SE更名为JavaSE，J2ME更名为JavaME。</li>\n<li>2006年11月13日，Java技术的发明者Sun公司宣布，将Java技术作为免费软件对外发布。</li>\n<li>2009年，甲骨文公司宣布收购Sun。</li>\n<li>2011年，甲骨文公司举行了全球性的活动，以庆祝Java7的推出，随后Java7正式发布。</li>\n<li>2014年，甲骨文公司发布了Java8正式版。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"https://segmentfault.com/img/bVbcbFO?w=220&amp;h=209\" alt=\"图片描述\"></p>\n<p>Java创始认之一：James Gosling</p>\n<p>Java之父 – James Gosling出生于加拿大，是一位计算机编程天才。在卡内基·梅隆大学攻读计算机博士学位时，他编写了多处理器版本的Unix操作系统。1991年，在Sun公司工作期间，James Gosling和一群技术人员创建了一个名为Oak的项目，旨在开发运行于虚拟机的编程语言，同时允许程序在电视机机顶盒等多平台上运行。后来，这项工作就演变成Java。随着互联网的普及，尤其是网景开发的网页浏览器的面世，Java成为全球最流行的开发语言。</p>\n<p><img src=\"https://segmentfault.com/img/bVbcbF2?w=875&amp;h=388\" alt=\"图片描述\"></p>\n<ul>\n<li>1996年1月，Sun公司发布了Java的第一个开发工具包（JDK1.0），这是Java发展历程中的重要的里程碑，标志着Java成为一种独立的开发工具。9月，约8.3万个网页应用了Java技术制作。10月，Sun公司发布了Java平台的第一个即时（JIT）编译器。</li>\n<li>1997年2月，JDK1.1面世，在随后的3周时间里，达到了22万次的下载量。4月2日，Java One会议召开，参会者逾一万人，创当时全球同类会议规模之记录。9月，Java Developer Connection社区超过10万。</li>\n<li>1998年12月8日，第二代Java平台的企业版J2EE发布。</li>\n<li>1999年6月，Sun公司发布了第二代Java平台（简称为Java2）的3个版本：J2ME（Java 2 Micro Edition， Java2平台的微型版），应用于移动、无线及有限资源的环境；J2SE（Java 2 Standard Edition, Java 2平台的标准版），应用于桌面环境；J2EE（Java 2 Enterprise Edition，Java 2平台的企业版），应用于Java的应用服务器。Java 2平台的发布，是Java发展过程中最重要的一个里程碑，标志着Java的应用开始普及。</li>\n<li>2000年5月，JDK1.3、JDK1.4和J2SE 1.3相继发布，几周后获得了Apple公司Mac OS X的工业标准的支持。</li>\n<li>2001年9月24日，J2EE1.3发布。</li>\n<li>2002年2月26日，J2SE1.4发布。自此Java的计算能力有了大幅提升。</li>\n<li>2004年9月30日，J2SE1.5发布，成为Java语言发展史上的又一里程碑。为了表示该版本的重要性，J2SE1.5更名为Java SE 5.0，代号为”Tiger“。</li>\n<li>2005年6月，在Java One大会上，Sun公司发布了Java SE 6。此时，Java的各种版本已经更名，已取消其中的数字2，如J2EE更名为JavaEE，J2SE更名为JavaSE，J2ME更名为JavaME。</li>\n<li>2006年11月13日，Java技术的发明者Sun公司宣布，将Java技术作为免费软件对外发布。</li>\n<li>2009年，甲骨文公司宣布收购Sun。</li>\n<li>2011年，甲骨文公司举行了全球性的活动，以庆祝Java7的推出，随后Java7正式发布。</li>\n<li>2014年，甲骨文公司发布了Java8正式版。</li>\n</ul>\n"},{"title":"JDK延迟队列DelayQueue","date":"2018-06-29T02:49:46.000Z","_content":"\n待更新...","source":"_posts/jdk-delayqueue.md","raw":"---\ntitle: JDK延迟队列DelayQueue\ndate: 2018-06-29 10:49:46\ntags:\n    - Java\n---\n\n待更新...","slug":"jdk-delayqueue","published":1,"updated":"2018-10-11T12:55:41.834Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t28001jgcoiebnet75x","content":"<p>待更新…</p>\n","site":{"data":{}},"excerpt":"","more":"<p>待更新…</p>\n"},{"title":"Java系列  - JDK环境配置","date":"2017-04-21T05:10:50.000Z","_content":"\n# Linux\n打开`/etc/profile`, 添加如下代码：\n```bash\nexport JAVA_HOME=/opt/jdk\nexport JRE_HOME=$JAVA_HOME/jre\nexport CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib\nexport PATH=$JAVA_HOME/bin:$PATH\n```\n执行代码，使配置生效\n```bash\nsource /etc/profile\n```\n\n安装命令 **需要root权限**\n```bash\nalternatives --install /usr/bin/java java /opt/jdk/bin/java 1600\nalternatives --install /usr/bin/javac javac /opt/jdk/bin/javac 1600\n```\n\n\n# Windows\n> windows下，path路径以`;`分割，bat变量`%JAVA_HOME%`","source":"_posts/jdk-profile.md","raw":"---\ntitle: Java系列  - JDK环境配置\ndate: 2017-04-21 13:10:50\ntags:\n---\n\n# Linux\n打开`/etc/profile`, 添加如下代码：\n```bash\nexport JAVA_HOME=/opt/jdk\nexport JRE_HOME=$JAVA_HOME/jre\nexport CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib\nexport PATH=$JAVA_HOME/bin:$PATH\n```\n执行代码，使配置生效\n```bash\nsource /etc/profile\n```\n\n安装命令 **需要root权限**\n```bash\nalternatives --install /usr/bin/java java /opt/jdk/bin/java 1600\nalternatives --install /usr/bin/javac javac /opt/jdk/bin/javac 1600\n```\n\n\n# Windows\n> windows下，path路径以`;`分割，bat变量`%JAVA_HOME%`","slug":"jdk-profile","published":1,"updated":"2018-01-16T06:08:44.658Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t29001lgcoiwwfysjtu","content":"<h1 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h1><p>打开<code>/etc/profile</code>, 添加如下代码：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/opt/jdk</span><br><span class=\"line\"><span class=\"built_in\">export</span> JRE_HOME=<span class=\"variable\">$JAVA_HOME</span>/jre</span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=.:<span class=\"variable\">$JAVA_HOME</span>/lib:<span class=\"variable\">$JRE_HOME</span>/lib</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure></p>\n<p>执行代码，使配置生效<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>\n<p>安装命令 <strong>需要root权限</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alternatives --install /usr/bin/java java /opt/jdk/bin/java 1600</span><br><span class=\"line\">alternatives --install /usr/bin/javac javac /opt/jdk/bin/javac 1600</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h1><blockquote>\n<p>windows下，path路径以<code>;</code>分割，bat变量<code>%JAVA_HOME%</code></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h1><p>打开<code>/etc/profile</code>, 添加如下代码：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/opt/jdk</span><br><span class=\"line\"><span class=\"built_in\">export</span> JRE_HOME=<span class=\"variable\">$JAVA_HOME</span>/jre</span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=.:<span class=\"variable\">$JAVA_HOME</span>/lib:<span class=\"variable\">$JRE_HOME</span>/lib</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure></p>\n<p>执行代码，使配置生效<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>\n<p>安装命令 <strong>需要root权限</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alternatives --install /usr/bin/java java /opt/jdk/bin/java 1600</span><br><span class=\"line\">alternatives --install /usr/bin/javac javac /opt/jdk/bin/javac 1600</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h1><blockquote>\n<p>windows下，path路径以<code>;</code>分割，bat变量<code>%JAVA_HOME%</code></p>\n</blockquote>\n"},{"title":"Linux常用系统命令","date":"2017-04-21T05:10:50.000Z","_content":"```bash\n# uname -a # 查看内核/操作系统/CPU信息 \n# head -n 1 /etc/issue # 查看操作系统版本 \n# cat /proc/cpuinfo # 查看CPU信息 \n# hostname # 查看计算机名 \n# lspci -tv # 列出所有PCI设备 \n# lsusb -tv # 列出所有USB设备 \n# lsmod # 列出加载的内核模块 \n# env # 查看环境变量资源 \n# free -m # 查看内存使用量和交换区使用量 \n# df -h # 查看各分区使用情况 \n# du -sh <目录名> # 查看指定目录的大小 \n# grep MemTotal /proc/meminfo # 查看内存总量 \n# grep MemFree /proc/meminfo # 查看空闲内存量 \n# uptime # 查看系统运行时间、用户数、负载 \n# cat /proc/loadavg # 查看系统负载磁盘和分区 \n# mount | column -t # 查看挂接的分区状态 \n# fdisk -l # 查看所有分区 \n# swapon -s # 查看所有交换分区 \n# hdparm -i /dev/hda # 查看磁盘参数(仅适用于IDE设备) \n# dmesg | grep IDE # 查看启动时IDE设备检测状况网络 \n# ifconfig # 查看所有网络接口的属性 \n# iptables -L # 查看防火墙设置 \n# route -n # 查看路由表 \n# netstat -lntp # 查看所有监听端口 \n# netstat -antp # 查看所有已经建立的连接 \n# netstat -s # 查看网络统计信息进程 \n# ps -ef # 查看所有进程 \n# top # 实时显示进程状态用户 \n# w # 查看活动用户 \n# id <用户名> # 查看指定用户信息 \n# last # 查看用户登录日志 \n# cut -d: -f1 /etc/passwd # 查看系统所有用户 \n# cut -d: -f1 /etc/group # 查看系统所有组 \n# crontab -l # 查看当前用户的计划任务服务 \n# chkconfig –list # 列出所有系统服务 \n# chkconfig –list | grep on # 列出所有启动的系统服务程序 \n# rpm -qa # 查看所有安装的软件包\n```\n","source":"_posts/linux-command.md","raw":"---\ntitle: Linux常用系统命令\ndate: 2017-04-21 13:10:50\ntags: [Linux]\n---\n```bash\n# uname -a # 查看内核/操作系统/CPU信息 \n# head -n 1 /etc/issue # 查看操作系统版本 \n# cat /proc/cpuinfo # 查看CPU信息 \n# hostname # 查看计算机名 \n# lspci -tv # 列出所有PCI设备 \n# lsusb -tv # 列出所有USB设备 \n# lsmod # 列出加载的内核模块 \n# env # 查看环境变量资源 \n# free -m # 查看内存使用量和交换区使用量 \n# df -h # 查看各分区使用情况 \n# du -sh <目录名> # 查看指定目录的大小 \n# grep MemTotal /proc/meminfo # 查看内存总量 \n# grep MemFree /proc/meminfo # 查看空闲内存量 \n# uptime # 查看系统运行时间、用户数、负载 \n# cat /proc/loadavg # 查看系统负载磁盘和分区 \n# mount | column -t # 查看挂接的分区状态 \n# fdisk -l # 查看所有分区 \n# swapon -s # 查看所有交换分区 \n# hdparm -i /dev/hda # 查看磁盘参数(仅适用于IDE设备) \n# dmesg | grep IDE # 查看启动时IDE设备检测状况网络 \n# ifconfig # 查看所有网络接口的属性 \n# iptables -L # 查看防火墙设置 \n# route -n # 查看路由表 \n# netstat -lntp # 查看所有监听端口 \n# netstat -antp # 查看所有已经建立的连接 \n# netstat -s # 查看网络统计信息进程 \n# ps -ef # 查看所有进程 \n# top # 实时显示进程状态用户 \n# w # 查看活动用户 \n# id <用户名> # 查看指定用户信息 \n# last # 查看用户登录日志 \n# cut -d: -f1 /etc/passwd # 查看系统所有用户 \n# cut -d: -f1 /etc/group # 查看系统所有组 \n# crontab -l # 查看当前用户的计划任务服务 \n# chkconfig –list # 列出所有系统服务 \n# chkconfig –list | grep on # 列出所有启动的系统服务程序 \n# rpm -qa # 查看所有安装的软件包\n```\n","slug":"linux-command","published":1,"updated":"2018-10-15T07:08:16.911Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2b001ogcoi7b6pfe77","content":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># uname -a # 查看内核/操作系统/CPU信息 </span></span><br><span class=\"line\"><span class=\"comment\"># head -n 1 /etc/issue # 查看操作系统版本 </span></span><br><span class=\"line\"><span class=\"comment\"># cat /proc/cpuinfo # 查看CPU信息 </span></span><br><span class=\"line\"><span class=\"comment\"># hostname # 查看计算机名 </span></span><br><span class=\"line\"><span class=\"comment\"># lspci -tv # 列出所有PCI设备 </span></span><br><span class=\"line\"><span class=\"comment\"># lsusb -tv # 列出所有USB设备 </span></span><br><span class=\"line\"><span class=\"comment\"># lsmod # 列出加载的内核模块 </span></span><br><span class=\"line\"><span class=\"comment\"># env # 查看环境变量资源 </span></span><br><span class=\"line\"><span class=\"comment\"># free -m # 查看内存使用量和交换区使用量 </span></span><br><span class=\"line\"><span class=\"comment\"># df -h # 查看各分区使用情况 </span></span><br><span class=\"line\"><span class=\"comment\"># du -sh &lt;目录名&gt; # 查看指定目录的大小 </span></span><br><span class=\"line\"><span class=\"comment\"># grep MemTotal /proc/meminfo # 查看内存总量 </span></span><br><span class=\"line\"><span class=\"comment\"># grep MemFree /proc/meminfo # 查看空闲内存量 </span></span><br><span class=\"line\"><span class=\"comment\"># uptime # 查看系统运行时间、用户数、负载 </span></span><br><span class=\"line\"><span class=\"comment\"># cat /proc/loadavg # 查看系统负载磁盘和分区 </span></span><br><span class=\"line\"><span class=\"comment\"># mount | column -t # 查看挂接的分区状态 </span></span><br><span class=\"line\"><span class=\"comment\"># fdisk -l # 查看所有分区 </span></span><br><span class=\"line\"><span class=\"comment\"># swapon -s # 查看所有交换分区 </span></span><br><span class=\"line\"><span class=\"comment\"># hdparm -i /dev/hda # 查看磁盘参数(仅适用于IDE设备) </span></span><br><span class=\"line\"><span class=\"comment\"># dmesg | grep IDE # 查看启动时IDE设备检测状况网络 </span></span><br><span class=\"line\"><span class=\"comment\"># ifconfig # 查看所有网络接口的属性 </span></span><br><span class=\"line\"><span class=\"comment\"># iptables -L # 查看防火墙设置 </span></span><br><span class=\"line\"><span class=\"comment\"># route -n # 查看路由表 </span></span><br><span class=\"line\"><span class=\"comment\"># netstat -lntp # 查看所有监听端口 </span></span><br><span class=\"line\"><span class=\"comment\"># netstat -antp # 查看所有已经建立的连接 </span></span><br><span class=\"line\"><span class=\"comment\"># netstat -s # 查看网络统计信息进程 </span></span><br><span class=\"line\"><span class=\"comment\"># ps -ef # 查看所有进程 </span></span><br><span class=\"line\"><span class=\"comment\"># top # 实时显示进程状态用户 </span></span><br><span class=\"line\"><span class=\"comment\"># w # 查看活动用户 </span></span><br><span class=\"line\"><span class=\"comment\"># id &lt;用户名&gt; # 查看指定用户信息 </span></span><br><span class=\"line\"><span class=\"comment\"># last # 查看用户登录日志 </span></span><br><span class=\"line\"><span class=\"comment\"># cut -d: -f1 /etc/passwd # 查看系统所有用户 </span></span><br><span class=\"line\"><span class=\"comment\"># cut -d: -f1 /etc/group # 查看系统所有组 </span></span><br><span class=\"line\"><span class=\"comment\"># crontab -l # 查看当前用户的计划任务服务 </span></span><br><span class=\"line\"><span class=\"comment\"># chkconfig –list # 列出所有系统服务 </span></span><br><span class=\"line\"><span class=\"comment\"># chkconfig –list | grep on # 列出所有启动的系统服务程序 </span></span><br><span class=\"line\"><span class=\"comment\"># rpm -qa # 查看所有安装的软件包</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># uname -a # 查看内核/操作系统/CPU信息 </span></span><br><span class=\"line\"><span class=\"comment\"># head -n 1 /etc/issue # 查看操作系统版本 </span></span><br><span class=\"line\"><span class=\"comment\"># cat /proc/cpuinfo # 查看CPU信息 </span></span><br><span class=\"line\"><span class=\"comment\"># hostname # 查看计算机名 </span></span><br><span class=\"line\"><span class=\"comment\"># lspci -tv # 列出所有PCI设备 </span></span><br><span class=\"line\"><span class=\"comment\"># lsusb -tv # 列出所有USB设备 </span></span><br><span class=\"line\"><span class=\"comment\"># lsmod # 列出加载的内核模块 </span></span><br><span class=\"line\"><span class=\"comment\"># env # 查看环境变量资源 </span></span><br><span class=\"line\"><span class=\"comment\"># free -m # 查看内存使用量和交换区使用量 </span></span><br><span class=\"line\"><span class=\"comment\"># df -h # 查看各分区使用情况 </span></span><br><span class=\"line\"><span class=\"comment\"># du -sh &lt;目录名&gt; # 查看指定目录的大小 </span></span><br><span class=\"line\"><span class=\"comment\"># grep MemTotal /proc/meminfo # 查看内存总量 </span></span><br><span class=\"line\"><span class=\"comment\"># grep MemFree /proc/meminfo # 查看空闲内存量 </span></span><br><span class=\"line\"><span class=\"comment\"># uptime # 查看系统运行时间、用户数、负载 </span></span><br><span class=\"line\"><span class=\"comment\"># cat /proc/loadavg # 查看系统负载磁盘和分区 </span></span><br><span class=\"line\"><span class=\"comment\"># mount | column -t # 查看挂接的分区状态 </span></span><br><span class=\"line\"><span class=\"comment\"># fdisk -l # 查看所有分区 </span></span><br><span class=\"line\"><span class=\"comment\"># swapon -s # 查看所有交换分区 </span></span><br><span class=\"line\"><span class=\"comment\"># hdparm -i /dev/hda # 查看磁盘参数(仅适用于IDE设备) </span></span><br><span class=\"line\"><span class=\"comment\"># dmesg | grep IDE # 查看启动时IDE设备检测状况网络 </span></span><br><span class=\"line\"><span class=\"comment\"># ifconfig # 查看所有网络接口的属性 </span></span><br><span class=\"line\"><span class=\"comment\"># iptables -L # 查看防火墙设置 </span></span><br><span class=\"line\"><span class=\"comment\"># route -n # 查看路由表 </span></span><br><span class=\"line\"><span class=\"comment\"># netstat -lntp # 查看所有监听端口 </span></span><br><span class=\"line\"><span class=\"comment\"># netstat -antp # 查看所有已经建立的连接 </span></span><br><span class=\"line\"><span class=\"comment\"># netstat -s # 查看网络统计信息进程 </span></span><br><span class=\"line\"><span class=\"comment\"># ps -ef # 查看所有进程 </span></span><br><span class=\"line\"><span class=\"comment\"># top # 实时显示进程状态用户 </span></span><br><span class=\"line\"><span class=\"comment\"># w # 查看活动用户 </span></span><br><span class=\"line\"><span class=\"comment\"># id &lt;用户名&gt; # 查看指定用户信息 </span></span><br><span class=\"line\"><span class=\"comment\"># last # 查看用户登录日志 </span></span><br><span class=\"line\"><span class=\"comment\"># cut -d: -f1 /etc/passwd # 查看系统所有用户 </span></span><br><span class=\"line\"><span class=\"comment\"># cut -d: -f1 /etc/group # 查看系统所有组 </span></span><br><span class=\"line\"><span class=\"comment\"># crontab -l # 查看当前用户的计划任务服务 </span></span><br><span class=\"line\"><span class=\"comment\"># chkconfig –list # 列出所有系统服务 </span></span><br><span class=\"line\"><span class=\"comment\"># chkconfig –list | grep on # 列出所有启动的系统服务程序 </span></span><br><span class=\"line\"><span class=\"comment\"># rpm -qa # 查看所有安装的软件包</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Linux环境变量配置","date":"2017-04-21T05:10:50.000Z","_content":"\n\n不论使用Linux开发，还是使用Linux生产，都不可避免环境变量的配置。通常都是去修改系统文件：`/etc/profile`, `/etc/enviroment`, `~/.bashrc`, `~/.profile`等等，在这些文件的末尾`export`上自己想要添加的环境变量，`source`一下该文件，配置就立刻生效了。\n\n今天通过阅读`/etc/profile`文件：\n```shell\n# /etc/profile: system-wide .profile file for the Bourne shell (sh(1))\n# and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).\n\nif [ \"`id -u`\" -eq 0 ]; then\n  PATH=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\nelse\n  PATH=\"/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\"\nfi\nexport PATH\n\nif [ \"$PS1\" ]; then\n  if [ \"$BASH\" ] && [ \"$BASH\" != \"/bin/sh\" ]; then\n    # The file bash.bashrc already sets the default PS1.\n    # PS1='\\h:\\w\\$ '\n    if [ -f /etc/bash.bashrc ]; then\n      . /etc/bash.bashrc\n    fi\n  else\n    if [ \"`id -u`\" -eq 0 ]; then\n      PS1='# '\n    else\n      PS1='$ '\n    fi\n  fi\nfi\n\nif [ -d /etc/profile.d ]; then\n  for i in /etc/profile.d/*.sh; do\n    if [ -r $i ]; then\n      . $i\n    fi\n  done\n  unset i\nfi\n```\n发现最后一个`for`循环，其作用是搜用`/etc/profile.d`下的所有的`.sh`结尾的可执行文件，并运行。\n因此，我们就可以根据不同的功能编写不同的可执行文件，将他们放到`/etc/profile.d`下，如`jdk.sh`，`ant.sh`，`maven.sh`等等。","source":"_posts/linux-profile.md","raw":"---\ntitle: Linux环境变量配置\ndate: 2017-04-21 13:10:50\ntags: [Linux]\n---\n\n\n不论使用Linux开发，还是使用Linux生产，都不可避免环境变量的配置。通常都是去修改系统文件：`/etc/profile`, `/etc/enviroment`, `~/.bashrc`, `~/.profile`等等，在这些文件的末尾`export`上自己想要添加的环境变量，`source`一下该文件，配置就立刻生效了。\n\n今天通过阅读`/etc/profile`文件：\n```shell\n# /etc/profile: system-wide .profile file for the Bourne shell (sh(1))\n# and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).\n\nif [ \"`id -u`\" -eq 0 ]; then\n  PATH=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\nelse\n  PATH=\"/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\"\nfi\nexport PATH\n\nif [ \"$PS1\" ]; then\n  if [ \"$BASH\" ] && [ \"$BASH\" != \"/bin/sh\" ]; then\n    # The file bash.bashrc already sets the default PS1.\n    # PS1='\\h:\\w\\$ '\n    if [ -f /etc/bash.bashrc ]; then\n      . /etc/bash.bashrc\n    fi\n  else\n    if [ \"`id -u`\" -eq 0 ]; then\n      PS1='# '\n    else\n      PS1='$ '\n    fi\n  fi\nfi\n\nif [ -d /etc/profile.d ]; then\n  for i in /etc/profile.d/*.sh; do\n    if [ -r $i ]; then\n      . $i\n    fi\n  done\n  unset i\nfi\n```\n发现最后一个`for`循环，其作用是搜用`/etc/profile.d`下的所有的`.sh`结尾的可执行文件，并运行。\n因此，我们就可以根据不同的功能编写不同的可执行文件，将他们放到`/etc/profile.d`下，如`jdk.sh`，`ant.sh`，`maven.sh`等等。","slug":"linux-profile","published":1,"updated":"2018-01-26T03:18:31.357Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2c001qgcoikwndk104","content":"<p>不论使用Linux开发，还是使用Linux生产，都不可避免环境变量的配置。通常都是去修改系统文件：<code>/etc/profile</code>, <code>/etc/enviroment</code>, <code>~/.bashrc</code>, <code>~/.profile</code>等等，在这些文件的末尾<code>export</code>上自己想要添加的环境变量，<code>source</code>一下该文件，配置就立刻生效了。</p>\n<p>今天通过阅读<code>/etc/profile</code>文件：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> /etc/profile: system-wide .profile file <span class=\"keyword\">for</span> the Bourne shell (sh(1))</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).</span></span><br><span class=\"line\"></span><br><span class=\"line\">if [ \"`id -u`\" -eq 0 ]; then</span><br><span class=\"line\">  PATH=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"</span><br><span class=\"line\">else</span><br><span class=\"line\">  PATH=\"/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\"</span><br><span class=\"line\">fi</span><br><span class=\"line\">export PATH</span><br><span class=\"line\"></span><br><span class=\"line\">if [ \"$PS1\" ]; then</span><br><span class=\"line\">  if [ \"$BASH\" ] &amp;&amp; [ \"$BASH\" != \"/bin/sh\" ]; then</span><br><span class=\"line\">    # The file bash.bashrc already sets the default PS1.</span><br><span class=\"line\">    # PS1='\\h:\\w\\$ '</span><br><span class=\"line\">    if [ -f /etc/bash.bashrc ]; then</span><br><span class=\"line\">      . /etc/bash.bashrc</span><br><span class=\"line\">    fi</span><br><span class=\"line\">  else</span><br><span class=\"line\">    if [ \"`id -u`\" -eq 0 ]; then</span><br><span class=\"line\">      PS1='# '</span><br><span class=\"line\">    else</span><br><span class=\"line\">      PS1='$ '</span><br><span class=\"line\">    fi</span><br><span class=\"line\">  fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [ -d /etc/profile.d ]; then</span><br><span class=\"line\">  for i in /etc/profile.d/*.sh; do</span><br><span class=\"line\">    if [ -r $i ]; then</span><br><span class=\"line\">      . $i</span><br><span class=\"line\">    fi</span><br><span class=\"line\">  done</span><br><span class=\"line\">  unset i</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></p>\n<p>发现最后一个<code>for</code>循环，其作用是搜用<code>/etc/profile.d</code>下的所有的<code>.sh</code>结尾的可执行文件，并运行。<br>因此，我们就可以根据不同的功能编写不同的可执行文件，将他们放到<code>/etc/profile.d</code>下，如<code>jdk.sh</code>，<code>ant.sh</code>，<code>maven.sh</code>等等。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>不论使用Linux开发，还是使用Linux生产，都不可避免环境变量的配置。通常都是去修改系统文件：<code>/etc/profile</code>, <code>/etc/enviroment</code>, <code>~/.bashrc</code>, <code>~/.profile</code>等等，在这些文件的末尾<code>export</code>上自己想要添加的环境变量，<code>source</code>一下该文件，配置就立刻生效了。</p>\n<p>今天通过阅读<code>/etc/profile</code>文件：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> /etc/profile: system-wide .profile file <span class=\"keyword\">for</span> the Bourne shell (sh(1))</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).</span></span><br><span class=\"line\"></span><br><span class=\"line\">if [ \"`id -u`\" -eq 0 ]; then</span><br><span class=\"line\">  PATH=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"</span><br><span class=\"line\">else</span><br><span class=\"line\">  PATH=\"/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\"</span><br><span class=\"line\">fi</span><br><span class=\"line\">export PATH</span><br><span class=\"line\"></span><br><span class=\"line\">if [ \"$PS1\" ]; then</span><br><span class=\"line\">  if [ \"$BASH\" ] &amp;&amp; [ \"$BASH\" != \"/bin/sh\" ]; then</span><br><span class=\"line\">    # The file bash.bashrc already sets the default PS1.</span><br><span class=\"line\">    # PS1='\\h:\\w\\$ '</span><br><span class=\"line\">    if [ -f /etc/bash.bashrc ]; then</span><br><span class=\"line\">      . /etc/bash.bashrc</span><br><span class=\"line\">    fi</span><br><span class=\"line\">  else</span><br><span class=\"line\">    if [ \"`id -u`\" -eq 0 ]; then</span><br><span class=\"line\">      PS1='# '</span><br><span class=\"line\">    else</span><br><span class=\"line\">      PS1='$ '</span><br><span class=\"line\">    fi</span><br><span class=\"line\">  fi</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [ -d /etc/profile.d ]; then</span><br><span class=\"line\">  for i in /etc/profile.d/*.sh; do</span><br><span class=\"line\">    if [ -r $i ]; then</span><br><span class=\"line\">      . $i</span><br><span class=\"line\">    fi</span><br><span class=\"line\">  done</span><br><span class=\"line\">  unset i</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></p>\n<p>发现最后一个<code>for</code>循环，其作用是搜用<code>/etc/profile.d</code>下的所有的<code>.sh</code>结尾的可执行文件，并运行。<br>因此，我们就可以根据不同的功能编写不同的可执行文件，将他们放到<code>/etc/profile.d</code>下，如<code>jdk.sh</code>，<code>ant.sh</code>，<code>maven.sh</code>等等。</p>\n"},{"title":"Logback配置文件","date":"2017-04-21T05:10:50.000Z","_content":"\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<configuration>\n\t<!-- 定义变量 -->\n\t<property name=\"LOG_HOME\" value=\"/mnt/raid5/log/web\" />\n\t<property name=\"LOG_DEBUG_HOME\" value=\"${LOG_HOME}/debug\" />\n\t<property name=\"LOG_INFO_HOME\" value=\"${LOG_HOME}/info\" />\n\t<property name=\"LOG_WARN_HOME\" value=\"${LOG_HOME}/warn\" />\n\t<property name=\"LOG_ERROR_HOME\" value=\"${LOG_HOME}/error\" />\n\n\n\t<!-- 控制台输出 -->\n\t<appender name=\"STDOUT\" class=\"ch.qos.logback.core.ConsoleAppender\">\n\t\t<!-- 日志输出编码 -->\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\t</appender>\n\n\t<!-- DEBUG输出 -->\n\t<appender name=\"FILE_DEBUG\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_DEBUG_HOME}/debug.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_DEBUG_HOME}/debug.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<!-- <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>DEBUG</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter> -->\n\t</appender>\n\t\n\t<!-- INFO输出 -->\n\t<appender name=\"FILE_INFO\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_INFO_HOME}/info.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_INFO_HOME}/info.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>INFO</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter>\n\t</appender>\n\t\n\t<!-- WARN输出 -->\n\t<appender name=\"FILE_WARN\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_WARN_HOME}/warn.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_WARN_HOME}/warn.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>WARN</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter>\n\t</appender>\n\t\n\t<!-- ERROR输出 -->\n\t<appender name=\"FILE_ERROR\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_ERROR_HOME}/error.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_ERROR_HOME}/error.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>ERROR</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter>\n\t</appender>\n\n\n\t<root level=\"DEBUG\">\n\t\t<appender-ref ref=\"STDOUT\" />\n\t\t<appender-ref ref=\"FILE_DEBUG\" />\n\t\t<appender-ref ref=\"FILE_INFO\" />\n\t\t<appender-ref ref=\"FILE_WARN\" />\n\t\t<appender-ref ref=\"FILE_ERROR\" />\n\t</root>\n\n</configuration>\n```","source":"_posts/logback-xml.md","raw":"---\ntitle: Logback配置文件\ndate: 2017-04-21 13:10:50\ntags: [Log]\n---\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<configuration>\n\t<!-- 定义变量 -->\n\t<property name=\"LOG_HOME\" value=\"/mnt/raid5/log/web\" />\n\t<property name=\"LOG_DEBUG_HOME\" value=\"${LOG_HOME}/debug\" />\n\t<property name=\"LOG_INFO_HOME\" value=\"${LOG_HOME}/info\" />\n\t<property name=\"LOG_WARN_HOME\" value=\"${LOG_HOME}/warn\" />\n\t<property name=\"LOG_ERROR_HOME\" value=\"${LOG_HOME}/error\" />\n\n\n\t<!-- 控制台输出 -->\n\t<appender name=\"STDOUT\" class=\"ch.qos.logback.core.ConsoleAppender\">\n\t\t<!-- 日志输出编码 -->\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\t</appender>\n\n\t<!-- DEBUG输出 -->\n\t<appender name=\"FILE_DEBUG\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_DEBUG_HOME}/debug.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_DEBUG_HOME}/debug.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<!-- <filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>DEBUG</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter> -->\n\t</appender>\n\t\n\t<!-- INFO输出 -->\n\t<appender name=\"FILE_INFO\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_INFO_HOME}/info.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_INFO_HOME}/info.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>INFO</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter>\n\t</appender>\n\t\n\t<!-- WARN输出 -->\n\t<appender name=\"FILE_WARN\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_WARN_HOME}/warn.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_WARN_HOME}/warn.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>WARN</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter>\n\t</appender>\n\t\n\t<!-- ERROR输出 -->\n\t<appender name=\"FILE_ERROR\"\n\t\tclass=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n\t\t<file>${LOG_ERROR_HOME}/error.log</file>\n\t\t<Encoding>UTF-8</Encoding>\n\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n\t\t\t<!-- 日志文件输出的文件名 -->\n\t\t\t<FileNamePattern>${LOG_ERROR_HOME}/error.%d{yyyy-MM-dd}.log</FileNamePattern>\n\t\t\t<MaxHistory>30</MaxHistory>\n\t\t</rollingPolicy>\n\n\t\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\n\t\t\t<!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 -->\n\t\t\t<pattern>[%d{yyyy-MM-dd HH:mm:ss.SSS}] %level [%thread] %logger{36} %X{medic.eventCode} %msg %ex%n</pattern>\n\t\t</layout>\n\n\t\t<!--日志文件最大的大小 -->\n\t\t<triggeringPolicy\n\t\t\tclass=\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\">\n\t\t\t<MaxFileSize>100MB</MaxFileSize>\n\t\t</triggeringPolicy>\n\n\t\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\n\t\t\t<level>ERROR</level>\n\t\t\t<onMatch>ACCEPT</onMatch>\n\t\t\t<onMismatch>DENY</onMismatch>\n\t\t</filter>\n\t</appender>\n\n\n\t<root level=\"DEBUG\">\n\t\t<appender-ref ref=\"STDOUT\" />\n\t\t<appender-ref ref=\"FILE_DEBUG\" />\n\t\t<appender-ref ref=\"FILE_INFO\" />\n\t\t<appender-ref ref=\"FILE_WARN\" />\n\t\t<appender-ref ref=\"FILE_ERROR\" />\n\t</root>\n\n</configuration>\n```","slug":"logback-xml","published":1,"updated":"2018-01-26T03:18:40.646Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2d001tgcoiwy637okl","content":"<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 定义变量 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/mnt/raid5/log/web\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_DEBUG_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/debug\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_INFO_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/info\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_WARN_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/warn\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_ERROR_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/error\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 控制台输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"STDOUT\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.ConsoleAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- 日志输出编码 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- DEBUG输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_DEBUG\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_DEBUG_HOME&#125;/debug.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_DEBUG_HOME&#125;/debug.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;level&gt;DEBUG&lt;/level&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;/filter&gt; --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- INFO输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_INFO\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_INFO_HOME&#125;/info.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_INFO_HOME&#125;/info.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.filter.LevelFilter\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>INFO<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- WARN输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_WARN\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_WARN_HOME&#125;/warn.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_WARN_HOME&#125;/warn.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.filter.LevelFilter\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>WARN<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- ERROR输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_ERROR\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_ERROR_HOME&#125;/error.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_ERROR_HOME&#125;/error.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.filter.LevelFilter\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>ERROR<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">\"DEBUG\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"STDOUT\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_DEBUG\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_INFO\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_WARN\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_ERROR\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 定义变量 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/mnt/raid5/log/web\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_DEBUG_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/debug\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_INFO_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/info\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_WARN_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/warn\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOG_ERROR_HOME\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;LOG_HOME&#125;/error\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 控制台输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"STDOUT\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.ConsoleAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- 日志输出编码 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- DEBUG输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_DEBUG\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_DEBUG_HOME&#125;/debug.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_DEBUG_HOME&#125;/debug.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;level&gt;DEBUG&lt;/level&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;/filter&gt; --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- INFO输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_INFO\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_INFO_HOME&#125;/info.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_INFO_HOME&#125;/info.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.filter.LevelFilter\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>INFO<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- WARN输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_WARN\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_WARN_HOME&#125;/warn.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_WARN_HOME&#125;/warn.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.filter.LevelFilter\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>WARN<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- ERROR输出 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"FILE_ERROR\"</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.RollingFileAppender\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">file</span>&gt;</span>$&#123;LOG_ERROR_HOME&#125;/error.log<span class=\"tag\">&lt;/<span class=\"name\">file</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">Encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">Encoding</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">rollingPolicy</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 日志文件输出的文件名 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">FileNamePattern</span>&gt;</span>$&#123;LOG_ERROR_HOME&#125;/error.%d&#123;yyyy-MM-dd&#125;.log<span class=\"tag\">&lt;/<span class=\"name\">FileNamePattern</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxHistory</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">MaxHistory</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">rollingPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">layout</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.PatternLayout\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 格式化输出: %d表示日期, %thread表示线程名, %-5level:级别从左显示5个字符宽度, %msg:日志消息, %n换行符 --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] %level [%thread] %logger&#123;36&#125; %X&#123;medic.eventCode&#125; %msg %ex%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!--日志文件最大的大小 --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">triggeringPolicy</span></span></span><br><span class=\"line\"><span class=\"tag\">\t\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">MaxFileSize</span>&gt;</span>100MB<span class=\"tag\">&lt;/<span class=\"name\">MaxFileSize</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">triggeringPolicy</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">filter</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.classic.filter.LevelFilter\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>ERROR<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMatch</span>&gt;</span>ACCEPT<span class=\"tag\">&lt;/<span class=\"name\">onMatch</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">onMismatch</span>&gt;</span>DENY<span class=\"tag\">&lt;/<span class=\"name\">onMismatch</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">\"DEBUG\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"STDOUT\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_DEBUG\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_INFO\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_WARN\"</span> /&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"FILE_ERROR\"</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"记一次线上问题的排查过程","date":"2018-04-04T16:00:00.000Z","_content":"\n# 问题\n\nXX系统中，一个用户需要维护的项目数过多，填写的任务数超多，产生了一次工时保存中，只有前面一部分的xx数据持久化到数据库，后面的数据没有保存。\n\n`图1`\n\n![](http://ww1.sinaimg.cn/large/806e3151ly1fptj4uwnnuj21200i8gm5.jpg)\n\n\n# 排查过程\n\n## 1.增加日志，监控参数信息\n\n首先想到的是否后面部分的数据在保存过程中发生了异常。排查异常日志，发现没有该问题存在。\n\n然后增加方法参数信息日志，数据参数信息。发现参数集合size=200，前端发送集合size=400。判断问题可以能是因为服务器容器环境(Nginx+Tomcat)导致\n\n## 2.开发环境问题重现\n\n### 2.1 模拟数据\n\n在测试环境模拟线上数据。如`图1`\n\n### 2.2 只配置Tomcat\n\n在idea中直接启动tomcat，无nginx环境，如果没有问题，则可暂时确定为nginx问题。\n\n然而，在过程中发现了新的问题。 \n\n```\norg.springframework.beans.InvalidPropertyException: Invalid property 'detail[256]' of bean class [com.suning.asvp.mer.entity.InviteCooperationInfo]: Index of out of bounds in property path 'detail[256]'; nested exception is java.lang.IndexOutOfBoundsException: Index: 256, Size: 256  \n    at org.springframework.beans.BeanWrapperImpl.getPropertyValue(BeanWrapperImpl.java:833) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.BeanWrapperImpl.getNestedBeanWrapper(BeanWrapperImpl.java:576) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.BeanWrapperImpl.getBeanWrapperForPropertyPath(BeanWrapperImpl.java:553) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:914) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:76) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.validation.DataBinder.applyPropertyValues(DataBinder.java:692) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.validation.DataBinder.doBind(DataBinder.java:588) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.web.bind.WebDataBinder.doBind(WebDataBinder.java:191) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.web.bind.ServletRequestDataBinder.bind(ServletRequestDataBinder.java:112) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE] \n```\n\n查看BeanWrapperImpl源码\n```\nelse if (value instanceof List) {  \n    int index = Integer.parseInt(key);                        \n    List list = (List) value;  \n    growCollectionIfNecessary(list, index, indexedPropertyName, pd, i + 1);                       \n    value = list.get(index);// 测试报错时，此处list只有256个，index为256时，取第257个报错  \n}  \n```\n\n```\n@SuppressWarnings(\"unchecked\")  \n    private void growCollectionIfNecessary(  \n            Collection collection, int index, String name, PropertyDescriptor pd, int nestingLevel) {  \n  \n  \n        if (!this.autoGrowNestedPaths) {  \n            return;  \n        }  \n        int size = collection.size();  \n        // 当个数小于autoGrowCollectionLimit这个值时才会向list中添加新元素  \n        if (index >= size && index < this.autoGrowCollectionLimit) {  \n            Class elementType = GenericCollectionTypeResolver.getCollectionReturnType(pd.getReadMethod(), nestingLevel);  \n            if (elementType != null) {  \n                for (int i = collection.size(); i < index + 1; i++) {  \n                    collection.add(newValue(elementType, name));  \n                }  \n            }  \n        }  \n    }  \n```\n\n根据上面的分析找到autoGrowCollectionLimit的定义\n\n```\npublic class DataBinder implements PropertyEditorRegistry, TypeConverter {  \n  \n    /** Default object name used for binding: \"target\" */  \n    public static final String DEFAULT_OBJECT_NAME = \"target\";  \n  \n    /** Default limit for array and collection growing: 256 */  \n    public static final int DEFAULT_AUTO_GROW_COLLECTION_LIMIT = 256;  \n  \n    private int autoGrowCollectionLimit = DEFAULT_AUTO_GROW_COLLECTION_LIMIT; \n```\n\n解决方案，是在自己的Controller中加入如下方法\n\n```\n@InitBinder  \nprotected void initBinder(WebDataBinder binder) {  \n    binder.setAutoGrowNestedPaths(true);  \n    binder.setAutoGrowCollectionLimit(1024);  \n}  \n```\n\n==**BUT** 这个问题和线上的不同，只能算是意外收获。革命尚未成功，同志仍需努力！！！！==\n\n### 2.3 增加Nginx\n经过2.2的奋斗，暂时判定是否为Nginx post请求参数做了限制。嗯，开搞~ 在开发环境配置Nginx代理，过程略·····\n\nnginx.conf 如下\n```\nupstream xxxxxxx {\n\tserver 127.0.0.1:8080  weight=10 max_fails=2 fail_timeout=30s ;\n}\n\nserver {\n    listen       80;\n    server_name  xxxxxxx.com;\n    client_max_body_size 100M;  # 配置post size\n    \n    #charset koi8-r;\n  \n    #access_log  logs/host.access.log  main;\n\t\n   location / {\n\t\t#proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header;\n\t\tproxy_set_header        Host  $host;\n\t\tproxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n\t\tproxy_pass              http://xxxxxxx;\n\t\texpires                 0;\n\t}\n}\n```\n\n对于`client_max_body_size 100M;`，网上都是与文件上传相关的。不过都是通过post， request body的方式上传数据，所以通用。\n\n测试~~\n\n功能正常，没有重现线上问题。 哭死~~~\n\n革命还要继续~~\n\n### 2.4 Tomcat post设置\n\n去线上服务器拉去配置\n\n```\n<Connector port=\"1601\" maxParameterCount=\"1000\" protocol=\"HTTP/1.1\" redirectPort=\"8443\" maxSpareThreads=\"750\" maxThreads=\"1000\" minSpareTHreads=\"50\" acceptCount=\"1000\" connectionTimeout=\"20000\" URIEncoding=\"utf-8\"/>\n```\n\n经分析，发现线上没有body size的配置，却有`maxParameterCount=\"1000\"`。该参数为限制请求的参数个数，从而变相限制body size。\n\n在开发环境配置该参数，测试，**问题重现**。\n\n\n## 3. 解决\n\n问题原因定位好了，剩下的就是如何解决了。\n\n两个方案：\n\n- 修改线上配置\n  \n    *该上实施难度系数高，因为公司使用的统一发布部署平台，开发人员无服务器操作权限。*\n\n- 修改代码\n    \n    *修改保存逻辑，分片存储*\n\n\n# 总结\n\n问题排查，需要先对整体有个把握，然后分析影响范围。不能钻牛角尖，采用西医“头疼医头”的方式。有可能最后结果还是要医头，但此时的医头已经是建立在中医的辩证主义上，对症下药。","source":"_posts/online-question-resolve.md","raw":"---\ntitle: 记一次线上问题的排查过程\ndate: 2018-04-05\ntags: \n    - nginx\n    - tomcat\n---\n\n# 问题\n\nXX系统中，一个用户需要维护的项目数过多，填写的任务数超多，产生了一次工时保存中，只有前面一部分的xx数据持久化到数据库，后面的数据没有保存。\n\n`图1`\n\n![](http://ww1.sinaimg.cn/large/806e3151ly1fptj4uwnnuj21200i8gm5.jpg)\n\n\n# 排查过程\n\n## 1.增加日志，监控参数信息\n\n首先想到的是否后面部分的数据在保存过程中发生了异常。排查异常日志，发现没有该问题存在。\n\n然后增加方法参数信息日志，数据参数信息。发现参数集合size=200，前端发送集合size=400。判断问题可以能是因为服务器容器环境(Nginx+Tomcat)导致\n\n## 2.开发环境问题重现\n\n### 2.1 模拟数据\n\n在测试环境模拟线上数据。如`图1`\n\n### 2.2 只配置Tomcat\n\n在idea中直接启动tomcat，无nginx环境，如果没有问题，则可暂时确定为nginx问题。\n\n然而，在过程中发现了新的问题。 \n\n```\norg.springframework.beans.InvalidPropertyException: Invalid property 'detail[256]' of bean class [com.suning.asvp.mer.entity.InviteCooperationInfo]: Index of out of bounds in property path 'detail[256]'; nested exception is java.lang.IndexOutOfBoundsException: Index: 256, Size: 256  \n    at org.springframework.beans.BeanWrapperImpl.getPropertyValue(BeanWrapperImpl.java:833) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.BeanWrapperImpl.getNestedBeanWrapper(BeanWrapperImpl.java:576) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.BeanWrapperImpl.getBeanWrapperForPropertyPath(BeanWrapperImpl.java:553) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:914) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:76) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.validation.DataBinder.applyPropertyValues(DataBinder.java:692) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.validation.DataBinder.doBind(DataBinder.java:588) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.web.bind.WebDataBinder.doBind(WebDataBinder.java:191) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE]  \n    at org.springframework.web.bind.ServletRequestDataBinder.bind(ServletRequestDataBinder.java:112) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE] \n```\n\n查看BeanWrapperImpl源码\n```\nelse if (value instanceof List) {  \n    int index = Integer.parseInt(key);                        \n    List list = (List) value;  \n    growCollectionIfNecessary(list, index, indexedPropertyName, pd, i + 1);                       \n    value = list.get(index);// 测试报错时，此处list只有256个，index为256时，取第257个报错  \n}  \n```\n\n```\n@SuppressWarnings(\"unchecked\")  \n    private void growCollectionIfNecessary(  \n            Collection collection, int index, String name, PropertyDescriptor pd, int nestingLevel) {  \n  \n  \n        if (!this.autoGrowNestedPaths) {  \n            return;  \n        }  \n        int size = collection.size();  \n        // 当个数小于autoGrowCollectionLimit这个值时才会向list中添加新元素  \n        if (index >= size && index < this.autoGrowCollectionLimit) {  \n            Class elementType = GenericCollectionTypeResolver.getCollectionReturnType(pd.getReadMethod(), nestingLevel);  \n            if (elementType != null) {  \n                for (int i = collection.size(); i < index + 1; i++) {  \n                    collection.add(newValue(elementType, name));  \n                }  \n            }  \n        }  \n    }  \n```\n\n根据上面的分析找到autoGrowCollectionLimit的定义\n\n```\npublic class DataBinder implements PropertyEditorRegistry, TypeConverter {  \n  \n    /** Default object name used for binding: \"target\" */  \n    public static final String DEFAULT_OBJECT_NAME = \"target\";  \n  \n    /** Default limit for array and collection growing: 256 */  \n    public static final int DEFAULT_AUTO_GROW_COLLECTION_LIMIT = 256;  \n  \n    private int autoGrowCollectionLimit = DEFAULT_AUTO_GROW_COLLECTION_LIMIT; \n```\n\n解决方案，是在自己的Controller中加入如下方法\n\n```\n@InitBinder  \nprotected void initBinder(WebDataBinder binder) {  \n    binder.setAutoGrowNestedPaths(true);  \n    binder.setAutoGrowCollectionLimit(1024);  \n}  \n```\n\n==**BUT** 这个问题和线上的不同，只能算是意外收获。革命尚未成功，同志仍需努力！！！！==\n\n### 2.3 增加Nginx\n经过2.2的奋斗，暂时判定是否为Nginx post请求参数做了限制。嗯，开搞~ 在开发环境配置Nginx代理，过程略·····\n\nnginx.conf 如下\n```\nupstream xxxxxxx {\n\tserver 127.0.0.1:8080  weight=10 max_fails=2 fail_timeout=30s ;\n}\n\nserver {\n    listen       80;\n    server_name  xxxxxxx.com;\n    client_max_body_size 100M;  # 配置post size\n    \n    #charset koi8-r;\n  \n    #access_log  logs/host.access.log  main;\n\t\n   location / {\n\t\t#proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header;\n\t\tproxy_set_header        Host  $host;\n\t\tproxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n\t\tproxy_pass              http://xxxxxxx;\n\t\texpires                 0;\n\t}\n}\n```\n\n对于`client_max_body_size 100M;`，网上都是与文件上传相关的。不过都是通过post， request body的方式上传数据，所以通用。\n\n测试~~\n\n功能正常，没有重现线上问题。 哭死~~~\n\n革命还要继续~~\n\n### 2.4 Tomcat post设置\n\n去线上服务器拉去配置\n\n```\n<Connector port=\"1601\" maxParameterCount=\"1000\" protocol=\"HTTP/1.1\" redirectPort=\"8443\" maxSpareThreads=\"750\" maxThreads=\"1000\" minSpareTHreads=\"50\" acceptCount=\"1000\" connectionTimeout=\"20000\" URIEncoding=\"utf-8\"/>\n```\n\n经分析，发现线上没有body size的配置，却有`maxParameterCount=\"1000\"`。该参数为限制请求的参数个数，从而变相限制body size。\n\n在开发环境配置该参数，测试，**问题重现**。\n\n\n## 3. 解决\n\n问题原因定位好了，剩下的就是如何解决了。\n\n两个方案：\n\n- 修改线上配置\n  \n    *该上实施难度系数高，因为公司使用的统一发布部署平台，开发人员无服务器操作权限。*\n\n- 修改代码\n    \n    *修改保存逻辑，分片存储*\n\n\n# 总结\n\n问题排查，需要先对整体有个把握，然后分析影响范围。不能钻牛角尖，采用西医“头疼医头”的方式。有可能最后结果还是要医头，但此时的医头已经是建立在中医的辩证主义上，对症下药。","slug":"online-question-resolve","published":1,"updated":"2018-04-05T08:00:01.693Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2e001vgcoikef45wv9","content":"<h1 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h1><p>XX系统中，一个用户需要维护的项目数过多，填写的任务数超多，产生了一次工时保存中，只有前面一部分的xx数据持久化到数据库，后面的数据没有保存。</p>\n<p><code>图1</code></p>\n<p><img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fptj4uwnnuj21200i8gm5.jpg\" alt=\"\"></p>\n<h1 id=\"排查过程\"><a href=\"#排查过程\" class=\"headerlink\" title=\"排查过程\"></a>排查过程</h1><h2 id=\"1-增加日志，监控参数信息\"><a href=\"#1-增加日志，监控参数信息\" class=\"headerlink\" title=\"1.增加日志，监控参数信息\"></a>1.增加日志，监控参数信息</h2><p>首先想到的是否后面部分的数据在保存过程中发生了异常。排查异常日志，发现没有该问题存在。</p>\n<p>然后增加方法参数信息日志，数据参数信息。发现参数集合size=200，前端发送集合size=400。判断问题可以能是因为服务器容器环境(Nginx+Tomcat)导致</p>\n<h2 id=\"2-开发环境问题重现\"><a href=\"#2-开发环境问题重现\" class=\"headerlink\" title=\"2.开发环境问题重现\"></a>2.开发环境问题重现</h2><h3 id=\"2-1-模拟数据\"><a href=\"#2-1-模拟数据\" class=\"headerlink\" title=\"2.1 模拟数据\"></a>2.1 模拟数据</h3><p>在测试环境模拟线上数据。如<code>图1</code></p>\n<h3 id=\"2-2-只配置Tomcat\"><a href=\"#2-2-只配置Tomcat\" class=\"headerlink\" title=\"2.2 只配置Tomcat\"></a>2.2 只配置Tomcat</h3><p>在idea中直接启动tomcat，无nginx环境，如果没有问题，则可暂时确定为nginx问题。</p>\n<p>然而，在过程中发现了新的问题。 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.springframework.beans.InvalidPropertyException: Invalid property &apos;detail[256]&apos; of bean class [com.suning.asvp.mer.entity.InviteCooperationInfo]: Index of out of bounds in property path &apos;detail[256]&apos;; nested exception is java.lang.IndexOutOfBoundsException: Index: 256, Size: 256  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.getPropertyValue(BeanWrapperImpl.java:833) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.getNestedBeanWrapper(BeanWrapperImpl.java:576) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.getBeanWrapperForPropertyPath(BeanWrapperImpl.java:553) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:914) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:76) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.validation.DataBinder.applyPropertyValues(DataBinder.java:692) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.validation.DataBinder.doBind(DataBinder.java:588) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.web.bind.WebDataBinder.doBind(WebDataBinder.java:191) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.web.bind.ServletRequestDataBinder.bind(ServletRequestDataBinder.java:112) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE]</span><br></pre></td></tr></table></figure>\n<p>查看BeanWrapperImpl源码<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">else if (value instanceof List) &#123;  </span><br><span class=\"line\">    int index = Integer.parseInt(key);                        </span><br><span class=\"line\">    List list = (List) value;  </span><br><span class=\"line\">    growCollectionIfNecessary(list, index, indexedPropertyName, pd, i + 1);                       </span><br><span class=\"line\">    value = list.get(index);// 测试报错时，此处list只有256个，index为256时，取第257个报错  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SuppressWarnings(&quot;unchecked&quot;)  </span><br><span class=\"line\">    private void growCollectionIfNecessary(  </span><br><span class=\"line\">            Collection collection, int index, String name, PropertyDescriptor pd, int nestingLevel) &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">        if (!this.autoGrowNestedPaths) &#123;  </span><br><span class=\"line\">            return;  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        int size = collection.size();  </span><br><span class=\"line\">        // 当个数小于autoGrowCollectionLimit这个值时才会向list中添加新元素  </span><br><span class=\"line\">        if (index &gt;= size &amp;&amp; index &lt; this.autoGrowCollectionLimit) &#123;  </span><br><span class=\"line\">            Class elementType = GenericCollectionTypeResolver.getCollectionReturnType(pd.getReadMethod(), nestingLevel);  </span><br><span class=\"line\">            if (elementType != null) &#123;  </span><br><span class=\"line\">                for (int i = collection.size(); i &lt; index + 1; i++) &#123;  </span><br><span class=\"line\">                    collection.add(newValue(elementType, name));  </span><br><span class=\"line\">                &#125;  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>根据上面的分析找到autoGrowCollectionLimit的定义</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class DataBinder implements PropertyEditorRegistry, TypeConverter &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    /** Default object name used for binding: &quot;target&quot; */  </span><br><span class=\"line\">    public static final String DEFAULT_OBJECT_NAME = &quot;target&quot;;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    /** Default limit for array and collection growing: 256 */  </span><br><span class=\"line\">    public static final int DEFAULT_AUTO_GROW_COLLECTION_LIMIT = 256;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    private int autoGrowCollectionLimit = DEFAULT_AUTO_GROW_COLLECTION_LIMIT;</span><br></pre></td></tr></table></figure>\n<p>解决方案，是在自己的Controller中加入如下方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@InitBinder  </span><br><span class=\"line\">protected void initBinder(WebDataBinder binder) &#123;  </span><br><span class=\"line\">    binder.setAutoGrowNestedPaths(true);  </span><br><span class=\"line\">    binder.setAutoGrowCollectionLimit(1024);  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>==<strong>BUT</strong> 这个问题和线上的不同，只能算是意外收获。革命尚未成功，同志仍需努力！！！！==</p>\n<h3 id=\"2-3-增加Nginx\"><a href=\"#2-3-增加Nginx\" class=\"headerlink\" title=\"2.3 增加Nginx\"></a>2.3 增加Nginx</h3><p>经过2.2的奋斗，暂时判定是否为Nginx post请求参数做了限制。嗯，开搞~ 在开发环境配置Nginx代理，过程略·····</p>\n<p>nginx.conf 如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream xxxxxxx &#123;</span><br><span class=\"line\">\tserver 127.0.0.1:8080  weight=10 max_fails=2 fail_timeout=30s ;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       80;</span><br><span class=\"line\">    server_name  xxxxxxx.com;</span><br><span class=\"line\">    client_max_body_size 100M;  # 配置post size</span><br><span class=\"line\">    </span><br><span class=\"line\">    #charset koi8-r;</span><br><span class=\"line\">  </span><br><span class=\"line\">    #access_log  logs/host.access.log  main;</span><br><span class=\"line\">\t</span><br><span class=\"line\">   location / &#123;</span><br><span class=\"line\">\t\t#proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header;</span><br><span class=\"line\">\t\tproxy_set_header        Host  $host;</span><br><span class=\"line\">\t\tproxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">\t\tproxy_pass              http://xxxxxxx;</span><br><span class=\"line\">\t\texpires                 0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>对于<code>client_max_body_size 100M;</code>，网上都是与文件上传相关的。不过都是通过post， request body的方式上传数据，所以通用。</p>\n<p>测试~~</p>\n<p>功能正常，没有重现线上问题。 哭死~~~</p>\n<p>革命还要继续~~</p>\n<h3 id=\"2-4-Tomcat-post设置\"><a href=\"#2-4-Tomcat-post设置\" class=\"headerlink\" title=\"2.4 Tomcat post设置\"></a>2.4 Tomcat post设置</h3><p>去线上服务器拉去配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Connector port=&quot;1601&quot; maxParameterCount=&quot;1000&quot; protocol=&quot;HTTP/1.1&quot; redirectPort=&quot;8443&quot; maxSpareThreads=&quot;750&quot; maxThreads=&quot;1000&quot; minSpareTHreads=&quot;50&quot; acceptCount=&quot;1000&quot; connectionTimeout=&quot;20000&quot; URIEncoding=&quot;utf-8&quot;/&gt;</span><br></pre></td></tr></table></figure>\n<p>经分析，发现线上没有body size的配置，却有<code>maxParameterCount=&quot;1000&quot;</code>。该参数为限制请求的参数个数，从而变相限制body size。</p>\n<p>在开发环境配置该参数，测试，<strong>问题重现</strong>。</p>\n<h2 id=\"3-解决\"><a href=\"#3-解决\" class=\"headerlink\" title=\"3. 解决\"></a>3. 解决</h2><p>问题原因定位好了，剩下的就是如何解决了。</p>\n<p>两个方案：</p>\n<ul>\n<li><p>修改线上配置</p>\n<p>  <em>该上实施难度系数高，因为公司使用的统一发布部署平台，开发人员无服务器操作权限。</em></p>\n</li>\n<li><p>修改代码</p>\n<p>  <em>修改保存逻辑，分片存储</em></p>\n</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>问题排查，需要先对整体有个把握，然后分析影响范围。不能钻牛角尖，采用西医“头疼医头”的方式。有可能最后结果还是要医头，但此时的医头已经是建立在中医的辩证主义上，对症下药。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h1><p>XX系统中，一个用户需要维护的项目数过多，填写的任务数超多，产生了一次工时保存中，只有前面一部分的xx数据持久化到数据库，后面的数据没有保存。</p>\n<p><code>图1</code></p>\n<p><img src=\"http://ww1.sinaimg.cn/large/806e3151ly1fptj4uwnnuj21200i8gm5.jpg\" alt=\"\"></p>\n<h1 id=\"排查过程\"><a href=\"#排查过程\" class=\"headerlink\" title=\"排查过程\"></a>排查过程</h1><h2 id=\"1-增加日志，监控参数信息\"><a href=\"#1-增加日志，监控参数信息\" class=\"headerlink\" title=\"1.增加日志，监控参数信息\"></a>1.增加日志，监控参数信息</h2><p>首先想到的是否后面部分的数据在保存过程中发生了异常。排查异常日志，发现没有该问题存在。</p>\n<p>然后增加方法参数信息日志，数据参数信息。发现参数集合size=200，前端发送集合size=400。判断问题可以能是因为服务器容器环境(Nginx+Tomcat)导致</p>\n<h2 id=\"2-开发环境问题重现\"><a href=\"#2-开发环境问题重现\" class=\"headerlink\" title=\"2.开发环境问题重现\"></a>2.开发环境问题重现</h2><h3 id=\"2-1-模拟数据\"><a href=\"#2-1-模拟数据\" class=\"headerlink\" title=\"2.1 模拟数据\"></a>2.1 模拟数据</h3><p>在测试环境模拟线上数据。如<code>图1</code></p>\n<h3 id=\"2-2-只配置Tomcat\"><a href=\"#2-2-只配置Tomcat\" class=\"headerlink\" title=\"2.2 只配置Tomcat\"></a>2.2 只配置Tomcat</h3><p>在idea中直接启动tomcat，无nginx环境，如果没有问题，则可暂时确定为nginx问题。</p>\n<p>然而，在过程中发现了新的问题。 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.springframework.beans.InvalidPropertyException: Invalid property &apos;detail[256]&apos; of bean class [com.suning.asvp.mer.entity.InviteCooperationInfo]: Index of out of bounds in property path &apos;detail[256]&apos;; nested exception is java.lang.IndexOutOfBoundsException: Index: 256, Size: 256  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.getPropertyValue(BeanWrapperImpl.java:833) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.getNestedBeanWrapper(BeanWrapperImpl.java:576) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.getBeanWrapperForPropertyPath(BeanWrapperImpl.java:553) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:914) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:76) ~[spring-beans-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.validation.DataBinder.applyPropertyValues(DataBinder.java:692) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.validation.DataBinder.doBind(DataBinder.java:588) ~[spring-context-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.web.bind.WebDataBinder.doBind(WebDataBinder.java:191) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE]  </span><br><span class=\"line\">    at org.springframework.web.bind.ServletRequestDataBinder.bind(ServletRequestDataBinder.java:112) ~[spring-web-3.1.2.RELEASE.jar:3.1.2.RELEASE]</span><br></pre></td></tr></table></figure>\n<p>查看BeanWrapperImpl源码<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">else if (value instanceof List) &#123;  </span><br><span class=\"line\">    int index = Integer.parseInt(key);                        </span><br><span class=\"line\">    List list = (List) value;  </span><br><span class=\"line\">    growCollectionIfNecessary(list, index, indexedPropertyName, pd, i + 1);                       </span><br><span class=\"line\">    value = list.get(index);// 测试报错时，此处list只有256个，index为256时，取第257个报错  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SuppressWarnings(&quot;unchecked&quot;)  </span><br><span class=\"line\">    private void growCollectionIfNecessary(  </span><br><span class=\"line\">            Collection collection, int index, String name, PropertyDescriptor pd, int nestingLevel) &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">        if (!this.autoGrowNestedPaths) &#123;  </span><br><span class=\"line\">            return;  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        int size = collection.size();  </span><br><span class=\"line\">        // 当个数小于autoGrowCollectionLimit这个值时才会向list中添加新元素  </span><br><span class=\"line\">        if (index &gt;= size &amp;&amp; index &lt; this.autoGrowCollectionLimit) &#123;  </span><br><span class=\"line\">            Class elementType = GenericCollectionTypeResolver.getCollectionReturnType(pd.getReadMethod(), nestingLevel);  </span><br><span class=\"line\">            if (elementType != null) &#123;  </span><br><span class=\"line\">                for (int i = collection.size(); i &lt; index + 1; i++) &#123;  </span><br><span class=\"line\">                    collection.add(newValue(elementType, name));  </span><br><span class=\"line\">                &#125;  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>根据上面的分析找到autoGrowCollectionLimit的定义</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class DataBinder implements PropertyEditorRegistry, TypeConverter &#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    /** Default object name used for binding: &quot;target&quot; */  </span><br><span class=\"line\">    public static final String DEFAULT_OBJECT_NAME = &quot;target&quot;;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    /** Default limit for array and collection growing: 256 */  </span><br><span class=\"line\">    public static final int DEFAULT_AUTO_GROW_COLLECTION_LIMIT = 256;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    private int autoGrowCollectionLimit = DEFAULT_AUTO_GROW_COLLECTION_LIMIT;</span><br></pre></td></tr></table></figure>\n<p>解决方案，是在自己的Controller中加入如下方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@InitBinder  </span><br><span class=\"line\">protected void initBinder(WebDataBinder binder) &#123;  </span><br><span class=\"line\">    binder.setAutoGrowNestedPaths(true);  </span><br><span class=\"line\">    binder.setAutoGrowCollectionLimit(1024);  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>==<strong>BUT</strong> 这个问题和线上的不同，只能算是意外收获。革命尚未成功，同志仍需努力！！！！==</p>\n<h3 id=\"2-3-增加Nginx\"><a href=\"#2-3-增加Nginx\" class=\"headerlink\" title=\"2.3 增加Nginx\"></a>2.3 增加Nginx</h3><p>经过2.2的奋斗，暂时判定是否为Nginx post请求参数做了限制。嗯，开搞~ 在开发环境配置Nginx代理，过程略·····</p>\n<p>nginx.conf 如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream xxxxxxx &#123;</span><br><span class=\"line\">\tserver 127.0.0.1:8080  weight=10 max_fails=2 fail_timeout=30s ;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       80;</span><br><span class=\"line\">    server_name  xxxxxxx.com;</span><br><span class=\"line\">    client_max_body_size 100M;  # 配置post size</span><br><span class=\"line\">    </span><br><span class=\"line\">    #charset koi8-r;</span><br><span class=\"line\">  </span><br><span class=\"line\">    #access_log  logs/host.access.log  main;</span><br><span class=\"line\">\t</span><br><span class=\"line\">   location / &#123;</span><br><span class=\"line\">\t\t#proxy_next_upstream     http_500 http_502 http_503 http_504 error timeout invalid_header;</span><br><span class=\"line\">\t\tproxy_set_header        Host  $host;</span><br><span class=\"line\">\t\tproxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">\t\tproxy_pass              http://xxxxxxx;</span><br><span class=\"line\">\t\texpires                 0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>对于<code>client_max_body_size 100M;</code>，网上都是与文件上传相关的。不过都是通过post， request body的方式上传数据，所以通用。</p>\n<p>测试~~</p>\n<p>功能正常，没有重现线上问题。 哭死~~~</p>\n<p>革命还要继续~~</p>\n<h3 id=\"2-4-Tomcat-post设置\"><a href=\"#2-4-Tomcat-post设置\" class=\"headerlink\" title=\"2.4 Tomcat post设置\"></a>2.4 Tomcat post设置</h3><p>去线上服务器拉去配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Connector port=&quot;1601&quot; maxParameterCount=&quot;1000&quot; protocol=&quot;HTTP/1.1&quot; redirectPort=&quot;8443&quot; maxSpareThreads=&quot;750&quot; maxThreads=&quot;1000&quot; minSpareTHreads=&quot;50&quot; acceptCount=&quot;1000&quot; connectionTimeout=&quot;20000&quot; URIEncoding=&quot;utf-8&quot;/&gt;</span><br></pre></td></tr></table></figure>\n<p>经分析，发现线上没有body size的配置，却有<code>maxParameterCount=&quot;1000&quot;</code>。该参数为限制请求的参数个数，从而变相限制body size。</p>\n<p>在开发环境配置该参数，测试，<strong>问题重现</strong>。</p>\n<h2 id=\"3-解决\"><a href=\"#3-解决\" class=\"headerlink\" title=\"3. 解决\"></a>3. 解决</h2><p>问题原因定位好了，剩下的就是如何解决了。</p>\n<p>两个方案：</p>\n<ul>\n<li><p>修改线上配置</p>\n<p>  <em>该上实施难度系数高，因为公司使用的统一发布部署平台，开发人员无服务器操作权限。</em></p>\n</li>\n<li><p>修改代码</p>\n<p>  <em>修改保存逻辑，分片存储</em></p>\n</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>问题排查，需要先对整体有个把握，然后分析影响范围。不能钻牛角尖，采用西医“头疼医头”的方式。有可能最后结果还是要医头，但此时的医头已经是建立在中医的辩证主义上，对症下药。</p>\n"},{"title":"MySQL修改root密码的多种方法","date":"2017-04-21T05:10:50.000Z","_content":"\n方法1： 用SET PASSWORD命令\n```\n　　mysql -u root\n　　mysql> SET PASSWORD FOR 'root'@'localhost' = PASSWORD('newpass');\n```\n方法2：用mysqladmin\n```\n　　mysqladmin -u root password \"newpass\"\n　　如果root已经设置过密码，采用如下方法\n　　mysqladmin -u root password oldpass \"newpass\"\n```\n方法3： 用UPDATE直接编辑user表\n```\n　　mysql -u root\n　　mysql> use mysql;\n　　mysql> UPDATE user SET Password = PASSWORD('newpass') WHERE user = 'root';\n　　mysql> FLUSH PRIVILEGES;\n```\n在丢失root密码的时候，可以这样\n```\n　　mysqld_safe --skip-grant-tables&\n　　mysql -u root mysql\n　　mysql> UPDATE user SET password=PASSWORD(\"new password\") WHERE user='root';\n　　mysql> FLUSH PRIVILEGES;\n```","source":"_posts/mysql-password.md","raw":"---\ntitle: MySQL修改root密码的多种方法\ndate: 2017-04-21 13:10:50\ntags: \n---\n\n方法1： 用SET PASSWORD命令\n```\n　　mysql -u root\n　　mysql> SET PASSWORD FOR 'root'@'localhost' = PASSWORD('newpass');\n```\n方法2：用mysqladmin\n```\n　　mysqladmin -u root password \"newpass\"\n　　如果root已经设置过密码，采用如下方法\n　　mysqladmin -u root password oldpass \"newpass\"\n```\n方法3： 用UPDATE直接编辑user表\n```\n　　mysql -u root\n　　mysql> use mysql;\n　　mysql> UPDATE user SET Password = PASSWORD('newpass') WHERE user = 'root';\n　　mysql> FLUSH PRIVILEGES;\n```\n在丢失root密码的时候，可以这样\n```\n　　mysqld_safe --skip-grant-tables&\n　　mysql -u root mysql\n　　mysql> UPDATE user SET password=PASSWORD(\"new password\") WHERE user='root';\n　　mysql> FLUSH PRIVILEGES;\n```","slug":"mysql-password","published":1,"updated":"2018-10-12T03:53:07.347Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2f001ygcoify7946ki","content":"<p>方法1： 用SET PASSWORD命令<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysql -u root</span><br><span class=\"line\">　　mysql&gt; SET PASSWORD FOR &apos;root&apos;@&apos;localhost&apos; = PASSWORD(&apos;newpass&apos;);</span><br></pre></td></tr></table></figure></p>\n<p>方法2：用mysqladmin<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysqladmin -u root password &quot;newpass&quot;</span><br><span class=\"line\">　　如果root已经设置过密码，采用如下方法</span><br><span class=\"line\">　　mysqladmin -u root password oldpass &quot;newpass&quot;</span><br></pre></td></tr></table></figure></p>\n<p>方法3： 用UPDATE直接编辑user表<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysql -u root</span><br><span class=\"line\">　　mysql&gt; use mysql;</span><br><span class=\"line\">　　mysql&gt; UPDATE user SET Password = PASSWORD(&apos;newpass&apos;) WHERE user = &apos;root&apos;;</span><br><span class=\"line\">　　mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></p>\n<p>在丢失root密码的时候，可以这样<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysqld_safe --skip-grant-tables&amp;</span><br><span class=\"line\">　　mysql -u root mysql</span><br><span class=\"line\">　　mysql&gt; UPDATE user SET password=PASSWORD(&quot;new password&quot;) WHERE user=&apos;root&apos;;</span><br><span class=\"line\">　　mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<p>方法1： 用SET PASSWORD命令<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysql -u root</span><br><span class=\"line\">　　mysql&gt; SET PASSWORD FOR &apos;root&apos;@&apos;localhost&apos; = PASSWORD(&apos;newpass&apos;);</span><br></pre></td></tr></table></figure></p>\n<p>方法2：用mysqladmin<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysqladmin -u root password &quot;newpass&quot;</span><br><span class=\"line\">　　如果root已经设置过密码，采用如下方法</span><br><span class=\"line\">　　mysqladmin -u root password oldpass &quot;newpass&quot;</span><br></pre></td></tr></table></figure></p>\n<p>方法3： 用UPDATE直接编辑user表<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysql -u root</span><br><span class=\"line\">　　mysql&gt; use mysql;</span><br><span class=\"line\">　　mysql&gt; UPDATE user SET Password = PASSWORD(&apos;newpass&apos;) WHERE user = &apos;root&apos;;</span><br><span class=\"line\">　　mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></p>\n<p>在丢失root密码的时候，可以这样<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">　　mysqld_safe --skip-grant-tables&amp;</span><br><span class=\"line\">　　mysql -u root mysql</span><br><span class=\"line\">　　mysql&gt; UPDATE user SET password=PASSWORD(&quot;new password&quot;) WHERE user=&apos;root&apos;;</span><br><span class=\"line\">　　mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></p>\n"},{"title":"RocketMQ文档","date":"2017-05-17T01:06:25.000Z","comments":0,"_content":"\n> [官方文档](https://rocketmq.incubator.apache.org/docs/quick-start/)\n\n# 快速开始\n\n# 环境准备\n\n安装以下软件：\n\n1. 64位系统，推荐Linux/Unix/Mac\n2. 64位 JDK 1.7+\n3. Maven 3.2.x\n4. Git\n\n# 克隆&编译\n\n```\n> git clone -b develop https://github.com/apache/incubator-rocketmq.git\n> cd incubator-rocketmq\n> mvn -Prelease-all -DskipTests clean install -U\n> cd distribution/target/apache-rocketmq\n\n```\n\n# 启动Name Server\n\n```\n> nohup sh bin/mqnamesrv &\n> tail -f ~/logs/rocketmqlogs/namesrv.log\nThe Name Server boot success...\n```\n\n# 启动Broker\n\n```\n> nohup sh bin/mqbroker -n localhost:9876 &\n> tail -f ~/logs/rocketmqlogs/broker.log \nThe broker[%s, 172.30.30.233:10911] boot success...\n\n```\n\n需要提供一个可以网络访问的ip。\n\n\n# 发送&接受消息\n\n发送&接受消息之前需要通过设置环境变量`NAMESRV_ADDR`，用于通知客户端需要访问的服务地址。\n\n```\n> export NAMESRV_ADDR=localhost:9876\n> sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer\nSendResult [sendStatus=SEND_OK, msgId= ...\n\n> sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer\nConsumeMessageThread_%d Receive New Messages: [MessageExt...\n```\n\n\n# 停止服务\n\n```\n> sh bin/mqshutdown broker\nThe mqbroker(36695) is running...\nSend shutdown request to mqbroker(36695) OK\n\n> sh bin/mqshutdown namesrv\nThe mqnamesrv(36664) is running...\nSend shutdown request to mqnamesrv(36664) OK\n```","source":"_posts/rocketmq-quickstart.md","raw":"---\ntitle: RocketMQ文档\ndate: 2017-05-17 09:06:25\ncomments: false\n---\n\n> [官方文档](https://rocketmq.incubator.apache.org/docs/quick-start/)\n\n# 快速开始\n\n# 环境准备\n\n安装以下软件：\n\n1. 64位系统，推荐Linux/Unix/Mac\n2. 64位 JDK 1.7+\n3. Maven 3.2.x\n4. Git\n\n# 克隆&编译\n\n```\n> git clone -b develop https://github.com/apache/incubator-rocketmq.git\n> cd incubator-rocketmq\n> mvn -Prelease-all -DskipTests clean install -U\n> cd distribution/target/apache-rocketmq\n\n```\n\n# 启动Name Server\n\n```\n> nohup sh bin/mqnamesrv &\n> tail -f ~/logs/rocketmqlogs/namesrv.log\nThe Name Server boot success...\n```\n\n# 启动Broker\n\n```\n> nohup sh bin/mqbroker -n localhost:9876 &\n> tail -f ~/logs/rocketmqlogs/broker.log \nThe broker[%s, 172.30.30.233:10911] boot success...\n\n```\n\n需要提供一个可以网络访问的ip。\n\n\n# 发送&接受消息\n\n发送&接受消息之前需要通过设置环境变量`NAMESRV_ADDR`，用于通知客户端需要访问的服务地址。\n\n```\n> export NAMESRV_ADDR=localhost:9876\n> sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer\nSendResult [sendStatus=SEND_OK, msgId= ...\n\n> sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer\nConsumeMessageThread_%d Receive New Messages: [MessageExt...\n```\n\n\n# 停止服务\n\n```\n> sh bin/mqshutdown broker\nThe mqbroker(36695) is running...\nSend shutdown request to mqbroker(36695) OK\n\n> sh bin/mqshutdown namesrv\nThe mqnamesrv(36664) is running...\nSend shutdown request to mqnamesrv(36664) OK\n```","slug":"rocketmq-quickstart","published":1,"updated":"2018-01-16T06:08:44.660Z","layout":"post","photos":[],"link":"","_id":"cjvg26t2g001zgcoiwtwlxj1y","content":"<blockquote>\n<p><a href=\"https://rocketmq.incubator.apache.org/docs/quick-start/\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n</blockquote>\n<h1 id=\"快速开始\"><a href=\"#快速开始\" class=\"headerlink\" title=\"快速开始\"></a>快速开始</h1><h1 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h1><p>安装以下软件：</p>\n<ol>\n<li>64位系统，推荐Linux/Unix/Mac</li>\n<li>64位 JDK 1.7+</li>\n<li>Maven 3.2.x</li>\n<li>Git</li>\n</ol>\n<h1 id=\"克隆-amp-编译\"><a href=\"#克隆-amp-编译\" class=\"headerlink\" title=\"克隆&amp;编译\"></a>克隆&amp;编译</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; git clone -b develop https://github.com/apache/incubator-rocketmq.git</span><br><span class=\"line\">&gt; cd incubator-rocketmq</span><br><span class=\"line\">&gt; mvn -Prelease-all -DskipTests clean install -U</span><br><span class=\"line\">&gt; cd distribution/target/apache-rocketmq</span><br></pre></td></tr></table></figure>\n<h1 id=\"启动Name-Server\"><a href=\"#启动Name-Server\" class=\"headerlink\" title=\"启动Name Server\"></a>启动Name Server</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; nohup sh bin/mqnamesrv &amp;</span><br><span class=\"line\">&gt; tail -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class=\"line\">The Name Server boot success...</span><br></pre></td></tr></table></figure>\n<h1 id=\"启动Broker\"><a href=\"#启动Broker\" class=\"headerlink\" title=\"启动Broker\"></a>启动Broker</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; nohup sh bin/mqbroker -n localhost:9876 &amp;</span><br><span class=\"line\">&gt; tail -f ~/logs/rocketmqlogs/broker.log </span><br><span class=\"line\">The broker[%s, 172.30.30.233:10911] boot success...</span><br></pre></td></tr></table></figure>\n<p>需要提供一个可以网络访问的ip。</p>\n<h1 id=\"发送-amp-接受消息\"><a href=\"#发送-amp-接受消息\" class=\"headerlink\" title=\"发送&amp;接受消息\"></a>发送&amp;接受消息</h1><p>发送&amp;接受消息之前需要通过设置环境变量<code>NAMESRV_ADDR</code>，用于通知客户端需要访问的服务地址。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; export NAMESRV_ADDR=localhost:9876</span><br><span class=\"line\">&gt; sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</span><br><span class=\"line\">SendResult [sendStatus=SEND_OK, msgId= ...</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span><br><span class=\"line\">ConsumeMessageThread_%d Receive New Messages: [MessageExt...</span><br></pre></td></tr></table></figure>\n<h1 id=\"停止服务\"><a href=\"#停止服务\" class=\"headerlink\" title=\"停止服务\"></a>停止服务</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; sh bin/mqshutdown broker</span><br><span class=\"line\">The mqbroker(36695) is running...</span><br><span class=\"line\">Send shutdown request to mqbroker(36695) OK</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; sh bin/mqshutdown namesrv</span><br><span class=\"line\">The mqnamesrv(36664) is running...</span><br><span class=\"line\">Send shutdown request to mqnamesrv(36664) OK</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><a href=\"https://rocketmq.incubator.apache.org/docs/quick-start/\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n</blockquote>\n<h1 id=\"快速开始\"><a href=\"#快速开始\" class=\"headerlink\" title=\"快速开始\"></a>快速开始</h1><h1 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h1><p>安装以下软件：</p>\n<ol>\n<li>64位系统，推荐Linux/Unix/Mac</li>\n<li>64位 JDK 1.7+</li>\n<li>Maven 3.2.x</li>\n<li>Git</li>\n</ol>\n<h1 id=\"克隆-amp-编译\"><a href=\"#克隆-amp-编译\" class=\"headerlink\" title=\"克隆&amp;编译\"></a>克隆&amp;编译</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; git clone -b develop https://github.com/apache/incubator-rocketmq.git</span><br><span class=\"line\">&gt; cd incubator-rocketmq</span><br><span class=\"line\">&gt; mvn -Prelease-all -DskipTests clean install -U</span><br><span class=\"line\">&gt; cd distribution/target/apache-rocketmq</span><br></pre></td></tr></table></figure>\n<h1 id=\"启动Name-Server\"><a href=\"#启动Name-Server\" class=\"headerlink\" title=\"启动Name Server\"></a>启动Name Server</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; nohup sh bin/mqnamesrv &amp;</span><br><span class=\"line\">&gt; tail -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class=\"line\">The Name Server boot success...</span><br></pre></td></tr></table></figure>\n<h1 id=\"启动Broker\"><a href=\"#启动Broker\" class=\"headerlink\" title=\"启动Broker\"></a>启动Broker</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; nohup sh bin/mqbroker -n localhost:9876 &amp;</span><br><span class=\"line\">&gt; tail -f ~/logs/rocketmqlogs/broker.log </span><br><span class=\"line\">The broker[%s, 172.30.30.233:10911] boot success...</span><br></pre></td></tr></table></figure>\n<p>需要提供一个可以网络访问的ip。</p>\n<h1 id=\"发送-amp-接受消息\"><a href=\"#发送-amp-接受消息\" class=\"headerlink\" title=\"发送&amp;接受消息\"></a>发送&amp;接受消息</h1><p>发送&amp;接受消息之前需要通过设置环境变量<code>NAMESRV_ADDR</code>，用于通知客户端需要访问的服务地址。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; export NAMESRV_ADDR=localhost:9876</span><br><span class=\"line\">&gt; sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</span><br><span class=\"line\">SendResult [sendStatus=SEND_OK, msgId= ...</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span><br><span class=\"line\">ConsumeMessageThread_%d Receive New Messages: [MessageExt...</span><br></pre></td></tr></table></figure>\n<h1 id=\"停止服务\"><a href=\"#停止服务\" class=\"headerlink\" title=\"停止服务\"></a>停止服务</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; sh bin/mqshutdown broker</span><br><span class=\"line\">The mqbroker(36695) is running...</span><br><span class=\"line\">Send shutdown request to mqbroker(36695) OK</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; sh bin/mqshutdown namesrv</span><br><span class=\"line\">The mqnamesrv(36664) is running...</span><br><span class=\"line\">Send shutdown request to mqnamesrv(36664) OK</span><br></pre></td></tr></table></figure>"},{"title":"RocketMQ架构简介","date":"2018-04-08T16:00:00.000Z","_content":"\n\n# 概览\nApache RocketMQ是一款具有低延迟，高性能和可靠性，数十亿容量和灵活可扩展性的分布式消息传递和流媒体平台。它由四部分组成：Name Servers，brokers，producers和consumers。 它们中的每一个都可以在没有单点故障的情况下进行水平扩展。 \n\n![RocketMQ架构](http://rocketmq.apache.org/assets/images/rmq-basic-arc.png)\n\n# NameServer集群\nName Servers提供轻量级服务发现和路由。每个Name Server记录完整的路由信息，提供相应的读写服务，并支持快速存储扩展。\n\n# Broker集群\nBrokers通过提供轻量级的TOPIC和QUEUE机制来实现消息存储。 它们支持Push和Pull模式，包含容错机制（2个或3个副本），并提供强大的峰值填充和按原始时间顺序累积数千亿条消息的能力。此外，broker提供灾难恢复，丰富的指标统计数据和警报机制，而传统的消息传递系统都缺乏这些机制。\n\n# Producer集群\nProducer集群支持分布式部署。分布式producer通过多种负载均衡模式向Broker集群发送消息。发送过程支持fast failure并具有低延迟。\n\n# Consumer集群\nConsumer也支持Push和Pull模型的分布式部署。 它还支持群集消费和消息广播。 它提供了实时的消息订阅机制，可以满足大多数消费者的需求。\n\n","source":"_posts/rocketmq-architecture.md","raw":"---\ntitle: RocketMQ架构简介\ndate: 2018-04-09\ntags: \n    - mq\n    - 分布式\n---\n\n\n# 概览\nApache RocketMQ是一款具有低延迟，高性能和可靠性，数十亿容量和灵活可扩展性的分布式消息传递和流媒体平台。它由四部分组成：Name Servers，brokers，producers和consumers。 它们中的每一个都可以在没有单点故障的情况下进行水平扩展。 \n\n![RocketMQ架构](http://rocketmq.apache.org/assets/images/rmq-basic-arc.png)\n\n# NameServer集群\nName Servers提供轻量级服务发现和路由。每个Name Server记录完整的路由信息，提供相应的读写服务，并支持快速存储扩展。\n\n# Broker集群\nBrokers通过提供轻量级的TOPIC和QUEUE机制来实现消息存储。 它们支持Push和Pull模式，包含容错机制（2个或3个副本），并提供强大的峰值填充和按原始时间顺序累积数千亿条消息的能力。此外，broker提供灾难恢复，丰富的指标统计数据和警报机制，而传统的消息传递系统都缺乏这些机制。\n\n# Producer集群\nProducer集群支持分布式部署。分布式producer通过多种负载均衡模式向Broker集群发送消息。发送过程支持fast failure并具有低延迟。\n\n# Consumer集群\nConsumer也支持Push和Pull模型的分布式部署。 它还支持群集消费和消息广播。 它提供了实时的消息订阅机制，可以满足大多数消费者的需求。\n\n","slug":"rocketmq-architecture","published":1,"updated":"2018-04-09T07:38:30.484Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2h0020gcoiy3zykav2","content":"<h1 id=\"概览\"><a href=\"#概览\" class=\"headerlink\" title=\"概览\"></a>概览</h1><p>Apache RocketMQ是一款具有低延迟，高性能和可靠性，数十亿容量和灵活可扩展性的分布式消息传递和流媒体平台。它由四部分组成：Name Servers，brokers，producers和consumers。 它们中的每一个都可以在没有单点故障的情况下进行水平扩展。 </p>\n<p><img src=\"http://rocketmq.apache.org/assets/images/rmq-basic-arc.png\" alt=\"RocketMQ架构\"></p>\n<h1 id=\"NameServer集群\"><a href=\"#NameServer集群\" class=\"headerlink\" title=\"NameServer集群\"></a>NameServer集群</h1><p>Name Servers提供轻量级服务发现和路由。每个Name Server记录完整的路由信息，提供相应的读写服务，并支持快速存储扩展。</p>\n<h1 id=\"Broker集群\"><a href=\"#Broker集群\" class=\"headerlink\" title=\"Broker集群\"></a>Broker集群</h1><p>Brokers通过提供轻量级的TOPIC和QUEUE机制来实现消息存储。 它们支持Push和Pull模式，包含容错机制（2个或3个副本），并提供强大的峰值填充和按原始时间顺序累积数千亿条消息的能力。此外，broker提供灾难恢复，丰富的指标统计数据和警报机制，而传统的消息传递系统都缺乏这些机制。</p>\n<h1 id=\"Producer集群\"><a href=\"#Producer集群\" class=\"headerlink\" title=\"Producer集群\"></a>Producer集群</h1><p>Producer集群支持分布式部署。分布式producer通过多种负载均衡模式向Broker集群发送消息。发送过程支持fast failure并具有低延迟。</p>\n<h1 id=\"Consumer集群\"><a href=\"#Consumer集群\" class=\"headerlink\" title=\"Consumer集群\"></a>Consumer集群</h1><p>Consumer也支持Push和Pull模型的分布式部署。 它还支持群集消费和消息广播。 它提供了实时的消息订阅机制，可以满足大多数消费者的需求。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"概览\"><a href=\"#概览\" class=\"headerlink\" title=\"概览\"></a>概览</h1><p>Apache RocketMQ是一款具有低延迟，高性能和可靠性，数十亿容量和灵活可扩展性的分布式消息传递和流媒体平台。它由四部分组成：Name Servers，brokers，producers和consumers。 它们中的每一个都可以在没有单点故障的情况下进行水平扩展。 </p>\n<p><img src=\"http://rocketmq.apache.org/assets/images/rmq-basic-arc.png\" alt=\"RocketMQ架构\"></p>\n<h1 id=\"NameServer集群\"><a href=\"#NameServer集群\" class=\"headerlink\" title=\"NameServer集群\"></a>NameServer集群</h1><p>Name Servers提供轻量级服务发现和路由。每个Name Server记录完整的路由信息，提供相应的读写服务，并支持快速存储扩展。</p>\n<h1 id=\"Broker集群\"><a href=\"#Broker集群\" class=\"headerlink\" title=\"Broker集群\"></a>Broker集群</h1><p>Brokers通过提供轻量级的TOPIC和QUEUE机制来实现消息存储。 它们支持Push和Pull模式，包含容错机制（2个或3个副本），并提供强大的峰值填充和按原始时间顺序累积数千亿条消息的能力。此外，broker提供灾难恢复，丰富的指标统计数据和警报机制，而传统的消息传递系统都缺乏这些机制。</p>\n<h1 id=\"Producer集群\"><a href=\"#Producer集群\" class=\"headerlink\" title=\"Producer集群\"></a>Producer集群</h1><p>Producer集群支持分布式部署。分布式producer通过多种负载均衡模式向Broker集群发送消息。发送过程支持fast failure并具有低延迟。</p>\n<h1 id=\"Consumer集群\"><a href=\"#Consumer集群\" class=\"headerlink\" title=\"Consumer集群\"></a>Consumer集群</h1><p>Consumer也支持Push和Pull模型的分布式部署。 它还支持群集消费和消息广播。 它提供了实时的消息订阅机制，可以满足大多数消费者的需求。</p>\n"},{"title":"spring主要组件","date":"2017-05-10T01:16:06.000Z","_content":"# Spring、Spring Cloud主要组件\n\n## spring 顶级项目：\n- Spring IO platform:用于系统部署，是可集成的，构建现代化应用的版本平台，具体来说当你使用maven dependency引入spring jar包时它就在工作了。\n- Spring Boot:旨在简化创建产品级的 Spring 应用和服务，简化了配置文件，使用嵌入式web服务器，含有诸多开箱即用微服务功能，可以和spring cloud联合部署。\n- Spring Framework:即通常所说的spring 框架，是一个开源的Java/Java EE全功能栈应用程序框架，其它spring项目如spring boot也依赖于此框架。\n- Spring Cloud：微服务工具包，为开发者提供了在分布式系统的配置管理、服务发现、断路器、智能路由、微代理、控制总线等开发工具包。\n- Spring XD：是一种运行时环境（服务器软件，非开发框架），组合spring技术，如spring batch、spring boot、spring data，采集大数据并处理。\n- Spring Data：是一个数据访问及操作的工具包，封装了很多种数据及数据库的访问相关技术，包括：jdbc、Redis、MongoDB、Neo4j等。\n- Spring Batch：批处理框架，或说是批量任务执行管理器，功能包括任务调度、日志记录/跟踪等。\n- Spring Security：是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。\n- Spring Integration：面向企业应用集成（EAI/ESB）的编程框架，支持的通信方式包括HTTP、FTP、TCP/UDP、JMS、RabbitMQ、Email等。\n- Spring Social：一组工具包，一组连接社交服务API，如Twitter、Facebook、LinkedIn、GitHub等，有几十个。\n- Spring AMQP：消息队列操作的工具包，主要是封装了RabbitMQ的操作。\n- Spring HATEOAS：是一个用于支持实现超文本驱动的 REST Web 服务的开发库。\n- Spring Mobile：是Spring MVC的扩展，用来简化手机上的Web应用开发。\n- Spring for Android：是Spring框架的一个扩展，其主要目的在乎简化Android本地应用的开发，提供RestTemplate来访问Rest服务。\n- Spring Web Flow：目标是成为管理Web应用页面流程的最佳方案，将页面跳转流程单独管理，并可配置。\n- Spring LDAP：是一个用于操作LDAP的Java工具包，基于Spring的JdbcTemplate模式，简化LDAP访问。\n- Spring Session：session管理的开发工具包，让你可以把session保存到redis等，进行集群化session管理。\n- Spring Web Services：是基于Spring的Web服务框架，提供SOAP服务开发，允许通过多种方式创建Web服务。\n- Spring Shell：提供交互式的Shell可让你使用简单的基于Spring的编程模型来开发命令，比如Spring Roo命令。\n- Spring Roo：是一种Spring开发的辅助工具，使用命令行操作来生成自动化项目，操作非常类似于Rails。\n- Spring Scala：为Scala语言编程提供的spring框架的封装（新的编程语言，Java平台的Scala于2003年底/2004年初发布）。\n- Spring BlazeDS Integration：一个开发RIA工具包，可以集成Adobe Flex、BlazeDS、Spring以及Java技术创建RIA。\n- Spring Loaded：用于实现java程序和web应用的热部署的开源工具。\n- Spring REST Shell：可以调用Rest服务的命令行工具，敲命令行操作Rest服务。\n\n\n## 目前来说spring主要集中于spring boot（用于开发微服务）和spring cloud相关框架的开发，spring cloud子项目包括：\n\n\n- Spring Cloud Config：配置管理开发工具包，可以让你把配置放到远程服务器，目前支持本地存储、Git以及Subversion。\n- Spring Cloud Bus：事件、消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与Spring Cloud Config联合实现热部署。\n- Spring Cloud Netflix：针对多种Netflix组件提供的开发工具包，其中包括Eureka、Hystrix、Zuul、Archaius等。\n- Netflix Eureka：云端负载均衡，一个基于 REST 的服务，用于定位服务，以实现云端的负载均衡和中间层服务器的故障转移。\n- Netflix Hystrix：容错管理工具，旨在通过控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。\n- Netflix Zuul：边缘服务工具，是提供动态路由，监控，弹性，安全等的边缘服务。\n- Netflix Archaius：配置管理API，包含一系列配置管理API，提供动态类型化属性、线程安全配置操作、轮询框架、回调机制等功能。\n- Spring Cloud for Cloud Foundry：通过Oauth2协议绑定服务到CloudFoundry，CloudFoundry是VMware推出的开源PaaS云平台。\n- Spring Cloud Sleuth：日志收集工具包，封装了Dapper,Zipkin和HTrace操作。\n- Spring Cloud Data Flow：大数据操作工具，通过命令行方式操作数据流。\n- Spring Cloud Security：安全工具包，为你的应用程序添加安全控制，主要是指OAuth2。\n- Spring Cloud Consul：封装了Consul操作，consul是一个服务发现与配置工具，与Docker容器可以无缝集成。\n- Spring Cloud Zookeeper：操作Zookeeper的工具包，用于使用zookeeper方式的服务注册和发现。\n- Spring Cloud Stream：数据流操作开发包，封装了与Redis,Rabbit、Kafka等发送接收消息。\n- Spring Cloud CLI：基于 Spring Boot CLI，可以让你以命令行方式快速建立云组件。","source":"_posts/spring.md","raw":"---\ntitle: spring主要组件\ndate: 2017-05-10 09:16:06\ntags: spring\n---\n# Spring、Spring Cloud主要组件\n\n## spring 顶级项目：\n- Spring IO platform:用于系统部署，是可集成的，构建现代化应用的版本平台，具体来说当你使用maven dependency引入spring jar包时它就在工作了。\n- Spring Boot:旨在简化创建产品级的 Spring 应用和服务，简化了配置文件，使用嵌入式web服务器，含有诸多开箱即用微服务功能，可以和spring cloud联合部署。\n- Spring Framework:即通常所说的spring 框架，是一个开源的Java/Java EE全功能栈应用程序框架，其它spring项目如spring boot也依赖于此框架。\n- Spring Cloud：微服务工具包，为开发者提供了在分布式系统的配置管理、服务发现、断路器、智能路由、微代理、控制总线等开发工具包。\n- Spring XD：是一种运行时环境（服务器软件，非开发框架），组合spring技术，如spring batch、spring boot、spring data，采集大数据并处理。\n- Spring Data：是一个数据访问及操作的工具包，封装了很多种数据及数据库的访问相关技术，包括：jdbc、Redis、MongoDB、Neo4j等。\n- Spring Batch：批处理框架，或说是批量任务执行管理器，功能包括任务调度、日志记录/跟踪等。\n- Spring Security：是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。\n- Spring Integration：面向企业应用集成（EAI/ESB）的编程框架，支持的通信方式包括HTTP、FTP、TCP/UDP、JMS、RabbitMQ、Email等。\n- Spring Social：一组工具包，一组连接社交服务API，如Twitter、Facebook、LinkedIn、GitHub等，有几十个。\n- Spring AMQP：消息队列操作的工具包，主要是封装了RabbitMQ的操作。\n- Spring HATEOAS：是一个用于支持实现超文本驱动的 REST Web 服务的开发库。\n- Spring Mobile：是Spring MVC的扩展，用来简化手机上的Web应用开发。\n- Spring for Android：是Spring框架的一个扩展，其主要目的在乎简化Android本地应用的开发，提供RestTemplate来访问Rest服务。\n- Spring Web Flow：目标是成为管理Web应用页面流程的最佳方案，将页面跳转流程单独管理，并可配置。\n- Spring LDAP：是一个用于操作LDAP的Java工具包，基于Spring的JdbcTemplate模式，简化LDAP访问。\n- Spring Session：session管理的开发工具包，让你可以把session保存到redis等，进行集群化session管理。\n- Spring Web Services：是基于Spring的Web服务框架，提供SOAP服务开发，允许通过多种方式创建Web服务。\n- Spring Shell：提供交互式的Shell可让你使用简单的基于Spring的编程模型来开发命令，比如Spring Roo命令。\n- Spring Roo：是一种Spring开发的辅助工具，使用命令行操作来生成自动化项目，操作非常类似于Rails。\n- Spring Scala：为Scala语言编程提供的spring框架的封装（新的编程语言，Java平台的Scala于2003年底/2004年初发布）。\n- Spring BlazeDS Integration：一个开发RIA工具包，可以集成Adobe Flex、BlazeDS、Spring以及Java技术创建RIA。\n- Spring Loaded：用于实现java程序和web应用的热部署的开源工具。\n- Spring REST Shell：可以调用Rest服务的命令行工具，敲命令行操作Rest服务。\n\n\n## 目前来说spring主要集中于spring boot（用于开发微服务）和spring cloud相关框架的开发，spring cloud子项目包括：\n\n\n- Spring Cloud Config：配置管理开发工具包，可以让你把配置放到远程服务器，目前支持本地存储、Git以及Subversion。\n- Spring Cloud Bus：事件、消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与Spring Cloud Config联合实现热部署。\n- Spring Cloud Netflix：针对多种Netflix组件提供的开发工具包，其中包括Eureka、Hystrix、Zuul、Archaius等。\n- Netflix Eureka：云端负载均衡，一个基于 REST 的服务，用于定位服务，以实现云端的负载均衡和中间层服务器的故障转移。\n- Netflix Hystrix：容错管理工具，旨在通过控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。\n- Netflix Zuul：边缘服务工具，是提供动态路由，监控，弹性，安全等的边缘服务。\n- Netflix Archaius：配置管理API，包含一系列配置管理API，提供动态类型化属性、线程安全配置操作、轮询框架、回调机制等功能。\n- Spring Cloud for Cloud Foundry：通过Oauth2协议绑定服务到CloudFoundry，CloudFoundry是VMware推出的开源PaaS云平台。\n- Spring Cloud Sleuth：日志收集工具包，封装了Dapper,Zipkin和HTrace操作。\n- Spring Cloud Data Flow：大数据操作工具，通过命令行方式操作数据流。\n- Spring Cloud Security：安全工具包，为你的应用程序添加安全控制，主要是指OAuth2。\n- Spring Cloud Consul：封装了Consul操作，consul是一个服务发现与配置工具，与Docker容器可以无缝集成。\n- Spring Cloud Zookeeper：操作Zookeeper的工具包，用于使用zookeeper方式的服务注册和发现。\n- Spring Cloud Stream：数据流操作开发包，封装了与Redis,Rabbit、Kafka等发送接收消息。\n- Spring Cloud CLI：基于 Spring Boot CLI，可以让你以命令行方式快速建立云组件。","slug":"spring","published":1,"updated":"2018-01-16T06:08:44.660Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2i0022gcoiehrbeye4","content":"<h1 id=\"Spring、Spring-Cloud主要组件\"><a href=\"#Spring、Spring-Cloud主要组件\" class=\"headerlink\" title=\"Spring、Spring Cloud主要组件\"></a>Spring、Spring Cloud主要组件</h1><h2 id=\"spring-顶级项目：\"><a href=\"#spring-顶级项目：\" class=\"headerlink\" title=\"spring 顶级项目：\"></a>spring 顶级项目：</h2><ul>\n<li>Spring IO platform:用于系统部署，是可集成的，构建现代化应用的版本平台，具体来说当你使用maven dependency引入spring jar包时它就在工作了。</li>\n<li>Spring Boot:旨在简化创建产品级的 Spring 应用和服务，简化了配置文件，使用嵌入式web服务器，含有诸多开箱即用微服务功能，可以和spring cloud联合部署。</li>\n<li>Spring Framework:即通常所说的spring 框架，是一个开源的Java/Java EE全功能栈应用程序框架，其它spring项目如spring boot也依赖于此框架。</li>\n<li>Spring Cloud：微服务工具包，为开发者提供了在分布式系统的配置管理、服务发现、断路器、智能路由、微代理、控制总线等开发工具包。</li>\n<li>Spring XD：是一种运行时环境（服务器软件，非开发框架），组合spring技术，如spring batch、spring boot、spring data，采集大数据并处理。</li>\n<li>Spring Data：是一个数据访问及操作的工具包，封装了很多种数据及数据库的访问相关技术，包括：jdbc、Redis、MongoDB、Neo4j等。</li>\n<li>Spring Batch：批处理框架，或说是批量任务执行管理器，功能包括任务调度、日志记录/跟踪等。</li>\n<li>Spring Security：是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。</li>\n<li>Spring Integration：面向企业应用集成（EAI/ESB）的编程框架，支持的通信方式包括HTTP、FTP、TCP/UDP、JMS、RabbitMQ、Email等。</li>\n<li>Spring Social：一组工具包，一组连接社交服务API，如Twitter、Facebook、LinkedIn、GitHub等，有几十个。</li>\n<li>Spring AMQP：消息队列操作的工具包，主要是封装了RabbitMQ的操作。</li>\n<li>Spring HATEOAS：是一个用于支持实现超文本驱动的 REST Web 服务的开发库。</li>\n<li>Spring Mobile：是Spring MVC的扩展，用来简化手机上的Web应用开发。</li>\n<li>Spring for Android：是Spring框架的一个扩展，其主要目的在乎简化Android本地应用的开发，提供RestTemplate来访问Rest服务。</li>\n<li>Spring Web Flow：目标是成为管理Web应用页面流程的最佳方案，将页面跳转流程单独管理，并可配置。</li>\n<li>Spring LDAP：是一个用于操作LDAP的Java工具包，基于Spring的JdbcTemplate模式，简化LDAP访问。</li>\n<li>Spring Session：session管理的开发工具包，让你可以把session保存到redis等，进行集群化session管理。</li>\n<li>Spring Web Services：是基于Spring的Web服务框架，提供SOAP服务开发，允许通过多种方式创建Web服务。</li>\n<li>Spring Shell：提供交互式的Shell可让你使用简单的基于Spring的编程模型来开发命令，比如Spring Roo命令。</li>\n<li>Spring Roo：是一种Spring开发的辅助工具，使用命令行操作来生成自动化项目，操作非常类似于Rails。</li>\n<li>Spring Scala：为Scala语言编程提供的spring框架的封装（新的编程语言，Java平台的Scala于2003年底/2004年初发布）。</li>\n<li>Spring BlazeDS Integration：一个开发RIA工具包，可以集成Adobe Flex、BlazeDS、Spring以及Java技术创建RIA。</li>\n<li>Spring Loaded：用于实现java程序和web应用的热部署的开源工具。</li>\n<li>Spring REST Shell：可以调用Rest服务的命令行工具，敲命令行操作Rest服务。</li>\n</ul>\n<h2 id=\"目前来说spring主要集中于spring-boot（用于开发微服务）和spring-cloud相关框架的开发，spring-cloud子项目包括：\"><a href=\"#目前来说spring主要集中于spring-boot（用于开发微服务）和spring-cloud相关框架的开发，spring-cloud子项目包括：\" class=\"headerlink\" title=\"目前来说spring主要集中于spring boot（用于开发微服务）和spring cloud相关框架的开发，spring cloud子项目包括：\"></a>目前来说spring主要集中于spring boot（用于开发微服务）和spring cloud相关框架的开发，spring cloud子项目包括：</h2><ul>\n<li>Spring Cloud Config：配置管理开发工具包，可以让你把配置放到远程服务器，目前支持本地存储、Git以及Subversion。</li>\n<li>Spring Cloud Bus：事件、消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与Spring Cloud Config联合实现热部署。</li>\n<li>Spring Cloud Netflix：针对多种Netflix组件提供的开发工具包，其中包括Eureka、Hystrix、Zuul、Archaius等。</li>\n<li>Netflix Eureka：云端负载均衡，一个基于 REST 的服务，用于定位服务，以实现云端的负载均衡和中间层服务器的故障转移。</li>\n<li>Netflix Hystrix：容错管理工具，旨在通过控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。</li>\n<li>Netflix Zuul：边缘服务工具，是提供动态路由，监控，弹性，安全等的边缘服务。</li>\n<li>Netflix Archaius：配置管理API，包含一系列配置管理API，提供动态类型化属性、线程安全配置操作、轮询框架、回调机制等功能。</li>\n<li>Spring Cloud for Cloud Foundry：通过Oauth2协议绑定服务到CloudFoundry，CloudFoundry是VMware推出的开源PaaS云平台。</li>\n<li>Spring Cloud Sleuth：日志收集工具包，封装了Dapper,Zipkin和HTrace操作。</li>\n<li>Spring Cloud Data Flow：大数据操作工具，通过命令行方式操作数据流。</li>\n<li>Spring Cloud Security：安全工具包，为你的应用程序添加安全控制，主要是指OAuth2。</li>\n<li>Spring Cloud Consul：封装了Consul操作，consul是一个服务发现与配置工具，与Docker容器可以无缝集成。</li>\n<li>Spring Cloud Zookeeper：操作Zookeeper的工具包，用于使用zookeeper方式的服务注册和发现。</li>\n<li>Spring Cloud Stream：数据流操作开发包，封装了与Redis,Rabbit、Kafka等发送接收消息。</li>\n<li>Spring Cloud CLI：基于 Spring Boot CLI，可以让你以命令行方式快速建立云组件。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Spring、Spring-Cloud主要组件\"><a href=\"#Spring、Spring-Cloud主要组件\" class=\"headerlink\" title=\"Spring、Spring Cloud主要组件\"></a>Spring、Spring Cloud主要组件</h1><h2 id=\"spring-顶级项目：\"><a href=\"#spring-顶级项目：\" class=\"headerlink\" title=\"spring 顶级项目：\"></a>spring 顶级项目：</h2><ul>\n<li>Spring IO platform:用于系统部署，是可集成的，构建现代化应用的版本平台，具体来说当你使用maven dependency引入spring jar包时它就在工作了。</li>\n<li>Spring Boot:旨在简化创建产品级的 Spring 应用和服务，简化了配置文件，使用嵌入式web服务器，含有诸多开箱即用微服务功能，可以和spring cloud联合部署。</li>\n<li>Spring Framework:即通常所说的spring 框架，是一个开源的Java/Java EE全功能栈应用程序框架，其它spring项目如spring boot也依赖于此框架。</li>\n<li>Spring Cloud：微服务工具包，为开发者提供了在分布式系统的配置管理、服务发现、断路器、智能路由、微代理、控制总线等开发工具包。</li>\n<li>Spring XD：是一种运行时环境（服务器软件，非开发框架），组合spring技术，如spring batch、spring boot、spring data，采集大数据并处理。</li>\n<li>Spring Data：是一个数据访问及操作的工具包，封装了很多种数据及数据库的访问相关技术，包括：jdbc、Redis、MongoDB、Neo4j等。</li>\n<li>Spring Batch：批处理框架，或说是批量任务执行管理器，功能包括任务调度、日志记录/跟踪等。</li>\n<li>Spring Security：是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。</li>\n<li>Spring Integration：面向企业应用集成（EAI/ESB）的编程框架，支持的通信方式包括HTTP、FTP、TCP/UDP、JMS、RabbitMQ、Email等。</li>\n<li>Spring Social：一组工具包，一组连接社交服务API，如Twitter、Facebook、LinkedIn、GitHub等，有几十个。</li>\n<li>Spring AMQP：消息队列操作的工具包，主要是封装了RabbitMQ的操作。</li>\n<li>Spring HATEOAS：是一个用于支持实现超文本驱动的 REST Web 服务的开发库。</li>\n<li>Spring Mobile：是Spring MVC的扩展，用来简化手机上的Web应用开发。</li>\n<li>Spring for Android：是Spring框架的一个扩展，其主要目的在乎简化Android本地应用的开发，提供RestTemplate来访问Rest服务。</li>\n<li>Spring Web Flow：目标是成为管理Web应用页面流程的最佳方案，将页面跳转流程单独管理，并可配置。</li>\n<li>Spring LDAP：是一个用于操作LDAP的Java工具包，基于Spring的JdbcTemplate模式，简化LDAP访问。</li>\n<li>Spring Session：session管理的开发工具包，让你可以把session保存到redis等，进行集群化session管理。</li>\n<li>Spring Web Services：是基于Spring的Web服务框架，提供SOAP服务开发，允许通过多种方式创建Web服务。</li>\n<li>Spring Shell：提供交互式的Shell可让你使用简单的基于Spring的编程模型来开发命令，比如Spring Roo命令。</li>\n<li>Spring Roo：是一种Spring开发的辅助工具，使用命令行操作来生成自动化项目，操作非常类似于Rails。</li>\n<li>Spring Scala：为Scala语言编程提供的spring框架的封装（新的编程语言，Java平台的Scala于2003年底/2004年初发布）。</li>\n<li>Spring BlazeDS Integration：一个开发RIA工具包，可以集成Adobe Flex、BlazeDS、Spring以及Java技术创建RIA。</li>\n<li>Spring Loaded：用于实现java程序和web应用的热部署的开源工具。</li>\n<li>Spring REST Shell：可以调用Rest服务的命令行工具，敲命令行操作Rest服务。</li>\n</ul>\n<h2 id=\"目前来说spring主要集中于spring-boot（用于开发微服务）和spring-cloud相关框架的开发，spring-cloud子项目包括：\"><a href=\"#目前来说spring主要集中于spring-boot（用于开发微服务）和spring-cloud相关框架的开发，spring-cloud子项目包括：\" class=\"headerlink\" title=\"目前来说spring主要集中于spring boot（用于开发微服务）和spring cloud相关框架的开发，spring cloud子项目包括：\"></a>目前来说spring主要集中于spring boot（用于开发微服务）和spring cloud相关框架的开发，spring cloud子项目包括：</h2><ul>\n<li>Spring Cloud Config：配置管理开发工具包，可以让你把配置放到远程服务器，目前支持本地存储、Git以及Subversion。</li>\n<li>Spring Cloud Bus：事件、消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与Spring Cloud Config联合实现热部署。</li>\n<li>Spring Cloud Netflix：针对多种Netflix组件提供的开发工具包，其中包括Eureka、Hystrix、Zuul、Archaius等。</li>\n<li>Netflix Eureka：云端负载均衡，一个基于 REST 的服务，用于定位服务，以实现云端的负载均衡和中间层服务器的故障转移。</li>\n<li>Netflix Hystrix：容错管理工具，旨在通过控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。</li>\n<li>Netflix Zuul：边缘服务工具，是提供动态路由，监控，弹性，安全等的边缘服务。</li>\n<li>Netflix Archaius：配置管理API，包含一系列配置管理API，提供动态类型化属性、线程安全配置操作、轮询框架、回调机制等功能。</li>\n<li>Spring Cloud for Cloud Foundry：通过Oauth2协议绑定服务到CloudFoundry，CloudFoundry是VMware推出的开源PaaS云平台。</li>\n<li>Spring Cloud Sleuth：日志收集工具包，封装了Dapper,Zipkin和HTrace操作。</li>\n<li>Spring Cloud Data Flow：大数据操作工具，通过命令行方式操作数据流。</li>\n<li>Spring Cloud Security：安全工具包，为你的应用程序添加安全控制，主要是指OAuth2。</li>\n<li>Spring Cloud Consul：封装了Consul操作，consul是一个服务发现与配置工具，与Docker容器可以无缝集成。</li>\n<li>Spring Cloud Zookeeper：操作Zookeeper的工具包，用于使用zookeeper方式的服务注册和发现。</li>\n<li>Spring Cloud Stream：数据流操作开发包，封装了与Redis,Rabbit、Kafka等发送接收消息。</li>\n<li>Spring Cloud CLI：基于 Spring Boot CLI，可以让你以命令行方式快速建立云组件。</li>\n</ul>\n"},{"title":"Squid 代理服务器配置","date":"2017-04-21T03:10:50.000Z","_content":"## 安装\n\n```shell\nyum -y install squid\n```\n\n\n安装`Mysql`\n\n\n\n```\nyum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker -y\n```\n\n\n\n安装`DBI-1.636.tar.gz` \n\n```\nwget http://search.cpan.org/CPAN/authors/id/T/TI/TIMB/DBI-1.636.tar.gz\ntar -xvf DBI-1.636.tar.gz \n\ncd DBI-1.636\n\nmake \nmake install\n```\n\n\n安装 `DBD-mysql-4.039.tar.gz` 时，需要设置\n```\nwget http://www.cpan.org/authors/id/C/CA/CAPTTOFU/DBD-mysql-4.039.tar.gz\ntar -xvf DBD-mysql-4.039.tar.gz \n\ncd DBD-mysql-4.039\n\nperl Makefile.PL --mysql_config=/usr/bin/mysql_config\nmake\nmake install\n```\n\n\n\n\n\n*配置文件 `squid.conf`*\n```\n#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd\nauth_param basic program /usr/lib64/squid/basic_db_auth --user root --password mysql2016 --plaintext --persist\nauth_param basic children 5\nauth_param basic realm Squid proxy-caching web server\nauth_param basic credentialsttl 2 hours\nacl normal proxy_auth REQUIRED\nhttp_access allow normal\n\n#\n# Recommended minimum configuration:\n#\n\n# Example rule allowing access from your local networks.\n# Adapt to list your (internal) IP networks from where browsing\n# should be allowed\nacl localnet src 10.0.0.0/8     # RFC1918 possible internal network\nacl localnet src 172.16.0.0/12  # RFC1918 possible internal network\nacl localnet src 192.168.0.0/16 # RFC1918 possible internal network\nacl localnet src fc00::/7       # RFC 4193 local private network range\nacl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines\n\nacl SSL_ports port 443\nacl Safe_ports port 80          # http\nacl Safe_ports port 21          # ftp\nacl Safe_ports port 443         # https\nacl Safe_ports port 70          # gopher\nacl Safe_ports port 210         # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280         # http-mgmt\nacl Safe_ports port 488         # gss-http\nacl Safe_ports port 591         # filemaker\nacl Safe_ports port 777         # multiling http\nacl CONNECT method CONNECT\n\n\n#\n# Recommended minimum Access Permission configuration:\n#\n# Deny requests to certain unsafe ports\nhttp_access deny !Safe_ports\n\n# Deny CONNECT to other than secure SSL ports\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\nhttp_access deny manager\n\n# We strongly recommend the following be uncommented to protect innocent\n# web applications running on the proxy server who think the only\n# one who can access services on \"localhost\" is a local user\n#http_access deny to_localhost\n\n#\n# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS\n#\n\n# Example rule allowing access from your local networks.\n# Adapt localnet in the ACL section to list your (internal) IP networks\n# from where browsing should be allowed\nhttp_access allow localnet\nhttp_access allow localhost\n\n# And finally deny all other access to this proxy\nhttp_access allow all\n\n# Squid normally listens to port 3128\nhttp_port 3128\n\n# Uncomment and adjust the following to add a disk cache directory.\n                                          \n# Uncomment and adjust the following to add a disk cache directory.\n#cache_dir ufs /var/spool/squid 100 16 256\n\n# Leave coredumps in the first cache dir\ncoredump_dir /var/spool/squid\n\n#\n# Add any of your own refresh_pattern entries above these.\n#\nrefresh_pattern ^ftp:           1440    20%     10080\nrefresh_pattern ^gopher:        1440    0%      1440\nrefresh_pattern -i (/cgi-bin/|\\?) 0     0%      0\nrefresh_pattern .               0       20%     4320\n\n#auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd\n#auth_param basic children 5        \n#auth_param basic credentialsttl 1 hours    \n#auth_param basic realm my test prosy         \n#acl test123 proxy_auth REQUIRED  \n#http_access allow test123    \n\n#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd \n#auth_param basic children 5\n#auth_param basic realm Squid proxy-caching web server\n#auth_param basic credentialsttl 2 hours\n#acl normal proxy_auth REQUIRED\n#http_access allow normal                                      \n```\n","source":"_posts/squid.md","raw":"---\ntitle: Squid 代理服务器配置\ndate: 2017-04-21 11:10:50\ntags:\n---\n## 安装\n\n```shell\nyum -y install squid\n```\n\n\n安装`Mysql`\n\n\n\n```\nyum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker -y\n```\n\n\n\n安装`DBI-1.636.tar.gz` \n\n```\nwget http://search.cpan.org/CPAN/authors/id/T/TI/TIMB/DBI-1.636.tar.gz\ntar -xvf DBI-1.636.tar.gz \n\ncd DBI-1.636\n\nmake \nmake install\n```\n\n\n安装 `DBD-mysql-4.039.tar.gz` 时，需要设置\n```\nwget http://www.cpan.org/authors/id/C/CA/CAPTTOFU/DBD-mysql-4.039.tar.gz\ntar -xvf DBD-mysql-4.039.tar.gz \n\ncd DBD-mysql-4.039\n\nperl Makefile.PL --mysql_config=/usr/bin/mysql_config\nmake\nmake install\n```\n\n\n\n\n\n*配置文件 `squid.conf`*\n```\n#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd\nauth_param basic program /usr/lib64/squid/basic_db_auth --user root --password mysql2016 --plaintext --persist\nauth_param basic children 5\nauth_param basic realm Squid proxy-caching web server\nauth_param basic credentialsttl 2 hours\nacl normal proxy_auth REQUIRED\nhttp_access allow normal\n\n#\n# Recommended minimum configuration:\n#\n\n# Example rule allowing access from your local networks.\n# Adapt to list your (internal) IP networks from where browsing\n# should be allowed\nacl localnet src 10.0.0.0/8     # RFC1918 possible internal network\nacl localnet src 172.16.0.0/12  # RFC1918 possible internal network\nacl localnet src 192.168.0.0/16 # RFC1918 possible internal network\nacl localnet src fc00::/7       # RFC 4193 local private network range\nacl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines\n\nacl SSL_ports port 443\nacl Safe_ports port 80          # http\nacl Safe_ports port 21          # ftp\nacl Safe_ports port 443         # https\nacl Safe_ports port 70          # gopher\nacl Safe_ports port 210         # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280         # http-mgmt\nacl Safe_ports port 488         # gss-http\nacl Safe_ports port 591         # filemaker\nacl Safe_ports port 777         # multiling http\nacl CONNECT method CONNECT\n\n\n#\n# Recommended minimum Access Permission configuration:\n#\n# Deny requests to certain unsafe ports\nhttp_access deny !Safe_ports\n\n# Deny CONNECT to other than secure SSL ports\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\nhttp_access deny manager\n\n# We strongly recommend the following be uncommented to protect innocent\n# web applications running on the proxy server who think the only\n# one who can access services on \"localhost\" is a local user\n#http_access deny to_localhost\n\n#\n# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS\n#\n\n# Example rule allowing access from your local networks.\n# Adapt localnet in the ACL section to list your (internal) IP networks\n# from where browsing should be allowed\nhttp_access allow localnet\nhttp_access allow localhost\n\n# And finally deny all other access to this proxy\nhttp_access allow all\n\n# Squid normally listens to port 3128\nhttp_port 3128\n\n# Uncomment and adjust the following to add a disk cache directory.\n                                          \n# Uncomment and adjust the following to add a disk cache directory.\n#cache_dir ufs /var/spool/squid 100 16 256\n\n# Leave coredumps in the first cache dir\ncoredump_dir /var/spool/squid\n\n#\n# Add any of your own refresh_pattern entries above these.\n#\nrefresh_pattern ^ftp:           1440    20%     10080\nrefresh_pattern ^gopher:        1440    0%      1440\nrefresh_pattern -i (/cgi-bin/|\\?) 0     0%      0\nrefresh_pattern .               0       20%     4320\n\n#auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd\n#auth_param basic children 5        \n#auth_param basic credentialsttl 1 hours    \n#auth_param basic realm my test prosy         \n#acl test123 proxy_auth REQUIRED  \n#http_access allow test123    \n\n#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd \n#auth_param basic children 5\n#auth_param basic realm Squid proxy-caching web server\n#auth_param basic credentialsttl 2 hours\n#acl normal proxy_auth REQUIRED\n#http_access allow normal                                      \n```\n","slug":"squid","published":1,"updated":"2018-01-26T03:37:13.908Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2j0023gcoi0rzntssp","content":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install squid</span><br></pre></td></tr></table></figure>\n<p>安装<code>Mysql</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker -y</span><br></pre></td></tr></table></figure>\n<p>安装<code>DBI-1.636.tar.gz</code> </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://search.cpan.org/CPAN/authors/id/T/TI/TIMB/DBI-1.636.tar.gz</span><br><span class=\"line\">tar -xvf DBI-1.636.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">cd DBI-1.636</span><br><span class=\"line\"></span><br><span class=\"line\">make </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p>安装 <code>DBD-mysql-4.039.tar.gz</code> 时，需要设置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://www.cpan.org/authors/id/C/CA/CAPTTOFU/DBD-mysql-4.039.tar.gz</span><br><span class=\"line\">tar -xvf DBD-mysql-4.039.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">cd DBD-mysql-4.039</span><br><span class=\"line\"></span><br><span class=\"line\">perl Makefile.PL --mysql_config=/usr/bin/mysql_config</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure></p>\n<p><em>配置文件 <code>squid.conf</code></em><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd</span><br><span class=\"line\">auth_param basic program /usr/lib64/squid/basic_db_auth --user root --password mysql2016 --plaintext --persist</span><br><span class=\"line\">auth_param basic children 5</span><br><span class=\"line\">auth_param basic realm Squid proxy-caching web server</span><br><span class=\"line\">auth_param basic credentialsttl 2 hours</span><br><span class=\"line\">acl normal proxy_auth REQUIRED</span><br><span class=\"line\">http_access allow normal</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># Recommended minimum configuration:</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Example rule allowing access from your local networks.</span><br><span class=\"line\"># Adapt to list your (internal) IP networks from where browsing</span><br><span class=\"line\"># should be allowed</span><br><span class=\"line\">acl localnet src 10.0.0.0/8     # RFC1918 possible internal network</span><br><span class=\"line\">acl localnet src 172.16.0.0/12  # RFC1918 possible internal network</span><br><span class=\"line\">acl localnet src 192.168.0.0/16 # RFC1918 possible internal network</span><br><span class=\"line\">acl localnet src fc00::/7       # RFC 4193 local private network range</span><br><span class=\"line\">acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines</span><br><span class=\"line\"></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80          # http</span><br><span class=\"line\">acl Safe_ports port 21          # ftp</span><br><span class=\"line\">acl Safe_ports port 443         # https</span><br><span class=\"line\">acl Safe_ports port 70          # gopher</span><br><span class=\"line\">acl Safe_ports port 210         # wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280         # http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488         # gss-http</span><br><span class=\"line\">acl Safe_ports port 591         # filemaker</span><br><span class=\"line\">acl Safe_ports port 777         # multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># Recommended minimum Access Permission configuration:</span><br><span class=\"line\">#</span><br><span class=\"line\"># Deny requests to certain unsafe ports</span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"></span><br><span class=\"line\"># Deny CONNECT to other than secure SSL ports</span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"># Only allow cachemgr access from localhost</span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\">http_access deny manager</span><br><span class=\"line\"></span><br><span class=\"line\"># We strongly recommend the following be uncommented to protect innocent</span><br><span class=\"line\"># web applications running on the proxy server who think the only</span><br><span class=\"line\"># one who can access services on &quot;localhost&quot; is a local user</span><br><span class=\"line\">#http_access deny to_localhost</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Example rule allowing access from your local networks.</span><br><span class=\"line\"># Adapt localnet in the ACL section to list your (internal) IP networks</span><br><span class=\"line\"># from where browsing should be allowed</span><br><span class=\"line\">http_access allow localnet</span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"># And finally deny all other access to this proxy</span><br><span class=\"line\">http_access allow all</span><br><span class=\"line\"></span><br><span class=\"line\"># Squid normally listens to port 3128</span><br><span class=\"line\">http_port 3128</span><br><span class=\"line\"></span><br><span class=\"line\"># Uncomment and adjust the following to add a disk cache directory.</span><br><span class=\"line\">                                          </span><br><span class=\"line\"># Uncomment and adjust the following to add a disk cache directory.</span><br><span class=\"line\">#cache_dir ufs /var/spool/squid 100 16 256</span><br><span class=\"line\"></span><br><span class=\"line\"># Leave coredumps in the first cache dir</span><br><span class=\"line\">coredump_dir /var/spool/squid</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># Add any of your own refresh_pattern entries above these.</span><br><span class=\"line\">#</span><br><span class=\"line\">refresh_pattern ^ftp:           1440    20%     10080</span><br><span class=\"line\">refresh_pattern ^gopher:        1440    0%      1440</span><br><span class=\"line\">refresh_pattern -i (/cgi-bin/|\\?) 0     0%      0</span><br><span class=\"line\">refresh_pattern .               0       20%     4320</span><br><span class=\"line\"></span><br><span class=\"line\">#auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class=\"line\">#auth_param basic children 5        </span><br><span class=\"line\">#auth_param basic credentialsttl 1 hours    </span><br><span class=\"line\">#auth_param basic realm my test prosy         </span><br><span class=\"line\">#acl test123 proxy_auth REQUIRED  </span><br><span class=\"line\">#http_access allow test123    </span><br><span class=\"line\"></span><br><span class=\"line\">#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd </span><br><span class=\"line\">#auth_param basic children 5</span><br><span class=\"line\">#auth_param basic realm Squid proxy-caching web server</span><br><span class=\"line\">#auth_param basic credentialsttl 2 hours</span><br><span class=\"line\">#acl normal proxy_auth REQUIRED</span><br><span class=\"line\">#http_access allow normal</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install squid</span><br></pre></td></tr></table></figure>\n<p>安装<code>Mysql</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker -y</span><br></pre></td></tr></table></figure>\n<p>安装<code>DBI-1.636.tar.gz</code> </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://search.cpan.org/CPAN/authors/id/T/TI/TIMB/DBI-1.636.tar.gz</span><br><span class=\"line\">tar -xvf DBI-1.636.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">cd DBI-1.636</span><br><span class=\"line\"></span><br><span class=\"line\">make </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p>安装 <code>DBD-mysql-4.039.tar.gz</code> 时，需要设置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://www.cpan.org/authors/id/C/CA/CAPTTOFU/DBD-mysql-4.039.tar.gz</span><br><span class=\"line\">tar -xvf DBD-mysql-4.039.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">cd DBD-mysql-4.039</span><br><span class=\"line\"></span><br><span class=\"line\">perl Makefile.PL --mysql_config=/usr/bin/mysql_config</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure></p>\n<p><em>配置文件 <code>squid.conf</code></em><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd</span><br><span class=\"line\">auth_param basic program /usr/lib64/squid/basic_db_auth --user root --password mysql2016 --plaintext --persist</span><br><span class=\"line\">auth_param basic children 5</span><br><span class=\"line\">auth_param basic realm Squid proxy-caching web server</span><br><span class=\"line\">auth_param basic credentialsttl 2 hours</span><br><span class=\"line\">acl normal proxy_auth REQUIRED</span><br><span class=\"line\">http_access allow normal</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># Recommended minimum configuration:</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Example rule allowing access from your local networks.</span><br><span class=\"line\"># Adapt to list your (internal) IP networks from where browsing</span><br><span class=\"line\"># should be allowed</span><br><span class=\"line\">acl localnet src 10.0.0.0/8     # RFC1918 possible internal network</span><br><span class=\"line\">acl localnet src 172.16.0.0/12  # RFC1918 possible internal network</span><br><span class=\"line\">acl localnet src 192.168.0.0/16 # RFC1918 possible internal network</span><br><span class=\"line\">acl localnet src fc00::/7       # RFC 4193 local private network range</span><br><span class=\"line\">acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines</span><br><span class=\"line\"></span><br><span class=\"line\">acl SSL_ports port 443</span><br><span class=\"line\">acl Safe_ports port 80          # http</span><br><span class=\"line\">acl Safe_ports port 21          # ftp</span><br><span class=\"line\">acl Safe_ports port 443         # https</span><br><span class=\"line\">acl Safe_ports port 70          # gopher</span><br><span class=\"line\">acl Safe_ports port 210         # wais</span><br><span class=\"line\">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class=\"line\">acl Safe_ports port 280         # http-mgmt</span><br><span class=\"line\">acl Safe_ports port 488         # gss-http</span><br><span class=\"line\">acl Safe_ports port 591         # filemaker</span><br><span class=\"line\">acl Safe_ports port 777         # multiling http</span><br><span class=\"line\">acl CONNECT method CONNECT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># Recommended minimum Access Permission configuration:</span><br><span class=\"line\">#</span><br><span class=\"line\"># Deny requests to certain unsafe ports</span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\"></span><br><span class=\"line\"># Deny CONNECT to other than secure SSL ports</span><br><span class=\"line\">http_access deny CONNECT !SSL_ports</span><br><span class=\"line\"></span><br><span class=\"line\"># Only allow cachemgr access from localhost</span><br><span class=\"line\">http_access allow localhost manager</span><br><span class=\"line\">http_access deny manager</span><br><span class=\"line\"></span><br><span class=\"line\"># We strongly recommend the following be uncommented to protect innocent</span><br><span class=\"line\"># web applications running on the proxy server who think the only</span><br><span class=\"line\"># one who can access services on &quot;localhost&quot; is a local user</span><br><span class=\"line\">#http_access deny to_localhost</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Example rule allowing access from your local networks.</span><br><span class=\"line\"># Adapt localnet in the ACL section to list your (internal) IP networks</span><br><span class=\"line\"># from where browsing should be allowed</span><br><span class=\"line\">http_access allow localnet</span><br><span class=\"line\">http_access allow localhost</span><br><span class=\"line\"></span><br><span class=\"line\"># And finally deny all other access to this proxy</span><br><span class=\"line\">http_access allow all</span><br><span class=\"line\"></span><br><span class=\"line\"># Squid normally listens to port 3128</span><br><span class=\"line\">http_port 3128</span><br><span class=\"line\"></span><br><span class=\"line\"># Uncomment and adjust the following to add a disk cache directory.</span><br><span class=\"line\">                                          </span><br><span class=\"line\"># Uncomment and adjust the following to add a disk cache directory.</span><br><span class=\"line\">#cache_dir ufs /var/spool/squid 100 16 256</span><br><span class=\"line\"></span><br><span class=\"line\"># Leave coredumps in the first cache dir</span><br><span class=\"line\">coredump_dir /var/spool/squid</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># Add any of your own refresh_pattern entries above these.</span><br><span class=\"line\">#</span><br><span class=\"line\">refresh_pattern ^ftp:           1440    20%     10080</span><br><span class=\"line\">refresh_pattern ^gopher:        1440    0%      1440</span><br><span class=\"line\">refresh_pattern -i (/cgi-bin/|\\?) 0     0%      0</span><br><span class=\"line\">refresh_pattern .               0       20%     4320</span><br><span class=\"line\"></span><br><span class=\"line\">#auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class=\"line\">#auth_param basic children 5        </span><br><span class=\"line\">#auth_param basic credentialsttl 1 hours    </span><br><span class=\"line\">#auth_param basic realm my test prosy         </span><br><span class=\"line\">#acl test123 proxy_auth REQUIRED  </span><br><span class=\"line\">#http_access allow test123    </span><br><span class=\"line\"></span><br><span class=\"line\">#auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd </span><br><span class=\"line\">#auth_param basic children 5</span><br><span class=\"line\">#auth_param basic realm Squid proxy-caching web server</span><br><span class=\"line\">#auth_param basic credentialsttl 2 hours</span><br><span class=\"line\">#acl normal proxy_auth REQUIRED</span><br><span class=\"line\">#http_access allow normal</span><br></pre></td></tr></table></figure></p>\n"},{"title":"Bootstrap模态框使WebUploader点击失效问题解决","date":"2017-04-21T05:10:50.000Z","_content":"\n在使用Bootstrap模态框页面上使用上传组件WebUploader，发现点击失效。\n\n解决方法：\n\n```javascript\nvar uploader;\n//在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题\n$(\"#myModal\").on(\"shown.bs.modal\",function(){\n    uploader = WebUploader.create({\n        swf : '/web/public/Uploader.swf',\n        server : $(\"#jumicontextPath\").val()+'/common/file/upload',// 后台路径\n        pick : '#filePicker', // 选择文件的按钮。可选。内部根据当前运行是创建，可能是input元素，也可能是flash.\n        resize : false,// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！\n        chunked : true, // 是否分片\n        duplicate:true,//去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n        chunkSize : 52428 * 100, // 分片大小， 5M\n        /*    fileSingleSizeLimit:100*1024,//文件大小限制*/\n        auto : true,\n        // 只允许选择图片文件。\n        accept: {\n            title: 'Images',\n            extensions: 'gif,jpg,jpeg,bmp,png',\n            mimeTypes: 'image/jpg,image/jpeg,image/png'\n        }\n    });\n\n    // 文件上传成功，给item添加成功class, 用样式标记上传成功。\n    uploader.on('uploadSuccess', function (file,response) {\n        var fileUrl = response.data.fileUrl;\n        //TODO\n        $(\"#responeseText\").text(\"上传成功,文件名：\"+response.data.fileName);\n    });\n\n    // 当文件上传出错时触发\n    uploader.on('uploadError', function (file) {\n        $(\"#responeseText\").text(\"上传失败\");\n    });\n\n    //当validate不通过时触发\n    uploader.on('error', function (type) {\n        if(type==\"F_EXCEED_SIZE\"){\n            alert(\"文件大小不能超过xxx KB!\");\n        }\n    });\n});\n```\n\n单单这样也会有问题，这样每次弹出模态框之后都加载一个边框，使按钮越来越大，所以需要在关闭模态框后销毁webuploader\n\n\n```javascript\n//关闭模态框销毁WebUploader，解决再次打开模态框时按钮越变越大问题\n$('#myModal').on('hide.bs.modal', function () {\n    $(\"#responeseText\").text(\"\");\n    uploader.destroy();\n});\n```\n\n\n-----\n\n        事件\t| 描述\n        ---     | ---\nshow.bs.modal\t| 在调用 show 方法后触发。\nshown.bs.modal\t| 当模态框对用户可见时触发（将等待 CSS 过渡效果完成）。\nhide.bs.modal\t| 当调用 hide 实例方法时触发。\nhidden.bs.modal\t| 当模态框完全对用户隐藏时触发。\n\n","source":"_posts/webupload.md","raw":"---\ntitle: Bootstrap模态框使WebUploader点击失效问题解决\ndate: 2017-04-21 13:10:50\ntags: [bootstrap, webuploader]\n---\n\n在使用Bootstrap模态框页面上使用上传组件WebUploader，发现点击失效。\n\n解决方法：\n\n```javascript\nvar uploader;\n//在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题\n$(\"#myModal\").on(\"shown.bs.modal\",function(){\n    uploader = WebUploader.create({\n        swf : '/web/public/Uploader.swf',\n        server : $(\"#jumicontextPath\").val()+'/common/file/upload',// 后台路径\n        pick : '#filePicker', // 选择文件的按钮。可选。内部根据当前运行是创建，可能是input元素，也可能是flash.\n        resize : false,// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！\n        chunked : true, // 是否分片\n        duplicate:true,//去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n        chunkSize : 52428 * 100, // 分片大小， 5M\n        /*    fileSingleSizeLimit:100*1024,//文件大小限制*/\n        auto : true,\n        // 只允许选择图片文件。\n        accept: {\n            title: 'Images',\n            extensions: 'gif,jpg,jpeg,bmp,png',\n            mimeTypes: 'image/jpg,image/jpeg,image/png'\n        }\n    });\n\n    // 文件上传成功，给item添加成功class, 用样式标记上传成功。\n    uploader.on('uploadSuccess', function (file,response) {\n        var fileUrl = response.data.fileUrl;\n        //TODO\n        $(\"#responeseText\").text(\"上传成功,文件名：\"+response.data.fileName);\n    });\n\n    // 当文件上传出错时触发\n    uploader.on('uploadError', function (file) {\n        $(\"#responeseText\").text(\"上传失败\");\n    });\n\n    //当validate不通过时触发\n    uploader.on('error', function (type) {\n        if(type==\"F_EXCEED_SIZE\"){\n            alert(\"文件大小不能超过xxx KB!\");\n        }\n    });\n});\n```\n\n单单这样也会有问题，这样每次弹出模态框之后都加载一个边框，使按钮越来越大，所以需要在关闭模态框后销毁webuploader\n\n\n```javascript\n//关闭模态框销毁WebUploader，解决再次打开模态框时按钮越变越大问题\n$('#myModal').on('hide.bs.modal', function () {\n    $(\"#responeseText\").text(\"\");\n    uploader.destroy();\n});\n```\n\n\n-----\n\n        事件\t| 描述\n        ---     | ---\nshow.bs.modal\t| 在调用 show 方法后触发。\nshown.bs.modal\t| 当模态框对用户可见时触发（将等待 CSS 过渡效果完成）。\nhide.bs.modal\t| 当调用 hide 实例方法时触发。\nhidden.bs.modal\t| 当模态框完全对用户隐藏时触发。\n\n","slug":"webupload","published":1,"updated":"2018-01-26T05:54:05.105Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2k0025gcoi932xvuve","content":"<p>在使用Bootstrap模态框页面上使用上传组件WebUploader，发现点击失效。</p>\n<p>解决方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> uploader;</span><br><span class=\"line\"><span class=\"comment\">//在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题</span></span><br><span class=\"line\">$(<span class=\"string\">\"#myModal\"</span>).on(<span class=\"string\">\"shown.bs.modal\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    uploader = WebUploader.create(&#123;</span><br><span class=\"line\">        swf : <span class=\"string\">'/web/public/Uploader.swf'</span>,</span><br><span class=\"line\">        server : $(<span class=\"string\">\"#jumicontextPath\"</span>).val()+<span class=\"string\">'/common/file/upload'</span>,<span class=\"comment\">// 后台路径</span></span><br><span class=\"line\">        pick : <span class=\"string\">'#filePicker'</span>, <span class=\"comment\">// 选择文件的按钮。可选。内部根据当前运行是创建，可能是input元素，也可能是flash.</span></span><br><span class=\"line\">        resize : <span class=\"literal\">false</span>,<span class=\"comment\">// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！</span></span><br><span class=\"line\">        chunked : <span class=\"literal\">true</span>, <span class=\"comment\">// 是否分片</span></span><br><span class=\"line\">        duplicate:<span class=\"literal\">true</span>,<span class=\"comment\">//去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.</span></span><br><span class=\"line\">        chunkSize : <span class=\"number\">52428</span> * <span class=\"number\">100</span>, <span class=\"comment\">// 分片大小， 5M</span></span><br><span class=\"line\">        <span class=\"comment\">/*    fileSingleSizeLimit:100*1024,//文件大小限制*/</span></span><br><span class=\"line\">        auto : <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 只允许选择图片文件。</span></span><br><span class=\"line\">        accept: &#123;</span><br><span class=\"line\">            title: <span class=\"string\">'Images'</span>,</span><br><span class=\"line\">            extensions: <span class=\"string\">'gif,jpg,jpeg,bmp,png'</span>,</span><br><span class=\"line\">            mimeTypes: <span class=\"string\">'image/jpg,image/jpeg,image/png'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 文件上传成功，给item添加成功class, 用样式标记上传成功。</span></span><br><span class=\"line\">    uploader.on(<span class=\"string\">'uploadSuccess'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">file,response</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> fileUrl = response.data.fileUrl;</span><br><span class=\"line\">        <span class=\"comment\">//TODO</span></span><br><span class=\"line\">        $(<span class=\"string\">\"#responeseText\"</span>).text(<span class=\"string\">\"上传成功,文件名：\"</span>+response.data.fileName);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 当文件上传出错时触发</span></span><br><span class=\"line\">    uploader.on(<span class=\"string\">'uploadError'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">file</span>) </span>&#123;</span><br><span class=\"line\">        $(<span class=\"string\">\"#responeseText\"</span>).text(<span class=\"string\">\"上传失败\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//当validate不通过时触发</span></span><br><span class=\"line\">    uploader.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(type==<span class=\"string\">\"F_EXCEED_SIZE\"</span>)&#123;</span><br><span class=\"line\">            alert(<span class=\"string\">\"文件大小不能超过xxx KB!\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>单单这样也会有问题，这样每次弹出模态框之后都加载一个边框，使按钮越来越大，所以需要在关闭模态框后销毁webuploader</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//关闭模态框销毁WebUploader，解决再次打开模态框时按钮越变越大问题</span></span><br><span class=\"line\">$(<span class=\"string\">'#myModal'</span>).on(<span class=\"string\">'hide.bs.modal'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $(<span class=\"string\">\"#responeseText\"</span>).text(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">    uploader.destroy();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<hr>\n<pre><code>事件    | 描述\n---     | ---\n</code></pre><p>show.bs.modal    | 在调用 show 方法后触发。<br>shown.bs.modal    | 当模态框对用户可见时触发（将等待 CSS 过渡效果完成）。<br>hide.bs.modal    | 当调用 hide 实例方法时触发。<br>hidden.bs.modal    | 当模态框完全对用户隐藏时触发。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>在使用Bootstrap模态框页面上使用上传组件WebUploader，发现点击失效。</p>\n<p>解决方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> uploader;</span><br><span class=\"line\"><span class=\"comment\">//在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题</span></span><br><span class=\"line\">$(<span class=\"string\">\"#myModal\"</span>).on(<span class=\"string\">\"shown.bs.modal\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    uploader = WebUploader.create(&#123;</span><br><span class=\"line\">        swf : <span class=\"string\">'/web/public/Uploader.swf'</span>,</span><br><span class=\"line\">        server : $(<span class=\"string\">\"#jumicontextPath\"</span>).val()+<span class=\"string\">'/common/file/upload'</span>,<span class=\"comment\">// 后台路径</span></span><br><span class=\"line\">        pick : <span class=\"string\">'#filePicker'</span>, <span class=\"comment\">// 选择文件的按钮。可选。内部根据当前运行是创建，可能是input元素，也可能是flash.</span></span><br><span class=\"line\">        resize : <span class=\"literal\">false</span>,<span class=\"comment\">// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！</span></span><br><span class=\"line\">        chunked : <span class=\"literal\">true</span>, <span class=\"comment\">// 是否分片</span></span><br><span class=\"line\">        duplicate:<span class=\"literal\">true</span>,<span class=\"comment\">//去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.</span></span><br><span class=\"line\">        chunkSize : <span class=\"number\">52428</span> * <span class=\"number\">100</span>, <span class=\"comment\">// 分片大小， 5M</span></span><br><span class=\"line\">        <span class=\"comment\">/*    fileSingleSizeLimit:100*1024,//文件大小限制*/</span></span><br><span class=\"line\">        auto : <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 只允许选择图片文件。</span></span><br><span class=\"line\">        accept: &#123;</span><br><span class=\"line\">            title: <span class=\"string\">'Images'</span>,</span><br><span class=\"line\">            extensions: <span class=\"string\">'gif,jpg,jpeg,bmp,png'</span>,</span><br><span class=\"line\">            mimeTypes: <span class=\"string\">'image/jpg,image/jpeg,image/png'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 文件上传成功，给item添加成功class, 用样式标记上传成功。</span></span><br><span class=\"line\">    uploader.on(<span class=\"string\">'uploadSuccess'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">file,response</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> fileUrl = response.data.fileUrl;</span><br><span class=\"line\">        <span class=\"comment\">//TODO</span></span><br><span class=\"line\">        $(<span class=\"string\">\"#responeseText\"</span>).text(<span class=\"string\">\"上传成功,文件名：\"</span>+response.data.fileName);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 当文件上传出错时触发</span></span><br><span class=\"line\">    uploader.on(<span class=\"string\">'uploadError'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">file</span>) </span>&#123;</span><br><span class=\"line\">        $(<span class=\"string\">\"#responeseText\"</span>).text(<span class=\"string\">\"上传失败\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//当validate不通过时触发</span></span><br><span class=\"line\">    uploader.on(<span class=\"string\">'error'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">type</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(type==<span class=\"string\">\"F_EXCEED_SIZE\"</span>)&#123;</span><br><span class=\"line\">            alert(<span class=\"string\">\"文件大小不能超过xxx KB!\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>单单这样也会有问题，这样每次弹出模态框之后都加载一个边框，使按钮越来越大，所以需要在关闭模态框后销毁webuploader</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//关闭模态框销毁WebUploader，解决再次打开模态框时按钮越变越大问题</span></span><br><span class=\"line\">$(<span class=\"string\">'#myModal'</span>).on(<span class=\"string\">'hide.bs.modal'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $(<span class=\"string\">\"#responeseText\"</span>).text(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">    uploader.destroy();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<hr>\n<pre><code>事件    | 描述\n---     | ---\n</code></pre><p>show.bs.modal    | 在调用 show 方法后触发。<br>shown.bs.modal    | 当模态框对用户可见时触发（将等待 CSS 过渡效果完成）。<br>hide.bs.modal    | 当调用 hide 实例方法时触发。<br>hidden.bs.modal    | 当模态框完全对用户隐藏时触发。</p>\n"},{"title":"【vue系列】安装nodejs","date":"2017-04-21T03:10:50.000Z","_content":"\n去官网下载安装包 \n\n\n\n\n\n\n## npm常用命令\n\n\n```\nnpm install xxx // 安装模块\n\nnpm install xxx -g  // 将模块安装到全局环境中 参考http://goddyzhao.tumblr.com/post/9835631010/no-direct-command-for-local-installed-command-line-modul\n\nnpm ls // 查看安装的模块及依赖\n\nnpm ls -g // 查看全局安装的模块及依赖\n\nnpm uninstall xxx  (-g) // 卸载模块\n\nnpm cache clean // 清理缓存\n```\n\n## 淘宝npm源\n\n```\n$ npm install -g cnpm --registry=https://registry.npm.taobao.org\n```\n\n然后就可以使用`cnpm`\n\n\n## 使用webpack server\n\n```\n./node_modules/.bin/webpack-dev-server --progress --colors\n```\n","source":"_posts/vue.md","raw":"---\ntitle: 【vue系列】安装nodejs\ndate: 2017-04-21 11:10:50\ntags:\n---\n\n去官网下载安装包 \n\n\n\n\n\n\n## npm常用命令\n\n\n```\nnpm install xxx // 安装模块\n\nnpm install xxx -g  // 将模块安装到全局环境中 参考http://goddyzhao.tumblr.com/post/9835631010/no-direct-command-for-local-installed-command-line-modul\n\nnpm ls // 查看安装的模块及依赖\n\nnpm ls -g // 查看全局安装的模块及依赖\n\nnpm uninstall xxx  (-g) // 卸载模块\n\nnpm cache clean // 清理缓存\n```\n\n## 淘宝npm源\n\n```\n$ npm install -g cnpm --registry=https://registry.npm.taobao.org\n```\n\n然后就可以使用`cnpm`\n\n\n## 使用webpack server\n\n```\n./node_modules/.bin/webpack-dev-server --progress --colors\n```\n","slug":"vue","published":1,"updated":"2018-01-16T06:08:44.661Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t2l0027gcoix9589yq7","content":"<p>去官网下载安装包 </p>\n<h2 id=\"npm常用命令\"><a href=\"#npm常用命令\" class=\"headerlink\" title=\"npm常用命令\"></a>npm常用命令</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install xxx // 安装模块</span><br><span class=\"line\"></span><br><span class=\"line\">npm install xxx -g  // 将模块安装到全局环境中 参考http://goddyzhao.tumblr.com/post/9835631010/no-direct-command-for-local-installed-command-line-modul</span><br><span class=\"line\"></span><br><span class=\"line\">npm ls // 查看安装的模块及依赖</span><br><span class=\"line\"></span><br><span class=\"line\">npm ls -g // 查看全局安装的模块及依赖</span><br><span class=\"line\"></span><br><span class=\"line\">npm uninstall xxx  (-g) // 卸载模块</span><br><span class=\"line\"></span><br><span class=\"line\">npm cache clean // 清理缓存</span><br></pre></td></tr></table></figure>\n<h2 id=\"淘宝npm源\"><a href=\"#淘宝npm源\" class=\"headerlink\" title=\"淘宝npm源\"></a>淘宝npm源</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n<p>然后就可以使用<code>cnpm</code></p>\n<h2 id=\"使用webpack-server\"><a href=\"#使用webpack-server\" class=\"headerlink\" title=\"使用webpack server\"></a>使用webpack server</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./node_modules/.bin/webpack-dev-server --progress --colors</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>去官网下载安装包 </p>\n<h2 id=\"npm常用命令\"><a href=\"#npm常用命令\" class=\"headerlink\" title=\"npm常用命令\"></a>npm常用命令</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install xxx // 安装模块</span><br><span class=\"line\"></span><br><span class=\"line\">npm install xxx -g  // 将模块安装到全局环境中 参考http://goddyzhao.tumblr.com/post/9835631010/no-direct-command-for-local-installed-command-line-modul</span><br><span class=\"line\"></span><br><span class=\"line\">npm ls // 查看安装的模块及依赖</span><br><span class=\"line\"></span><br><span class=\"line\">npm ls -g // 查看全局安装的模块及依赖</span><br><span class=\"line\"></span><br><span class=\"line\">npm uninstall xxx  (-g) // 卸载模块</span><br><span class=\"line\"></span><br><span class=\"line\">npm cache clean // 清理缓存</span><br></pre></td></tr></table></figure>\n<h2 id=\"淘宝npm源\"><a href=\"#淘宝npm源\" class=\"headerlink\" title=\"淘宝npm源\"></a>淘宝npm源</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n<p>然后就可以使用<code>cnpm</code></p>\n<h2 id=\"使用webpack-server\"><a href=\"#使用webpack-server\" class=\"headerlink\" title=\"使用webpack server\"></a>使用webpack server</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./node_modules/.bin/webpack-dev-server --progress --colors</span><br></pre></td></tr></table></figure>\n"},{"title":"A Guide To OAuth 2.0 Grants","date":"2018-10-26T06:24:30.000Z","_content":"\n>[alexbilbie.com](http://alexbilbie.com/guide-to-oauth-2-grants/) · by Alex Bilbie\n\n\nThe [OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749) is a flexibile authorization framework that describes a number of grants (“methods”) for a client application to acquire an access token (which represents a user’s permission for the client to access their data) which can be used to authenticate a request to an API endpoint.\n\nThe specification describes five grants for acquiring an access token:\n\n- Authorization code grant\n- Implicit grant\n- Resource owner credentials grant\n- Client credentials grant\n- Refresh token grant\n\nIn this post I’m going to describe each of the above grants and their appropriate use cases.\n\nAs a refresher here is a quick glossary of OAuth terms (taken from the core spec):\n\n- **Resource owner (a.k.a. the User)** - An entity capable of granting access to a protected resource. When the resource owner is a person, it is referred to as an end-user.\n- **Resource server (a.k.a. the API server)** - The server hosting the protected resources, capable of accepting and responding to protected resource requests using access tokens.\n- **Client** - An application making protected resource requests on behalf of the resource owner and with its authorization. The term client does not imply any particular implementation characteristics (e.g. whether the application executes on a server, a desktop, or other devices).\n- **Authorization server** - The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization.\n\n\n\n## Authorisation Code Grant ([section 4.1](http://tools.ietf.org/html/rfc6749#section-4.1))\n\nThe authorization code grant should be very familiar if you’ve ever signed into an application using your Facebook or Google account.\n\n### The Flow (Part One)\n\nThe client will redirect the user to the authorization server with the following parameters in the query string:\n\n- `response_type` with the value `code`\n- `client_id` with the client identifier\n- `redirect_uri` with the client redirect URI. This parameter is optional, but if not send the user will be redirected to a pre-registered redirect URI.\n- `scope` a space delimited list of scopes\n- `state` with a [CSRF](https://en.wikipedia.org/wiki/Cross-site_request_forgery) token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.\n\nAll of these parameters will be validated by the authorization server.\n\nThe user will then be asked to login to the authorization server and approve the client.\n\nIf the user approves the client they will be redirected from the authorisation server back to the client (specifically to the redirect URI) with the following parameters in the query string:\n\n- `code` with the authorization code\n- `state` with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.\n\n### The Flow (Part Two)\n\nThe client will now send a POST request to the authorization server with the following parameters:\n\n- `grant_type` with the value of `authorization_code`\n- `client_id` with the client identifier\n- `client_secret` with the client secret\n- `redirect_uri` with the same redirect URI the user was redirect back to\n- `code` with the authorization code from the query string\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` this will usually be the word “Bearer” (to indicate a bearer token)\n- `expires_in` with an integer representing the TTL of the access token (i.e. when the token will expire)\n- `access_token` the access token itself\n- `refresh_token` a refresh token that can be used to acquire a new access token when the original expires\n\n## Implicit grant ([section 4.2](http://tools.ietf.org/html/rfc6749#section-4.2))\n\nThe implicit grant is similar to the authorization code grant with two distinct differences.\n\nIt is intended to be used for user-agent-based clients (e.g. single page web apps) that can’t keep a client secret because all of the application code and storage is easily accessible.\n\nSecondly instead of the authorization server returning an authorization code which is exchanged for an access token, the authorization server returns an access token.\n\n### The Flow\n\nThe client will redirect the user to the authorization server with the following parameters in the query string:\n\n- `response_type` with the value `token`\n- `client_id` with the client identifier\n- `redirect_uri` with the client redirect URI. This parameter is optional, but if not sent the user will be redirected to a pre-registered redirect URI.\n- `scope` a space delimited list of scopes\n- `state` with a [CSRF](https://en.wikipedia.org/wiki/Cross-site_request_forgery) token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.\n\nAll of these parameters will be validated by the authorization server.\n\nThe user will then be asked to login to the authorization server and approve the client.\n\nIf the user approves the client they will be redirected back to the authorization server with the following parameters in the query string:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n- `state` with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.\n\n**Note:** this grant does not return a refresh token because the browser has no means of keeping it private\n\n\n\n## Resource owner credentials grant ([section 4.3](http://tools.ietf.org/html/rfc6749#section-4.3))\n\nThis grant is a great user experience for trusted first party clients both on the web and in native device applications.\n\n### The Flow\n\nThe client will ask the user for their authorization credentials (ususally a username and password).\n\nThe client then sends a POST request with following body parameters to the authorization server:\n\n- `grant_type` with the value `password`\n- `client_id` with the the client’s ID\n- `client_secret` with the client’s secret\n- `scope` with a space-delimited list of requested scope permissions.\n- `username` with the user’s username\n- `password` with the user’s password\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n- `refresh_token` a refresh token that can be used to acquire a new access token when the original expires\n\n## Client credentials grant ([section 4.4](http://tools.ietf.org/html/rfc6749#section-4.4))\n\nThe simplest of all of the OAuth 2.0 grants, this grant is suitable for machine-to-machine authentication where a specific user’s permission to access data is not required.\n\n### The Flow\n\nThe client sends a POST request with following body parameters to the authorization server:\n\n- `grant_type` with the value `client_credentials`\n- `client_id` with the the client’s ID\n- `client_secret` with the client’s secret\n- `scope` with a space-delimited list of requested scope permissions.\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n\n## Refresh token grant ([section 1.5](http://tools.ietf.org/html/rfc6749#section-1.5))\n\nAccess tokens eventually expire; however some grants respond with a refresh token which enables the client to get a new access token without requiring the user to be redirected.\n\n### The Flow\n\nThe client sends a POST request with following body parameters to the authorization server:\n\n- `grant_type` with the value `refresh_token`\n- `refresh_token` with the refresh token\n- `client_id` with the the client’s ID\n- `client_secret` with the client’s secret\n- `scope` with a space-delimited list of requested scope permissions. This is optional; if not sent the original scopes will be used, otherwise you can request a reduced set of scopes.\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n- `refresh_token` a refresh token that can be used to acquire a new access token when the original expires\n\n## Additonal Grants\n\nThere are additional grants that have been published in other specifications that I will cover in a future article.\n\n## Which OAuth 2.0 grant should I use?\n\nA grant is a method of acquiring an access token. Deciding which grants to implement depends on the type of client the end user will be using, and the experience you want for your users.\n\n![img](http://alexbilbie.com/images/oauth-grants.svg)\n\n### First party or third party client?\n\nA first party client is a client that you trust enough to handle the end user’s authorization credentials. For example Spotify’s iPhone app is owned and developed by Spotify so therefore they implicitly trust it.\n\nA third party client is a client that you don’t trust.\n\n### Access Token Owner?\n\nAn access token represents a permission granted to a client to access some protected resources.\n\nIf you are authorizing a machine to access resources and you don’t require the permission of a user to access said resources you should implement the client credentials grant.\n\nIf you require the permission of a user to access resources you need to determine the client type.\n\n### Client Type?\n\nDepending on whether or not the client is capable of keeping a secret will depend on which grant the client should use.\n\nIf the client is a web application that has a server side component then you should implement the authorization code grant.\n\nIf the client is a web application that has runs entirely on the front end (e.g. a single page web application) you should implement the password grant for a first party clients and the implicit grant for a third party clients.\n\nIf the client is a native application such as a mobile app you should implement the password grant.\n\nThird party native applications should use the authorization code grant (via the native browser, not an embedded browser - e.g. for iOS push the user to Safari or use [SFSafariViewController](https://developer.apple.com/library/ios/documentation/SafariServices/Reference/SFSafariViewController_Ref/), don't use an embedded [WKWebView](https://developer.apple.com/library/ios/documentation/WebKit/Reference/WKWebView_Ref/)).\n","source":"_posts/0004-a-guide-to-oauth2-grants.md","raw":"---\ntitle: A Guide To OAuth 2.0 Grants\ndate: 2018-10-26 14:24:30\ntags:\n    - Oauth\n---\n\n>[alexbilbie.com](http://alexbilbie.com/guide-to-oauth-2-grants/) · by Alex Bilbie\n\n\nThe [OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749) is a flexibile authorization framework that describes a number of grants (“methods”) for a client application to acquire an access token (which represents a user’s permission for the client to access their data) which can be used to authenticate a request to an API endpoint.\n\nThe specification describes five grants for acquiring an access token:\n\n- Authorization code grant\n- Implicit grant\n- Resource owner credentials grant\n- Client credentials grant\n- Refresh token grant\n\nIn this post I’m going to describe each of the above grants and their appropriate use cases.\n\nAs a refresher here is a quick glossary of OAuth terms (taken from the core spec):\n\n- **Resource owner (a.k.a. the User)** - An entity capable of granting access to a protected resource. When the resource owner is a person, it is referred to as an end-user.\n- **Resource server (a.k.a. the API server)** - The server hosting the protected resources, capable of accepting and responding to protected resource requests using access tokens.\n- **Client** - An application making protected resource requests on behalf of the resource owner and with its authorization. The term client does not imply any particular implementation characteristics (e.g. whether the application executes on a server, a desktop, or other devices).\n- **Authorization server** - The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization.\n\n\n\n## Authorisation Code Grant ([section 4.1](http://tools.ietf.org/html/rfc6749#section-4.1))\n\nThe authorization code grant should be very familiar if you’ve ever signed into an application using your Facebook or Google account.\n\n### The Flow (Part One)\n\nThe client will redirect the user to the authorization server with the following parameters in the query string:\n\n- `response_type` with the value `code`\n- `client_id` with the client identifier\n- `redirect_uri` with the client redirect URI. This parameter is optional, but if not send the user will be redirected to a pre-registered redirect URI.\n- `scope` a space delimited list of scopes\n- `state` with a [CSRF](https://en.wikipedia.org/wiki/Cross-site_request_forgery) token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.\n\nAll of these parameters will be validated by the authorization server.\n\nThe user will then be asked to login to the authorization server and approve the client.\n\nIf the user approves the client they will be redirected from the authorisation server back to the client (specifically to the redirect URI) with the following parameters in the query string:\n\n- `code` with the authorization code\n- `state` with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.\n\n### The Flow (Part Two)\n\nThe client will now send a POST request to the authorization server with the following parameters:\n\n- `grant_type` with the value of `authorization_code`\n- `client_id` with the client identifier\n- `client_secret` with the client secret\n- `redirect_uri` with the same redirect URI the user was redirect back to\n- `code` with the authorization code from the query string\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` this will usually be the word “Bearer” (to indicate a bearer token)\n- `expires_in` with an integer representing the TTL of the access token (i.e. when the token will expire)\n- `access_token` the access token itself\n- `refresh_token` a refresh token that can be used to acquire a new access token when the original expires\n\n## Implicit grant ([section 4.2](http://tools.ietf.org/html/rfc6749#section-4.2))\n\nThe implicit grant is similar to the authorization code grant with two distinct differences.\n\nIt is intended to be used for user-agent-based clients (e.g. single page web apps) that can’t keep a client secret because all of the application code and storage is easily accessible.\n\nSecondly instead of the authorization server returning an authorization code which is exchanged for an access token, the authorization server returns an access token.\n\n### The Flow\n\nThe client will redirect the user to the authorization server with the following parameters in the query string:\n\n- `response_type` with the value `token`\n- `client_id` with the client identifier\n- `redirect_uri` with the client redirect URI. This parameter is optional, but if not sent the user will be redirected to a pre-registered redirect URI.\n- `scope` a space delimited list of scopes\n- `state` with a [CSRF](https://en.wikipedia.org/wiki/Cross-site_request_forgery) token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.\n\nAll of these parameters will be validated by the authorization server.\n\nThe user will then be asked to login to the authorization server and approve the client.\n\nIf the user approves the client they will be redirected back to the authorization server with the following parameters in the query string:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n- `state` with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.\n\n**Note:** this grant does not return a refresh token because the browser has no means of keeping it private\n\n\n\n## Resource owner credentials grant ([section 4.3](http://tools.ietf.org/html/rfc6749#section-4.3))\n\nThis grant is a great user experience for trusted first party clients both on the web and in native device applications.\n\n### The Flow\n\nThe client will ask the user for their authorization credentials (ususally a username and password).\n\nThe client then sends a POST request with following body parameters to the authorization server:\n\n- `grant_type` with the value `password`\n- `client_id` with the the client’s ID\n- `client_secret` with the client’s secret\n- `scope` with a space-delimited list of requested scope permissions.\n- `username` with the user’s username\n- `password` with the user’s password\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n- `refresh_token` a refresh token that can be used to acquire a new access token when the original expires\n\n## Client credentials grant ([section 4.4](http://tools.ietf.org/html/rfc6749#section-4.4))\n\nThe simplest of all of the OAuth 2.0 grants, this grant is suitable for machine-to-machine authentication where a specific user’s permission to access data is not required.\n\n### The Flow\n\nThe client sends a POST request with following body parameters to the authorization server:\n\n- `grant_type` with the value `client_credentials`\n- `client_id` with the the client’s ID\n- `client_secret` with the client’s secret\n- `scope` with a space-delimited list of requested scope permissions.\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n\n## Refresh token grant ([section 1.5](http://tools.ietf.org/html/rfc6749#section-1.5))\n\nAccess tokens eventually expire; however some grants respond with a refresh token which enables the client to get a new access token without requiring the user to be redirected.\n\n### The Flow\n\nThe client sends a POST request with following body parameters to the authorization server:\n\n- `grant_type` with the value `refresh_token`\n- `refresh_token` with the refresh token\n- `client_id` with the the client’s ID\n- `client_secret` with the client’s secret\n- `scope` with a space-delimited list of requested scope permissions. This is optional; if not sent the original scopes will be used, otherwise you can request a reduced set of scopes.\n\nThe authorization server will respond with a JSON object containing the following properties:\n\n- `token_type` with the value `Bearer`\n- `expires_in` with an integer representing the TTL of the access token\n- `access_token` the access token itself\n- `refresh_token` a refresh token that can be used to acquire a new access token when the original expires\n\n## Additonal Grants\n\nThere are additional grants that have been published in other specifications that I will cover in a future article.\n\n## Which OAuth 2.0 grant should I use?\n\nA grant is a method of acquiring an access token. Deciding which grants to implement depends on the type of client the end user will be using, and the experience you want for your users.\n\n![img](http://alexbilbie.com/images/oauth-grants.svg)\n\n### First party or third party client?\n\nA first party client is a client that you trust enough to handle the end user’s authorization credentials. For example Spotify’s iPhone app is owned and developed by Spotify so therefore they implicitly trust it.\n\nA third party client is a client that you don’t trust.\n\n### Access Token Owner?\n\nAn access token represents a permission granted to a client to access some protected resources.\n\nIf you are authorizing a machine to access resources and you don’t require the permission of a user to access said resources you should implement the client credentials grant.\n\nIf you require the permission of a user to access resources you need to determine the client type.\n\n### Client Type?\n\nDepending on whether or not the client is capable of keeping a secret will depend on which grant the client should use.\n\nIf the client is a web application that has a server side component then you should implement the authorization code grant.\n\nIf the client is a web application that has runs entirely on the front end (e.g. a single page web application) you should implement the password grant for a first party clients and the implicit grant for a third party clients.\n\nIf the client is a native application such as a mobile app you should implement the password grant.\n\nThird party native applications should use the authorization code grant (via the native browser, not an embedded browser - e.g. for iOS push the user to Safari or use [SFSafariViewController](https://developer.apple.com/library/ios/documentation/SafariServices/Reference/SFSafariViewController_Ref/), don't use an embedded [WKWebView](https://developer.apple.com/library/ios/documentation/WebKit/Reference/WKWebView_Ref/)).\n","slug":"0004-a-guide-to-oauth2-grants","published":1,"updated":"2018-10-26T06:06:06.991Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t7s003bgcoimrd2s5c7","content":"<blockquote>\n<p><a href=\"http://alexbilbie.com/guide-to-oauth-2-grants/\" target=\"_blank\" rel=\"noopener\">alexbilbie.com</a> · by Alex Bilbie</p>\n</blockquote>\n<p>The <a href=\"http://tools.ietf.org/html/rfc6749\" target=\"_blank\" rel=\"noopener\">OAuth 2.0 specification</a> is a flexibile authorization framework that describes a number of grants (“methods”) for a client application to acquire an access token (which represents a user’s permission for the client to access their data) which can be used to authenticate a request to an API endpoint.</p>\n<p>The specification describes five grants for acquiring an access token:</p>\n<ul>\n<li>Authorization code grant</li>\n<li>Implicit grant</li>\n<li>Resource owner credentials grant</li>\n<li>Client credentials grant</li>\n<li>Refresh token grant</li>\n</ul>\n<p>In this post I’m going to describe each of the above grants and their appropriate use cases.</p>\n<p>As a refresher here is a quick glossary of OAuth terms (taken from the core spec):</p>\n<ul>\n<li><strong>Resource owner (a.k.a. the User)</strong> - An entity capable of granting access to a protected resource. When the resource owner is a person, it is referred to as an end-user.</li>\n<li><strong>Resource server (a.k.a. the API server)</strong> - The server hosting the protected resources, capable of accepting and responding to protected resource requests using access tokens.</li>\n<li><strong>Client</strong> - An application making protected resource requests on behalf of the resource owner and with its authorization. The term client does not imply any particular implementation characteristics (e.g. whether the application executes on a server, a desktop, or other devices).</li>\n<li><strong>Authorization server</strong> - The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization.</li>\n</ul>\n<h2 id=\"Authorisation-Code-Grant-section-4-1\"><a href=\"#Authorisation-Code-Grant-section-4-1\" class=\"headerlink\" title=\"Authorisation Code Grant (section 4.1)\"></a>Authorisation Code Grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.1\" target=\"_blank\" rel=\"noopener\">section 4.1</a>)</h2><p>The authorization code grant should be very familiar if you’ve ever signed into an application using your Facebook or Google account.</p>\n<h3 id=\"The-Flow-Part-One\"><a href=\"#The-Flow-Part-One\" class=\"headerlink\" title=\"The Flow (Part One)\"></a>The Flow (Part One)</h3><p>The client will redirect the user to the authorization server with the following parameters in the query string:</p>\n<ul>\n<li><code>response_type</code> with the value <code>code</code></li>\n<li><code>client_id</code> with the client identifier</li>\n<li><code>redirect_uri</code> with the client redirect URI. This parameter is optional, but if not send the user will be redirected to a pre-registered redirect URI.</li>\n<li><code>scope</code> a space delimited list of scopes</li>\n<li><code>state</code> with a <a href=\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\" target=\"_blank\" rel=\"noopener\">CSRF</a> token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.</li>\n</ul>\n<p>All of these parameters will be validated by the authorization server.</p>\n<p>The user will then be asked to login to the authorization server and approve the client.</p>\n<p>If the user approves the client they will be redirected from the authorisation server back to the client (specifically to the redirect URI) with the following parameters in the query string:</p>\n<ul>\n<li><code>code</code> with the authorization code</li>\n<li><code>state</code> with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.</li>\n</ul>\n<h3 id=\"The-Flow-Part-Two\"><a href=\"#The-Flow-Part-Two\" class=\"headerlink\" title=\"The Flow (Part Two)\"></a>The Flow (Part Two)</h3><p>The client will now send a POST request to the authorization server with the following parameters:</p>\n<ul>\n<li><code>grant_type</code> with the value of <code>authorization_code</code></li>\n<li><code>client_id</code> with the client identifier</li>\n<li><code>client_secret</code> with the client secret</li>\n<li><code>redirect_uri</code> with the same redirect URI the user was redirect back to</li>\n<li><code>code</code> with the authorization code from the query string</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> this will usually be the word “Bearer” (to indicate a bearer token)</li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token (i.e. when the token will expire)</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>\n</ul>\n<h2 id=\"Implicit-grant-section-4-2\"><a href=\"#Implicit-grant-section-4-2\" class=\"headerlink\" title=\"Implicit grant (section 4.2)\"></a>Implicit grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.2\" target=\"_blank\" rel=\"noopener\">section 4.2</a>)</h2><p>The implicit grant is similar to the authorization code grant with two distinct differences.</p>\n<p>It is intended to be used for user-agent-based clients (e.g. single page web apps) that can’t keep a client secret because all of the application code and storage is easily accessible.</p>\n<p>Secondly instead of the authorization server returning an authorization code which is exchanged for an access token, the authorization server returns an access token.</p>\n<h3 id=\"The-Flow\"><a href=\"#The-Flow\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client will redirect the user to the authorization server with the following parameters in the query string:</p>\n<ul>\n<li><code>response_type</code> with the value <code>token</code></li>\n<li><code>client_id</code> with the client identifier</li>\n<li><code>redirect_uri</code> with the client redirect URI. This parameter is optional, but if not sent the user will be redirected to a pre-registered redirect URI.</li>\n<li><code>scope</code> a space delimited list of scopes</li>\n<li><code>state</code> with a <a href=\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\" target=\"_blank\" rel=\"noopener\">CSRF</a> token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.</li>\n</ul>\n<p>All of these parameters will be validated by the authorization server.</p>\n<p>The user will then be asked to login to the authorization server and approve the client.</p>\n<p>If the user approves the client they will be redirected back to the authorization server with the following parameters in the query string:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>state</code> with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.</li>\n</ul>\n<p><strong>Note:</strong> this grant does not return a refresh token because the browser has no means of keeping it private</p>\n<h2 id=\"Resource-owner-credentials-grant-section-4-3\"><a href=\"#Resource-owner-credentials-grant-section-4-3\" class=\"headerlink\" title=\"Resource owner credentials grant (section 4.3)\"></a>Resource owner credentials grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.3\" target=\"_blank\" rel=\"noopener\">section 4.3</a>)</h2><p>This grant is a great user experience for trusted first party clients both on the web and in native device applications.</p>\n<h3 id=\"The-Flow-1\"><a href=\"#The-Flow-1\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client will ask the user for their authorization credentials (ususally a username and password).</p>\n<p>The client then sends a POST request with following body parameters to the authorization server:</p>\n<ul>\n<li><code>grant_type</code> with the value <code>password</code></li>\n<li><code>client_id</code> with the the client’s ID</li>\n<li><code>client_secret</code> with the client’s secret</li>\n<li><code>scope</code> with a space-delimited list of requested scope permissions.</li>\n<li><code>username</code> with the user’s username</li>\n<li><code>password</code> with the user’s password</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>\n</ul>\n<h2 id=\"Client-credentials-grant-section-4-4\"><a href=\"#Client-credentials-grant-section-4-4\" class=\"headerlink\" title=\"Client credentials grant (section 4.4)\"></a>Client credentials grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.4\" target=\"_blank\" rel=\"noopener\">section 4.4</a>)</h2><p>The simplest of all of the OAuth 2.0 grants, this grant is suitable for machine-to-machine authentication where a specific user’s permission to access data is not required.</p>\n<h3 id=\"The-Flow-2\"><a href=\"#The-Flow-2\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client sends a POST request with following body parameters to the authorization server:</p>\n<ul>\n<li><code>grant_type</code> with the value <code>client_credentials</code></li>\n<li><code>client_id</code> with the the client’s ID</li>\n<li><code>client_secret</code> with the client’s secret</li>\n<li><code>scope</code> with a space-delimited list of requested scope permissions.</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n</ul>\n<h2 id=\"Refresh-token-grant-section-1-5\"><a href=\"#Refresh-token-grant-section-1-5\" class=\"headerlink\" title=\"Refresh token grant (section 1.5)\"></a>Refresh token grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-1.5\" target=\"_blank\" rel=\"noopener\">section 1.5</a>)</h2><p>Access tokens eventually expire; however some grants respond with a refresh token which enables the client to get a new access token without requiring the user to be redirected.</p>\n<h3 id=\"The-Flow-3\"><a href=\"#The-Flow-3\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client sends a POST request with following body parameters to the authorization server:</p>\n<ul>\n<li><code>grant_type</code> with the value <code>refresh_token</code></li>\n<li><code>refresh_token</code> with the refresh token</li>\n<li><code>client_id</code> with the the client’s ID</li>\n<li><code>client_secret</code> with the client’s secret</li>\n<li><code>scope</code> with a space-delimited list of requested scope permissions. This is optional; if not sent the original scopes will be used, otherwise you can request a reduced set of scopes.</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>\n</ul>\n<h2 id=\"Additonal-Grants\"><a href=\"#Additonal-Grants\" class=\"headerlink\" title=\"Additonal Grants\"></a>Additonal Grants</h2><p>There are additional grants that have been published in other specifications that I will cover in a future article.</p>\n<h2 id=\"Which-OAuth-2-0-grant-should-I-use\"><a href=\"#Which-OAuth-2-0-grant-should-I-use\" class=\"headerlink\" title=\"Which OAuth 2.0 grant should I use?\"></a>Which OAuth 2.0 grant should I use?</h2><p>A grant is a method of acquiring an access token. Deciding which grants to implement depends on the type of client the end user will be using, and the experience you want for your users.</p>\n<p><img src=\"http://alexbilbie.com/images/oauth-grants.svg\" alt=\"img\"></p>\n<h3 id=\"First-party-or-third-party-client\"><a href=\"#First-party-or-third-party-client\" class=\"headerlink\" title=\"First party or third party client?\"></a>First party or third party client?</h3><p>A first party client is a client that you trust enough to handle the end user’s authorization credentials. For example Spotify’s iPhone app is owned and developed by Spotify so therefore they implicitly trust it.</p>\n<p>A third party client is a client that you don’t trust.</p>\n<h3 id=\"Access-Token-Owner\"><a href=\"#Access-Token-Owner\" class=\"headerlink\" title=\"Access Token Owner?\"></a>Access Token Owner?</h3><p>An access token represents a permission granted to a client to access some protected resources.</p>\n<p>If you are authorizing a machine to access resources and you don’t require the permission of a user to access said resources you should implement the client credentials grant.</p>\n<p>If you require the permission of a user to access resources you need to determine the client type.</p>\n<h3 id=\"Client-Type\"><a href=\"#Client-Type\" class=\"headerlink\" title=\"Client Type?\"></a>Client Type?</h3><p>Depending on whether or not the client is capable of keeping a secret will depend on which grant the client should use.</p>\n<p>If the client is a web application that has a server side component then you should implement the authorization code grant.</p>\n<p>If the client is a web application that has runs entirely on the front end (e.g. a single page web application) you should implement the password grant for a first party clients and the implicit grant for a third party clients.</p>\n<p>If the client is a native application such as a mobile app you should implement the password grant.</p>\n<p>Third party native applications should use the authorization code grant (via the native browser, not an embedded browser - e.g. for iOS push the user to Safari or use <a href=\"https://developer.apple.com/library/ios/documentation/SafariServices/Reference/SFSafariViewController_Ref/\" target=\"_blank\" rel=\"noopener\">SFSafariViewController</a>, don’t use an embedded <a href=\"https://developer.apple.com/library/ios/documentation/WebKit/Reference/WKWebView_Ref/\" target=\"_blank\" rel=\"noopener\">WKWebView</a>).</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><a href=\"http://alexbilbie.com/guide-to-oauth-2-grants/\" target=\"_blank\" rel=\"noopener\">alexbilbie.com</a> · by Alex Bilbie</p>\n</blockquote>\n<p>The <a href=\"http://tools.ietf.org/html/rfc6749\" target=\"_blank\" rel=\"noopener\">OAuth 2.0 specification</a> is a flexibile authorization framework that describes a number of grants (“methods”) for a client application to acquire an access token (which represents a user’s permission for the client to access their data) which can be used to authenticate a request to an API endpoint.</p>\n<p>The specification describes five grants for acquiring an access token:</p>\n<ul>\n<li>Authorization code grant</li>\n<li>Implicit grant</li>\n<li>Resource owner credentials grant</li>\n<li>Client credentials grant</li>\n<li>Refresh token grant</li>\n</ul>\n<p>In this post I’m going to describe each of the above grants and their appropriate use cases.</p>\n<p>As a refresher here is a quick glossary of OAuth terms (taken from the core spec):</p>\n<ul>\n<li><strong>Resource owner (a.k.a. the User)</strong> - An entity capable of granting access to a protected resource. When the resource owner is a person, it is referred to as an end-user.</li>\n<li><strong>Resource server (a.k.a. the API server)</strong> - The server hosting the protected resources, capable of accepting and responding to protected resource requests using access tokens.</li>\n<li><strong>Client</strong> - An application making protected resource requests on behalf of the resource owner and with its authorization. The term client does not imply any particular implementation characteristics (e.g. whether the application executes on a server, a desktop, or other devices).</li>\n<li><strong>Authorization server</strong> - The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization.</li>\n</ul>\n<h2 id=\"Authorisation-Code-Grant-section-4-1\"><a href=\"#Authorisation-Code-Grant-section-4-1\" class=\"headerlink\" title=\"Authorisation Code Grant (section 4.1)\"></a>Authorisation Code Grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.1\" target=\"_blank\" rel=\"noopener\">section 4.1</a>)</h2><p>The authorization code grant should be very familiar if you’ve ever signed into an application using your Facebook or Google account.</p>\n<h3 id=\"The-Flow-Part-One\"><a href=\"#The-Flow-Part-One\" class=\"headerlink\" title=\"The Flow (Part One)\"></a>The Flow (Part One)</h3><p>The client will redirect the user to the authorization server with the following parameters in the query string:</p>\n<ul>\n<li><code>response_type</code> with the value <code>code</code></li>\n<li><code>client_id</code> with the client identifier</li>\n<li><code>redirect_uri</code> with the client redirect URI. This parameter is optional, but if not send the user will be redirected to a pre-registered redirect URI.</li>\n<li><code>scope</code> a space delimited list of scopes</li>\n<li><code>state</code> with a <a href=\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\" target=\"_blank\" rel=\"noopener\">CSRF</a> token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.</li>\n</ul>\n<p>All of these parameters will be validated by the authorization server.</p>\n<p>The user will then be asked to login to the authorization server and approve the client.</p>\n<p>If the user approves the client they will be redirected from the authorisation server back to the client (specifically to the redirect URI) with the following parameters in the query string:</p>\n<ul>\n<li><code>code</code> with the authorization code</li>\n<li><code>state</code> with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.</li>\n</ul>\n<h3 id=\"The-Flow-Part-Two\"><a href=\"#The-Flow-Part-Two\" class=\"headerlink\" title=\"The Flow (Part Two)\"></a>The Flow (Part Two)</h3><p>The client will now send a POST request to the authorization server with the following parameters:</p>\n<ul>\n<li><code>grant_type</code> with the value of <code>authorization_code</code></li>\n<li><code>client_id</code> with the client identifier</li>\n<li><code>client_secret</code> with the client secret</li>\n<li><code>redirect_uri</code> with the same redirect URI the user was redirect back to</li>\n<li><code>code</code> with the authorization code from the query string</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> this will usually be the word “Bearer” (to indicate a bearer token)</li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token (i.e. when the token will expire)</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>\n</ul>\n<h2 id=\"Implicit-grant-section-4-2\"><a href=\"#Implicit-grant-section-4-2\" class=\"headerlink\" title=\"Implicit grant (section 4.2)\"></a>Implicit grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.2\" target=\"_blank\" rel=\"noopener\">section 4.2</a>)</h2><p>The implicit grant is similar to the authorization code grant with two distinct differences.</p>\n<p>It is intended to be used for user-agent-based clients (e.g. single page web apps) that can’t keep a client secret because all of the application code and storage is easily accessible.</p>\n<p>Secondly instead of the authorization server returning an authorization code which is exchanged for an access token, the authorization server returns an access token.</p>\n<h3 id=\"The-Flow\"><a href=\"#The-Flow\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client will redirect the user to the authorization server with the following parameters in the query string:</p>\n<ul>\n<li><code>response_type</code> with the value <code>token</code></li>\n<li><code>client_id</code> with the client identifier</li>\n<li><code>redirect_uri</code> with the client redirect URI. This parameter is optional, but if not sent the user will be redirected to a pre-registered redirect URI.</li>\n<li><code>scope</code> a space delimited list of scopes</li>\n<li><code>state</code> with a <a href=\"https://en.wikipedia.org/wiki/Cross-site_request_forgery\" target=\"_blank\" rel=\"noopener\">CSRF</a> token. This parameter is optional but highly recommended. You should store the value of the CSRF token in the user’s session to be validated when they return.</li>\n</ul>\n<p>All of these parameters will be validated by the authorization server.</p>\n<p>The user will then be asked to login to the authorization server and approve the client.</p>\n<p>If the user approves the client they will be redirected back to the authorization server with the following parameters in the query string:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>state</code> with the state parameter sent in the original request. You should compare this value with the value stored in the user’s session to ensure the authorization code obtained is in response to requests made by this client rather than another client application.</li>\n</ul>\n<p><strong>Note:</strong> this grant does not return a refresh token because the browser has no means of keeping it private</p>\n<h2 id=\"Resource-owner-credentials-grant-section-4-3\"><a href=\"#Resource-owner-credentials-grant-section-4-3\" class=\"headerlink\" title=\"Resource owner credentials grant (section 4.3)\"></a>Resource owner credentials grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.3\" target=\"_blank\" rel=\"noopener\">section 4.3</a>)</h2><p>This grant is a great user experience for trusted first party clients both on the web and in native device applications.</p>\n<h3 id=\"The-Flow-1\"><a href=\"#The-Flow-1\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client will ask the user for their authorization credentials (ususally a username and password).</p>\n<p>The client then sends a POST request with following body parameters to the authorization server:</p>\n<ul>\n<li><code>grant_type</code> with the value <code>password</code></li>\n<li><code>client_id</code> with the the client’s ID</li>\n<li><code>client_secret</code> with the client’s secret</li>\n<li><code>scope</code> with a space-delimited list of requested scope permissions.</li>\n<li><code>username</code> with the user’s username</li>\n<li><code>password</code> with the user’s password</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>\n</ul>\n<h2 id=\"Client-credentials-grant-section-4-4\"><a href=\"#Client-credentials-grant-section-4-4\" class=\"headerlink\" title=\"Client credentials grant (section 4.4)\"></a>Client credentials grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-4.4\" target=\"_blank\" rel=\"noopener\">section 4.4</a>)</h2><p>The simplest of all of the OAuth 2.0 grants, this grant is suitable for machine-to-machine authentication where a specific user’s permission to access data is not required.</p>\n<h3 id=\"The-Flow-2\"><a href=\"#The-Flow-2\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client sends a POST request with following body parameters to the authorization server:</p>\n<ul>\n<li><code>grant_type</code> with the value <code>client_credentials</code></li>\n<li><code>client_id</code> with the the client’s ID</li>\n<li><code>client_secret</code> with the client’s secret</li>\n<li><code>scope</code> with a space-delimited list of requested scope permissions.</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n</ul>\n<h2 id=\"Refresh-token-grant-section-1-5\"><a href=\"#Refresh-token-grant-section-1-5\" class=\"headerlink\" title=\"Refresh token grant (section 1.5)\"></a>Refresh token grant (<a href=\"http://tools.ietf.org/html/rfc6749#section-1.5\" target=\"_blank\" rel=\"noopener\">section 1.5</a>)</h2><p>Access tokens eventually expire; however some grants respond with a refresh token which enables the client to get a new access token without requiring the user to be redirected.</p>\n<h3 id=\"The-Flow-3\"><a href=\"#The-Flow-3\" class=\"headerlink\" title=\"The Flow\"></a>The Flow</h3><p>The client sends a POST request with following body parameters to the authorization server:</p>\n<ul>\n<li><code>grant_type</code> with the value <code>refresh_token</code></li>\n<li><code>refresh_token</code> with the refresh token</li>\n<li><code>client_id</code> with the the client’s ID</li>\n<li><code>client_secret</code> with the client’s secret</li>\n<li><code>scope</code> with a space-delimited list of requested scope permissions. This is optional; if not sent the original scopes will be used, otherwise you can request a reduced set of scopes.</li>\n</ul>\n<p>The authorization server will respond with a JSON object containing the following properties:</p>\n<ul>\n<li><code>token_type</code> with the value <code>Bearer</code></li>\n<li><code>expires_in</code> with an integer representing the TTL of the access token</li>\n<li><code>access_token</code> the access token itself</li>\n<li><code>refresh_token</code> a refresh token that can be used to acquire a new access token when the original expires</li>\n</ul>\n<h2 id=\"Additonal-Grants\"><a href=\"#Additonal-Grants\" class=\"headerlink\" title=\"Additonal Grants\"></a>Additonal Grants</h2><p>There are additional grants that have been published in other specifications that I will cover in a future article.</p>\n<h2 id=\"Which-OAuth-2-0-grant-should-I-use\"><a href=\"#Which-OAuth-2-0-grant-should-I-use\" class=\"headerlink\" title=\"Which OAuth 2.0 grant should I use?\"></a>Which OAuth 2.0 grant should I use?</h2><p>A grant is a method of acquiring an access token. Deciding which grants to implement depends on the type of client the end user will be using, and the experience you want for your users.</p>\n<p><img src=\"http://alexbilbie.com/images/oauth-grants.svg\" alt=\"img\"></p>\n<h3 id=\"First-party-or-third-party-client\"><a href=\"#First-party-or-third-party-client\" class=\"headerlink\" title=\"First party or third party client?\"></a>First party or third party client?</h3><p>A first party client is a client that you trust enough to handle the end user’s authorization credentials. For example Spotify’s iPhone app is owned and developed by Spotify so therefore they implicitly trust it.</p>\n<p>A third party client is a client that you don’t trust.</p>\n<h3 id=\"Access-Token-Owner\"><a href=\"#Access-Token-Owner\" class=\"headerlink\" title=\"Access Token Owner?\"></a>Access Token Owner?</h3><p>An access token represents a permission granted to a client to access some protected resources.</p>\n<p>If you are authorizing a machine to access resources and you don’t require the permission of a user to access said resources you should implement the client credentials grant.</p>\n<p>If you require the permission of a user to access resources you need to determine the client type.</p>\n<h3 id=\"Client-Type\"><a href=\"#Client-Type\" class=\"headerlink\" title=\"Client Type?\"></a>Client Type?</h3><p>Depending on whether or not the client is capable of keeping a secret will depend on which grant the client should use.</p>\n<p>If the client is a web application that has a server side component then you should implement the authorization code grant.</p>\n<p>If the client is a web application that has runs entirely on the front end (e.g. a single page web application) you should implement the password grant for a first party clients and the implicit grant for a third party clients.</p>\n<p>If the client is a native application such as a mobile app you should implement the password grant.</p>\n<p>Third party native applications should use the authorization code grant (via the native browser, not an embedded browser - e.g. for iOS push the user to Safari or use <a href=\"https://developer.apple.com/library/ios/documentation/SafariServices/Reference/SFSafariViewController_Ref/\" target=\"_blank\" rel=\"noopener\">SFSafariViewController</a>, don’t use an embedded <a href=\"https://developer.apple.com/library/ios/documentation/WebKit/Reference/WKWebView_Ref/\" target=\"_blank\" rel=\"noopener\">WKWebView</a>).</p>\n"},{"title":"nginx功能解密","date":"2018-11-20T04:24:30.000Z","_content":"\n来自：[编程无界](https://mp.weixin.qq.com/s/DDbLVj0jxpfOmJDZxt9SYg)（微信号：qianshic），作者：假不理\n\n> 本文旨在用最通俗的语言讲述最枯燥的基本知识\n\nnginx作为一个高性能的web服务器，想必大家垂涎已久，蠢蠢欲动，想学习一番了吧，语法不多说，网上一大堆。下面博主就nginx的非常常用的几个功能做一些讲述和分析，学会了这几个功能，平常的开发和部署就不是什么问题了。因此希望大家看完之后，能自己装个nginx来学习配置测试，这样才能真正的掌握它。\n\n> 文章提纲：\n>\n> 1. 正向代理\n> 2. 反向代理\n> 3. 透明代理\n> 4. 负载均衡\n> 5. 静态服务器\n> 6. nginx的安装\n\n------\n\n### 1. 正向代理\n\n> 正向代理：内网服务器主动去请求外网的服务的一种行为\n\n光看概念，可能有读者还是搞不明白：什么叫做“正向”，什么叫做“代理”，我们分别来理解一下这两个名词。\n\n> 正向：相同的或一致的方向\n> 代理：自己做不了的事情或者自己不打算做的事情，委托或依靠别人来完成。\n\n借助解释，回归到nginx的概念，正向代理其实就是说客户端无法主动或者不打算完成主动去向某服务器发起请求，而是委托了nginx代理服务器去向服务器发起请求，并且获得处理结果，返回给客户端。\n从下图可以看出：**客户端向目标服务器发起的请求，是由代理服务器代替它向目标主机发起，得到结果之后，通过代理服务器返回给客户端。**\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195547528384.jpg)\n\n\n\n举个栗子：广大社会主义接班人都知道，为了保护祖国的花朵不受外界的乌烟瘴气熏陶，国家对网络做了一些“优化”，正常情况下是不能外网的，但作为程序员的我们如果没有谷歌等搜索引擎的帮助，再销魂的代码也会因此失色，因此，网络上也曾出现过一些fan qiang技术和软件供有需要的人使用，如某VPN等，其实VPN的原理大体上也类似于一个正向代理，也就是需要访问外网的电脑，发起一个访问外网的请求，通过本机上的VPN去寻找一个可以访问国外网站的代理服务器，代理服务器向外国网站发起请求，然后把结果返回给本机。\n\n> 正向代理的配置:\n\n```\nserver {\n    #指定DNS服务器IP地址  \n    resolver 114.114.114.114;   \n    #指定代理端口    \n    listen 8080;  \n    location / {\n        #设定代理服务器的协议和地址（固定不变）    \n        proxy_pass http://$http_host$request_uri;\n    }  \n}\n```\n\n这样就可以做到内网中端口为8080的服务器主动请求到1.2.13.4的主机上，如在Linux下可以：\n\n```\n1curl --proxy proxy_server:8080 http://www.taobao.com/\n```\n\n正向代理的关键配置：\n\n> 1. resolver：DNS服务器IP地址\n> 2. listen：主动发起请求的内网服务器端口\n> 3. proxy_pass：代理服务器的协议和地址\n\n### 2. 反向代理\n\n> 反向代理：reverse proxy，是指用代理服务器来接受客户端发来的请求，然后将请求转发给内网中的上游服务器，上游服务器处理完之后，把结果通过nginx返回给客户端。\n\n上面讲述了正向代理的原理，相信对于反向代理，就很好理解了吧。\n反向代理是对于来自外界的请求，先通过nginx统一接受，然后按需转发给内网中的服务器，并且把处理请求返回给外界客户端，此时代理服务器对外表现的就是一个web服务器，客户端根本不知道“上游服务器”的存在。\n\n\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548421886.jpg)\n\n\n\n举个栗子：一个服务器的80端口只有一个，而服务器中可能有多个项目，如果A项目是端口是8081，B项目是8082，C项目是8083，假设指向该服务器的域名为www.xxx.com，此时访问B项目是www.xxx.com:8082，以此类推其它项目的URL也是要加上一个端口号，这样就很不美观了，这时我们把80端口给nginx服务器，给每个项目分配一个独立的子域名，如A项目是a.xxx.com，并且在nginx中设置每个项目的转发配置，然后对所有项目的访问都由nginx服务器接受，然后根据配置转发给不同的服务器处理。具体流程如下图所示：\n\n\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548507062.jpg)\n\n\n\n\n\n> 反向代理配置:\n\n```\nserver {\n    #监听端口\n    listen 80;\n    #服务器名称，也就是客户端访问的域名地址\n    server_name  a.xxx.com;\n    #nginx日志输出文件\n    access_log  logs/nginx.access.log  main;\n    #nginx错误日志输出文件\n    error_log  logs/nginx.error.log;\n    root   html;\n    index  index.html index.htm index.php;\n    location / {\n        #被代理服务器的地址\n        proxy_pass  http://localhost:8081;\n        #对发送给客户端的URL进行修改的操作\n        proxy_redirect     off;\n        proxy_set_header   Host             $host;\n        proxy_set_header   X-Real-IP        $remote_addr;\n        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;\n        proxy_max_temp_file_size 0;\n   }\n}\n```\n\n这样就可以通过a.xxx.com来访问a项目对应的网站了，而不需要带上难看的端口号。\n反向代理的配置关键点是：\n\n> 1. server_name：代表客户端向服务器发起请求时输入的域名\n> 2. proxy_pass：代表源服务器的访问地址，也就是真正处理请求的服务器（localhost+端口号）。\n\n### 3. 透明代理\n\n> 透明代理：也叫做简单代理，意思客户端向服务端发起请求时，请求会先到达透明代理服务器，代理服务器再把请求转交给真实的源服务器处理，也就是是客户端根本不知道有代理服务器的存在。\n\n举个栗子：它的用法有点类似于拦截器，如某些制度严格的公司里的办公电脑，无论我们用电脑做了什么事情，安全部门都能拦截我们对外发送的任何东西，这是因为电脑在对外发送时，实际上先经过网络上的一个透明的服务器，经过它的处理之后，才接着往外网走，而我们在网上冲浪时，根本没有感知到有拦截器拦截我们的数据和信息。\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548380599.jpg)\n\n\n\n有人说透明代理和反向代理有点像，都是由代理服务器先接受请求，再转发到源服务器。其实本质上是有区别的，透明代理是客户端感知不到代理服务器的存在，而反向代理是客户端感知只有一个代理服务器的存在，因此他们一个是隐藏了自己，一个是隐藏了源服务器。事实上，透明代理和正向代理才是相像的，都是由客户端主动发起请求，代理服务器处理；他们差异点在于：正向代理是代理服务器代替客户端请求，而透明代理是客户端在发起请求时，会先经过透明代理服务器，再达到服务端，在这过程中，客户端是感知不到这个代理服务器的。\n\n### 4. 负载均衡\n\n负载均衡：将服务器接收到的请求按照规则分发的过程，称为负载均衡。负载均衡是反向代理的一种体现。\n\n可能绝大部分人接触到的web项目，刚开始时都是一台服务器就搞定了，但当网站访问量越来越大时，单台服务器就扛不住了，这时候需要增加服务器做成集群来分担流量压力，而在架设这些服务器时，nginx就充当了接受流量和分流的作用了，当请求到nginx服务器时，nginx就可以根据设置好的负载信息，把请求分配到不同的服务器，服务器处理完毕后，nginx获取处理结果返回给客户端，这样，用nginx的反向代理，即可实现了负载均衡。\n\n\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195549241458.jpg)\n\nnginx实现负载均衡有几种模式：\n\n> 1. 轮询：每个请求按时间顺序逐一分配到不同的后端服务器，也是nginx的默认模式。轮询模式的配置很简单，只需要把服务器列表加入到upstream模块中即可。\n\n下面的配置是指：**负载中有三台服务器，当请求到达时，nginx按照时间顺序把请求分配给三台服务器处理。**\n\n```\nupstream serverList {\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n}\n```\n\n> 1. ip_hash：每个请求按访问IP的hash结果分配，同一个IP客户端固定访问一个后端服务器。可以保证来自同一ip的请求被打到固定的机器上，可以解决session问题。\n\n下面的配置是指：**负载中有三台服务器，当请求到达时，nginx优先按照ip_hash的结果进行分配，也就是同一个IP的请求固定在某一台服务器上，其它则按时间顺序把请求分配给三台服务器处理。**\n\n```\nupstream serverList {\n    ip_hash\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n}\n```\n\n> 1. url_hash：按访问url的hash结果来分配请求，相同的url固定转发到同一个后端服务器处理。\n\n```\nupstream serverList {\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n    hash $request_uri;\n    hash_method crc32;\n}\n```\n\n> 1. fair：按后端服务器的响应时间来分配请求，响应时间短的优先分配。\n\n```\nupstream serverList {\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n    fair;\n}\n```\n\n而在每一种模式中，每一台服务器后面的可以携带的参数有：\n\n> 1. down: 当前服务器暂不参与负载\n> 2. weight: 权重，值越大，服务器的负载量越大。\n> 3. max_fails：允许请求失败的次数，默认为1。\n> 4. fail_timeout:max_fails次失败后暂停的时间。\n> 5. backup：备份机， 只有其它所有的非backup机器down或者忙时才会请求backup机器。\n\n如下面的配置是指：**负载中有三台服务器，当请求到达时，nginx按时间顺序和权重把请求分配给三台服务器处理，例如有100个请求，有30%是服务器4处理，有50%的请求是服务器5处理，有20%的请求是服务器6处理。**\n\n```\nupstream serverList {\n    server 1.2.3.4 weight=30;\n    server 1.2.3.5 weight=50;\n    server 1.2.3.6 weight=20;\n}\n```\n\n如下面的配置是指：**负载中有三台服务器，服务器4的失败超时时间为60s，服务器5暂不参与负载，服务器6只用作备份机。**\n\n```\nupstream serverList {\n    server 1.2.3.4 fail_timeout=60s;\n    server 1.2.3.5 down;\n    server 1.2.3.6 backup;\n}\n```\n\n> 下面是一个配置负载均衡的示例（只写了关键配置）：\n> 其中：\n>\n> 1. upstream：是负载的配置模块，serverList是名称，随便起\n> 2. server_name：是客户端请求的域名地址\n> 3. proxy_pass：是指向负载的列表的模块，如serverList\n\n```\nupstream serverList {\n    server 1.2.3.4 weight=30;\n    server 1.2.3.5 down;\n    server 1.2.3.6 backup;\n}   \n\nserver {\n    listen 80;\n    server_name  www.xxx.com;\n    root   html;\n    index  index.html index.htm index.php;\n    location / {\n        proxy_pass  http://serverList;\n        proxy_redirect     off;\n        proxy_set_header   Host             $host;\n   }\n}\n```\n\n### 5. 静态服务器\n\n现在很多项目流行前后分离，也就是前端服务器和后端服务器分离，分别部署，这样的方式能让前后端人员能各司其职，不需要互相依赖，而前后分离中，前端项目的运行是不需要用Tomcat、Apache等服务器环境的，因此可以直接用nginx来作为静态服务器。\n\n> 静态服务器的配置如下,其中关键配置为：\n>\n> 1. root：直接静态项目的绝对路径的根目录。\n> 2. server_name : 静态网站访问的域名地址。\n\n```\nserver {\n        listen       80;                                                         \n        server_name  www.xxx.com;                                               \n        client_max_body_size 1024M;\n        location / {\n               root   /var/www/xxx_static;\n               index  index.html;\n           }\n    }\n```\n\n### 6. nginx的安装\n\n学了这么多nginx的配置用法之后，我们需要对每一个知识点做一下测试，才能印象深刻，在此之前，我们需要知道nginx是怎么安装，下面以Linux环境为例，简述yum方式安装nginx的步骤：\n\n1. 安装依赖：\n\n```\n//一键安装上面四个依赖\nyum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel\n```\n\n1. 安装nginx：\n\n```\nyum install nginx\n```\n\n1. 检查是否安装成功：\n\n```\nnginx -v\n```\n\n1. 启动/挺尸nginx：\n\n```\n/etc/init.d/nginx start\n/etc/init.d/nginx stop\n```\n\n1. 编辑配置文件：\n\n```\n/etc/nginx/nginx.conf\n```\n\n这些步骤都完成之后，我们就可以进入nginx的配置文件nginx.conf对上面的各个知识点，进行配置和测试了。\n","source":"_posts/0008-nginx-all.md","raw":"---\ntitle: nginx功能解密\ndate: 2018-11-20 12:24:30\ntags:\n    - nginx\n---\n\n来自：[编程无界](https://mp.weixin.qq.com/s/DDbLVj0jxpfOmJDZxt9SYg)（微信号：qianshic），作者：假不理\n\n> 本文旨在用最通俗的语言讲述最枯燥的基本知识\n\nnginx作为一个高性能的web服务器，想必大家垂涎已久，蠢蠢欲动，想学习一番了吧，语法不多说，网上一大堆。下面博主就nginx的非常常用的几个功能做一些讲述和分析，学会了这几个功能，平常的开发和部署就不是什么问题了。因此希望大家看完之后，能自己装个nginx来学习配置测试，这样才能真正的掌握它。\n\n> 文章提纲：\n>\n> 1. 正向代理\n> 2. 反向代理\n> 3. 透明代理\n> 4. 负载均衡\n> 5. 静态服务器\n> 6. nginx的安装\n\n------\n\n### 1. 正向代理\n\n> 正向代理：内网服务器主动去请求外网的服务的一种行为\n\n光看概念，可能有读者还是搞不明白：什么叫做“正向”，什么叫做“代理”，我们分别来理解一下这两个名词。\n\n> 正向：相同的或一致的方向\n> 代理：自己做不了的事情或者自己不打算做的事情，委托或依靠别人来完成。\n\n借助解释，回归到nginx的概念，正向代理其实就是说客户端无法主动或者不打算完成主动去向某服务器发起请求，而是委托了nginx代理服务器去向服务器发起请求，并且获得处理结果，返回给客户端。\n从下图可以看出：**客户端向目标服务器发起的请求，是由代理服务器代替它向目标主机发起，得到结果之后，通过代理服务器返回给客户端。**\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195547528384.jpg)\n\n\n\n举个栗子：广大社会主义接班人都知道，为了保护祖国的花朵不受外界的乌烟瘴气熏陶，国家对网络做了一些“优化”，正常情况下是不能外网的，但作为程序员的我们如果没有谷歌等搜索引擎的帮助，再销魂的代码也会因此失色，因此，网络上也曾出现过一些fan qiang技术和软件供有需要的人使用，如某VPN等，其实VPN的原理大体上也类似于一个正向代理，也就是需要访问外网的电脑，发起一个访问外网的请求，通过本机上的VPN去寻找一个可以访问国外网站的代理服务器，代理服务器向外国网站发起请求，然后把结果返回给本机。\n\n> 正向代理的配置:\n\n```\nserver {\n    #指定DNS服务器IP地址  \n    resolver 114.114.114.114;   \n    #指定代理端口    \n    listen 8080;  \n    location / {\n        #设定代理服务器的协议和地址（固定不变）    \n        proxy_pass http://$http_host$request_uri;\n    }  \n}\n```\n\n这样就可以做到内网中端口为8080的服务器主动请求到1.2.13.4的主机上，如在Linux下可以：\n\n```\n1curl --proxy proxy_server:8080 http://www.taobao.com/\n```\n\n正向代理的关键配置：\n\n> 1. resolver：DNS服务器IP地址\n> 2. listen：主动发起请求的内网服务器端口\n> 3. proxy_pass：代理服务器的协议和地址\n\n### 2. 反向代理\n\n> 反向代理：reverse proxy，是指用代理服务器来接受客户端发来的请求，然后将请求转发给内网中的上游服务器，上游服务器处理完之后，把结果通过nginx返回给客户端。\n\n上面讲述了正向代理的原理，相信对于反向代理，就很好理解了吧。\n反向代理是对于来自外界的请求，先通过nginx统一接受，然后按需转发给内网中的服务器，并且把处理请求返回给外界客户端，此时代理服务器对外表现的就是一个web服务器，客户端根本不知道“上游服务器”的存在。\n\n\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548421886.jpg)\n\n\n\n举个栗子：一个服务器的80端口只有一个，而服务器中可能有多个项目，如果A项目是端口是8081，B项目是8082，C项目是8083，假设指向该服务器的域名为www.xxx.com，此时访问B项目是www.xxx.com:8082，以此类推其它项目的URL也是要加上一个端口号，这样就很不美观了，这时我们把80端口给nginx服务器，给每个项目分配一个独立的子域名，如A项目是a.xxx.com，并且在nginx中设置每个项目的转发配置，然后对所有项目的访问都由nginx服务器接受，然后根据配置转发给不同的服务器处理。具体流程如下图所示：\n\n\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548507062.jpg)\n\n\n\n\n\n> 反向代理配置:\n\n```\nserver {\n    #监听端口\n    listen 80;\n    #服务器名称，也就是客户端访问的域名地址\n    server_name  a.xxx.com;\n    #nginx日志输出文件\n    access_log  logs/nginx.access.log  main;\n    #nginx错误日志输出文件\n    error_log  logs/nginx.error.log;\n    root   html;\n    index  index.html index.htm index.php;\n    location / {\n        #被代理服务器的地址\n        proxy_pass  http://localhost:8081;\n        #对发送给客户端的URL进行修改的操作\n        proxy_redirect     off;\n        proxy_set_header   Host             $host;\n        proxy_set_header   X-Real-IP        $remote_addr;\n        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;\n        proxy_max_temp_file_size 0;\n   }\n}\n```\n\n这样就可以通过a.xxx.com来访问a项目对应的网站了，而不需要带上难看的端口号。\n反向代理的配置关键点是：\n\n> 1. server_name：代表客户端向服务器发起请求时输入的域名\n> 2. proxy_pass：代表源服务器的访问地址，也就是真正处理请求的服务器（localhost+端口号）。\n\n### 3. 透明代理\n\n> 透明代理：也叫做简单代理，意思客户端向服务端发起请求时，请求会先到达透明代理服务器，代理服务器再把请求转交给真实的源服务器处理，也就是是客户端根本不知道有代理服务器的存在。\n\n举个栗子：它的用法有点类似于拦截器，如某些制度严格的公司里的办公电脑，无论我们用电脑做了什么事情，安全部门都能拦截我们对外发送的任何东西，这是因为电脑在对外发送时，实际上先经过网络上的一个透明的服务器，经过它的处理之后，才接着往外网走，而我们在网上冲浪时，根本没有感知到有拦截器拦截我们的数据和信息。\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548380599.jpg)\n\n\n\n有人说透明代理和反向代理有点像，都是由代理服务器先接受请求，再转发到源服务器。其实本质上是有区别的，透明代理是客户端感知不到代理服务器的存在，而反向代理是客户端感知只有一个代理服务器的存在，因此他们一个是隐藏了自己，一个是隐藏了源服务器。事实上，透明代理和正向代理才是相像的，都是由客户端主动发起请求，代理服务器处理；他们差异点在于：正向代理是代理服务器代替客户端请求，而透明代理是客户端在发起请求时，会先经过透明代理服务器，再达到服务端，在这过程中，客户端是感知不到这个代理服务器的。\n\n### 4. 负载均衡\n\n负载均衡：将服务器接收到的请求按照规则分发的过程，称为负载均衡。负载均衡是反向代理的一种体现。\n\n可能绝大部分人接触到的web项目，刚开始时都是一台服务器就搞定了，但当网站访问量越来越大时，单台服务器就扛不住了，这时候需要增加服务器做成集群来分担流量压力，而在架设这些服务器时，nginx就充当了接受流量和分流的作用了，当请求到nginx服务器时，nginx就可以根据设置好的负载信息，把请求分配到不同的服务器，服务器处理完毕后，nginx获取处理结果返回给客户端，这样，用nginx的反向代理，即可实现了负载均衡。\n\n\n\n![img](https://www.itcodemonkey.com/data/upload/portal/20181114/1542195549241458.jpg)\n\nnginx实现负载均衡有几种模式：\n\n> 1. 轮询：每个请求按时间顺序逐一分配到不同的后端服务器，也是nginx的默认模式。轮询模式的配置很简单，只需要把服务器列表加入到upstream模块中即可。\n\n下面的配置是指：**负载中有三台服务器，当请求到达时，nginx按照时间顺序把请求分配给三台服务器处理。**\n\n```\nupstream serverList {\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n}\n```\n\n> 1. ip_hash：每个请求按访问IP的hash结果分配，同一个IP客户端固定访问一个后端服务器。可以保证来自同一ip的请求被打到固定的机器上，可以解决session问题。\n\n下面的配置是指：**负载中有三台服务器，当请求到达时，nginx优先按照ip_hash的结果进行分配，也就是同一个IP的请求固定在某一台服务器上，其它则按时间顺序把请求分配给三台服务器处理。**\n\n```\nupstream serverList {\n    ip_hash\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n}\n```\n\n> 1. url_hash：按访问url的hash结果来分配请求，相同的url固定转发到同一个后端服务器处理。\n\n```\nupstream serverList {\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n    hash $request_uri;\n    hash_method crc32;\n}\n```\n\n> 1. fair：按后端服务器的响应时间来分配请求，响应时间短的优先分配。\n\n```\nupstream serverList {\n    server 1.2.3.4;\n    server 1.2.3.5;\n    server 1.2.3.6;\n    fair;\n}\n```\n\n而在每一种模式中，每一台服务器后面的可以携带的参数有：\n\n> 1. down: 当前服务器暂不参与负载\n> 2. weight: 权重，值越大，服务器的负载量越大。\n> 3. max_fails：允许请求失败的次数，默认为1。\n> 4. fail_timeout:max_fails次失败后暂停的时间。\n> 5. backup：备份机， 只有其它所有的非backup机器down或者忙时才会请求backup机器。\n\n如下面的配置是指：**负载中有三台服务器，当请求到达时，nginx按时间顺序和权重把请求分配给三台服务器处理，例如有100个请求，有30%是服务器4处理，有50%的请求是服务器5处理，有20%的请求是服务器6处理。**\n\n```\nupstream serverList {\n    server 1.2.3.4 weight=30;\n    server 1.2.3.5 weight=50;\n    server 1.2.3.6 weight=20;\n}\n```\n\n如下面的配置是指：**负载中有三台服务器，服务器4的失败超时时间为60s，服务器5暂不参与负载，服务器6只用作备份机。**\n\n```\nupstream serverList {\n    server 1.2.3.4 fail_timeout=60s;\n    server 1.2.3.5 down;\n    server 1.2.3.6 backup;\n}\n```\n\n> 下面是一个配置负载均衡的示例（只写了关键配置）：\n> 其中：\n>\n> 1. upstream：是负载的配置模块，serverList是名称，随便起\n> 2. server_name：是客户端请求的域名地址\n> 3. proxy_pass：是指向负载的列表的模块，如serverList\n\n```\nupstream serverList {\n    server 1.2.3.4 weight=30;\n    server 1.2.3.5 down;\n    server 1.2.3.6 backup;\n}   \n\nserver {\n    listen 80;\n    server_name  www.xxx.com;\n    root   html;\n    index  index.html index.htm index.php;\n    location / {\n        proxy_pass  http://serverList;\n        proxy_redirect     off;\n        proxy_set_header   Host             $host;\n   }\n}\n```\n\n### 5. 静态服务器\n\n现在很多项目流行前后分离，也就是前端服务器和后端服务器分离，分别部署，这样的方式能让前后端人员能各司其职，不需要互相依赖，而前后分离中，前端项目的运行是不需要用Tomcat、Apache等服务器环境的，因此可以直接用nginx来作为静态服务器。\n\n> 静态服务器的配置如下,其中关键配置为：\n>\n> 1. root：直接静态项目的绝对路径的根目录。\n> 2. server_name : 静态网站访问的域名地址。\n\n```\nserver {\n        listen       80;                                                         \n        server_name  www.xxx.com;                                               \n        client_max_body_size 1024M;\n        location / {\n               root   /var/www/xxx_static;\n               index  index.html;\n           }\n    }\n```\n\n### 6. nginx的安装\n\n学了这么多nginx的配置用法之后，我们需要对每一个知识点做一下测试，才能印象深刻，在此之前，我们需要知道nginx是怎么安装，下面以Linux环境为例，简述yum方式安装nginx的步骤：\n\n1. 安装依赖：\n\n```\n//一键安装上面四个依赖\nyum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel\n```\n\n1. 安装nginx：\n\n```\nyum install nginx\n```\n\n1. 检查是否安装成功：\n\n```\nnginx -v\n```\n\n1. 启动/挺尸nginx：\n\n```\n/etc/init.d/nginx start\n/etc/init.d/nginx stop\n```\n\n1. 编辑配置文件：\n\n```\n/etc/nginx/nginx.conf\n```\n\n这些步骤都完成之后，我们就可以进入nginx的配置文件nginx.conf对上面的各个知识点，进行配置和测试了。\n","slug":"0008-nginx-all","published":1,"updated":"2018-11-20T03:55:20.092Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t7u003dgcoi2dps2g5v","content":"<p>来自：<a href=\"https://mp.weixin.qq.com/s/DDbLVj0jxpfOmJDZxt9SYg\" target=\"_blank\" rel=\"noopener\">编程无界</a>（微信号：qianshic），作者：假不理</p>\n<blockquote>\n<p>本文旨在用最通俗的语言讲述最枯燥的基本知识</p>\n</blockquote>\n<p>nginx作为一个高性能的web服务器，想必大家垂涎已久，蠢蠢欲动，想学习一番了吧，语法不多说，网上一大堆。下面博主就nginx的非常常用的几个功能做一些讲述和分析，学会了这几个功能，平常的开发和部署就不是什么问题了。因此希望大家看完之后，能自己装个nginx来学习配置测试，这样才能真正的掌握它。</p>\n<blockquote>\n<p>文章提纲：</p>\n<ol>\n<li>正向代理</li>\n<li>反向代理</li>\n<li>透明代理</li>\n<li>负载均衡</li>\n<li>静态服务器</li>\n<li>nginx的安装</li>\n</ol>\n</blockquote>\n<hr>\n<h3 id=\"1-正向代理\"><a href=\"#1-正向代理\" class=\"headerlink\" title=\"1. 正向代理\"></a>1. 正向代理</h3><blockquote>\n<p>正向代理：内网服务器主动去请求外网的服务的一种行为</p>\n</blockquote>\n<p>光看概念，可能有读者还是搞不明白：什么叫做“正向”，什么叫做“代理”，我们分别来理解一下这两个名词。</p>\n<blockquote>\n<p>正向：相同的或一致的方向<br>代理：自己做不了的事情或者自己不打算做的事情，委托或依靠别人来完成。</p>\n</blockquote>\n<p>借助解释，回归到nginx的概念，正向代理其实就是说客户端无法主动或者不打算完成主动去向某服务器发起请求，而是委托了nginx代理服务器去向服务器发起请求，并且获得处理结果，返回给客户端。<br>从下图可以看出：<strong>客户端向目标服务器发起的请求，是由代理服务器代替它向目标主机发起，得到结果之后，通过代理服务器返回给客户端。</strong></p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195547528384.jpg\" alt=\"img\"></p>\n<p>举个栗子：广大社会主义接班人都知道，为了保护祖国的花朵不受外界的乌烟瘴气熏陶，国家对网络做了一些“优化”，正常情况下是不能外网的，但作为程序员的我们如果没有谷歌等搜索引擎的帮助，再销魂的代码也会因此失色，因此，网络上也曾出现过一些fan qiang技术和软件供有需要的人使用，如某VPN等，其实VPN的原理大体上也类似于一个正向代理，也就是需要访问外网的电脑，发起一个访问外网的请求，通过本机上的VPN去寻找一个可以访问国外网站的代理服务器，代理服务器向外国网站发起请求，然后把结果返回给本机。</p>\n<blockquote>\n<p>正向代理的配置:</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    #指定DNS服务器IP地址  </span><br><span class=\"line\">    resolver 114.114.114.114;   </span><br><span class=\"line\">    #指定代理端口    </span><br><span class=\"line\">    listen 8080;  </span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        #设定代理服务器的协议和地址（固定不变）    </span><br><span class=\"line\">        proxy_pass http://$http_host$request_uri;</span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就可以做到内网中端口为8080的服务器主动请求到1.2.13.4的主机上，如在Linux下可以：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1curl --proxy proxy_server:8080 http://www.taobao.com/</span><br></pre></td></tr></table></figure>\n<p>正向代理的关键配置：</p>\n<blockquote>\n<ol>\n<li>resolver：DNS服务器IP地址</li>\n<li>listen：主动发起请求的内网服务器端口</li>\n<li>proxy_pass：代理服务器的协议和地址</li>\n</ol>\n</blockquote>\n<h3 id=\"2-反向代理\"><a href=\"#2-反向代理\" class=\"headerlink\" title=\"2. 反向代理\"></a>2. 反向代理</h3><blockquote>\n<p>反向代理：reverse proxy，是指用代理服务器来接受客户端发来的请求，然后将请求转发给内网中的上游服务器，上游服务器处理完之后，把结果通过nginx返回给客户端。</p>\n</blockquote>\n<p>上面讲述了正向代理的原理，相信对于反向代理，就很好理解了吧。<br>反向代理是对于来自外界的请求，先通过nginx统一接受，然后按需转发给内网中的服务器，并且把处理请求返回给外界客户端，此时代理服务器对外表现的就是一个web服务器，客户端根本不知道“上游服务器”的存在。</p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548421886.jpg\" alt=\"img\"></p>\n<p>举个栗子：一个服务器的80端口只有一个，而服务器中可能有多个项目，如果A项目是端口是8081，B项目是8082，C项目是8083，假设指向该服务器的域名为<a href=\"http://www.xxx.com，此时访问B项目是www.xxx.com:8082，以此类推其它项目的URL也是要加上一个端口号，这样就很不美观了，这时我们把80端口给nginx服务器，给每个项目分配一个独立的子域名，如A项目是a.xxx.com，并且在nginx中设置每个项目的转发配置，然后对所有项目的访问都由nginx服务器接受，然后根据配置转发给不同的服务器处理。具体流程如下图所示：\" target=\"_blank\" rel=\"noopener\">www.xxx.com，此时访问B项目是www.xxx.com:8082，以此类推其它项目的URL也是要加上一个端口号，这样就很不美观了，这时我们把80端口给nginx服务器，给每个项目分配一个独立的子域名，如A项目是a.xxx.com，并且在nginx中设置每个项目的转发配置，然后对所有项目的访问都由nginx服务器接受，然后根据配置转发给不同的服务器处理。具体流程如下图所示：</a></p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548507062.jpg\" alt=\"img\"></p>\n<blockquote>\n<p>反向代理配置:</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    #监听端口</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    #服务器名称，也就是客户端访问的域名地址</span><br><span class=\"line\">    server_name  a.xxx.com;</span><br><span class=\"line\">    #nginx日志输出文件</span><br><span class=\"line\">    access_log  logs/nginx.access.log  main;</span><br><span class=\"line\">    #nginx错误日志输出文件</span><br><span class=\"line\">    error_log  logs/nginx.error.log;</span><br><span class=\"line\">    root   html;</span><br><span class=\"line\">    index  index.html index.htm index.php;</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        #被代理服务器的地址</span><br><span class=\"line\">        proxy_pass  http://localhost:8081;</span><br><span class=\"line\">        #对发送给客户端的URL进行修改的操作</span><br><span class=\"line\">        proxy_redirect     off;</span><br><span class=\"line\">        proxy_set_header   Host             $host;</span><br><span class=\"line\">        proxy_set_header   X-Real-IP        $remote_addr;</span><br><span class=\"line\">        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class=\"line\">        proxy_max_temp_file_size 0;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就可以通过a.xxx.com来访问a项目对应的网站了，而不需要带上难看的端口号。<br>反向代理的配置关键点是：</p>\n<blockquote>\n<ol>\n<li>server_name：代表客户端向服务器发起请求时输入的域名</li>\n<li>proxy_pass：代表源服务器的访问地址，也就是真正处理请求的服务器（localhost+端口号）。</li>\n</ol>\n</blockquote>\n<h3 id=\"3-透明代理\"><a href=\"#3-透明代理\" class=\"headerlink\" title=\"3. 透明代理\"></a>3. 透明代理</h3><blockquote>\n<p>透明代理：也叫做简单代理，意思客户端向服务端发起请求时，请求会先到达透明代理服务器，代理服务器再把请求转交给真实的源服务器处理，也就是是客户端根本不知道有代理服务器的存在。</p>\n</blockquote>\n<p>举个栗子：它的用法有点类似于拦截器，如某些制度严格的公司里的办公电脑，无论我们用电脑做了什么事情，安全部门都能拦截我们对外发送的任何东西，这是因为电脑在对外发送时，实际上先经过网络上的一个透明的服务器，经过它的处理之后，才接着往外网走，而我们在网上冲浪时，根本没有感知到有拦截器拦截我们的数据和信息。</p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548380599.jpg\" alt=\"img\"></p>\n<p>有人说透明代理和反向代理有点像，都是由代理服务器先接受请求，再转发到源服务器。其实本质上是有区别的，透明代理是客户端感知不到代理服务器的存在，而反向代理是客户端感知只有一个代理服务器的存在，因此他们一个是隐藏了自己，一个是隐藏了源服务器。事实上，透明代理和正向代理才是相像的，都是由客户端主动发起请求，代理服务器处理；他们差异点在于：正向代理是代理服务器代替客户端请求，而透明代理是客户端在发起请求时，会先经过透明代理服务器，再达到服务端，在这过程中，客户端是感知不到这个代理服务器的。</p>\n<h3 id=\"4-负载均衡\"><a href=\"#4-负载均衡\" class=\"headerlink\" title=\"4. 负载均衡\"></a>4. 负载均衡</h3><p>负载均衡：将服务器接收到的请求按照规则分发的过程，称为负载均衡。负载均衡是反向代理的一种体现。</p>\n<p>可能绝大部分人接触到的web项目，刚开始时都是一台服务器就搞定了，但当网站访问量越来越大时，单台服务器就扛不住了，这时候需要增加服务器做成集群来分担流量压力，而在架设这些服务器时，nginx就充当了接受流量和分流的作用了，当请求到nginx服务器时，nginx就可以根据设置好的负载信息，把请求分配到不同的服务器，服务器处理完毕后，nginx获取处理结果返回给客户端，这样，用nginx的反向代理，即可实现了负载均衡。</p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195549241458.jpg\" alt=\"img\"></p>\n<p>nginx实现负载均衡有几种模式：</p>\n<blockquote>\n<ol>\n<li>轮询：每个请求按时间顺序逐一分配到不同的后端服务器，也是nginx的默认模式。轮询模式的配置很简单，只需要把服务器列表加入到upstream模块中即可。</li>\n</ol>\n</blockquote>\n<p>下面的配置是指：<strong>负载中有三台服务器，当请求到达时，nginx按照时间顺序把请求分配给三台服务器处理。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<ol>\n<li>ip_hash：每个请求按访问IP的hash结果分配，同一个IP客户端固定访问一个后端服务器。可以保证来自同一ip的请求被打到固定的机器上，可以解决session问题。</li>\n</ol>\n</blockquote>\n<p>下面的配置是指：<strong>负载中有三台服务器，当请求到达时，nginx优先按照ip_hash的结果进行分配，也就是同一个IP的请求固定在某一台服务器上，其它则按时间顺序把请求分配给三台服务器处理。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    ip_hash</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<ol>\n<li>url_hash：按访问url的hash结果来分配请求，相同的url固定转发到同一个后端服务器处理。</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">    hash $request_uri;</span><br><span class=\"line\">    hash_method crc32;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<ol>\n<li>fair：按后端服务器的响应时间来分配请求，响应时间短的优先分配。</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">    fair;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>而在每一种模式中，每一台服务器后面的可以携带的参数有：</p>\n<blockquote>\n<ol>\n<li>down: 当前服务器暂不参与负载</li>\n<li>weight: 权重，值越大，服务器的负载量越大。</li>\n<li>max_fails：允许请求失败的次数，默认为1。</li>\n<li>fail_timeout:max_fails次失败后暂停的时间。</li>\n<li>backup：备份机， 只有其它所有的非backup机器down或者忙时才会请求backup机器。</li>\n</ol>\n</blockquote>\n<p>如下面的配置是指：<strong>负载中有三台服务器，当请求到达时，nginx按时间顺序和权重把请求分配给三台服务器处理，例如有100个请求，有30%是服务器4处理，有50%的请求是服务器5处理，有20%的请求是服务器6处理。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4 weight=30;</span><br><span class=\"line\">    server 1.2.3.5 weight=50;</span><br><span class=\"line\">    server 1.2.3.6 weight=20;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如下面的配置是指：<strong>负载中有三台服务器，服务器4的失败超时时间为60s，服务器5暂不参与负载，服务器6只用作备份机。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4 fail_timeout=60s;</span><br><span class=\"line\">    server 1.2.3.5 down;</span><br><span class=\"line\">    server 1.2.3.6 backup;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>下面是一个配置负载均衡的示例（只写了关键配置）：<br>其中：</p>\n<ol>\n<li>upstream：是负载的配置模块，serverList是名称，随便起</li>\n<li>server_name：是客户端请求的域名地址</li>\n<li>proxy_pass：是指向负载的列表的模块，如serverList</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4 weight=30;</span><br><span class=\"line\">    server 1.2.3.5 down;</span><br><span class=\"line\">    server 1.2.3.6 backup;</span><br><span class=\"line\">&#125;   </span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name  www.xxx.com;</span><br><span class=\"line\">    root   html;</span><br><span class=\"line\">    index  index.html index.htm index.php;</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass  http://serverList;</span><br><span class=\"line\">        proxy_redirect     off;</span><br><span class=\"line\">        proxy_set_header   Host             $host;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-静态服务器\"><a href=\"#5-静态服务器\" class=\"headerlink\" title=\"5. 静态服务器\"></a>5. 静态服务器</h3><p>现在很多项目流行前后分离，也就是前端服务器和后端服务器分离，分别部署，这样的方式能让前后端人员能各司其职，不需要互相依赖，而前后分离中，前端项目的运行是不需要用Tomcat、Apache等服务器环境的，因此可以直接用nginx来作为静态服务器。</p>\n<blockquote>\n<p>静态服务器的配置如下,其中关键配置为：</p>\n<ol>\n<li>root：直接静态项目的绝对路径的根目录。</li>\n<li>server_name : 静态网站访问的域名地址。</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       80;                                                         </span><br><span class=\"line\">        server_name  www.xxx.com;                                               </span><br><span class=\"line\">        client_max_body_size 1024M;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">               root   /var/www/xxx_static;</span><br><span class=\"line\">               index  index.html;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-nginx的安装\"><a href=\"#6-nginx的安装\" class=\"headerlink\" title=\"6. nginx的安装\"></a>6. nginx的安装</h3><p>学了这么多nginx的配置用法之后，我们需要对每一个知识点做一下测试，才能印象深刻，在此之前，我们需要知道nginx是怎么安装，下面以Linux环境为例，简述yum方式安装nginx的步骤：</p>\n<ol>\n<li>安装依赖：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//一键安装上面四个依赖</span><br><span class=\"line\">yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel</span><br></pre></td></tr></table></figure>\n<ol>\n<li>安装nginx：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install nginx</span><br></pre></td></tr></table></figure>\n<ol>\n<li>检查是否安装成功：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -v</span><br></pre></td></tr></table></figure>\n<ol>\n<li>启动/挺尸nginx：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/nginx start</span><br><span class=\"line\">/etc/init.d/nginx stop</span><br></pre></td></tr></table></figure>\n<ol>\n<li>编辑配置文件：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>\n<p>这些步骤都完成之后，我们就可以进入nginx的配置文件nginx.conf对上面的各个知识点，进行配置和测试了。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>来自：<a href=\"https://mp.weixin.qq.com/s/DDbLVj0jxpfOmJDZxt9SYg\" target=\"_blank\" rel=\"noopener\">编程无界</a>（微信号：qianshic），作者：假不理</p>\n<blockquote>\n<p>本文旨在用最通俗的语言讲述最枯燥的基本知识</p>\n</blockquote>\n<p>nginx作为一个高性能的web服务器，想必大家垂涎已久，蠢蠢欲动，想学习一番了吧，语法不多说，网上一大堆。下面博主就nginx的非常常用的几个功能做一些讲述和分析，学会了这几个功能，平常的开发和部署就不是什么问题了。因此希望大家看完之后，能自己装个nginx来学习配置测试，这样才能真正的掌握它。</p>\n<blockquote>\n<p>文章提纲：</p>\n<ol>\n<li>正向代理</li>\n<li>反向代理</li>\n<li>透明代理</li>\n<li>负载均衡</li>\n<li>静态服务器</li>\n<li>nginx的安装</li>\n</ol>\n</blockquote>\n<hr>\n<h3 id=\"1-正向代理\"><a href=\"#1-正向代理\" class=\"headerlink\" title=\"1. 正向代理\"></a>1. 正向代理</h3><blockquote>\n<p>正向代理：内网服务器主动去请求外网的服务的一种行为</p>\n</blockquote>\n<p>光看概念，可能有读者还是搞不明白：什么叫做“正向”，什么叫做“代理”，我们分别来理解一下这两个名词。</p>\n<blockquote>\n<p>正向：相同的或一致的方向<br>代理：自己做不了的事情或者自己不打算做的事情，委托或依靠别人来完成。</p>\n</blockquote>\n<p>借助解释，回归到nginx的概念，正向代理其实就是说客户端无法主动或者不打算完成主动去向某服务器发起请求，而是委托了nginx代理服务器去向服务器发起请求，并且获得处理结果，返回给客户端。<br>从下图可以看出：<strong>客户端向目标服务器发起的请求，是由代理服务器代替它向目标主机发起，得到结果之后，通过代理服务器返回给客户端。</strong></p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195547528384.jpg\" alt=\"img\"></p>\n<p>举个栗子：广大社会主义接班人都知道，为了保护祖国的花朵不受外界的乌烟瘴气熏陶，国家对网络做了一些“优化”，正常情况下是不能外网的，但作为程序员的我们如果没有谷歌等搜索引擎的帮助，再销魂的代码也会因此失色，因此，网络上也曾出现过一些fan qiang技术和软件供有需要的人使用，如某VPN等，其实VPN的原理大体上也类似于一个正向代理，也就是需要访问外网的电脑，发起一个访问外网的请求，通过本机上的VPN去寻找一个可以访问国外网站的代理服务器，代理服务器向外国网站发起请求，然后把结果返回给本机。</p>\n<blockquote>\n<p>正向代理的配置:</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    #指定DNS服务器IP地址  </span><br><span class=\"line\">    resolver 114.114.114.114;   </span><br><span class=\"line\">    #指定代理端口    </span><br><span class=\"line\">    listen 8080;  </span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        #设定代理服务器的协议和地址（固定不变）    </span><br><span class=\"line\">        proxy_pass http://$http_host$request_uri;</span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就可以做到内网中端口为8080的服务器主动请求到1.2.13.4的主机上，如在Linux下可以：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1curl --proxy proxy_server:8080 http://www.taobao.com/</span><br></pre></td></tr></table></figure>\n<p>正向代理的关键配置：</p>\n<blockquote>\n<ol>\n<li>resolver：DNS服务器IP地址</li>\n<li>listen：主动发起请求的内网服务器端口</li>\n<li>proxy_pass：代理服务器的协议和地址</li>\n</ol>\n</blockquote>\n<h3 id=\"2-反向代理\"><a href=\"#2-反向代理\" class=\"headerlink\" title=\"2. 反向代理\"></a>2. 反向代理</h3><blockquote>\n<p>反向代理：reverse proxy，是指用代理服务器来接受客户端发来的请求，然后将请求转发给内网中的上游服务器，上游服务器处理完之后，把结果通过nginx返回给客户端。</p>\n</blockquote>\n<p>上面讲述了正向代理的原理，相信对于反向代理，就很好理解了吧。<br>反向代理是对于来自外界的请求，先通过nginx统一接受，然后按需转发给内网中的服务器，并且把处理请求返回给外界客户端，此时代理服务器对外表现的就是一个web服务器，客户端根本不知道“上游服务器”的存在。</p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548421886.jpg\" alt=\"img\"></p>\n<p>举个栗子：一个服务器的80端口只有一个，而服务器中可能有多个项目，如果A项目是端口是8081，B项目是8082，C项目是8083，假设指向该服务器的域名为<a href=\"http://www.xxx.com，此时访问B项目是www.xxx.com:8082，以此类推其它项目的URL也是要加上一个端口号，这样就很不美观了，这时我们把80端口给nginx服务器，给每个项目分配一个独立的子域名，如A项目是a.xxx.com，并且在nginx中设置每个项目的转发配置，然后对所有项目的访问都由nginx服务器接受，然后根据配置转发给不同的服务器处理。具体流程如下图所示：\" target=\"_blank\" rel=\"noopener\">www.xxx.com，此时访问B项目是www.xxx.com:8082，以此类推其它项目的URL也是要加上一个端口号，这样就很不美观了，这时我们把80端口给nginx服务器，给每个项目分配一个独立的子域名，如A项目是a.xxx.com，并且在nginx中设置每个项目的转发配置，然后对所有项目的访问都由nginx服务器接受，然后根据配置转发给不同的服务器处理。具体流程如下图所示：</a></p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548507062.jpg\" alt=\"img\"></p>\n<blockquote>\n<p>反向代理配置:</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    #监听端口</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    #服务器名称，也就是客户端访问的域名地址</span><br><span class=\"line\">    server_name  a.xxx.com;</span><br><span class=\"line\">    #nginx日志输出文件</span><br><span class=\"line\">    access_log  logs/nginx.access.log  main;</span><br><span class=\"line\">    #nginx错误日志输出文件</span><br><span class=\"line\">    error_log  logs/nginx.error.log;</span><br><span class=\"line\">    root   html;</span><br><span class=\"line\">    index  index.html index.htm index.php;</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        #被代理服务器的地址</span><br><span class=\"line\">        proxy_pass  http://localhost:8081;</span><br><span class=\"line\">        #对发送给客户端的URL进行修改的操作</span><br><span class=\"line\">        proxy_redirect     off;</span><br><span class=\"line\">        proxy_set_header   Host             $host;</span><br><span class=\"line\">        proxy_set_header   X-Real-IP        $remote_addr;</span><br><span class=\"line\">        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class=\"line\">        proxy_max_temp_file_size 0;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就可以通过a.xxx.com来访问a项目对应的网站了，而不需要带上难看的端口号。<br>反向代理的配置关键点是：</p>\n<blockquote>\n<ol>\n<li>server_name：代表客户端向服务器发起请求时输入的域名</li>\n<li>proxy_pass：代表源服务器的访问地址，也就是真正处理请求的服务器（localhost+端口号）。</li>\n</ol>\n</blockquote>\n<h3 id=\"3-透明代理\"><a href=\"#3-透明代理\" class=\"headerlink\" title=\"3. 透明代理\"></a>3. 透明代理</h3><blockquote>\n<p>透明代理：也叫做简单代理，意思客户端向服务端发起请求时，请求会先到达透明代理服务器，代理服务器再把请求转交给真实的源服务器处理，也就是是客户端根本不知道有代理服务器的存在。</p>\n</blockquote>\n<p>举个栗子：它的用法有点类似于拦截器，如某些制度严格的公司里的办公电脑，无论我们用电脑做了什么事情，安全部门都能拦截我们对外发送的任何东西，这是因为电脑在对外发送时，实际上先经过网络上的一个透明的服务器，经过它的处理之后，才接着往外网走，而我们在网上冲浪时，根本没有感知到有拦截器拦截我们的数据和信息。</p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195548380599.jpg\" alt=\"img\"></p>\n<p>有人说透明代理和反向代理有点像，都是由代理服务器先接受请求，再转发到源服务器。其实本质上是有区别的，透明代理是客户端感知不到代理服务器的存在，而反向代理是客户端感知只有一个代理服务器的存在，因此他们一个是隐藏了自己，一个是隐藏了源服务器。事实上，透明代理和正向代理才是相像的，都是由客户端主动发起请求，代理服务器处理；他们差异点在于：正向代理是代理服务器代替客户端请求，而透明代理是客户端在发起请求时，会先经过透明代理服务器，再达到服务端，在这过程中，客户端是感知不到这个代理服务器的。</p>\n<h3 id=\"4-负载均衡\"><a href=\"#4-负载均衡\" class=\"headerlink\" title=\"4. 负载均衡\"></a>4. 负载均衡</h3><p>负载均衡：将服务器接收到的请求按照规则分发的过程，称为负载均衡。负载均衡是反向代理的一种体现。</p>\n<p>可能绝大部分人接触到的web项目，刚开始时都是一台服务器就搞定了，但当网站访问量越来越大时，单台服务器就扛不住了，这时候需要增加服务器做成集群来分担流量压力，而在架设这些服务器时，nginx就充当了接受流量和分流的作用了，当请求到nginx服务器时，nginx就可以根据设置好的负载信息，把请求分配到不同的服务器，服务器处理完毕后，nginx获取处理结果返回给客户端，这样，用nginx的反向代理，即可实现了负载均衡。</p>\n<p><img src=\"https://www.itcodemonkey.com/data/upload/portal/20181114/1542195549241458.jpg\" alt=\"img\"></p>\n<p>nginx实现负载均衡有几种模式：</p>\n<blockquote>\n<ol>\n<li>轮询：每个请求按时间顺序逐一分配到不同的后端服务器，也是nginx的默认模式。轮询模式的配置很简单，只需要把服务器列表加入到upstream模块中即可。</li>\n</ol>\n</blockquote>\n<p>下面的配置是指：<strong>负载中有三台服务器，当请求到达时，nginx按照时间顺序把请求分配给三台服务器处理。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<ol>\n<li>ip_hash：每个请求按访问IP的hash结果分配，同一个IP客户端固定访问一个后端服务器。可以保证来自同一ip的请求被打到固定的机器上，可以解决session问题。</li>\n</ol>\n</blockquote>\n<p>下面的配置是指：<strong>负载中有三台服务器，当请求到达时，nginx优先按照ip_hash的结果进行分配，也就是同一个IP的请求固定在某一台服务器上，其它则按时间顺序把请求分配给三台服务器处理。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    ip_hash</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<ol>\n<li>url_hash：按访问url的hash结果来分配请求，相同的url固定转发到同一个后端服务器处理。</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">    hash $request_uri;</span><br><span class=\"line\">    hash_method crc32;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<ol>\n<li>fair：按后端服务器的响应时间来分配请求，响应时间短的优先分配。</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4;</span><br><span class=\"line\">    server 1.2.3.5;</span><br><span class=\"line\">    server 1.2.3.6;</span><br><span class=\"line\">    fair;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>而在每一种模式中，每一台服务器后面的可以携带的参数有：</p>\n<blockquote>\n<ol>\n<li>down: 当前服务器暂不参与负载</li>\n<li>weight: 权重，值越大，服务器的负载量越大。</li>\n<li>max_fails：允许请求失败的次数，默认为1。</li>\n<li>fail_timeout:max_fails次失败后暂停的时间。</li>\n<li>backup：备份机， 只有其它所有的非backup机器down或者忙时才会请求backup机器。</li>\n</ol>\n</blockquote>\n<p>如下面的配置是指：<strong>负载中有三台服务器，当请求到达时，nginx按时间顺序和权重把请求分配给三台服务器处理，例如有100个请求，有30%是服务器4处理，有50%的请求是服务器5处理，有20%的请求是服务器6处理。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4 weight=30;</span><br><span class=\"line\">    server 1.2.3.5 weight=50;</span><br><span class=\"line\">    server 1.2.3.6 weight=20;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如下面的配置是指：<strong>负载中有三台服务器，服务器4的失败超时时间为60s，服务器5暂不参与负载，服务器6只用作备份机。</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4 fail_timeout=60s;</span><br><span class=\"line\">    server 1.2.3.5 down;</span><br><span class=\"line\">    server 1.2.3.6 backup;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>下面是一个配置负载均衡的示例（只写了关键配置）：<br>其中：</p>\n<ol>\n<li>upstream：是负载的配置模块，serverList是名称，随便起</li>\n<li>server_name：是客户端请求的域名地址</li>\n<li>proxy_pass：是指向负载的列表的模块，如serverList</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream serverList &#123;</span><br><span class=\"line\">    server 1.2.3.4 weight=30;</span><br><span class=\"line\">    server 1.2.3.5 down;</span><br><span class=\"line\">    server 1.2.3.6 backup;</span><br><span class=\"line\">&#125;   </span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name  www.xxx.com;</span><br><span class=\"line\">    root   html;</span><br><span class=\"line\">    index  index.html index.htm index.php;</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass  http://serverList;</span><br><span class=\"line\">        proxy_redirect     off;</span><br><span class=\"line\">        proxy_set_header   Host             $host;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-静态服务器\"><a href=\"#5-静态服务器\" class=\"headerlink\" title=\"5. 静态服务器\"></a>5. 静态服务器</h3><p>现在很多项目流行前后分离，也就是前端服务器和后端服务器分离，分别部署，这样的方式能让前后端人员能各司其职，不需要互相依赖，而前后分离中，前端项目的运行是不需要用Tomcat、Apache等服务器环境的，因此可以直接用nginx来作为静态服务器。</p>\n<blockquote>\n<p>静态服务器的配置如下,其中关键配置为：</p>\n<ol>\n<li>root：直接静态项目的绝对路径的根目录。</li>\n<li>server_name : 静态网站访问的域名地址。</li>\n</ol>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       80;                                                         </span><br><span class=\"line\">        server_name  www.xxx.com;                                               </span><br><span class=\"line\">        client_max_body_size 1024M;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">               root   /var/www/xxx_static;</span><br><span class=\"line\">               index  index.html;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-nginx的安装\"><a href=\"#6-nginx的安装\" class=\"headerlink\" title=\"6. nginx的安装\"></a>6. nginx的安装</h3><p>学了这么多nginx的配置用法之后，我们需要对每一个知识点做一下测试，才能印象深刻，在此之前，我们需要知道nginx是怎么安装，下面以Linux环境为例，简述yum方式安装nginx的步骤：</p>\n<ol>\n<li>安装依赖：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//一键安装上面四个依赖</span><br><span class=\"line\">yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel</span><br></pre></td></tr></table></figure>\n<ol>\n<li>安装nginx：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install nginx</span><br></pre></td></tr></table></figure>\n<ol>\n<li>检查是否安装成功：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -v</span><br></pre></td></tr></table></figure>\n<ol>\n<li>启动/挺尸nginx：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/nginx start</span><br><span class=\"line\">/etc/init.d/nginx stop</span><br></pre></td></tr></table></figure>\n<ol>\n<li>编辑配置文件：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>\n<p>这些步骤都完成之后，我们就可以进入nginx的配置文件nginx.conf对上面的各个知识点，进行配置和测试了。</p>\n"},{"title":"如何用Angular6创建各种动画效果","date":"2019-02-15T01:44:01.000Z","_content":"\n\n# 如何用Angular 6创建各种动画效果\n\n## 介绍\n\n就技术角度而言，动画可以被定义为从初始状态到最终状态的转换过程。如今它已是各种Web应用不可或缺的组成部分。通过动画，我们不仅能创建出各种酷炫的UI，同时它们也能增加应用程序的趣味性。因此，设计精美的动画在吸引用户眼球的同时，也增强了他们的浏览体验。\n\nAngular能够让我们创建出具有原生表现效果的动画。我们将通过本文学习到如何使用Angular 6来创建各种动画效果。\n\n## 准备工作\n\n安装vs code和 Angular cli。\n\n## 源代码\n\n[https://stackblitz.com/edit/tk-angular-animations-01](https://stackblitz.com/edit/tk-angular-animations-01)\n\n## 理解Angular动画的不同状态\n\n动画是某个元素从一种状态向另一种状态的转变，Angular为单个元素定义出了三种不同的状态。\n\n1. void状态：void状态表示某个元素处于不是DOM一部分的状态。当一个元素被创建且尚未放到DOM中、或者该元素从DOM中移除时，就处于该状态。此状态特别实用，特别是当我们想通过添加或删除DOM中的元素，来创建动画的时候，我们在代码中使用关键字void来定义这种状态。\n2. wildcard状态：又称元素的默认状态。不管当前的动画状态如何，各种样式都用这种状态来定义元素。我们在代码中用符号*来定义这种状态。\n3. Custom状态：元素的这种状态需要在代码中被明确定义。我们在代码中可以使用任何自定义的名称来表示这种状态。\n\n## 动画转换定时\n\n我们在自己的应用中，通过定义动画转换的定时，来显示从一个状态过度到另一个状态。Angular为我们提供了如下三种与时间相关的属性：\n\n1. 持续时间(Duration)\n\n此属性表示我们的动画从开始(初始状态)到完成(最终状态)所需的时间。我们可以用以下三种方式来定义动画的持续时间：\n\n- 使用一个整数值，来表示以毫秒为单位的时间，例如：500\n- 使用一个字符串值，来表示以毫秒为单位的时间，例如：’500ms’\n- 使用一个字符串值，来表示以秒为单位的时间。例如：’0.5’\n  \n2. 延迟(Delay)\n\n此属性代表动画从触发到和实际转换开始之间的时间间隔。该属性遵循与上述持续时间相同的语法规则。要定义延迟，我们需要在持续时间值的后面，以字符串的形式添加延迟的数值，即：'Duration Delay'。例如' 0.3s 500ms’，表示转换将等待500毫秒，然后运行0.3秒。\n\n3. 滑动(Easing)\n\n此属性表示动画在其执行过程中是如何被加速或减速的。我们可以在持续时间和延迟的字符串后面，添加第三个变量。当然，如果延迟数值不存在的话，那么Easing将成为第二个数值。这同样也是一个可选属性。例如：\n\n- '0.3s 500ms ease-in'。这意味着转换将等待500毫秒，然后运行0.3秒(300毫秒)，实现滑入的效果。\n- '300ms ease-out'。这意味着转换将运行300毫秒(0.3秒)，实现滑出的效果。\n\n## 创建Angular 6应用\n\n请在您的计算机上打开命令提示行，并执行以下命令集：\n\n- mkdir ngAnimationDemo\n- cd ngAnimationDemo\n- ng new ngAnimation\n\n这些命令将创建一个名为ngAnimationDemo的目录，然后在该目录内创建一个名为ngAnimation的Angular应用。\n\n请使用Visual Studio Code打开ngAnimation应用。接着我们将创建自己的组件。\n\n请依次进入View >> Integrated Terminal，这将打开Visual Studio Code的终端窗口。\n\n请执行以下命令，以创建相应的组件：\n\n```\nng g c animationdemo \n```\n\n它将在/src/app文件夹内创建我们的组件--animationdemo。\n\n为了用到Angular动画，我们需要在应用中导入特定的动画模块--BrowserAnimationsModule。请打开app.module.ts文件，并添加如下的导入定义：\n\n```ts\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';  \n// other import definitions  \n@NgModule({ imports: [BrowserAnimationsModule // other imports]})  \n```\n## 理解Angular动画的语法\n\n下面，我们在组件的元数据中编写动画代码。其语法如下：\n\n```ts\n@Component({ \n// other component properties. \n  animations: [ \n    trigger('triggerName'), [ \n      state('stateName', style()) \n      transition('stateChangeExpression', [Animation Steps]) \n    ] \n  ] \n}) \n```\n\n此处，我们用到了名为animations的属性。该属性的输入是一个阵列，此阵列包含一个或多个“触发器”。同时，每个触发器都带有唯一的名称、和用来定义动画的状态和各种转换的具体实现。\n\n另外，每一个状态函数都会通过“stateName”来唯一地识别其状态、并用样式函数来显示在该状态下的元素样式。\n\n当然，每个转换函数也都通过stateChangeExpression，来定义元素状态转换、并定义动画的不同步骤所对应的阵列，从而能够显示出转换是如何发生的。在此，我们就可以用逗号分隔的数值，来将多个触发器函数包括到动画的属性之中。\n\n由于这些功能(触发、状态、和转换)都被定义在@angular/animations模块之中，因此，我们需要在自己的组件导入该模块。\n\n为了将动画应用到某个元素之上，我们需要在元素的定义中包含触发器的名称，即：在元素的标签里使用@后面加触发器名称的格式。对应的代码示例如下：\n\n```html\n<div @changeSize></div>  \n```\n\n这是将触发器changeSize应用到元素的上。\n\n下面，让我们创建更多的动画，以更好地理解Angular的动画概念吧。\n\n更改大小的动画\n\n我们将创建一个动画，来实现一键改变的大小。\n\n请打开animationdemo.component.ts文件，将如下代码添加到导入定义之中。\n\n```ts\nimport { trigger, state, style, animate, transition } from '@angular/animations'; \n```\n\n在组件的元数据中添加如下的动画属性定义。\n\n```ts\nanimations: [ \n  trigger('changeDivSize', [ \n    state('initial', style({ \n      backgroundColor: 'green', \n      width: '100px', \n      height: '100px' \n    })), \n    state('final', style({ \n      backgroundColor: 'red', \n      width: '200px', \n      height: '200px' \n    })), \n    transition('initial=>final', animate('1500ms')), \n    transition('final=>initial', animate('1000ms')) \n  ]), \n]  \n\n```\n\n在此，我们定义了一个触发器—changeDivSize，而且该触发器里的两个功能函数。该元素在“初始”状态时呈现绿色，并随着宽度和高度的增加，在“最终”状态时呈现为红色。\n\n同时，我们定义了状态的转换规则：从“初始”态到“最终”态将持续1500毫秒，而从“最终”态返回“初始”态则为1000毫秒。\n\n为了改变元素的状态，我们在组件的类定义中定义了一个功能函数。我们将如下代码包含在AnimationdemoComponent类中：\n\n```ts\ncurrentState = 'initial'; \nchangeState() { \n  this.currentState = this.currentState === 'initial' ? 'final' : 'initial'; \n}  \n```\n\n此处，我们定义了一个changeState方法，来切换元素的状态。\n\n请打开animationdemo.component.html文件，并添加以下代码：\n\n```html\n<h3>Change the div size</h3> \n<button (click)=\"changeState()\">Change Size</button> \n<br /> \n<div [@changeDivSize]=currentState></div> \n<br /> \n```\n\n我们定义了一个按钮，来调用点击时的changeState函数。由于我们前面已经定义了元素，并对它应用了changeDivSize动画触发器，因此当按钮被点击时，它会更新元素的状态，其大小则会伴随着转换效果而发生变化。\n\n在执行该应用之前，我们也需要将引用包含在app.component.html文件内的Animationdemo组件中。\n\n打开app.component.html文件，您会发现该文件中已包含了一些默认的HTML代码。请删除所有的代码，并按照下图所示放置组件的选择器：\n\n```html\n<app-animationdemo></app-animationdemo> \n```\n\n请在Visual Studio Code的终端窗口里运行ng serve命令，以执行该代码。运行完毕后，它会提示您在浏览器中打开http://localhost:4200。随后，您就会在浏览器中看到如下点击按钮的动画效果。\n\n\n\n## 气球动画效果\n\n在前面的动画示例中，转化仅发生在两个方向。而在本节中，我们将学习如何改变所有方向上的尺寸。这与气球的充、放气比较类似，故称为气球动画效果。\n\n请在动画属性中添加如下的触发器定义。\n\n```ts\ntrigger('balloonEffect', [ \n   state('initial', style({ \n     backgroundColor: 'green', \n     transform: 'scale(1)' \n   })), \n   state('final', style({ \n     backgroundColor: 'red', \n     transform: 'scale(1.5)' \n   })), \n   transition('final=>initial', animate('1000ms')), \n   transition('initial=>final', animate('1500ms')) \n ]), \n ```\n\n在此，我们使用转换属性来更改所有方向的尺寸大小。当该元素的状态发生变化时转换随即发生。\n\n请在app.component.html文件中添加如下HTML代码。\n\n```html\n<h3>Balloon Effect</h3> \n<div (click)=\"changeState()\"  \n  style=\"width:100px;height:100px; border-radius: 100%; margin: 3rem; background-color: green\" \n  [@balloonEffect]=currentState> \n</div> \n```\n\n在此，我们定义了一个div，并通过CSS样式来定义成一个圆圈。我们将通过点击div去调用changeState，从而实现元素状态的切换。\n\n下图便是该动画在浏览器中的运行效果：\n\n\n\n淡入和淡出动画\n\n有时候，我们需要在显示动画的同时，对DOM添加或移除元素。下面，我们来看看如何通过对一个列表添加或删除条目，以实现淡入和淡出的动画效果。\n\n请将如下代码插入AnimationdemoComponent类的定义之中。\n\n```ts\nlistItem = []; \nlist_order: number = 1; \naddItem() { \n  var listitem = \"ListItem \" + this.list_order; \n  this.list_order++; \n  this.listItem.push(listitem); \n} \nremoveItem() { \n  this.listItem.length -= 1; \n} \n```\n\n请在该动画的属性中添加如下的触发器定义。\n\n```ts\ntrigger('fadeInOut', [ \n  state('void', style({ \n    opacity: 0 \n  })), \n  transition('void <=> *', animate(1000)), \n]),  \n```\n\n在此，我们定义了触发器fadeInOut。当该元素被添加到DOM时，它的状态就从void转换为wildcard，我们表示为void => *。而当该元素从DOM删除时，它的状态就从wildcard转换为void，我们表示为* => void。\n\n我们给动画的不同方向使用相同的动画定时，其语法为<=>。正如该触发器所定义的，动画从void => * 和 * => void，都需要1000毫秒才能完成。\n\n请在app.component.html文件中添加如下HTML代码。\n\n```html\n<h3>Fade-In and Fade-Out animation</h3> \n<button (click)=\"addItem()\">Add List</button> \n<button (click)=\"removeItem()\">Remove List</button> \n<div style=\"width:200px; margin-left: 20px\"> \n  <ul> \n    <li *ngFor=\"let list of listItem\" [@fadeInOut]> \n      {{list}} \n    </li> \n  </ul> \n</div> \n``` \n\n在此，我们定义了两个按钮来添加和删除条目。我们将fadeInOut触发器与元素绑定，以实现在对DOM进行添加、删除时，能够出现淡入和淡出的效果。\n\n下图便是该动画在浏览器中的运行效果：\n\n\n\n进入和离开动画\n\n此外，我们还能够通过对DOM的添加，实现某个元素从左边进入屏幕;而在删除时，能让该元素从右边离开屏幕。\n\n由于从void => * 和 * => void 的转换十分常见。因此，Angular为这些动画提供了别名机制：\n\n- 对于 void => * ，我们可以用':enter'\n- 对于 * => void ，我们可以用':leave'\n\n这两个别名使得此类转换更具可读性，也更容易被理解。\n\n请在动画的属性中添加如下触发器的定义。\n\n```ts\ntrigger('EnterLeave', [ \n  state('flyIn', style({ transform: 'translateX(0)' })), \n  transition(':enter', [ \n    style({ transform: 'translateX(-100%)' }), \n    animate('0.5s 300ms ease-in') \n  ]), \n  transition(':leave', [ \n    animate('0.3s ease-out', style({ transform: 'translateX(100%)' })) \n  ]) \n])  \n```\n\n在此，我们定义了触发器EnterLeave。那么':enter'的转换需要等待300毫秒，然后运行0.5秒，并实现滑入的效果;而':leave'的转换只运行0.3秒，实现滑出的效果。\n\n请在app.component.html文件中添加如下HTML代码。\n\n```html\n<h3>Enter and Leave animation</h3> \n<button (click)=\"addItem()\">Add List</button> \n<button (click)=\"removeItem()\">Remove List</button> \n<div style=\"width:200px; margin-left: 20px\"> \n  <ul> \n    <li *ngFor=\"let list of listItem\" [@EnterLeave]=\"'flyIn'\"> \n      {{list}} \n    </li> \n  </ul> \n</div> \n```\n\n在此，我们定义了两个按钮来对列表添加和删除条目。我们将EnterLeave触发器与元素绑定，以实现在对DOM进行添加、删除时，出现滑入和滑出的效果。\n\n下图便是该动画在浏览器中的运行效果：\n\n\n\n## 结论\n\n综上所述，我们针对Angular 6的动画效果，探讨了动画状态和转换的概念，也通过一个应用示例展示了实际的动画代码与效果。","source":"_posts/0015-如何用Angular6创建各种动画效果.md","raw":"---\ntitle: 如何用Angular6创建各种动画效果\ndate: 2019-02-15 09:44:01\ntags:\n    - Angular\n---\n\n\n# 如何用Angular 6创建各种动画效果\n\n## 介绍\n\n就技术角度而言，动画可以被定义为从初始状态到最终状态的转换过程。如今它已是各种Web应用不可或缺的组成部分。通过动画，我们不仅能创建出各种酷炫的UI，同时它们也能增加应用程序的趣味性。因此，设计精美的动画在吸引用户眼球的同时，也增强了他们的浏览体验。\n\nAngular能够让我们创建出具有原生表现效果的动画。我们将通过本文学习到如何使用Angular 6来创建各种动画效果。\n\n## 准备工作\n\n安装vs code和 Angular cli。\n\n## 源代码\n\n[https://stackblitz.com/edit/tk-angular-animations-01](https://stackblitz.com/edit/tk-angular-animations-01)\n\n## 理解Angular动画的不同状态\n\n动画是某个元素从一种状态向另一种状态的转变，Angular为单个元素定义出了三种不同的状态。\n\n1. void状态：void状态表示某个元素处于不是DOM一部分的状态。当一个元素被创建且尚未放到DOM中、或者该元素从DOM中移除时，就处于该状态。此状态特别实用，特别是当我们想通过添加或删除DOM中的元素，来创建动画的时候，我们在代码中使用关键字void来定义这种状态。\n2. wildcard状态：又称元素的默认状态。不管当前的动画状态如何，各种样式都用这种状态来定义元素。我们在代码中用符号*来定义这种状态。\n3. Custom状态：元素的这种状态需要在代码中被明确定义。我们在代码中可以使用任何自定义的名称来表示这种状态。\n\n## 动画转换定时\n\n我们在自己的应用中，通过定义动画转换的定时，来显示从一个状态过度到另一个状态。Angular为我们提供了如下三种与时间相关的属性：\n\n1. 持续时间(Duration)\n\n此属性表示我们的动画从开始(初始状态)到完成(最终状态)所需的时间。我们可以用以下三种方式来定义动画的持续时间：\n\n- 使用一个整数值，来表示以毫秒为单位的时间，例如：500\n- 使用一个字符串值，来表示以毫秒为单位的时间，例如：’500ms’\n- 使用一个字符串值，来表示以秒为单位的时间。例如：’0.5’\n  \n2. 延迟(Delay)\n\n此属性代表动画从触发到和实际转换开始之间的时间间隔。该属性遵循与上述持续时间相同的语法规则。要定义延迟，我们需要在持续时间值的后面，以字符串的形式添加延迟的数值，即：'Duration Delay'。例如' 0.3s 500ms’，表示转换将等待500毫秒，然后运行0.3秒。\n\n3. 滑动(Easing)\n\n此属性表示动画在其执行过程中是如何被加速或减速的。我们可以在持续时间和延迟的字符串后面，添加第三个变量。当然，如果延迟数值不存在的话，那么Easing将成为第二个数值。这同样也是一个可选属性。例如：\n\n- '0.3s 500ms ease-in'。这意味着转换将等待500毫秒，然后运行0.3秒(300毫秒)，实现滑入的效果。\n- '300ms ease-out'。这意味着转换将运行300毫秒(0.3秒)，实现滑出的效果。\n\n## 创建Angular 6应用\n\n请在您的计算机上打开命令提示行，并执行以下命令集：\n\n- mkdir ngAnimationDemo\n- cd ngAnimationDemo\n- ng new ngAnimation\n\n这些命令将创建一个名为ngAnimationDemo的目录，然后在该目录内创建一个名为ngAnimation的Angular应用。\n\n请使用Visual Studio Code打开ngAnimation应用。接着我们将创建自己的组件。\n\n请依次进入View >> Integrated Terminal，这将打开Visual Studio Code的终端窗口。\n\n请执行以下命令，以创建相应的组件：\n\n```\nng g c animationdemo \n```\n\n它将在/src/app文件夹内创建我们的组件--animationdemo。\n\n为了用到Angular动画，我们需要在应用中导入特定的动画模块--BrowserAnimationsModule。请打开app.module.ts文件，并添加如下的导入定义：\n\n```ts\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';  \n// other import definitions  \n@NgModule({ imports: [BrowserAnimationsModule // other imports]})  \n```\n## 理解Angular动画的语法\n\n下面，我们在组件的元数据中编写动画代码。其语法如下：\n\n```ts\n@Component({ \n// other component properties. \n  animations: [ \n    trigger('triggerName'), [ \n      state('stateName', style()) \n      transition('stateChangeExpression', [Animation Steps]) \n    ] \n  ] \n}) \n```\n\n此处，我们用到了名为animations的属性。该属性的输入是一个阵列，此阵列包含一个或多个“触发器”。同时，每个触发器都带有唯一的名称、和用来定义动画的状态和各种转换的具体实现。\n\n另外，每一个状态函数都会通过“stateName”来唯一地识别其状态、并用样式函数来显示在该状态下的元素样式。\n\n当然，每个转换函数也都通过stateChangeExpression，来定义元素状态转换、并定义动画的不同步骤所对应的阵列，从而能够显示出转换是如何发生的。在此，我们就可以用逗号分隔的数值，来将多个触发器函数包括到动画的属性之中。\n\n由于这些功能(触发、状态、和转换)都被定义在@angular/animations模块之中，因此，我们需要在自己的组件导入该模块。\n\n为了将动画应用到某个元素之上，我们需要在元素的定义中包含触发器的名称，即：在元素的标签里使用@后面加触发器名称的格式。对应的代码示例如下：\n\n```html\n<div @changeSize></div>  \n```\n\n这是将触发器changeSize应用到元素的上。\n\n下面，让我们创建更多的动画，以更好地理解Angular的动画概念吧。\n\n更改大小的动画\n\n我们将创建一个动画，来实现一键改变的大小。\n\n请打开animationdemo.component.ts文件，将如下代码添加到导入定义之中。\n\n```ts\nimport { trigger, state, style, animate, transition } from '@angular/animations'; \n```\n\n在组件的元数据中添加如下的动画属性定义。\n\n```ts\nanimations: [ \n  trigger('changeDivSize', [ \n    state('initial', style({ \n      backgroundColor: 'green', \n      width: '100px', \n      height: '100px' \n    })), \n    state('final', style({ \n      backgroundColor: 'red', \n      width: '200px', \n      height: '200px' \n    })), \n    transition('initial=>final', animate('1500ms')), \n    transition('final=>initial', animate('1000ms')) \n  ]), \n]  \n\n```\n\n在此，我们定义了一个触发器—changeDivSize，而且该触发器里的两个功能函数。该元素在“初始”状态时呈现绿色，并随着宽度和高度的增加，在“最终”状态时呈现为红色。\n\n同时，我们定义了状态的转换规则：从“初始”态到“最终”态将持续1500毫秒，而从“最终”态返回“初始”态则为1000毫秒。\n\n为了改变元素的状态，我们在组件的类定义中定义了一个功能函数。我们将如下代码包含在AnimationdemoComponent类中：\n\n```ts\ncurrentState = 'initial'; \nchangeState() { \n  this.currentState = this.currentState === 'initial' ? 'final' : 'initial'; \n}  \n```\n\n此处，我们定义了一个changeState方法，来切换元素的状态。\n\n请打开animationdemo.component.html文件，并添加以下代码：\n\n```html\n<h3>Change the div size</h3> \n<button (click)=\"changeState()\">Change Size</button> \n<br /> \n<div [@changeDivSize]=currentState></div> \n<br /> \n```\n\n我们定义了一个按钮，来调用点击时的changeState函数。由于我们前面已经定义了元素，并对它应用了changeDivSize动画触发器，因此当按钮被点击时，它会更新元素的状态，其大小则会伴随着转换效果而发生变化。\n\n在执行该应用之前，我们也需要将引用包含在app.component.html文件内的Animationdemo组件中。\n\n打开app.component.html文件，您会发现该文件中已包含了一些默认的HTML代码。请删除所有的代码，并按照下图所示放置组件的选择器：\n\n```html\n<app-animationdemo></app-animationdemo> \n```\n\n请在Visual Studio Code的终端窗口里运行ng serve命令，以执行该代码。运行完毕后，它会提示您在浏览器中打开http://localhost:4200。随后，您就会在浏览器中看到如下点击按钮的动画效果。\n\n\n\n## 气球动画效果\n\n在前面的动画示例中，转化仅发生在两个方向。而在本节中，我们将学习如何改变所有方向上的尺寸。这与气球的充、放气比较类似，故称为气球动画效果。\n\n请在动画属性中添加如下的触发器定义。\n\n```ts\ntrigger('balloonEffect', [ \n   state('initial', style({ \n     backgroundColor: 'green', \n     transform: 'scale(1)' \n   })), \n   state('final', style({ \n     backgroundColor: 'red', \n     transform: 'scale(1.5)' \n   })), \n   transition('final=>initial', animate('1000ms')), \n   transition('initial=>final', animate('1500ms')) \n ]), \n ```\n\n在此，我们使用转换属性来更改所有方向的尺寸大小。当该元素的状态发生变化时转换随即发生。\n\n请在app.component.html文件中添加如下HTML代码。\n\n```html\n<h3>Balloon Effect</h3> \n<div (click)=\"changeState()\"  \n  style=\"width:100px;height:100px; border-radius: 100%; margin: 3rem; background-color: green\" \n  [@balloonEffect]=currentState> \n</div> \n```\n\n在此，我们定义了一个div，并通过CSS样式来定义成一个圆圈。我们将通过点击div去调用changeState，从而实现元素状态的切换。\n\n下图便是该动画在浏览器中的运行效果：\n\n\n\n淡入和淡出动画\n\n有时候，我们需要在显示动画的同时，对DOM添加或移除元素。下面，我们来看看如何通过对一个列表添加或删除条目，以实现淡入和淡出的动画效果。\n\n请将如下代码插入AnimationdemoComponent类的定义之中。\n\n```ts\nlistItem = []; \nlist_order: number = 1; \naddItem() { \n  var listitem = \"ListItem \" + this.list_order; \n  this.list_order++; \n  this.listItem.push(listitem); \n} \nremoveItem() { \n  this.listItem.length -= 1; \n} \n```\n\n请在该动画的属性中添加如下的触发器定义。\n\n```ts\ntrigger('fadeInOut', [ \n  state('void', style({ \n    opacity: 0 \n  })), \n  transition('void <=> *', animate(1000)), \n]),  \n```\n\n在此，我们定义了触发器fadeInOut。当该元素被添加到DOM时，它的状态就从void转换为wildcard，我们表示为void => *。而当该元素从DOM删除时，它的状态就从wildcard转换为void，我们表示为* => void。\n\n我们给动画的不同方向使用相同的动画定时，其语法为<=>。正如该触发器所定义的，动画从void => * 和 * => void，都需要1000毫秒才能完成。\n\n请在app.component.html文件中添加如下HTML代码。\n\n```html\n<h3>Fade-In and Fade-Out animation</h3> \n<button (click)=\"addItem()\">Add List</button> \n<button (click)=\"removeItem()\">Remove List</button> \n<div style=\"width:200px; margin-left: 20px\"> \n  <ul> \n    <li *ngFor=\"let list of listItem\" [@fadeInOut]> \n      {{list}} \n    </li> \n  </ul> \n</div> \n``` \n\n在此，我们定义了两个按钮来添加和删除条目。我们将fadeInOut触发器与元素绑定，以实现在对DOM进行添加、删除时，能够出现淡入和淡出的效果。\n\n下图便是该动画在浏览器中的运行效果：\n\n\n\n进入和离开动画\n\n此外，我们还能够通过对DOM的添加，实现某个元素从左边进入屏幕;而在删除时，能让该元素从右边离开屏幕。\n\n由于从void => * 和 * => void 的转换十分常见。因此，Angular为这些动画提供了别名机制：\n\n- 对于 void => * ，我们可以用':enter'\n- 对于 * => void ，我们可以用':leave'\n\n这两个别名使得此类转换更具可读性，也更容易被理解。\n\n请在动画的属性中添加如下触发器的定义。\n\n```ts\ntrigger('EnterLeave', [ \n  state('flyIn', style({ transform: 'translateX(0)' })), \n  transition(':enter', [ \n    style({ transform: 'translateX(-100%)' }), \n    animate('0.5s 300ms ease-in') \n  ]), \n  transition(':leave', [ \n    animate('0.3s ease-out', style({ transform: 'translateX(100%)' })) \n  ]) \n])  \n```\n\n在此，我们定义了触发器EnterLeave。那么':enter'的转换需要等待300毫秒，然后运行0.5秒，并实现滑入的效果;而':leave'的转换只运行0.3秒，实现滑出的效果。\n\n请在app.component.html文件中添加如下HTML代码。\n\n```html\n<h3>Enter and Leave animation</h3> \n<button (click)=\"addItem()\">Add List</button> \n<button (click)=\"removeItem()\">Remove List</button> \n<div style=\"width:200px; margin-left: 20px\"> \n  <ul> \n    <li *ngFor=\"let list of listItem\" [@EnterLeave]=\"'flyIn'\"> \n      {{list}} \n    </li> \n  </ul> \n</div> \n```\n\n在此，我们定义了两个按钮来对列表添加和删除条目。我们将EnterLeave触发器与元素绑定，以实现在对DOM进行添加、删除时，出现滑入和滑出的效果。\n\n下图便是该动画在浏览器中的运行效果：\n\n\n\n## 结论\n\n综上所述，我们针对Angular 6的动画效果，探讨了动画状态和转换的概念，也通过一个应用示例展示了实际的动画代码与效果。","slug":"0015-如何用Angular6创建各种动画效果","published":1,"updated":"2019-02-15T01:43:39.886Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t7w003fgcoitisca145","content":"<h1 id=\"如何用Angular-6创建各种动画效果\"><a href=\"#如何用Angular-6创建各种动画效果\" class=\"headerlink\" title=\"如何用Angular 6创建各种动画效果\"></a>如何用Angular 6创建各种动画效果</h1><h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>就技术角度而言，动画可以被定义为从初始状态到最终状态的转换过程。如今它已是各种Web应用不可或缺的组成部分。通过动画，我们不仅能创建出各种酷炫的UI，同时它们也能增加应用程序的趣味性。因此，设计精美的动画在吸引用户眼球的同时，也增强了他们的浏览体验。</p>\n<p>Angular能够让我们创建出具有原生表现效果的动画。我们将通过本文学习到如何使用Angular 6来创建各种动画效果。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>安装vs code和 Angular cli。</p>\n<h2 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h2><p><a href=\"https://stackblitz.com/edit/tk-angular-animations-01\" target=\"_blank\" rel=\"noopener\">https://stackblitz.com/edit/tk-angular-animations-01</a></p>\n<h2 id=\"理解Angular动画的不同状态\"><a href=\"#理解Angular动画的不同状态\" class=\"headerlink\" title=\"理解Angular动画的不同状态\"></a>理解Angular动画的不同状态</h2><p>动画是某个元素从一种状态向另一种状态的转变，Angular为单个元素定义出了三种不同的状态。</p>\n<ol>\n<li>void状态：void状态表示某个元素处于不是DOM一部分的状态。当一个元素被创建且尚未放到DOM中、或者该元素从DOM中移除时，就处于该状态。此状态特别实用，特别是当我们想通过添加或删除DOM中的元素，来创建动画的时候，我们在代码中使用关键字void来定义这种状态。</li>\n<li>wildcard状态：又称元素的默认状态。不管当前的动画状态如何，各种样式都用这种状态来定义元素。我们在代码中用符号*来定义这种状态。</li>\n<li>Custom状态：元素的这种状态需要在代码中被明确定义。我们在代码中可以使用任何自定义的名称来表示这种状态。</li>\n</ol>\n<h2 id=\"动画转换定时\"><a href=\"#动画转换定时\" class=\"headerlink\" title=\"动画转换定时\"></a>动画转换定时</h2><p>我们在自己的应用中，通过定义动画转换的定时，来显示从一个状态过度到另一个状态。Angular为我们提供了如下三种与时间相关的属性：</p>\n<ol>\n<li>持续时间(Duration)</li>\n</ol>\n<p>此属性表示我们的动画从开始(初始状态)到完成(最终状态)所需的时间。我们可以用以下三种方式来定义动画的持续时间：</p>\n<ul>\n<li>使用一个整数值，来表示以毫秒为单位的时间，例如：500</li>\n<li>使用一个字符串值，来表示以毫秒为单位的时间，例如：’500ms’</li>\n<li>使用一个字符串值，来表示以秒为单位的时间。例如：’0.5’</li>\n</ul>\n<ol start=\"2\">\n<li>延迟(Delay)</li>\n</ol>\n<p>此属性代表动画从触发到和实际转换开始之间的时间间隔。该属性遵循与上述持续时间相同的语法规则。要定义延迟，我们需要在持续时间值的后面，以字符串的形式添加延迟的数值，即：’Duration Delay’。例如’ 0.3s 500ms’，表示转换将等待500毫秒，然后运行0.3秒。</p>\n<ol start=\"3\">\n<li>滑动(Easing)</li>\n</ol>\n<p>此属性表示动画在其执行过程中是如何被加速或减速的。我们可以在持续时间和延迟的字符串后面，添加第三个变量。当然，如果延迟数值不存在的话，那么Easing将成为第二个数值。这同样也是一个可选属性。例如：</p>\n<ul>\n<li>‘0.3s 500ms ease-in’。这意味着转换将等待500毫秒，然后运行0.3秒(300毫秒)，实现滑入的效果。</li>\n<li>‘300ms ease-out’。这意味着转换将运行300毫秒(0.3秒)，实现滑出的效果。</li>\n</ul>\n<h2 id=\"创建Angular-6应用\"><a href=\"#创建Angular-6应用\" class=\"headerlink\" title=\"创建Angular 6应用\"></a>创建Angular 6应用</h2><p>请在您的计算机上打开命令提示行，并执行以下命令集：</p>\n<ul>\n<li>mkdir ngAnimationDemo</li>\n<li>cd ngAnimationDemo</li>\n<li>ng new ngAnimation</li>\n</ul>\n<p>这些命令将创建一个名为ngAnimationDemo的目录，然后在该目录内创建一个名为ngAnimation的Angular应用。</p>\n<p>请使用Visual Studio Code打开ngAnimation应用。接着我们将创建自己的组件。</p>\n<p>请依次进入View &gt;&gt; Integrated Terminal，这将打开Visual Studio Code的终端窗口。</p>\n<p>请执行以下命令，以创建相应的组件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng g c animationdemo</span><br></pre></td></tr></table></figure>\n<p>它将在/src/app文件夹内创建我们的组件–animationdemo。</p>\n<p>为了用到Angular动画，我们需要在应用中导入特定的动画模块–BrowserAnimationsModule。请打开app.module.ts文件，并添加如下的导入定义：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; BrowserAnimationsModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/platform-browser/animations'</span>;  </span><br><span class=\"line\"><span class=\"comment\">// other import definitions  </span></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123; imports: [BrowserAnimationsModule <span class=\"comment\">// other imports]&#125;)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"理解Angular动画的语法\"><a href=\"#理解Angular动画的语法\" class=\"headerlink\" title=\"理解Angular动画的语法\"></a>理解Angular动画的语法</h2><p>下面，我们在组件的元数据中编写动画代码。其语法如下：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span>(&#123; </span><br><span class=\"line\"><span class=\"comment\">// other component properties. </span></span><br><span class=\"line\">  animations: [ </span><br><span class=\"line\">    trigger(<span class=\"string\">'triggerName'</span>), [ </span><br><span class=\"line\">      state(<span class=\"string\">'stateName'</span>, style()) </span><br><span class=\"line\">      transition(<span class=\"string\">'stateChangeExpression'</span>, [Animation Steps]) </span><br><span class=\"line\">    ] </span><br><span class=\"line\">  ] </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>此处，我们用到了名为animations的属性。该属性的输入是一个阵列，此阵列包含一个或多个“触发器”。同时，每个触发器都带有唯一的名称、和用来定义动画的状态和各种转换的具体实现。</p>\n<p>另外，每一个状态函数都会通过“stateName”来唯一地识别其状态、并用样式函数来显示在该状态下的元素样式。</p>\n<p>当然，每个转换函数也都通过stateChangeExpression，来定义元素状态转换、并定义动画的不同步骤所对应的阵列，从而能够显示出转换是如何发生的。在此，我们就可以用逗号分隔的数值，来将多个触发器函数包括到动画的属性之中。</p>\n<p>由于这些功能(触发、状态、和转换)都被定义在@angular/animations模块之中，因此，我们需要在自己的组件导入该模块。</p>\n<p>为了将动画应用到某个元素之上，我们需要在元素的定义中包含触发器的名称，即：在元素的标签里使用@后面加触发器名称的格式。对应的代码示例如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">changeSize</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这是将触发器changeSize应用到元素的上。</p>\n<p>下面，让我们创建更多的动画，以更好地理解Angular的动画概念吧。</p>\n<p>更改大小的动画</p>\n<p>我们将创建一个动画，来实现一键改变的大小。</p>\n<p>请打开animationdemo.component.ts文件，将如下代码添加到导入定义之中。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; trigger, state, style, animate, transition &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/animations'</span>;</span><br></pre></td></tr></table></figure>\n<p>在组件的元数据中添加如下的动画属性定义。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">animations: [ </span><br><span class=\"line\">  trigger(<span class=\"string\">'changeDivSize'</span>, [ </span><br><span class=\"line\">    state(<span class=\"string\">'initial'</span>, style(&#123; </span><br><span class=\"line\">      backgroundColor: <span class=\"string\">'green'</span>, </span><br><span class=\"line\">      width: <span class=\"string\">'100px'</span>, </span><br><span class=\"line\">      height: <span class=\"string\">'100px'</span> </span><br><span class=\"line\">    &#125;)), </span><br><span class=\"line\">    state(<span class=\"string\">'final'</span>, style(&#123; </span><br><span class=\"line\">      backgroundColor: <span class=\"string\">'red'</span>, </span><br><span class=\"line\">      width: <span class=\"string\">'200px'</span>, </span><br><span class=\"line\">      height: <span class=\"string\">'200px'</span> </span><br><span class=\"line\">    &#125;)), </span><br><span class=\"line\">    transition(<span class=\"string\">'initial=&gt;final'</span>, animate(<span class=\"string\">'1500ms'</span>)), </span><br><span class=\"line\">    transition(<span class=\"string\">'final=&gt;initial'</span>, animate(<span class=\"string\">'1000ms'</span>)) </span><br><span class=\"line\">  ]), </span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了一个触发器—changeDivSize，而且该触发器里的两个功能函数。该元素在“初始”状态时呈现绿色，并随着宽度和高度的增加，在“最终”状态时呈现为红色。</p>\n<p>同时，我们定义了状态的转换规则：从“初始”态到“最终”态将持续1500毫秒，而从“最终”态返回“初始”态则为1000毫秒。</p>\n<p>为了改变元素的状态，我们在组件的类定义中定义了一个功能函数。我们将如下代码包含在AnimationdemoComponent类中：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">currentState = <span class=\"string\">'initial'</span>; </span><br><span class=\"line\">changeState() &#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.currentState = <span class=\"keyword\">this</span>.currentState === <span class=\"string\">'initial'</span> ? <span class=\"string\">'final'</span> : <span class=\"string\">'initial'</span>; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此处，我们定义了一个changeState方法，来切换元素的状态。</p>\n<p>请打开animationdemo.component.html文件，并添加以下代码：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Change the div size<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"changeState()\"</span>&gt;</span>Change Size<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> [@<span class=\"attr\">changeDivSize</span>]=<span class=\"string\">currentState</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>我们定义了一个按钮，来调用点击时的changeState函数。由于我们前面已经定义了元素，并对它应用了changeDivSize动画触发器，因此当按钮被点击时，它会更新元素的状态，其大小则会伴随着转换效果而发生变化。</p>\n<p>在执行该应用之前，我们也需要将引用包含在app.component.html文件内的Animationdemo组件中。</p>\n<p>打开app.component.html文件，您会发现该文件中已包含了一些默认的HTML代码。请删除所有的代码，并按照下图所示放置组件的选择器：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">app-animationdemo</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">app-animationdemo</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>请在Visual Studio Code的终端窗口里运行ng serve命令，以执行该代码。运行完毕后，它会提示您在浏览器中打开<a href=\"http://localhost:4200。随后，您就会在浏览器中看到如下点击按钮的动画效果。\" target=\"_blank\" rel=\"noopener\">http://localhost:4200。随后，您就会在浏览器中看到如下点击按钮的动画效果。</a></p>\n<h2 id=\"气球动画效果\"><a href=\"#气球动画效果\" class=\"headerlink\" title=\"气球动画效果\"></a>气球动画效果</h2><p>在前面的动画示例中，转化仅发生在两个方向。而在本节中，我们将学习如何改变所有方向上的尺寸。这与气球的充、放气比较类似，故称为气球动画效果。</p>\n<p>请在动画属性中添加如下的触发器定义。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">trigger(<span class=\"string\">'balloonEffect'</span>, [ </span><br><span class=\"line\">   state(<span class=\"string\">'initial'</span>, style(&#123; </span><br><span class=\"line\">     backgroundColor: <span class=\"string\">'green'</span>, </span><br><span class=\"line\">     transform: <span class=\"string\">'scale(1)'</span> </span><br><span class=\"line\">   &#125;)), </span><br><span class=\"line\">   state(<span class=\"string\">'final'</span>, style(&#123; </span><br><span class=\"line\">     backgroundColor: <span class=\"string\">'red'</span>, </span><br><span class=\"line\">     transform: <span class=\"string\">'scale(1.5)'</span> </span><br><span class=\"line\">   &#125;)), </span><br><span class=\"line\">   transition(<span class=\"string\">'final=&gt;initial'</span>, animate(<span class=\"string\">'1000ms'</span>)), </span><br><span class=\"line\">   transition(<span class=\"string\">'initial=&gt;final'</span>, animate(<span class=\"string\">'1500ms'</span>)) </span><br><span class=\"line\"> ]),</span><br></pre></td></tr></table></figure>\n<p>在此，我们使用转换属性来更改所有方向的尺寸大小。当该元素的状态发生变化时转换随即发生。</p>\n<p>请在app.component.html文件中添加如下HTML代码。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Balloon Effect<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"changeState()\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">style</span>=<span class=\"string\">\"width:100px;height:100px; border-radius: 100%; margin: 3rem; background-color: green\"</span> </span></span><br><span class=\"line\"><span class=\"tag\">  [@<span class=\"attr\">balloonEffect</span>]=<span class=\"string\">currentState</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了一个div，并通过CSS样式来定义成一个圆圈。我们将通过点击div去调用changeState，从而实现元素状态的切换。</p>\n<p>下图便是该动画在浏览器中的运行效果：</p>\n<p>淡入和淡出动画</p>\n<p>有时候，我们需要在显示动画的同时，对DOM添加或移除元素。下面，我们来看看如何通过对一个列表添加或删除条目，以实现淡入和淡出的动画效果。</p>\n<p>请将如下代码插入AnimationdemoComponent类的定义之中。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listItem = []; </span><br><span class=\"line\">list_order: <span class=\"built_in\">number</span> = <span class=\"number\">1</span>; </span><br><span class=\"line\">addItem() &#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> listitem = <span class=\"string\">\"ListItem \"</span> + <span class=\"keyword\">this</span>.list_order; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.list_order++; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.listItem.push(listitem); </span><br><span class=\"line\">&#125; </span><br><span class=\"line\">removeItem() &#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.listItem.length -= <span class=\"number\">1</span>; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请在该动画的属性中添加如下的触发器定义。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">trigger(<span class=\"string\">'fadeInOut'</span>, [ </span><br><span class=\"line\">  state(<span class=\"string\">'void'</span>, style(&#123; </span><br><span class=\"line\">    opacity: <span class=\"number\">0</span> </span><br><span class=\"line\">  &#125;)), </span><br><span class=\"line\">  transition(<span class=\"string\">'void &lt;=&gt; *'</span>, animate(<span class=\"number\">1000</span>)), </span><br><span class=\"line\">]),</span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了触发器fadeInOut。当该元素被添加到DOM时，它的状态就从void转换为wildcard，我们表示为void =&gt; <em>。而当该元素从DOM删除时，它的状态就从wildcard转换为void，我们表示为</em> =&gt; void。</p>\n<p>我们给动画的不同方向使用相同的动画定时，其语法为&lt;=&gt;。正如该触发器所定义的，动画从void =&gt; <em> 和 </em> =&gt; void，都需要1000毫秒才能完成。</p>\n<p>请在app.component.html文件中添加如下HTML代码。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Fade-In and Fade-Out animation<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"addItem()\"</span>&gt;</span>Add List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"removeItem()\"</span>&gt;</span>Remove List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:200px; margin-left: 20px\"</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">li</span> *<span class=\"attr\">ngFor</span>=<span class=\"string\">\"let list of listItem\"</span> [@<span class=\"attr\">fadeInOut</span>]&gt;</span> </span><br><span class=\"line\">      &#123;&#123;list&#125;&#125; </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\">在此，我们定义了两个按钮来添加和删除条目。我们将fadeInOut触发器与元素绑定，以实现在对DOM进行添加、删除时，能够出现淡入和淡出的效果。</span><br><span class=\"line\"></span><br><span class=\"line\">下图便是该动画在浏览器中的运行效果：</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">进入和离开动画</span><br><span class=\"line\"></span><br><span class=\"line\">此外，我们还能够通过对DOM的添加，实现某个元素从左边进入屏幕;而在删除时，能让该元素从右边离开屏幕。</span><br><span class=\"line\"></span><br><span class=\"line\">由于从void =&gt; * 和 * =&gt; void 的转换十分常见。因此，Angular为这些动画提供了别名机制：</span><br><span class=\"line\"></span><br><span class=\"line\">- 对于 void =&gt; * ，我们可以用':enter'</span><br><span class=\"line\">- 对于 * =&gt; void ，我们可以用':leave'</span><br><span class=\"line\"></span><br><span class=\"line\">这两个别名使得此类转换更具可读性，也更容易被理解。</span><br><span class=\"line\"></span><br><span class=\"line\">请在动画的属性中添加如下触发器的定义。</span><br><span class=\"line\"></span><br><span class=\"line\">```ts</span><br><span class=\"line\">trigger('EnterLeave', [ </span><br><span class=\"line\">  state('flyIn', style(&#123; transform: 'translateX(0)' &#125;)), </span><br><span class=\"line\">  transition(':enter', [ </span><br><span class=\"line\">    style(&#123; transform: 'translateX(-100%)' &#125;), </span><br><span class=\"line\">    animate('0.5s 300ms ease-in') </span><br><span class=\"line\">  ]), </span><br><span class=\"line\">  transition(':leave', [ </span><br><span class=\"line\">    animate('0.3s ease-out', style(&#123; transform: 'translateX(100%)' &#125;)) </span><br><span class=\"line\">  ]) </span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了触发器EnterLeave。那么’:enter’的转换需要等待300毫秒，然后运行0.5秒，并实现滑入的效果;而’:leave’的转换只运行0.3秒，实现滑出的效果。</p>\n<p>请在app.component.html文件中添加如下HTML代码。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Enter and Leave animation<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"addItem()\"</span>&gt;</span>Add List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"removeItem()\"</span>&gt;</span>Remove List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:200px; margin-left: 20px\"</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">li</span> *<span class=\"attr\">ngFor</span>=<span class=\"string\">\"let list of listItem\"</span> [@<span class=\"attr\">EnterLeave</span>]=<span class=\"string\">\"'flyIn'\"</span>&gt;</span> </span><br><span class=\"line\">      &#123;&#123;list&#125;&#125; </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了两个按钮来对列表添加和删除条目。我们将EnterLeave触发器与元素绑定，以实现在对DOM进行添加、删除时，出现滑入和滑出的效果。</p>\n<p>下图便是该动画在浏览器中的运行效果：</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>综上所述，我们针对Angular 6的动画效果，探讨了动画状态和转换的概念，也通过一个应用示例展示了实际的动画代码与效果。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"如何用Angular-6创建各种动画效果\"><a href=\"#如何用Angular-6创建各种动画效果\" class=\"headerlink\" title=\"如何用Angular 6创建各种动画效果\"></a>如何用Angular 6创建各种动画效果</h1><h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>就技术角度而言，动画可以被定义为从初始状态到最终状态的转换过程。如今它已是各种Web应用不可或缺的组成部分。通过动画，我们不仅能创建出各种酷炫的UI，同时它们也能增加应用程序的趣味性。因此，设计精美的动画在吸引用户眼球的同时，也增强了他们的浏览体验。</p>\n<p>Angular能够让我们创建出具有原生表现效果的动画。我们将通过本文学习到如何使用Angular 6来创建各种动画效果。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>安装vs code和 Angular cli。</p>\n<h2 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h2><p><a href=\"https://stackblitz.com/edit/tk-angular-animations-01\" target=\"_blank\" rel=\"noopener\">https://stackblitz.com/edit/tk-angular-animations-01</a></p>\n<h2 id=\"理解Angular动画的不同状态\"><a href=\"#理解Angular动画的不同状态\" class=\"headerlink\" title=\"理解Angular动画的不同状态\"></a>理解Angular动画的不同状态</h2><p>动画是某个元素从一种状态向另一种状态的转变，Angular为单个元素定义出了三种不同的状态。</p>\n<ol>\n<li>void状态：void状态表示某个元素处于不是DOM一部分的状态。当一个元素被创建且尚未放到DOM中、或者该元素从DOM中移除时，就处于该状态。此状态特别实用，特别是当我们想通过添加或删除DOM中的元素，来创建动画的时候，我们在代码中使用关键字void来定义这种状态。</li>\n<li>wildcard状态：又称元素的默认状态。不管当前的动画状态如何，各种样式都用这种状态来定义元素。我们在代码中用符号*来定义这种状态。</li>\n<li>Custom状态：元素的这种状态需要在代码中被明确定义。我们在代码中可以使用任何自定义的名称来表示这种状态。</li>\n</ol>\n<h2 id=\"动画转换定时\"><a href=\"#动画转换定时\" class=\"headerlink\" title=\"动画转换定时\"></a>动画转换定时</h2><p>我们在自己的应用中，通过定义动画转换的定时，来显示从一个状态过度到另一个状态。Angular为我们提供了如下三种与时间相关的属性：</p>\n<ol>\n<li>持续时间(Duration)</li>\n</ol>\n<p>此属性表示我们的动画从开始(初始状态)到完成(最终状态)所需的时间。我们可以用以下三种方式来定义动画的持续时间：</p>\n<ul>\n<li>使用一个整数值，来表示以毫秒为单位的时间，例如：500</li>\n<li>使用一个字符串值，来表示以毫秒为单位的时间，例如：’500ms’</li>\n<li>使用一个字符串值，来表示以秒为单位的时间。例如：’0.5’</li>\n</ul>\n<ol start=\"2\">\n<li>延迟(Delay)</li>\n</ol>\n<p>此属性代表动画从触发到和实际转换开始之间的时间间隔。该属性遵循与上述持续时间相同的语法规则。要定义延迟，我们需要在持续时间值的后面，以字符串的形式添加延迟的数值，即：’Duration Delay’。例如’ 0.3s 500ms’，表示转换将等待500毫秒，然后运行0.3秒。</p>\n<ol start=\"3\">\n<li>滑动(Easing)</li>\n</ol>\n<p>此属性表示动画在其执行过程中是如何被加速或减速的。我们可以在持续时间和延迟的字符串后面，添加第三个变量。当然，如果延迟数值不存在的话，那么Easing将成为第二个数值。这同样也是一个可选属性。例如：</p>\n<ul>\n<li>‘0.3s 500ms ease-in’。这意味着转换将等待500毫秒，然后运行0.3秒(300毫秒)，实现滑入的效果。</li>\n<li>‘300ms ease-out’。这意味着转换将运行300毫秒(0.3秒)，实现滑出的效果。</li>\n</ul>\n<h2 id=\"创建Angular-6应用\"><a href=\"#创建Angular-6应用\" class=\"headerlink\" title=\"创建Angular 6应用\"></a>创建Angular 6应用</h2><p>请在您的计算机上打开命令提示行，并执行以下命令集：</p>\n<ul>\n<li>mkdir ngAnimationDemo</li>\n<li>cd ngAnimationDemo</li>\n<li>ng new ngAnimation</li>\n</ul>\n<p>这些命令将创建一个名为ngAnimationDemo的目录，然后在该目录内创建一个名为ngAnimation的Angular应用。</p>\n<p>请使用Visual Studio Code打开ngAnimation应用。接着我们将创建自己的组件。</p>\n<p>请依次进入View &gt;&gt; Integrated Terminal，这将打开Visual Studio Code的终端窗口。</p>\n<p>请执行以下命令，以创建相应的组件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng g c animationdemo</span><br></pre></td></tr></table></figure>\n<p>它将在/src/app文件夹内创建我们的组件–animationdemo。</p>\n<p>为了用到Angular动画，我们需要在应用中导入特定的动画模块–BrowserAnimationsModule。请打开app.module.ts文件，并添加如下的导入定义：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; BrowserAnimationsModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/platform-browser/animations'</span>;  </span><br><span class=\"line\"><span class=\"comment\">// other import definitions  </span></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123; imports: [BrowserAnimationsModule <span class=\"comment\">// other imports]&#125;)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"理解Angular动画的语法\"><a href=\"#理解Angular动画的语法\" class=\"headerlink\" title=\"理解Angular动画的语法\"></a>理解Angular动画的语法</h2><p>下面，我们在组件的元数据中编写动画代码。其语法如下：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span>(&#123; </span><br><span class=\"line\"><span class=\"comment\">// other component properties. </span></span><br><span class=\"line\">  animations: [ </span><br><span class=\"line\">    trigger(<span class=\"string\">'triggerName'</span>), [ </span><br><span class=\"line\">      state(<span class=\"string\">'stateName'</span>, style()) </span><br><span class=\"line\">      transition(<span class=\"string\">'stateChangeExpression'</span>, [Animation Steps]) </span><br><span class=\"line\">    ] </span><br><span class=\"line\">  ] </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>此处，我们用到了名为animations的属性。该属性的输入是一个阵列，此阵列包含一个或多个“触发器”。同时，每个触发器都带有唯一的名称、和用来定义动画的状态和各种转换的具体实现。</p>\n<p>另外，每一个状态函数都会通过“stateName”来唯一地识别其状态、并用样式函数来显示在该状态下的元素样式。</p>\n<p>当然，每个转换函数也都通过stateChangeExpression，来定义元素状态转换、并定义动画的不同步骤所对应的阵列，从而能够显示出转换是如何发生的。在此，我们就可以用逗号分隔的数值，来将多个触发器函数包括到动画的属性之中。</p>\n<p>由于这些功能(触发、状态、和转换)都被定义在@angular/animations模块之中，因此，我们需要在自己的组件导入该模块。</p>\n<p>为了将动画应用到某个元素之上，我们需要在元素的定义中包含触发器的名称，即：在元素的标签里使用@后面加触发器名称的格式。对应的代码示例如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> @<span class=\"attr\">changeSize</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这是将触发器changeSize应用到元素的上。</p>\n<p>下面，让我们创建更多的动画，以更好地理解Angular的动画概念吧。</p>\n<p>更改大小的动画</p>\n<p>我们将创建一个动画，来实现一键改变的大小。</p>\n<p>请打开animationdemo.component.ts文件，将如下代码添加到导入定义之中。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; trigger, state, style, animate, transition &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/animations'</span>;</span><br></pre></td></tr></table></figure>\n<p>在组件的元数据中添加如下的动画属性定义。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">animations: [ </span><br><span class=\"line\">  trigger(<span class=\"string\">'changeDivSize'</span>, [ </span><br><span class=\"line\">    state(<span class=\"string\">'initial'</span>, style(&#123; </span><br><span class=\"line\">      backgroundColor: <span class=\"string\">'green'</span>, </span><br><span class=\"line\">      width: <span class=\"string\">'100px'</span>, </span><br><span class=\"line\">      height: <span class=\"string\">'100px'</span> </span><br><span class=\"line\">    &#125;)), </span><br><span class=\"line\">    state(<span class=\"string\">'final'</span>, style(&#123; </span><br><span class=\"line\">      backgroundColor: <span class=\"string\">'red'</span>, </span><br><span class=\"line\">      width: <span class=\"string\">'200px'</span>, </span><br><span class=\"line\">      height: <span class=\"string\">'200px'</span> </span><br><span class=\"line\">    &#125;)), </span><br><span class=\"line\">    transition(<span class=\"string\">'initial=&gt;final'</span>, animate(<span class=\"string\">'1500ms'</span>)), </span><br><span class=\"line\">    transition(<span class=\"string\">'final=&gt;initial'</span>, animate(<span class=\"string\">'1000ms'</span>)) </span><br><span class=\"line\">  ]), </span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了一个触发器—changeDivSize，而且该触发器里的两个功能函数。该元素在“初始”状态时呈现绿色，并随着宽度和高度的增加，在“最终”状态时呈现为红色。</p>\n<p>同时，我们定义了状态的转换规则：从“初始”态到“最终”态将持续1500毫秒，而从“最终”态返回“初始”态则为1000毫秒。</p>\n<p>为了改变元素的状态，我们在组件的类定义中定义了一个功能函数。我们将如下代码包含在AnimationdemoComponent类中：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">currentState = <span class=\"string\">'initial'</span>; </span><br><span class=\"line\">changeState() &#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.currentState = <span class=\"keyword\">this</span>.currentState === <span class=\"string\">'initial'</span> ? <span class=\"string\">'final'</span> : <span class=\"string\">'initial'</span>; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此处，我们定义了一个changeState方法，来切换元素的状态。</p>\n<p>请打开animationdemo.component.html文件，并添加以下代码：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Change the div size<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"changeState()\"</span>&gt;</span>Change Size<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> [@<span class=\"attr\">changeDivSize</span>]=<span class=\"string\">currentState</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>我们定义了一个按钮，来调用点击时的changeState函数。由于我们前面已经定义了元素，并对它应用了changeDivSize动画触发器，因此当按钮被点击时，它会更新元素的状态，其大小则会伴随着转换效果而发生变化。</p>\n<p>在执行该应用之前，我们也需要将引用包含在app.component.html文件内的Animationdemo组件中。</p>\n<p>打开app.component.html文件，您会发现该文件中已包含了一些默认的HTML代码。请删除所有的代码，并按照下图所示放置组件的选择器：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">app-animationdemo</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">app-animationdemo</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>请在Visual Studio Code的终端窗口里运行ng serve命令，以执行该代码。运行完毕后，它会提示您在浏览器中打开<a href=\"http://localhost:4200。随后，您就会在浏览器中看到如下点击按钮的动画效果。\" target=\"_blank\" rel=\"noopener\">http://localhost:4200。随后，您就会在浏览器中看到如下点击按钮的动画效果。</a></p>\n<h2 id=\"气球动画效果\"><a href=\"#气球动画效果\" class=\"headerlink\" title=\"气球动画效果\"></a>气球动画效果</h2><p>在前面的动画示例中，转化仅发生在两个方向。而在本节中，我们将学习如何改变所有方向上的尺寸。这与气球的充、放气比较类似，故称为气球动画效果。</p>\n<p>请在动画属性中添加如下的触发器定义。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">trigger(<span class=\"string\">'balloonEffect'</span>, [ </span><br><span class=\"line\">   state(<span class=\"string\">'initial'</span>, style(&#123; </span><br><span class=\"line\">     backgroundColor: <span class=\"string\">'green'</span>, </span><br><span class=\"line\">     transform: <span class=\"string\">'scale(1)'</span> </span><br><span class=\"line\">   &#125;)), </span><br><span class=\"line\">   state(<span class=\"string\">'final'</span>, style(&#123; </span><br><span class=\"line\">     backgroundColor: <span class=\"string\">'red'</span>, </span><br><span class=\"line\">     transform: <span class=\"string\">'scale(1.5)'</span> </span><br><span class=\"line\">   &#125;)), </span><br><span class=\"line\">   transition(<span class=\"string\">'final=&gt;initial'</span>, animate(<span class=\"string\">'1000ms'</span>)), </span><br><span class=\"line\">   transition(<span class=\"string\">'initial=&gt;final'</span>, animate(<span class=\"string\">'1500ms'</span>)) </span><br><span class=\"line\"> ]),</span><br></pre></td></tr></table></figure>\n<p>在此，我们使用转换属性来更改所有方向的尺寸大小。当该元素的状态发生变化时转换随即发生。</p>\n<p>请在app.component.html文件中添加如下HTML代码。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Balloon Effect<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"changeState()\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">style</span>=<span class=\"string\">\"width:100px;height:100px; border-radius: 100%; margin: 3rem; background-color: green\"</span> </span></span><br><span class=\"line\"><span class=\"tag\">  [@<span class=\"attr\">balloonEffect</span>]=<span class=\"string\">currentState</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了一个div，并通过CSS样式来定义成一个圆圈。我们将通过点击div去调用changeState，从而实现元素状态的切换。</p>\n<p>下图便是该动画在浏览器中的运行效果：</p>\n<p>淡入和淡出动画</p>\n<p>有时候，我们需要在显示动画的同时，对DOM添加或移除元素。下面，我们来看看如何通过对一个列表添加或删除条目，以实现淡入和淡出的动画效果。</p>\n<p>请将如下代码插入AnimationdemoComponent类的定义之中。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listItem = []; </span><br><span class=\"line\">list_order: <span class=\"built_in\">number</span> = <span class=\"number\">1</span>; </span><br><span class=\"line\">addItem() &#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> listitem = <span class=\"string\">\"ListItem \"</span> + <span class=\"keyword\">this</span>.list_order; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.list_order++; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.listItem.push(listitem); </span><br><span class=\"line\">&#125; </span><br><span class=\"line\">removeItem() &#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.listItem.length -= <span class=\"number\">1</span>; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请在该动画的属性中添加如下的触发器定义。</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">trigger(<span class=\"string\">'fadeInOut'</span>, [ </span><br><span class=\"line\">  state(<span class=\"string\">'void'</span>, style(&#123; </span><br><span class=\"line\">    opacity: <span class=\"number\">0</span> </span><br><span class=\"line\">  &#125;)), </span><br><span class=\"line\">  transition(<span class=\"string\">'void &lt;=&gt; *'</span>, animate(<span class=\"number\">1000</span>)), </span><br><span class=\"line\">]),</span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了触发器fadeInOut。当该元素被添加到DOM时，它的状态就从void转换为wildcard，我们表示为void =&gt; <em>。而当该元素从DOM删除时，它的状态就从wildcard转换为void，我们表示为</em> =&gt; void。</p>\n<p>我们给动画的不同方向使用相同的动画定时，其语法为&lt;=&gt;。正如该触发器所定义的，动画从void =&gt; <em> 和 </em> =&gt; void，都需要1000毫秒才能完成。</p>\n<p>请在app.component.html文件中添加如下HTML代码。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Fade-In and Fade-Out animation<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"addItem()\"</span>&gt;</span>Add List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"removeItem()\"</span>&gt;</span>Remove List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:200px; margin-left: 20px\"</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">li</span> *<span class=\"attr\">ngFor</span>=<span class=\"string\">\"let list of listItem\"</span> [@<span class=\"attr\">fadeInOut</span>]&gt;</span> </span><br><span class=\"line\">      &#123;&#123;list&#125;&#125; </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\">在此，我们定义了两个按钮来添加和删除条目。我们将fadeInOut触发器与元素绑定，以实现在对DOM进行添加、删除时，能够出现淡入和淡出的效果。</span><br><span class=\"line\"></span><br><span class=\"line\">下图便是该动画在浏览器中的运行效果：</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">进入和离开动画</span><br><span class=\"line\"></span><br><span class=\"line\">此外，我们还能够通过对DOM的添加，实现某个元素从左边进入屏幕;而在删除时，能让该元素从右边离开屏幕。</span><br><span class=\"line\"></span><br><span class=\"line\">由于从void =&gt; * 和 * =&gt; void 的转换十分常见。因此，Angular为这些动画提供了别名机制：</span><br><span class=\"line\"></span><br><span class=\"line\">- 对于 void =&gt; * ，我们可以用':enter'</span><br><span class=\"line\">- 对于 * =&gt; void ，我们可以用':leave'</span><br><span class=\"line\"></span><br><span class=\"line\">这两个别名使得此类转换更具可读性，也更容易被理解。</span><br><span class=\"line\"></span><br><span class=\"line\">请在动画的属性中添加如下触发器的定义。</span><br><span class=\"line\"></span><br><span class=\"line\">```ts</span><br><span class=\"line\">trigger('EnterLeave', [ </span><br><span class=\"line\">  state('flyIn', style(&#123; transform: 'translateX(0)' &#125;)), </span><br><span class=\"line\">  transition(':enter', [ </span><br><span class=\"line\">    style(&#123; transform: 'translateX(-100%)' &#125;), </span><br><span class=\"line\">    animate('0.5s 300ms ease-in') </span><br><span class=\"line\">  ]), </span><br><span class=\"line\">  transition(':leave', [ </span><br><span class=\"line\">    animate('0.3s ease-out', style(&#123; transform: 'translateX(100%)' &#125;)) </span><br><span class=\"line\">  ]) </span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了触发器EnterLeave。那么’:enter’的转换需要等待300毫秒，然后运行0.5秒，并实现滑入的效果;而’:leave’的转换只运行0.3秒，实现滑出的效果。</p>\n<p>请在app.component.html文件中添加如下HTML代码。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Enter and Leave animation<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"addItem()\"</span>&gt;</span>Add List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"removeItem()\"</span>&gt;</span>Remove List<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:200px; margin-left: 20px\"</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">li</span> *<span class=\"attr\">ngFor</span>=<span class=\"string\">\"let list of listItem\"</span> [@<span class=\"attr\">EnterLeave</span>]=<span class=\"string\">\"'flyIn'\"</span>&gt;</span> </span><br><span class=\"line\">      &#123;&#123;list&#125;&#125; </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在此，我们定义了两个按钮来对列表添加和删除条目。我们将EnterLeave触发器与元素绑定，以实现在对DOM进行添加、删除时，出现滑入和滑出的效果。</p>\n<p>下图便是该动画在浏览器中的运行效果：</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>综上所述，我们针对Angular 6的动画效果，探讨了动画状态和转换的概念，也通过一个应用示例展示了实际的动画代码与效果。</p>\n"},{"title":"面向对象","date":"2019-02-21T01:44:01.000Z","_content":"\n## 面向对象\n\n### 什么是面向对象\n\n面向对象(Object Oriented,OO)是软件开发方法。面向对象的概念和应用已超越了程序设计和软件开发，扩展到如数据库系统、交互式界面、应用结构、应用平台、分布式系统、网络管理结构、CAD技术、人工智能等领域。面向对象是一种对现实世界理解和抽象的方法，是计算机编程技术发展到一定阶段后的产物。\n\n\n面向过程(Procedure Oriented)是一种以过程为中心的编程思想。这些都是以什么正在发生为主要目标进行编程，不同于面向对象的是谁在受影响。与面向对象明显的不同就是封装、继承、类。\n\n\n### 面向对象的三大基本特征\n面向对象的三个基本特征是：封装、继承、多态。\n\n![](http://www.cnitblog.com/images/cnitblog_com/lily/1972/o_OOBase.gif)\n\n面向对象的三大基本特征和五大基本原则\n\n\n**封装**\n\n封装最好理解了。封装是面向对象的特征之一，是对象和类概念的主要特性。\n\n封装，也就是把客观事物封装成抽象的类，并且类可以把自己的数据和方法只让可信的类或者对象操作，对不可信的进行信息隐藏。\n\n**继承**\n\n面向对象编程(OOP)语言的一个主要功能就是“继承”。继承是指这样一种能力：它可以使用现有类的所有功能，并在无需重新编写原来的类的情况下对这些功能进行扩展。\n\n通过继承创建的新类称为**子类**或**派生类**。被继承的类称为**基类**、**父类**或**超类**。\n\n继承的过程，就是从一般到特殊的过程。\n\n要实现继承，可以通过`继承（Inheritance）`和`组合（Composition）`来实现。\n在某些 OOP 语言中，一个子类可以继承多个基类。但是一般情况下，一个子类只能有一个基类，要实现多重继承，可以通过多级继承来实现。\n \n继承概念的实现方式有三类：实现继承、接口继承和可视继承。\n- 实现继承是指使用基类的属性和方法而无需额外编码的能力；\n- 接口继承是指仅使用属性和方法的名称、但是子类必须提供实现的能力；\n- 可视继承是指子窗体（类）使用基窗体（类）的外观和实现代码的能力。\n\n在考虑使用继承时，有一点需要注意，那就是两个类之间的关系应该是**属于**关系。例如，`Employee`是一个人，`Manager`也是一个人，因此这两个类都可以继承`Person`类。但是`Leg` 类却不能继承`Person`类，因为腿并不是一个人。\n\n抽象类仅定义将由子类创建的一般属性和方法，创建抽象类时，请使用关键字 `interface` 而不是`class`。\n\nOO开发范式大致为：划分对象->抽象类->将类组织成为层次化结构(继承和合成) ->用类与实例进行设计和实现几个阶段。\n\n**多态**\n\n多态性（polymorphisn）是允许你将父对象设置成为和一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值给它的子对象的特性以不同的方式运作。简单的说，就是一句话：允许将子类类型的指针赋值给父类类型的指针。\n\n实现多态，有二种方式: **覆盖**、**重载**。\n\n- **覆盖**，是指子类重新定义父类的虚函数的做法。\n- **重载**，是指允许存在多个同名函数，而这些函数的参数表不同（或许参数个数不同，或许参数类型不同，或许两者都不同）。\n\n其实，重载的概念并不属于“面向对象编程”，重载的实现是：编译器根据函数不同的参数表，对同名函数的名称做修饰，然后这些同名函数就成了不同的函数（至少对于编译器来说是这样的）。如，有两个同名函数：`function func(p:integer):integer;`和`function func(p:string):integer;`。那么编译器做过修饰后的函数名称可能是这样的：`int_func`、`str_func`。对于这两个函数的调用，在编译器间就已经确定了，是静态的（记住：是静态）。也就是说，它们的地址在编译期就绑定了（早绑定），因此，重载和多态无关！真正和多态相关的是“覆盖”。当子类重新定义了父类的虚函数后，父类指针根据赋给它的不同的子类指针，动态（记住：是动态！）的调用属于子类的该函数，这样的函数调用在编译期间是无法确定的（调用的子类的虚函数的地址无法给出）。因此，这样的函数地址是在运行期绑定的（晚邦定）。结论就是：重载只是一种语言特性，与多态无关，与面向对象也无关！引用一句Bruce Eckel的话：“不要犯傻，如果它不是晚邦定，它就不是多态。”\n\n那么，多态的作用是什么呢？\n\n我们知道，封装可以隐藏实现细节，使得代码模块化；继承可以扩展已存在的代码模块（类）；它们的目的都是为了——代码重用。而多态则是为了实现另一个目的——接口重用！多态的作用，就是为了类在继承和派生的时候，保证使用“家谱”中任一类的实例的某一属性时的正确调用。\n\n### 平台无关性\n\nJava是平台无关的语言是指用Java写的应用程序不用修改就可在不同的软硬件平台上运行。平台无关有两种：源代码级和目标代码级。C和C++具有一定程度的源代码级平台无关，表明用C或C++写的应用程序不用修改只需重新编译就可以在不同平台上运行。\n\nJava主要靠Java虚拟机（JVM）在目标码级实现平台无关性。JVM是一种抽象机器，它附着在具体操作系统之上，本身具有一套虚机器指令，并有自己的栈、寄存器组等。但JVM通常是在软件上而不是在硬件上实现。（目前，SUN系统公司已经设计实现了Java芯片，主要使用在网络计算机NC上。另外，Java芯片的出现也会使Java更容易嵌入到家用电器中。）JVM是Java平台无关的基础，在JVM上，有一个Java解释器用来解释Java编译器编译后的程序。Java编程人员在编写完软件后，通过Java编译器将Java源程序编译为JVM的字节代码。任何一台机器只要配备了Java解释器，就可以运行这个程序，而不管这种字节码是在何种平台上生成的（过程如图1所示）。另外，Java采用的是基于IEEE标准的数据类型。通过JVM保证数据类型的一致性，也确保了Java的平台无关性。\n\nJava的平台无关性具有深远意义。首先，它使得编程人员所梦寐以求的事情（开发一次软件在任意平台上运行）变成事实，这将大大加快和促进软件产品的开发。其次Java的平台无关性正好迎合了 \"网络计算机 \"思想。如果大量常用的应用软件（如字处理软件等）都用Java重新编写，并且放在某个Internet服务器上，那么具有NC的用户将不需要占用大量空间安装软件，他们只需要一个Java解释器，每当需要使用某种应用软件时，下载该软件的字节代码即可，运行结果也可以发回服务器。目前，已有数家公司开始使用这种新型的计算模式构筑自己的企业信息系统。\n\n#### JVM 还支持哪些语言\n\n**Kotlin**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-1-660x344.gif)\n\n官方站点：https://kotlinlang.org/\n\n由JetBrains于2010年创建，并于2012年开源， Kotlin比Java更加简洁和安全。 您完全可以将Kotlin视为是一种“更加简单但高效的Java”。Kotlin的编译速度通常比Java代码快，而且在其创建之初，就非常明确的支持了函数式编程，这一点，Java是到Java 8才开始支持的。\n\n特别的，因为有了Google的加持，越来越多的Android开发人员，开始选择Kotlin来开发应用程序，与此同时，独立的超越JVM的行动也已经在展开，通过一项名为LLVM的项目，Kotlin正在努力实现代码编译的本地化，而不在基于JVM 。\n\n但无论如何，至少现在，它还活在JVM中。\n\n**Scala**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-2-660x274.gif)\n\n官方站点：http://www.scala-lang.org/\n\n和Kotlin一样， Scala也是为了让Java开发人员提高工作效率而创建的。 作为一种完全的面向对象语言和一种完全的函数式编程语言，Scala巧妙的将这两种编程范式结合到了一起。\n\n特别是在函数式编程方面，Scala几乎支持函数式编程语言中所有已知的特性，比如，模式匹配（Pattern matching）、延迟初始化（Lazy initialization）、偏函数（Partial Function）、不变性（Immutability）等等等等，\n\n因此，虽然Scala的类Lisp的语法会让初学者倍感迷惑，但花时间在这上面，永远是值得的，很快，就会让你体会到那种只需要关注 What（做什么），而不用关注How（如何做）的酸爽。\n\n一个最新的关于Scala的消息是，它似乎也在和Kotlin一样，在加速准备逃离JVM的控制，这对于JVM，恐怕不是一个什么特别好的消息，虽然，其距离用于生产可能还为时尚早。\n\n\n**Clojure**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-3.gif)\n\n官方站点：https://clojure.org/\n\nClojure是由开发人员Rich Hickey在JVM下，所创建的一种Lisp方言，借助于JVM的执行效率越来越高，Clojure也常被嵌入在Java中，用于编写其中需要高并发、高性能的部分 。\n\n\n**Groovy**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-4-660x291.gif)\n\n官方站点：http://www.groovy-lang.org/\n\nGroovy是在Java现有基础上，吸收Python和Ruby等动态语言的特性，而创建的一种新型语言，也是Jenkins持续集成服务器，所直接支持的语言之一，并且最关键的一点，通过基于Groovy的Web开发框架Grails，可以快速的完成相关Web项目的构建 。\n\n在未来，Groovy则拟包含Java和JVM的一些更新的特性，比如如Java 8的lambda语法等。\n\n**Jython**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-5.gif)\n\n官方站点：http://www.jython.org/\n\nJython是JVM的Python实现，与Python的2.x分支兼容，可以动态编译为Java字节码，并且可以与其他JVM语言（特别是Java）自由交互操作。\n\n **JRuby**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-6-660x206.gif)\n\n官方站点：http://jruby.org\n\nJRuby几乎就是Jython的翻版，所不同的是，JRuby所对标的语言是Ruby，当前所支持的语法规范则和Ruby 2.3兼容。\n\n**Ceylon**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-7.gif)\n\n官方站点：https://www.ceylon-lang.org\n\n这个以大象为Logo的语言，其创建初衷可不是像大象一样笨拙，恰恰相反，语言的创始人 Gavin King，是出于对Java所存在问题的深刻认识，如泛型等特性的复杂性、粗劣的注解语法、不完善的块结构、对 XML 的依赖性等等，才萌生了创建一种新的静态类型语言语言，即Ceylon来一劳永逸的解决这些问题的想法。\n\nCeylon保留了一些好的 Java 语言特性，改进了语言的可读性和内置的模块性，还吸收了高阶函数等函数语言特性，此外，Ceylon 还融合了 C 和 Smalltalk 的一些特性。与 Java 语言一样，这种新语言也以业务计算为重点，但是它在其他领域也很灵活、很有用。并且，通过这些年的努力，Ceylon已经跨出了其自身跨平台的第一步，其代码已经可以在JVM，Dart VM或Node.js上进行编译或运行。\n\n**Eta**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-8.gif)\n\n官方站点：https://eta-lang.org/\n\n我们的名单中怎么能少了时下最能装酷，也是被Node.js的创建者称为觉得暂无能力驾驭的语言Haskell的JVM实现？\n\n它来了，就是Eta，它的优势，不仅仅在于它可以在JVM下执行，更在于它可以使用Haskell的软件包仓库中的软件包，最大程度的兼容了整个Haskell生态系统。\n\n**Haxe**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-9.gif)\n\n官方站点：http://haxe.org\n\nHaxe的口号是：One Language，Everywhere！是不是有点熟悉？是的，在非常久远的过去，这其实正是Java的初心。\n\n但是，这二者又是如此的迥异。Java的策略是，我做一个平台JVM，给出一种规范，你们来生成我需要的代码；Haxe的策略则正好相反，既然芸芸众生，语言纷杂，每个人都各有偏好，那好，来吧，我可以把我的代码，生成任何一种你们想要的语言下的代码！\n\n多么疯狂的想法！就为这点疯狂，就值得我们每个开发人员去膜拜一番了，毕竟，在Haxe看来，JVM，不过是其可以编译的一个“小”对象而已。\n\n### 值传递、引用传递\n\n**值传递**：(形式参数类型是基本数据类型)：方法调用时，实际参数把它的值传递给对应的形式参数，形式参数只是用实际参数的值初始化自己的存储单元内容，是两个不同的存储单元，所以方法执行中形式参数值的改变不影响实际参数的值。\n\n**引用传递**：(形式参数类型是引用数据类型参数)：也称为传地址。方法调用时，实际参数是对象(或数组)，这时实际参数与形式参数指向同一个地址，在方法执行中，对形式参数的操作实际上就是对实际参数的操作，这个结果在方法结束后被保留了下来，所以方法执行中形式参数的改变将会影响实际参数。\n\n\n说明：\n\n（1）：“在Java里面参数传递都是按值传递”这句话的意思是：按值传递是传递的值的拷贝，按引用传递其实传递的是引用的地址值，所以统称按值传递。\n\n（2）：在Java里面只有基本类型和按照下面这种定义方式的String是按值传递，其它的都是按引用传递。就是直接使用双引号定义字符串方式：String str = “Java私塾”;\n\n\n为什么说 Java 中只有值传递: https://blog.csdn.net/bjweimengshu/article/details/79799485\n\n\n\n\n---\n\n> 附参考\n> \n> - https://www.cnblogs.com/autumn001/p/9036148.html\n> - https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376\n> \n","source":"_posts/0016-面向对象.md","raw":"---\ntitle: 面向对象\ndate: 2019-02-21 09:44:01\ntags:\n    - Java\ncategories:\n    - Java成神之路\n---\n\n## 面向对象\n\n### 什么是面向对象\n\n面向对象(Object Oriented,OO)是软件开发方法。面向对象的概念和应用已超越了程序设计和软件开发，扩展到如数据库系统、交互式界面、应用结构、应用平台、分布式系统、网络管理结构、CAD技术、人工智能等领域。面向对象是一种对现实世界理解和抽象的方法，是计算机编程技术发展到一定阶段后的产物。\n\n\n面向过程(Procedure Oriented)是一种以过程为中心的编程思想。这些都是以什么正在发生为主要目标进行编程，不同于面向对象的是谁在受影响。与面向对象明显的不同就是封装、继承、类。\n\n\n### 面向对象的三大基本特征\n面向对象的三个基本特征是：封装、继承、多态。\n\n![](http://www.cnitblog.com/images/cnitblog_com/lily/1972/o_OOBase.gif)\n\n面向对象的三大基本特征和五大基本原则\n\n\n**封装**\n\n封装最好理解了。封装是面向对象的特征之一，是对象和类概念的主要特性。\n\n封装，也就是把客观事物封装成抽象的类，并且类可以把自己的数据和方法只让可信的类或者对象操作，对不可信的进行信息隐藏。\n\n**继承**\n\n面向对象编程(OOP)语言的一个主要功能就是“继承”。继承是指这样一种能力：它可以使用现有类的所有功能，并在无需重新编写原来的类的情况下对这些功能进行扩展。\n\n通过继承创建的新类称为**子类**或**派生类**。被继承的类称为**基类**、**父类**或**超类**。\n\n继承的过程，就是从一般到特殊的过程。\n\n要实现继承，可以通过`继承（Inheritance）`和`组合（Composition）`来实现。\n在某些 OOP 语言中，一个子类可以继承多个基类。但是一般情况下，一个子类只能有一个基类，要实现多重继承，可以通过多级继承来实现。\n \n继承概念的实现方式有三类：实现继承、接口继承和可视继承。\n- 实现继承是指使用基类的属性和方法而无需额外编码的能力；\n- 接口继承是指仅使用属性和方法的名称、但是子类必须提供实现的能力；\n- 可视继承是指子窗体（类）使用基窗体（类）的外观和实现代码的能力。\n\n在考虑使用继承时，有一点需要注意，那就是两个类之间的关系应该是**属于**关系。例如，`Employee`是一个人，`Manager`也是一个人，因此这两个类都可以继承`Person`类。但是`Leg` 类却不能继承`Person`类，因为腿并不是一个人。\n\n抽象类仅定义将由子类创建的一般属性和方法，创建抽象类时，请使用关键字 `interface` 而不是`class`。\n\nOO开发范式大致为：划分对象->抽象类->将类组织成为层次化结构(继承和合成) ->用类与实例进行设计和实现几个阶段。\n\n**多态**\n\n多态性（polymorphisn）是允许你将父对象设置成为和一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值给它的子对象的特性以不同的方式运作。简单的说，就是一句话：允许将子类类型的指针赋值给父类类型的指针。\n\n实现多态，有二种方式: **覆盖**、**重载**。\n\n- **覆盖**，是指子类重新定义父类的虚函数的做法。\n- **重载**，是指允许存在多个同名函数，而这些函数的参数表不同（或许参数个数不同，或许参数类型不同，或许两者都不同）。\n\n其实，重载的概念并不属于“面向对象编程”，重载的实现是：编译器根据函数不同的参数表，对同名函数的名称做修饰，然后这些同名函数就成了不同的函数（至少对于编译器来说是这样的）。如，有两个同名函数：`function func(p:integer):integer;`和`function func(p:string):integer;`。那么编译器做过修饰后的函数名称可能是这样的：`int_func`、`str_func`。对于这两个函数的调用，在编译器间就已经确定了，是静态的（记住：是静态）。也就是说，它们的地址在编译期就绑定了（早绑定），因此，重载和多态无关！真正和多态相关的是“覆盖”。当子类重新定义了父类的虚函数后，父类指针根据赋给它的不同的子类指针，动态（记住：是动态！）的调用属于子类的该函数，这样的函数调用在编译期间是无法确定的（调用的子类的虚函数的地址无法给出）。因此，这样的函数地址是在运行期绑定的（晚邦定）。结论就是：重载只是一种语言特性，与多态无关，与面向对象也无关！引用一句Bruce Eckel的话：“不要犯傻，如果它不是晚邦定，它就不是多态。”\n\n那么，多态的作用是什么呢？\n\n我们知道，封装可以隐藏实现细节，使得代码模块化；继承可以扩展已存在的代码模块（类）；它们的目的都是为了——代码重用。而多态则是为了实现另一个目的——接口重用！多态的作用，就是为了类在继承和派生的时候，保证使用“家谱”中任一类的实例的某一属性时的正确调用。\n\n### 平台无关性\n\nJava是平台无关的语言是指用Java写的应用程序不用修改就可在不同的软硬件平台上运行。平台无关有两种：源代码级和目标代码级。C和C++具有一定程度的源代码级平台无关，表明用C或C++写的应用程序不用修改只需重新编译就可以在不同平台上运行。\n\nJava主要靠Java虚拟机（JVM）在目标码级实现平台无关性。JVM是一种抽象机器，它附着在具体操作系统之上，本身具有一套虚机器指令，并有自己的栈、寄存器组等。但JVM通常是在软件上而不是在硬件上实现。（目前，SUN系统公司已经设计实现了Java芯片，主要使用在网络计算机NC上。另外，Java芯片的出现也会使Java更容易嵌入到家用电器中。）JVM是Java平台无关的基础，在JVM上，有一个Java解释器用来解释Java编译器编译后的程序。Java编程人员在编写完软件后，通过Java编译器将Java源程序编译为JVM的字节代码。任何一台机器只要配备了Java解释器，就可以运行这个程序，而不管这种字节码是在何种平台上生成的（过程如图1所示）。另外，Java采用的是基于IEEE标准的数据类型。通过JVM保证数据类型的一致性，也确保了Java的平台无关性。\n\nJava的平台无关性具有深远意义。首先，它使得编程人员所梦寐以求的事情（开发一次软件在任意平台上运行）变成事实，这将大大加快和促进软件产品的开发。其次Java的平台无关性正好迎合了 \"网络计算机 \"思想。如果大量常用的应用软件（如字处理软件等）都用Java重新编写，并且放在某个Internet服务器上，那么具有NC的用户将不需要占用大量空间安装软件，他们只需要一个Java解释器，每当需要使用某种应用软件时，下载该软件的字节代码即可，运行结果也可以发回服务器。目前，已有数家公司开始使用这种新型的计算模式构筑自己的企业信息系统。\n\n#### JVM 还支持哪些语言\n\n**Kotlin**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-1-660x344.gif)\n\n官方站点：https://kotlinlang.org/\n\n由JetBrains于2010年创建，并于2012年开源， Kotlin比Java更加简洁和安全。 您完全可以将Kotlin视为是一种“更加简单但高效的Java”。Kotlin的编译速度通常比Java代码快，而且在其创建之初，就非常明确的支持了函数式编程，这一点，Java是到Java 8才开始支持的。\n\n特别的，因为有了Google的加持，越来越多的Android开发人员，开始选择Kotlin来开发应用程序，与此同时，独立的超越JVM的行动也已经在展开，通过一项名为LLVM的项目，Kotlin正在努力实现代码编译的本地化，而不在基于JVM 。\n\n但无论如何，至少现在，它还活在JVM中。\n\n**Scala**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-2-660x274.gif)\n\n官方站点：http://www.scala-lang.org/\n\n和Kotlin一样， Scala也是为了让Java开发人员提高工作效率而创建的。 作为一种完全的面向对象语言和一种完全的函数式编程语言，Scala巧妙的将这两种编程范式结合到了一起。\n\n特别是在函数式编程方面，Scala几乎支持函数式编程语言中所有已知的特性，比如，模式匹配（Pattern matching）、延迟初始化（Lazy initialization）、偏函数（Partial Function）、不变性（Immutability）等等等等，\n\n因此，虽然Scala的类Lisp的语法会让初学者倍感迷惑，但花时间在这上面，永远是值得的，很快，就会让你体会到那种只需要关注 What（做什么），而不用关注How（如何做）的酸爽。\n\n一个最新的关于Scala的消息是，它似乎也在和Kotlin一样，在加速准备逃离JVM的控制，这对于JVM，恐怕不是一个什么特别好的消息，虽然，其距离用于生产可能还为时尚早。\n\n\n**Clojure**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-3.gif)\n\n官方站点：https://clojure.org/\n\nClojure是由开发人员Rich Hickey在JVM下，所创建的一种Lisp方言，借助于JVM的执行效率越来越高，Clojure也常被嵌入在Java中，用于编写其中需要高并发、高性能的部分 。\n\n\n**Groovy**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-4-660x291.gif)\n\n官方站点：http://www.groovy-lang.org/\n\nGroovy是在Java现有基础上，吸收Python和Ruby等动态语言的特性，而创建的一种新型语言，也是Jenkins持续集成服务器，所直接支持的语言之一，并且最关键的一点，通过基于Groovy的Web开发框架Grails，可以快速的完成相关Web项目的构建 。\n\n在未来，Groovy则拟包含Java和JVM的一些更新的特性，比如如Java 8的lambda语法等。\n\n**Jython**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-5.gif)\n\n官方站点：http://www.jython.org/\n\nJython是JVM的Python实现，与Python的2.x分支兼容，可以动态编译为Java字节码，并且可以与其他JVM语言（特别是Java）自由交互操作。\n\n **JRuby**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-6-660x206.gif)\n\n官方站点：http://jruby.org\n\nJRuby几乎就是Jython的翻版，所不同的是，JRuby所对标的语言是Ruby，当前所支持的语法规范则和Ruby 2.3兼容。\n\n**Ceylon**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-7.gif)\n\n官方站点：https://www.ceylon-lang.org\n\n这个以大象为Logo的语言，其创建初衷可不是像大象一样笨拙，恰恰相反，语言的创始人 Gavin King，是出于对Java所存在问题的深刻认识，如泛型等特性的复杂性、粗劣的注解语法、不完善的块结构、对 XML 的依赖性等等，才萌生了创建一种新的静态类型语言语言，即Ceylon来一劳永逸的解决这些问题的想法。\n\nCeylon保留了一些好的 Java 语言特性，改进了语言的可读性和内置的模块性，还吸收了高阶函数等函数语言特性，此外，Ceylon 还融合了 C 和 Smalltalk 的一些特性。与 Java 语言一样，这种新语言也以业务计算为重点，但是它在其他领域也很灵活、很有用。并且，通过这些年的努力，Ceylon已经跨出了其自身跨平台的第一步，其代码已经可以在JVM，Dart VM或Node.js上进行编译或运行。\n\n**Eta**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-8.gif)\n\n官方站点：https://eta-lang.org/\n\n我们的名单中怎么能少了时下最能装酷，也是被Node.js的创建者称为觉得暂无能力驾驭的语言Haskell的JVM实现？\n\n它来了，就是Eta，它的优势，不仅仅在于它可以在JVM下执行，更在于它可以使用Haskell的软件包仓库中的软件包，最大程度的兼容了整个Haskell生态系统。\n\n**Haxe**\n\n![](https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-9.gif)\n\n官方站点：http://haxe.org\n\nHaxe的口号是：One Language，Everywhere！是不是有点熟悉？是的，在非常久远的过去，这其实正是Java的初心。\n\n但是，这二者又是如此的迥异。Java的策略是，我做一个平台JVM，给出一种规范，你们来生成我需要的代码；Haxe的策略则正好相反，既然芸芸众生，语言纷杂，每个人都各有偏好，那好，来吧，我可以把我的代码，生成任何一种你们想要的语言下的代码！\n\n多么疯狂的想法！就为这点疯狂，就值得我们每个开发人员去膜拜一番了，毕竟，在Haxe看来，JVM，不过是其可以编译的一个“小”对象而已。\n\n### 值传递、引用传递\n\n**值传递**：(形式参数类型是基本数据类型)：方法调用时，实际参数把它的值传递给对应的形式参数，形式参数只是用实际参数的值初始化自己的存储单元内容，是两个不同的存储单元，所以方法执行中形式参数值的改变不影响实际参数的值。\n\n**引用传递**：(形式参数类型是引用数据类型参数)：也称为传地址。方法调用时，实际参数是对象(或数组)，这时实际参数与形式参数指向同一个地址，在方法执行中，对形式参数的操作实际上就是对实际参数的操作，这个结果在方法结束后被保留了下来，所以方法执行中形式参数的改变将会影响实际参数。\n\n\n说明：\n\n（1）：“在Java里面参数传递都是按值传递”这句话的意思是：按值传递是传递的值的拷贝，按引用传递其实传递的是引用的地址值，所以统称按值传递。\n\n（2）：在Java里面只有基本类型和按照下面这种定义方式的String是按值传递，其它的都是按引用传递。就是直接使用双引号定义字符串方式：String str = “Java私塾”;\n\n\n为什么说 Java 中只有值传递: https://blog.csdn.net/bjweimengshu/article/details/79799485\n\n\n\n\n---\n\n> 附参考\n> \n> - https://www.cnblogs.com/autumn001/p/9036148.html\n> - https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376\n> \n","slug":"0016-面向对象","published":1,"updated":"2019-02-21T08:12:30.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t7x003hgcoivcsbyacf","content":"<h2 id=\"面向对象\"><a href=\"#面向对象\" class=\"headerlink\" title=\"面向对象\"></a>面向对象</h2><h3 id=\"什么是面向对象\"><a href=\"#什么是面向对象\" class=\"headerlink\" title=\"什么是面向对象\"></a>什么是面向对象</h3><p>面向对象(Object Oriented,OO)是软件开发方法。面向对象的概念和应用已超越了程序设计和软件开发，扩展到如数据库系统、交互式界面、应用结构、应用平台、分布式系统、网络管理结构、CAD技术、人工智能等领域。面向对象是一种对现实世界理解和抽象的方法，是计算机编程技术发展到一定阶段后的产物。</p>\n<p>面向过程(Procedure Oriented)是一种以过程为中心的编程思想。这些都是以什么正在发生为主要目标进行编程，不同于面向对象的是谁在受影响。与面向对象明显的不同就是封装、继承、类。</p>\n<h3 id=\"面向对象的三大基本特征\"><a href=\"#面向对象的三大基本特征\" class=\"headerlink\" title=\"面向对象的三大基本特征\"></a>面向对象的三大基本特征</h3><p>面向对象的三个基本特征是：封装、继承、多态。</p>\n<p><img src=\"http://www.cnitblog.com/images/cnitblog_com/lily/1972/o_OOBase.gif\" alt=\"\"></p>\n<p>面向对象的三大基本特征和五大基本原则</p>\n<p><strong>封装</strong></p>\n<p>封装最好理解了。封装是面向对象的特征之一，是对象和类概念的主要特性。</p>\n<p>封装，也就是把客观事物封装成抽象的类，并且类可以把自己的数据和方法只让可信的类或者对象操作，对不可信的进行信息隐藏。</p>\n<p><strong>继承</strong></p>\n<p>面向对象编程(OOP)语言的一个主要功能就是“继承”。继承是指这样一种能力：它可以使用现有类的所有功能，并在无需重新编写原来的类的情况下对这些功能进行扩展。</p>\n<p>通过继承创建的新类称为<strong>子类</strong>或<strong>派生类</strong>。被继承的类称为<strong>基类</strong>、<strong>父类</strong>或<strong>超类</strong>。</p>\n<p>继承的过程，就是从一般到特殊的过程。</p>\n<p>要实现继承，可以通过<code>继承（Inheritance）</code>和<code>组合（Composition）</code>来实现。<br>在某些 OOP 语言中，一个子类可以继承多个基类。但是一般情况下，一个子类只能有一个基类，要实现多重继承，可以通过多级继承来实现。</p>\n<p>继承概念的实现方式有三类：实现继承、接口继承和可视继承。</p>\n<ul>\n<li>实现继承是指使用基类的属性和方法而无需额外编码的能力；</li>\n<li>接口继承是指仅使用属性和方法的名称、但是子类必须提供实现的能力；</li>\n<li>可视继承是指子窗体（类）使用基窗体（类）的外观和实现代码的能力。</li>\n</ul>\n<p>在考虑使用继承时，有一点需要注意，那就是两个类之间的关系应该是<strong>属于</strong>关系。例如，<code>Employee</code>是一个人，<code>Manager</code>也是一个人，因此这两个类都可以继承<code>Person</code>类。但是<code>Leg</code> 类却不能继承<code>Person</code>类，因为腿并不是一个人。</p>\n<p>抽象类仅定义将由子类创建的一般属性和方法，创建抽象类时，请使用关键字 <code>interface</code> 而不是<code>class</code>。</p>\n<p>OO开发范式大致为：划分对象-&gt;抽象类-&gt;将类组织成为层次化结构(继承和合成) -&gt;用类与实例进行设计和实现几个阶段。</p>\n<p><strong>多态</strong></p>\n<p>多态性（polymorphisn）是允许你将父对象设置成为和一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值给它的子对象的特性以不同的方式运作。简单的说，就是一句话：允许将子类类型的指针赋值给父类类型的指针。</p>\n<p>实现多态，有二种方式: <strong>覆盖</strong>、<strong>重载</strong>。</p>\n<ul>\n<li><strong>覆盖</strong>，是指子类重新定义父类的虚函数的做法。</li>\n<li><strong>重载</strong>，是指允许存在多个同名函数，而这些函数的参数表不同（或许参数个数不同，或许参数类型不同，或许两者都不同）。</li>\n</ul>\n<p>其实，重载的概念并不属于“面向对象编程”，重载的实现是：编译器根据函数不同的参数表，对同名函数的名称做修饰，然后这些同名函数就成了不同的函数（至少对于编译器来说是这样的）。如，有两个同名函数：<code>function func(p:integer):integer;</code>和<code>function func(p:string):integer;</code>。那么编译器做过修饰后的函数名称可能是这样的：<code>int_func</code>、<code>str_func</code>。对于这两个函数的调用，在编译器间就已经确定了，是静态的（记住：是静态）。也就是说，它们的地址在编译期就绑定了（早绑定），因此，重载和多态无关！真正和多态相关的是“覆盖”。当子类重新定义了父类的虚函数后，父类指针根据赋给它的不同的子类指针，动态（记住：是动态！）的调用属于子类的该函数，这样的函数调用在编译期间是无法确定的（调用的子类的虚函数的地址无法给出）。因此，这样的函数地址是在运行期绑定的（晚邦定）。结论就是：重载只是一种语言特性，与多态无关，与面向对象也无关！引用一句Bruce Eckel的话：“不要犯傻，如果它不是晚邦定，它就不是多态。”</p>\n<p>那么，多态的作用是什么呢？</p>\n<p>我们知道，封装可以隐藏实现细节，使得代码模块化；继承可以扩展已存在的代码模块（类）；它们的目的都是为了——代码重用。而多态则是为了实现另一个目的——接口重用！多态的作用，就是为了类在继承和派生的时候，保证使用“家谱”中任一类的实例的某一属性时的正确调用。</p>\n<h3 id=\"平台无关性\"><a href=\"#平台无关性\" class=\"headerlink\" title=\"平台无关性\"></a>平台无关性</h3><p>Java是平台无关的语言是指用Java写的应用程序不用修改就可在不同的软硬件平台上运行。平台无关有两种：源代码级和目标代码级。C和C++具有一定程度的源代码级平台无关，表明用C或C++写的应用程序不用修改只需重新编译就可以在不同平台上运行。</p>\n<p>Java主要靠Java虚拟机（JVM）在目标码级实现平台无关性。JVM是一种抽象机器，它附着在具体操作系统之上，本身具有一套虚机器指令，并有自己的栈、寄存器组等。但JVM通常是在软件上而不是在硬件上实现。（目前，SUN系统公司已经设计实现了Java芯片，主要使用在网络计算机NC上。另外，Java芯片的出现也会使Java更容易嵌入到家用电器中。）JVM是Java平台无关的基础，在JVM上，有一个Java解释器用来解释Java编译器编译后的程序。Java编程人员在编写完软件后，通过Java编译器将Java源程序编译为JVM的字节代码。任何一台机器只要配备了Java解释器，就可以运行这个程序，而不管这种字节码是在何种平台上生成的（过程如图1所示）。另外，Java采用的是基于IEEE标准的数据类型。通过JVM保证数据类型的一致性，也确保了Java的平台无关性。</p>\n<p>Java的平台无关性具有深远意义。首先，它使得编程人员所梦寐以求的事情（开发一次软件在任意平台上运行）变成事实，这将大大加快和促进软件产品的开发。其次Java的平台无关性正好迎合了 “网络计算机 “思想。如果大量常用的应用软件（如字处理软件等）都用Java重新编写，并且放在某个Internet服务器上，那么具有NC的用户将不需要占用大量空间安装软件，他们只需要一个Java解释器，每当需要使用某种应用软件时，下载该软件的字节代码即可，运行结果也可以发回服务器。目前，已有数家公司开始使用这种新型的计算模式构筑自己的企业信息系统。</p>\n<h4 id=\"JVM-还支持哪些语言\"><a href=\"#JVM-还支持哪些语言\" class=\"headerlink\" title=\"JVM 还支持哪些语言\"></a>JVM 还支持哪些语言</h4><p><strong>Kotlin</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-1-660x344.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://kotlinlang.org/\" target=\"_blank\" rel=\"noopener\">https://kotlinlang.org/</a></p>\n<p>由JetBrains于2010年创建，并于2012年开源， Kotlin比Java更加简洁和安全。 您完全可以将Kotlin视为是一种“更加简单但高效的Java”。Kotlin的编译速度通常比Java代码快，而且在其创建之初，就非常明确的支持了函数式编程，这一点，Java是到Java 8才开始支持的。</p>\n<p>特别的，因为有了Google的加持，越来越多的Android开发人员，开始选择Kotlin来开发应用程序，与此同时，独立的超越JVM的行动也已经在展开，通过一项名为LLVM的项目，Kotlin正在努力实现代码编译的本地化，而不在基于JVM 。</p>\n<p>但无论如何，至少现在，它还活在JVM中。</p>\n<p><strong>Scala</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-2-660x274.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://www.scala-lang.org/\" target=\"_blank\" rel=\"noopener\">http://www.scala-lang.org/</a></p>\n<p>和Kotlin一样， Scala也是为了让Java开发人员提高工作效率而创建的。 作为一种完全的面向对象语言和一种完全的函数式编程语言，Scala巧妙的将这两种编程范式结合到了一起。</p>\n<p>特别是在函数式编程方面，Scala几乎支持函数式编程语言中所有已知的特性，比如，模式匹配（Pattern matching）、延迟初始化（Lazy initialization）、偏函数（Partial Function）、不变性（Immutability）等等等等，</p>\n<p>因此，虽然Scala的类Lisp的语法会让初学者倍感迷惑，但花时间在这上面，永远是值得的，很快，就会让你体会到那种只需要关注 What（做什么），而不用关注How（如何做）的酸爽。</p>\n<p>一个最新的关于Scala的消息是，它似乎也在和Kotlin一样，在加速准备逃离JVM的控制，这对于JVM，恐怕不是一个什么特别好的消息，虽然，其距离用于生产可能还为时尚早。</p>\n<p><strong>Clojure</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-3.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://clojure.org/\" target=\"_blank\" rel=\"noopener\">https://clojure.org/</a></p>\n<p>Clojure是由开发人员Rich Hickey在JVM下，所创建的一种Lisp方言，借助于JVM的执行效率越来越高，Clojure也常被嵌入在Java中，用于编写其中需要高并发、高性能的部分 。</p>\n<p><strong>Groovy</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-4-660x291.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://www.groovy-lang.org/\" target=\"_blank\" rel=\"noopener\">http://www.groovy-lang.org/</a></p>\n<p>Groovy是在Java现有基础上，吸收Python和Ruby等动态语言的特性，而创建的一种新型语言，也是Jenkins持续集成服务器，所直接支持的语言之一，并且最关键的一点，通过基于Groovy的Web开发框架Grails，可以快速的完成相关Web项目的构建 。</p>\n<p>在未来，Groovy则拟包含Java和JVM的一些更新的特性，比如如Java 8的lambda语法等。</p>\n<p><strong>Jython</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-5.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://www.jython.org/\" target=\"_blank\" rel=\"noopener\">http://www.jython.org/</a></p>\n<p>Jython是JVM的Python实现，与Python的2.x分支兼容，可以动态编译为Java字节码，并且可以与其他JVM语言（特别是Java）自由交互操作。</p>\n<p> <strong>JRuby</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-6-660x206.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://jruby.org\" target=\"_blank\" rel=\"noopener\">http://jruby.org</a></p>\n<p>JRuby几乎就是Jython的翻版，所不同的是，JRuby所对标的语言是Ruby，当前所支持的语法规范则和Ruby 2.3兼容。</p>\n<p><strong>Ceylon</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-7.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://www.ceylon-lang.org\" target=\"_blank\" rel=\"noopener\">https://www.ceylon-lang.org</a></p>\n<p>这个以大象为Logo的语言，其创建初衷可不是像大象一样笨拙，恰恰相反，语言的创始人 Gavin King，是出于对Java所存在问题的深刻认识，如泛型等特性的复杂性、粗劣的注解语法、不完善的块结构、对 XML 的依赖性等等，才萌生了创建一种新的静态类型语言语言，即Ceylon来一劳永逸的解决这些问题的想法。</p>\n<p>Ceylon保留了一些好的 Java 语言特性，改进了语言的可读性和内置的模块性，还吸收了高阶函数等函数语言特性，此外，Ceylon 还融合了 C 和 Smalltalk 的一些特性。与 Java 语言一样，这种新语言也以业务计算为重点，但是它在其他领域也很灵活、很有用。并且，通过这些年的努力，Ceylon已经跨出了其自身跨平台的第一步，其代码已经可以在JVM，Dart VM或Node.js上进行编译或运行。</p>\n<p><strong>Eta</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-8.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://eta-lang.org/\" target=\"_blank\" rel=\"noopener\">https://eta-lang.org/</a></p>\n<p>我们的名单中怎么能少了时下最能装酷，也是被Node.js的创建者称为觉得暂无能力驾驭的语言Haskell的JVM实现？</p>\n<p>它来了，就是Eta，它的优势，不仅仅在于它可以在JVM下执行，更在于它可以使用Haskell的软件包仓库中的软件包，最大程度的兼容了整个Haskell生态系统。</p>\n<p><strong>Haxe</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-9.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://haxe.org\" target=\"_blank\" rel=\"noopener\">http://haxe.org</a></p>\n<p>Haxe的口号是：One Language，Everywhere！是不是有点熟悉？是的，在非常久远的过去，这其实正是Java的初心。</p>\n<p>但是，这二者又是如此的迥异。Java的策略是，我做一个平台JVM，给出一种规范，你们来生成我需要的代码；Haxe的策略则正好相反，既然芸芸众生，语言纷杂，每个人都各有偏好，那好，来吧，我可以把我的代码，生成任何一种你们想要的语言下的代码！</p>\n<p>多么疯狂的想法！就为这点疯狂，就值得我们每个开发人员去膜拜一番了，毕竟，在Haxe看来，JVM，不过是其可以编译的一个“小”对象而已。</p>\n<h3 id=\"值传递、引用传递\"><a href=\"#值传递、引用传递\" class=\"headerlink\" title=\"值传递、引用传递\"></a>值传递、引用传递</h3><p><strong>值传递</strong>：(形式参数类型是基本数据类型)：方法调用时，实际参数把它的值传递给对应的形式参数，形式参数只是用实际参数的值初始化自己的存储单元内容，是两个不同的存储单元，所以方法执行中形式参数值的改变不影响实际参数的值。</p>\n<p><strong>引用传递</strong>：(形式参数类型是引用数据类型参数)：也称为传地址。方法调用时，实际参数是对象(或数组)，这时实际参数与形式参数指向同一个地址，在方法执行中，对形式参数的操作实际上就是对实际参数的操作，这个结果在方法结束后被保留了下来，所以方法执行中形式参数的改变将会影响实际参数。</p>\n<p>说明：</p>\n<p>（1）：“在Java里面参数传递都是按值传递”这句话的意思是：按值传递是传递的值的拷贝，按引用传递其实传递的是引用的地址值，所以统称按值传递。</p>\n<p>（2）：在Java里面只有基本类型和按照下面这种定义方式的String是按值传递，其它的都是按引用传递。就是直接使用双引号定义字符串方式：String str = “Java私塾”;</p>\n<p>为什么说 Java 中只有值传递: <a href=\"https://blog.csdn.net/bjweimengshu/article/details/79799485\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/bjweimengshu/article/details/79799485</a></p>\n<hr>\n<blockquote>\n<p>附参考</p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/autumn001/p/9036148.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/autumn001/p/9036148.html</a></li>\n<li><a href=\"https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376</a></li>\n</ul>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"面向对象\"><a href=\"#面向对象\" class=\"headerlink\" title=\"面向对象\"></a>面向对象</h2><h3 id=\"什么是面向对象\"><a href=\"#什么是面向对象\" class=\"headerlink\" title=\"什么是面向对象\"></a>什么是面向对象</h3><p>面向对象(Object Oriented,OO)是软件开发方法。面向对象的概念和应用已超越了程序设计和软件开发，扩展到如数据库系统、交互式界面、应用结构、应用平台、分布式系统、网络管理结构、CAD技术、人工智能等领域。面向对象是一种对现实世界理解和抽象的方法，是计算机编程技术发展到一定阶段后的产物。</p>\n<p>面向过程(Procedure Oriented)是一种以过程为中心的编程思想。这些都是以什么正在发生为主要目标进行编程，不同于面向对象的是谁在受影响。与面向对象明显的不同就是封装、继承、类。</p>\n<h3 id=\"面向对象的三大基本特征\"><a href=\"#面向对象的三大基本特征\" class=\"headerlink\" title=\"面向对象的三大基本特征\"></a>面向对象的三大基本特征</h3><p>面向对象的三个基本特征是：封装、继承、多态。</p>\n<p><img src=\"http://www.cnitblog.com/images/cnitblog_com/lily/1972/o_OOBase.gif\" alt=\"\"></p>\n<p>面向对象的三大基本特征和五大基本原则</p>\n<p><strong>封装</strong></p>\n<p>封装最好理解了。封装是面向对象的特征之一，是对象和类概念的主要特性。</p>\n<p>封装，也就是把客观事物封装成抽象的类，并且类可以把自己的数据和方法只让可信的类或者对象操作，对不可信的进行信息隐藏。</p>\n<p><strong>继承</strong></p>\n<p>面向对象编程(OOP)语言的一个主要功能就是“继承”。继承是指这样一种能力：它可以使用现有类的所有功能，并在无需重新编写原来的类的情况下对这些功能进行扩展。</p>\n<p>通过继承创建的新类称为<strong>子类</strong>或<strong>派生类</strong>。被继承的类称为<strong>基类</strong>、<strong>父类</strong>或<strong>超类</strong>。</p>\n<p>继承的过程，就是从一般到特殊的过程。</p>\n<p>要实现继承，可以通过<code>继承（Inheritance）</code>和<code>组合（Composition）</code>来实现。<br>在某些 OOP 语言中，一个子类可以继承多个基类。但是一般情况下，一个子类只能有一个基类，要实现多重继承，可以通过多级继承来实现。</p>\n<p>继承概念的实现方式有三类：实现继承、接口继承和可视继承。</p>\n<ul>\n<li>实现继承是指使用基类的属性和方法而无需额外编码的能力；</li>\n<li>接口继承是指仅使用属性和方法的名称、但是子类必须提供实现的能力；</li>\n<li>可视继承是指子窗体（类）使用基窗体（类）的外观和实现代码的能力。</li>\n</ul>\n<p>在考虑使用继承时，有一点需要注意，那就是两个类之间的关系应该是<strong>属于</strong>关系。例如，<code>Employee</code>是一个人，<code>Manager</code>也是一个人，因此这两个类都可以继承<code>Person</code>类。但是<code>Leg</code> 类却不能继承<code>Person</code>类，因为腿并不是一个人。</p>\n<p>抽象类仅定义将由子类创建的一般属性和方法，创建抽象类时，请使用关键字 <code>interface</code> 而不是<code>class</code>。</p>\n<p>OO开发范式大致为：划分对象-&gt;抽象类-&gt;将类组织成为层次化结构(继承和合成) -&gt;用类与实例进行设计和实现几个阶段。</p>\n<p><strong>多态</strong></p>\n<p>多态性（polymorphisn）是允许你将父对象设置成为和一个或更多的他的子对象相等的技术，赋值之后，父对象就可以根据当前赋值给它的子对象的特性以不同的方式运作。简单的说，就是一句话：允许将子类类型的指针赋值给父类类型的指针。</p>\n<p>实现多态，有二种方式: <strong>覆盖</strong>、<strong>重载</strong>。</p>\n<ul>\n<li><strong>覆盖</strong>，是指子类重新定义父类的虚函数的做法。</li>\n<li><strong>重载</strong>，是指允许存在多个同名函数，而这些函数的参数表不同（或许参数个数不同，或许参数类型不同，或许两者都不同）。</li>\n</ul>\n<p>其实，重载的概念并不属于“面向对象编程”，重载的实现是：编译器根据函数不同的参数表，对同名函数的名称做修饰，然后这些同名函数就成了不同的函数（至少对于编译器来说是这样的）。如，有两个同名函数：<code>function func(p:integer):integer;</code>和<code>function func(p:string):integer;</code>。那么编译器做过修饰后的函数名称可能是这样的：<code>int_func</code>、<code>str_func</code>。对于这两个函数的调用，在编译器间就已经确定了，是静态的（记住：是静态）。也就是说，它们的地址在编译期就绑定了（早绑定），因此，重载和多态无关！真正和多态相关的是“覆盖”。当子类重新定义了父类的虚函数后，父类指针根据赋给它的不同的子类指针，动态（记住：是动态！）的调用属于子类的该函数，这样的函数调用在编译期间是无法确定的（调用的子类的虚函数的地址无法给出）。因此，这样的函数地址是在运行期绑定的（晚邦定）。结论就是：重载只是一种语言特性，与多态无关，与面向对象也无关！引用一句Bruce Eckel的话：“不要犯傻，如果它不是晚邦定，它就不是多态。”</p>\n<p>那么，多态的作用是什么呢？</p>\n<p>我们知道，封装可以隐藏实现细节，使得代码模块化；继承可以扩展已存在的代码模块（类）；它们的目的都是为了——代码重用。而多态则是为了实现另一个目的——接口重用！多态的作用，就是为了类在继承和派生的时候，保证使用“家谱”中任一类的实例的某一属性时的正确调用。</p>\n<h3 id=\"平台无关性\"><a href=\"#平台无关性\" class=\"headerlink\" title=\"平台无关性\"></a>平台无关性</h3><p>Java是平台无关的语言是指用Java写的应用程序不用修改就可在不同的软硬件平台上运行。平台无关有两种：源代码级和目标代码级。C和C++具有一定程度的源代码级平台无关，表明用C或C++写的应用程序不用修改只需重新编译就可以在不同平台上运行。</p>\n<p>Java主要靠Java虚拟机（JVM）在目标码级实现平台无关性。JVM是一种抽象机器，它附着在具体操作系统之上，本身具有一套虚机器指令，并有自己的栈、寄存器组等。但JVM通常是在软件上而不是在硬件上实现。（目前，SUN系统公司已经设计实现了Java芯片，主要使用在网络计算机NC上。另外，Java芯片的出现也会使Java更容易嵌入到家用电器中。）JVM是Java平台无关的基础，在JVM上，有一个Java解释器用来解释Java编译器编译后的程序。Java编程人员在编写完软件后，通过Java编译器将Java源程序编译为JVM的字节代码。任何一台机器只要配备了Java解释器，就可以运行这个程序，而不管这种字节码是在何种平台上生成的（过程如图1所示）。另外，Java采用的是基于IEEE标准的数据类型。通过JVM保证数据类型的一致性，也确保了Java的平台无关性。</p>\n<p>Java的平台无关性具有深远意义。首先，它使得编程人员所梦寐以求的事情（开发一次软件在任意平台上运行）变成事实，这将大大加快和促进软件产品的开发。其次Java的平台无关性正好迎合了 “网络计算机 “思想。如果大量常用的应用软件（如字处理软件等）都用Java重新编写，并且放在某个Internet服务器上，那么具有NC的用户将不需要占用大量空间安装软件，他们只需要一个Java解释器，每当需要使用某种应用软件时，下载该软件的字节代码即可，运行结果也可以发回服务器。目前，已有数家公司开始使用这种新型的计算模式构筑自己的企业信息系统。</p>\n<h4 id=\"JVM-还支持哪些语言\"><a href=\"#JVM-还支持哪些语言\" class=\"headerlink\" title=\"JVM 还支持哪些语言\"></a>JVM 还支持哪些语言</h4><p><strong>Kotlin</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-1-660x344.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://kotlinlang.org/\" target=\"_blank\" rel=\"noopener\">https://kotlinlang.org/</a></p>\n<p>由JetBrains于2010年创建，并于2012年开源， Kotlin比Java更加简洁和安全。 您完全可以将Kotlin视为是一种“更加简单但高效的Java”。Kotlin的编译速度通常比Java代码快，而且在其创建之初，就非常明确的支持了函数式编程，这一点，Java是到Java 8才开始支持的。</p>\n<p>特别的，因为有了Google的加持，越来越多的Android开发人员，开始选择Kotlin来开发应用程序，与此同时，独立的超越JVM的行动也已经在展开，通过一项名为LLVM的项目，Kotlin正在努力实现代码编译的本地化，而不在基于JVM 。</p>\n<p>但无论如何，至少现在，它还活在JVM中。</p>\n<p><strong>Scala</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-2-660x274.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://www.scala-lang.org/\" target=\"_blank\" rel=\"noopener\">http://www.scala-lang.org/</a></p>\n<p>和Kotlin一样， Scala也是为了让Java开发人员提高工作效率而创建的。 作为一种完全的面向对象语言和一种完全的函数式编程语言，Scala巧妙的将这两种编程范式结合到了一起。</p>\n<p>特别是在函数式编程方面，Scala几乎支持函数式编程语言中所有已知的特性，比如，模式匹配（Pattern matching）、延迟初始化（Lazy initialization）、偏函数（Partial Function）、不变性（Immutability）等等等等，</p>\n<p>因此，虽然Scala的类Lisp的语法会让初学者倍感迷惑，但花时间在这上面，永远是值得的，很快，就会让你体会到那种只需要关注 What（做什么），而不用关注How（如何做）的酸爽。</p>\n<p>一个最新的关于Scala的消息是，它似乎也在和Kotlin一样，在加速准备逃离JVM的控制，这对于JVM，恐怕不是一个什么特别好的消息，虽然，其距离用于生产可能还为时尚早。</p>\n<p><strong>Clojure</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-3.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://clojure.org/\" target=\"_blank\" rel=\"noopener\">https://clojure.org/</a></p>\n<p>Clojure是由开发人员Rich Hickey在JVM下，所创建的一种Lisp方言，借助于JVM的执行效率越来越高，Clojure也常被嵌入在Java中，用于编写其中需要高并发、高性能的部分 。</p>\n<p><strong>Groovy</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-4-660x291.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://www.groovy-lang.org/\" target=\"_blank\" rel=\"noopener\">http://www.groovy-lang.org/</a></p>\n<p>Groovy是在Java现有基础上，吸收Python和Ruby等动态语言的特性，而创建的一种新型语言，也是Jenkins持续集成服务器，所直接支持的语言之一，并且最关键的一点，通过基于Groovy的Web开发框架Grails，可以快速的完成相关Web项目的构建 。</p>\n<p>在未来，Groovy则拟包含Java和JVM的一些更新的特性，比如如Java 8的lambda语法等。</p>\n<p><strong>Jython</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-5.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://www.jython.org/\" target=\"_blank\" rel=\"noopener\">http://www.jython.org/</a></p>\n<p>Jython是JVM的Python实现，与Python的2.x分支兼容，可以动态编译为Java字节码，并且可以与其他JVM语言（特别是Java）自由交互操作。</p>\n<p> <strong>JRuby</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-6-660x206.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://jruby.org\" target=\"_blank\" rel=\"noopener\">http://jruby.org</a></p>\n<p>JRuby几乎就是Jython的翻版，所不同的是，JRuby所对标的语言是Ruby，当前所支持的语法规范则和Ruby 2.3兼容。</p>\n<p><strong>Ceylon</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-7.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://www.ceylon-lang.org\" target=\"_blank\" rel=\"noopener\">https://www.ceylon-lang.org</a></p>\n<p>这个以大象为Logo的语言，其创建初衷可不是像大象一样笨拙，恰恰相反，语言的创始人 Gavin King，是出于对Java所存在问题的深刻认识，如泛型等特性的复杂性、粗劣的注解语法、不完善的块结构、对 XML 的依赖性等等，才萌生了创建一种新的静态类型语言语言，即Ceylon来一劳永逸的解决这些问题的想法。</p>\n<p>Ceylon保留了一些好的 Java 语言特性，改进了语言的可读性和内置的模块性，还吸收了高阶函数等函数语言特性，此外，Ceylon 还融合了 C 和 Smalltalk 的一些特性。与 Java 语言一样，这种新语言也以业务计算为重点，但是它在其他领域也很灵活、很有用。并且，通过这些年的努力，Ceylon已经跨出了其自身跨平台的第一步，其代码已经可以在JVM，Dart VM或Node.js上进行编译或运行。</p>\n<p><strong>Eta</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-8.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"https://eta-lang.org/\" target=\"_blank\" rel=\"noopener\">https://eta-lang.org/</a></p>\n<p>我们的名单中怎么能少了时下最能装酷，也是被Node.js的创建者称为觉得暂无能力驾驭的语言Haskell的JVM实现？</p>\n<p>它来了，就是Eta，它的优势，不仅仅在于它可以在JVM下执行，更在于它可以使用Haskell的软件包仓库中的软件包，最大程度的兼容了整个Haskell生态系统。</p>\n<p><strong>Haxe</strong></p>\n<p><img src=\"https://ss.csdn.net/p?http://codebay.cn/wp-content/uploads/2018/05/image.php_-9.gif\" alt=\"\"></p>\n<p>官方站点：<a href=\"http://haxe.org\" target=\"_blank\" rel=\"noopener\">http://haxe.org</a></p>\n<p>Haxe的口号是：One Language，Everywhere！是不是有点熟悉？是的，在非常久远的过去，这其实正是Java的初心。</p>\n<p>但是，这二者又是如此的迥异。Java的策略是，我做一个平台JVM，给出一种规范，你们来生成我需要的代码；Haxe的策略则正好相反，既然芸芸众生，语言纷杂，每个人都各有偏好，那好，来吧，我可以把我的代码，生成任何一种你们想要的语言下的代码！</p>\n<p>多么疯狂的想法！就为这点疯狂，就值得我们每个开发人员去膜拜一番了，毕竟，在Haxe看来，JVM，不过是其可以编译的一个“小”对象而已。</p>\n<h3 id=\"值传递、引用传递\"><a href=\"#值传递、引用传递\" class=\"headerlink\" title=\"值传递、引用传递\"></a>值传递、引用传递</h3><p><strong>值传递</strong>：(形式参数类型是基本数据类型)：方法调用时，实际参数把它的值传递给对应的形式参数，形式参数只是用实际参数的值初始化自己的存储单元内容，是两个不同的存储单元，所以方法执行中形式参数值的改变不影响实际参数的值。</p>\n<p><strong>引用传递</strong>：(形式参数类型是引用数据类型参数)：也称为传地址。方法调用时，实际参数是对象(或数组)，这时实际参数与形式参数指向同一个地址，在方法执行中，对形式参数的操作实际上就是对实际参数的操作，这个结果在方法结束后被保留了下来，所以方法执行中形式参数的改变将会影响实际参数。</p>\n<p>说明：</p>\n<p>（1）：“在Java里面参数传递都是按值传递”这句话的意思是：按值传递是传递的值的拷贝，按引用传递其实传递的是引用的地址值，所以统称按值传递。</p>\n<p>（2）：在Java里面只有基本类型和按照下面这种定义方式的String是按值传递，其它的都是按引用传递。就是直接使用双引号定义字符串方式：String str = “Java私塾”;</p>\n<p>为什么说 Java 中只有值传递: <a href=\"https://blog.csdn.net/bjweimengshu/article/details/79799485\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/bjweimengshu/article/details/79799485</a></p>\n<hr>\n<blockquote>\n<p>附参考</p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/autumn001/p/9036148.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/autumn001/p/9036148.html</a></li>\n<li><a href=\"https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/B9Q8e64lO6mm/article/details/80235376</a></li>\n</ul>\n</blockquote>\n"},{"title":"使用 Docker 部署 Spring Boot","date":"2019-04-17T08:11:01.000Z","photos":["https://cdn.pixabay.com/photo/2019/05/02/18/47/park-4174278_960_720.jpg"],"_content":"\n\nDocker 技术发展为微服务落地提供了更加便利的环境，使用 Docker 部署 Spring Boot 其实非常简单，这篇文章我们就来简单学习下。\n\n首先构建一个简单的 Spring Boot 项目，然后给项目添加 Docker 支持，最后对项目进行部署。\n\n## 一个简单 Spring Boot 项目\n\n在 `pom.xml` 中 ，使用 Spring Boot 2.0 相关依赖\n\n```xml\n<parent>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-parent</artifactId>\n    <version>2.0.0.RELEASE</version>\n</parent>\n```\n\n添加 web 和测试依赖\n\n```xml\n<dependencies>\n     <dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-test</artifactId>\n        <scope>test</scope>\n    </dependency>\n</dependencies>\n```\n\n创建一个 DockerController，在其中有一个`index()`方法，访问时返回：`Hello Docker!`\n\n```\n@RestController\npublic class DockerController {\n\n    @RequestMapping(\"/\")\n    public String index() {\n        return \"Hello Docker!\";\n    }\n}\n```\n\n启动类\n\n```\n@SpringBootApplication\npublic class DockerApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(DockerApplication.class, args);\n    }\n}\n```\n\n添加完毕后启动项目，启动成功后浏览器放问：`http://localhost:8080/`，页面返回：`Hello Docker!`，说明 Spring Boot 项目配置正常。\n\n## Spring Boot 项目添加 Docker 支持\n\n在 `pom.xml-properties`中添加 Docker 镜像名称\n\n```\n<properties>\n    <docker.image.prefix>springboot</docker.image.prefix>\n</properties>\n```\n\nplugins 中添加 Docker 构建插件：\n\n```\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-maven-plugin</artifactId>\n        </plugin>\n        <!-- Docker maven plugin -->\n        <plugin>\n            <groupId>com.spotify</groupId>\n            <artifactId>docker-maven-plugin</artifactId>\n            <version>1.0.0</version>\n            <configuration>\n                <imageName>${docker.image.prefix}/${project.artifactId}</imageName>\n                <dockerDirectory>src/main/docker</dockerDirectory>\n                <resources>\n                    <resource>\n                        <targetPath>/</targetPath>\n                        <directory>${project.build.directory}</directory>\n                        <include>${project.build.finalName}.jar</include>\n                    </resource>\n                </resources>\n            </configuration>\n        </plugin>\n        <!-- Docker maven plugin -->\n    </plugins>\n</build>\n```\n\n在目录`src/main/docker`下创建 Dockerfile 文件，Dockerfile 文件用来说明如何来构建镜像。\n\n```\nFROM openjdk:8-jdk-alpine\nVOLUME /tmp\nADD spring-boot-docker-1.0.jar app.jar\nENTRYPOINT [\"java\",\"-Djava.security.egd=file:/dev/./urandom\",\"-jar\",\"/app.jar\"]\n```\n\n这个 Dockerfile 文件很简单，构建 Jdk 基础环境，添加 Spring Boot Jar 到镜像中，简单解释一下:\n\n*   FROM ，表示使用 Jdk8 环境 为基础镜像，如果镜像不是本地的会从 DockerHub 进行下载\n*   VOLUME ，VOLUME 指向了一个`/tmp`的目录，由于 Spring Boot 使用内置的 Tomcat 容器，Tomcat 默认使用`/tmp`作为工作目录。这个命令的效果是：在宿主机的`/var/lib/docker`目录下创建一个临时文件并把它链接到容器中的`/tmp`目录\n*   ADD ，拷贝文件并且重命名\n*   ENTRYPOINT ，为了缩短 Tomcat 的启动时间，添加`java.security.egd`的系统属性指向`/dev/urandom`作为 ENTRYPOINT\n\n> 这样 Spring Boot 项目添加 Docker 依赖就完成了。\n\n## 构建打包环境\n\n我们需要有一个 Docker 环境来打包 Spring Boot 项目，在 Windows 搭建 Docker 环境很麻烦，因此我这里以 Centos 7 为例。\n\n### 安装 Docker 环境\n\n安装\n\n```\nyum install docker\n```\n\n安装完成后，使用下面的命令来启动 docker 服务，并将其设置为开机启动：\n\n```\nervice docker start\nchkconfig docker on\n\n#LCTT 译注：此处采用了旧式的 sysv 语法，如采用CentOS 7中支持的新式 systemd 语法，如下：\nsystemctl  start docker.service\nsystemctl  enable docker.service\n```\n\n使用 Docker 中国加速器\n\n```\nvi  /etc/docker/daemon.json\n\n#添加后：\n{\n    \"registry-mirrors\": [\"https://registry.docker-cn.com\"],\n    \"live-restore\": true\n}\n```\n\n重新启动 docker\n\n```\nsystemctl restart docker\n```\n\n输入`docker version` 返回版本信息则安装正常。\n\n### 安装 JDK\n\n```\nyum -y install java-1.8.0-openjdk*\n```\n\n配置环境变量\n打开 `vim /etc/profile`\n添加一下内容\n\n```\nexport JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64 \nexport PATH=$PATH:$JAVA_HOME/bin \n```\n\n修改完成之后，使其生效\n\n```\nsource /etc/profile\n```\n\n输入`java -version` 返回版本信息则安装正常。\n\n### 安装 MAVEN\n\n下载：`http://mirrors.shu.edu.cn/apache/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz`\n\n```\n## 解压\ntar vxf apache-maven-3.5.2-bin.tar.gz\n## 移动\nmv apache-maven-3.5.2 /usr/local/maven3\n```\n\n修改环境变量， 在`/etc/profile`中添加以下几行\n\n```\nMAVEN_HOME=/usr/local/maven3\nexport MAVEN_HOME\nexport PATH=${PATH}:${MAVEN_HOME}/bin\n```\n\n记得执行`source /etc/profile`使环境变量生效。\n\n输入`mvn -version` 返回版本信息则安装正常。\n\n> 这样整个构建环境就配置完成了。\n\n## 使用 Docker 部署 Spring Boot 项目\n\n将项目 `spring-boot-docker` 拷贝服务器中，进入项目路径下进行打包测试。\n\n```\n#打包\nmvn package\n#启动\njava -jar target/spring-boot-docker-1.0.jar\n```\n\n看到 Spring Boot 的启动日志后表明环境配置没有问题，接下来我们使用 DockerFile 构建镜像。\n\n```\nmvn package docker:build\n```\n\n第一次构建可能有点慢，当看到以下内容的时候表明构建成功：\n\n```\n...\nStep 1 : FROM openjdk:8-jdk-alpine\n ---> 224765a6bdbe\nStep 2 : VOLUME /tmp\n ---> Using cache\n ---> b4e86cc8654e\nStep 3 : ADD spring-boot-docker-1.0.jar app.jar\n ---> a20fe75963ab\nRemoving intermediate container 593ee5e1ea51\nStep 4 : ENTRYPOINT java -Djava.security.egd=file:/dev/./urandom -jar /app.jar\n ---> Running in 85d558a10cd4\n ---> 7102f08b5e95\nRemoving intermediate container 85d558a10cd4\nSuccessfully built 7102f08b5e95\n[INFO] Built springboot/spring-boot-docker\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 54.346 s\n[INFO] Finished at: 2018-03-13T16:20:15+08:00\n[INFO] Final Memory: 42M/182M\n[INFO] ------------------------------------------------------------------------\n```\n\n使用`docker images`命令查看构建好的镜像：\n\n```\ndocker images\nREPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE\nspringboot/spring-boot-docker   latest              99ce9468da74        6 seconds ago       117.5 MB\n```\n\n`springboot/spring-boot-docker` 就是我们构建好的镜像，下一步就是运行该镜像\n\n```\ndocker run -p 8080:8080 -t springboot/spring-boot-docker\n```\n\n启动完成之后我们使用`docker ps`查看正在运行的镜像：\n\n```\ndocker ps\nCONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                    NAMES\n049570da86a9        springboot/spring-boot-docker   \"java -Djava.security\"   30 seconds ago      Up 27 seconds       0.0.0.0:8080->8080/tcp   determined_mahavira\n```\n\n可以看到我们构建的容器正在在运行，访问浏览器：`http://192.168.0.x:8080/`, 返回\n\n```\nHello Docker!\n```\n\n说明使用 Docker 部署 Spring Boot 项目成功！\n\n**[示例代码 - github](https://github.com/ityouknow/spring-boot-examples)**\n\n**[示例代码 - 码云](https://gitee.com/ityouknow/spring-boot-examples)**\n\n## 参考\n\n[Spring Boot with Docker](https://spring.io/guides/gs/spring-boot-docker/)\n[Docker：Spring Boot 应用发布到 Docker](https://lw900925.github.io/docker/docker-springboot.html)\n\n\n> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码\n>\n> 原文地址 https://www.cnblogs.com/ityouknow/p/8599093.html\n","source":"_posts/0018-使用 Docker 部署 Spring Boot.md","raw":"---\ntitle: 使用 Docker 部署 Spring Boot\ndate: 2019-04-17 16:11:01\nphotos:\n    - https://cdn.pixabay.com/photo/2019/05/02/18/47/park-4174278_960_720.jpg\n---\n\n\nDocker 技术发展为微服务落地提供了更加便利的环境，使用 Docker 部署 Spring Boot 其实非常简单，这篇文章我们就来简单学习下。\n\n首先构建一个简单的 Spring Boot 项目，然后给项目添加 Docker 支持，最后对项目进行部署。\n\n## 一个简单 Spring Boot 项目\n\n在 `pom.xml` 中 ，使用 Spring Boot 2.0 相关依赖\n\n```xml\n<parent>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-parent</artifactId>\n    <version>2.0.0.RELEASE</version>\n</parent>\n```\n\n添加 web 和测试依赖\n\n```xml\n<dependencies>\n     <dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-test</artifactId>\n        <scope>test</scope>\n    </dependency>\n</dependencies>\n```\n\n创建一个 DockerController，在其中有一个`index()`方法，访问时返回：`Hello Docker!`\n\n```\n@RestController\npublic class DockerController {\n\n    @RequestMapping(\"/\")\n    public String index() {\n        return \"Hello Docker!\";\n    }\n}\n```\n\n启动类\n\n```\n@SpringBootApplication\npublic class DockerApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(DockerApplication.class, args);\n    }\n}\n```\n\n添加完毕后启动项目，启动成功后浏览器放问：`http://localhost:8080/`，页面返回：`Hello Docker!`，说明 Spring Boot 项目配置正常。\n\n## Spring Boot 项目添加 Docker 支持\n\n在 `pom.xml-properties`中添加 Docker 镜像名称\n\n```\n<properties>\n    <docker.image.prefix>springboot</docker.image.prefix>\n</properties>\n```\n\nplugins 中添加 Docker 构建插件：\n\n```\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-maven-plugin</artifactId>\n        </plugin>\n        <!-- Docker maven plugin -->\n        <plugin>\n            <groupId>com.spotify</groupId>\n            <artifactId>docker-maven-plugin</artifactId>\n            <version>1.0.0</version>\n            <configuration>\n                <imageName>${docker.image.prefix}/${project.artifactId}</imageName>\n                <dockerDirectory>src/main/docker</dockerDirectory>\n                <resources>\n                    <resource>\n                        <targetPath>/</targetPath>\n                        <directory>${project.build.directory}</directory>\n                        <include>${project.build.finalName}.jar</include>\n                    </resource>\n                </resources>\n            </configuration>\n        </plugin>\n        <!-- Docker maven plugin -->\n    </plugins>\n</build>\n```\n\n在目录`src/main/docker`下创建 Dockerfile 文件，Dockerfile 文件用来说明如何来构建镜像。\n\n```\nFROM openjdk:8-jdk-alpine\nVOLUME /tmp\nADD spring-boot-docker-1.0.jar app.jar\nENTRYPOINT [\"java\",\"-Djava.security.egd=file:/dev/./urandom\",\"-jar\",\"/app.jar\"]\n```\n\n这个 Dockerfile 文件很简单，构建 Jdk 基础环境，添加 Spring Boot Jar 到镜像中，简单解释一下:\n\n*   FROM ，表示使用 Jdk8 环境 为基础镜像，如果镜像不是本地的会从 DockerHub 进行下载\n*   VOLUME ，VOLUME 指向了一个`/tmp`的目录，由于 Spring Boot 使用内置的 Tomcat 容器，Tomcat 默认使用`/tmp`作为工作目录。这个命令的效果是：在宿主机的`/var/lib/docker`目录下创建一个临时文件并把它链接到容器中的`/tmp`目录\n*   ADD ，拷贝文件并且重命名\n*   ENTRYPOINT ，为了缩短 Tomcat 的启动时间，添加`java.security.egd`的系统属性指向`/dev/urandom`作为 ENTRYPOINT\n\n> 这样 Spring Boot 项目添加 Docker 依赖就完成了。\n\n## 构建打包环境\n\n我们需要有一个 Docker 环境来打包 Spring Boot 项目，在 Windows 搭建 Docker 环境很麻烦，因此我这里以 Centos 7 为例。\n\n### 安装 Docker 环境\n\n安装\n\n```\nyum install docker\n```\n\n安装完成后，使用下面的命令来启动 docker 服务，并将其设置为开机启动：\n\n```\nervice docker start\nchkconfig docker on\n\n#LCTT 译注：此处采用了旧式的 sysv 语法，如采用CentOS 7中支持的新式 systemd 语法，如下：\nsystemctl  start docker.service\nsystemctl  enable docker.service\n```\n\n使用 Docker 中国加速器\n\n```\nvi  /etc/docker/daemon.json\n\n#添加后：\n{\n    \"registry-mirrors\": [\"https://registry.docker-cn.com\"],\n    \"live-restore\": true\n}\n```\n\n重新启动 docker\n\n```\nsystemctl restart docker\n```\n\n输入`docker version` 返回版本信息则安装正常。\n\n### 安装 JDK\n\n```\nyum -y install java-1.8.0-openjdk*\n```\n\n配置环境变量\n打开 `vim /etc/profile`\n添加一下内容\n\n```\nexport JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64 \nexport PATH=$PATH:$JAVA_HOME/bin \n```\n\n修改完成之后，使其生效\n\n```\nsource /etc/profile\n```\n\n输入`java -version` 返回版本信息则安装正常。\n\n### 安装 MAVEN\n\n下载：`http://mirrors.shu.edu.cn/apache/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz`\n\n```\n## 解压\ntar vxf apache-maven-3.5.2-bin.tar.gz\n## 移动\nmv apache-maven-3.5.2 /usr/local/maven3\n```\n\n修改环境变量， 在`/etc/profile`中添加以下几行\n\n```\nMAVEN_HOME=/usr/local/maven3\nexport MAVEN_HOME\nexport PATH=${PATH}:${MAVEN_HOME}/bin\n```\n\n记得执行`source /etc/profile`使环境变量生效。\n\n输入`mvn -version` 返回版本信息则安装正常。\n\n> 这样整个构建环境就配置完成了。\n\n## 使用 Docker 部署 Spring Boot 项目\n\n将项目 `spring-boot-docker` 拷贝服务器中，进入项目路径下进行打包测试。\n\n```\n#打包\nmvn package\n#启动\njava -jar target/spring-boot-docker-1.0.jar\n```\n\n看到 Spring Boot 的启动日志后表明环境配置没有问题，接下来我们使用 DockerFile 构建镜像。\n\n```\nmvn package docker:build\n```\n\n第一次构建可能有点慢，当看到以下内容的时候表明构建成功：\n\n```\n...\nStep 1 : FROM openjdk:8-jdk-alpine\n ---> 224765a6bdbe\nStep 2 : VOLUME /tmp\n ---> Using cache\n ---> b4e86cc8654e\nStep 3 : ADD spring-boot-docker-1.0.jar app.jar\n ---> a20fe75963ab\nRemoving intermediate container 593ee5e1ea51\nStep 4 : ENTRYPOINT java -Djava.security.egd=file:/dev/./urandom -jar /app.jar\n ---> Running in 85d558a10cd4\n ---> 7102f08b5e95\nRemoving intermediate container 85d558a10cd4\nSuccessfully built 7102f08b5e95\n[INFO] Built springboot/spring-boot-docker\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 54.346 s\n[INFO] Finished at: 2018-03-13T16:20:15+08:00\n[INFO] Final Memory: 42M/182M\n[INFO] ------------------------------------------------------------------------\n```\n\n使用`docker images`命令查看构建好的镜像：\n\n```\ndocker images\nREPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE\nspringboot/spring-boot-docker   latest              99ce9468da74        6 seconds ago       117.5 MB\n```\n\n`springboot/spring-boot-docker` 就是我们构建好的镜像，下一步就是运行该镜像\n\n```\ndocker run -p 8080:8080 -t springboot/spring-boot-docker\n```\n\n启动完成之后我们使用`docker ps`查看正在运行的镜像：\n\n```\ndocker ps\nCONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                    NAMES\n049570da86a9        springboot/spring-boot-docker   \"java -Djava.security\"   30 seconds ago      Up 27 seconds       0.0.0.0:8080->8080/tcp   determined_mahavira\n```\n\n可以看到我们构建的容器正在在运行，访问浏览器：`http://192.168.0.x:8080/`, 返回\n\n```\nHello Docker!\n```\n\n说明使用 Docker 部署 Spring Boot 项目成功！\n\n**[示例代码 - github](https://github.com/ityouknow/spring-boot-examples)**\n\n**[示例代码 - 码云](https://gitee.com/ityouknow/spring-boot-examples)**\n\n## 参考\n\n[Spring Boot with Docker](https://spring.io/guides/gs/spring-boot-docker/)\n[Docker：Spring Boot 应用发布到 Docker](https://lw900925.github.io/docker/docker-springboot.html)\n\n\n> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码\n>\n> 原文地址 https://www.cnblogs.com/ityouknow/p/8599093.html\n","slug":"0018-使用 Docker 部署 Spring Boot","published":1,"updated":"2019-05-09T03:17:23.749Z","_id":"cjvg26t7z003jgcoi8yc14wjt","comments":1,"layout":"post","link":"","content":"<p>Docker 技术发展为微服务落地提供了更加便利的环境，使用 Docker 部署 Spring Boot 其实非常简单，这篇文章我们就来简单学习下。</p>\n<p>首先构建一个简单的 Spring Boot 项目，然后给项目添加 Docker 支持，最后对项目进行部署。</p>\n<h2 id=\"一个简单-Spring-Boot-项目\"><a href=\"#一个简单-Spring-Boot-项目\" class=\"headerlink\" title=\"一个简单 Spring Boot 项目\"></a>一个简单 Spring Boot 项目</h2><p>在 <code>pom.xml</code> 中 ，使用 Spring Boot 2.0 相关依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>添加 web 和测试依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>创建一个 DockerController，在其中有一个<code>index()</code>方法，访问时返回：<code>Hello Docker!</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RestController</span><br><span class=\"line\">public class DockerController &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RequestMapping(&quot;/&quot;)</span><br><span class=\"line\">    public String index() &#123;</span><br><span class=\"line\">        return &quot;Hello Docker!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动类</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SpringBootApplication</span><br><span class=\"line\">public class DockerApplication &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        SpringApplication.run(DockerApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>添加完毕后启动项目，启动成功后浏览器放问：<code>http://localhost:8080/</code>，页面返回：<code>Hello Docker!</code>，说明 Spring Boot 项目配置正常。</p>\n<h2 id=\"Spring-Boot-项目添加-Docker-支持\"><a href=\"#Spring-Boot-项目添加-Docker-支持\" class=\"headerlink\" title=\"Spring Boot 项目添加 Docker 支持\"></a>Spring Boot 项目添加 Docker 支持</h2><p>在 <code>pom.xml-properties</code>中添加 Docker 镜像名称</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;properties&gt;</span><br><span class=\"line\">    &lt;docker.image.prefix&gt;springboot&lt;/docker.image.prefix&gt;</span><br><span class=\"line\">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>\n<p>plugins 中添加 Docker 构建插件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">    &lt;plugins&gt;</span><br><span class=\"line\">        &lt;plugin&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;!-- Docker maven plugin --&gt;</span><br><span class=\"line\">        &lt;plugin&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class=\"line\">            &lt;configuration&gt;</span><br><span class=\"line\">                &lt;imageName&gt;$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;&lt;/imageName&gt;</span><br><span class=\"line\">                &lt;dockerDirectory&gt;src/main/docker&lt;/dockerDirectory&gt;</span><br><span class=\"line\">                &lt;resources&gt;</span><br><span class=\"line\">                    &lt;resource&gt;</span><br><span class=\"line\">                        &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class=\"line\">                        &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class=\"line\">                        &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt;</span><br><span class=\"line\">                    &lt;/resource&gt;</span><br><span class=\"line\">                &lt;/resources&gt;</span><br><span class=\"line\">            &lt;/configuration&gt;</span><br><span class=\"line\">        &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;!-- Docker maven plugin --&gt;</span><br><span class=\"line\">    &lt;/plugins&gt;</span><br><span class=\"line\">&lt;/build&gt;</span><br></pre></td></tr></table></figure>\n<p>在目录<code>src/main/docker</code>下创建 Dockerfile 文件，Dockerfile 文件用来说明如何来构建镜像。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM openjdk:8-jdk-alpine</span><br><span class=\"line\">VOLUME /tmp</span><br><span class=\"line\">ADD spring-boot-docker-1.0.jar app.jar</span><br><span class=\"line\">ENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure>\n<p>这个 Dockerfile 文件很简单，构建 Jdk 基础环境，添加 Spring Boot Jar 到镜像中，简单解释一下:</p>\n<ul>\n<li>FROM ，表示使用 Jdk8 环境 为基础镜像，如果镜像不是本地的会从 DockerHub 进行下载</li>\n<li>VOLUME ，VOLUME 指向了一个<code>/tmp</code>的目录，由于 Spring Boot 使用内置的 Tomcat 容器，Tomcat 默认使用<code>/tmp</code>作为工作目录。这个命令的效果是：在宿主机的<code>/var/lib/docker</code>目录下创建一个临时文件并把它链接到容器中的<code>/tmp</code>目录</li>\n<li>ADD ，拷贝文件并且重命名</li>\n<li>ENTRYPOINT ，为了缩短 Tomcat 的启动时间，添加<code>java.security.egd</code>的系统属性指向<code>/dev/urandom</code>作为 ENTRYPOINT</li>\n</ul>\n<blockquote>\n<p>这样 Spring Boot 项目添加 Docker 依赖就完成了。</p>\n</blockquote>\n<h2 id=\"构建打包环境\"><a href=\"#构建打包环境\" class=\"headerlink\" title=\"构建打包环境\"></a>构建打包环境</h2><p>我们需要有一个 Docker 环境来打包 Spring Boot 项目，在 Windows 搭建 Docker 环境很麻烦，因此我这里以 Centos 7 为例。</p>\n<h3 id=\"安装-Docker-环境\"><a href=\"#安装-Docker-环境\" class=\"headerlink\" title=\"安装 Docker 环境\"></a>安装 Docker 环境</h3><p>安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install docker</span><br></pre></td></tr></table></figure>\n<p>安装完成后，使用下面的命令来启动 docker 服务，并将其设置为开机启动：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ervice docker start</span><br><span class=\"line\">chkconfig docker on</span><br><span class=\"line\"></span><br><span class=\"line\">#LCTT 译注：此处采用了旧式的 sysv 语法，如采用CentOS 7中支持的新式 systemd 语法，如下：</span><br><span class=\"line\">systemctl  start docker.service</span><br><span class=\"line\">systemctl  enable docker.service</span><br></pre></td></tr></table></figure>\n<p>使用 Docker 中国加速器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi  /etc/docker/daemon.json</span><br><span class=\"line\"></span><br><span class=\"line\">#添加后：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;],</span><br><span class=\"line\">    &quot;live-restore&quot;: true</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>重新启动 docker</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n<p>输入<code>docker version</code> 返回版本信息则安装正常。</p>\n<h3 id=\"安装-JDK\"><a href=\"#安装-JDK\" class=\"headerlink\" title=\"安装 JDK\"></a>安装 JDK</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install java-1.8.0-openjdk*</span><br></pre></td></tr></table></figure>\n<p>配置环境变量<br>打开 <code>vim /etc/profile</code><br>添加一下内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64 </span><br><span class=\"line\">export PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure>\n<p>修改完成之后，使其生效</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n<p>输入<code>java -version</code> 返回版本信息则安装正常。</p>\n<h3 id=\"安装-MAVEN\"><a href=\"#安装-MAVEN\" class=\"headerlink\" title=\"安装 MAVEN\"></a>安装 MAVEN</h3><p>下载：<code>http://mirrors.shu.edu.cn/apache/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## 解压</span><br><span class=\"line\">tar vxf apache-maven-3.5.2-bin.tar.gz</span><br><span class=\"line\">## 移动</span><br><span class=\"line\">mv apache-maven-3.5.2 /usr/local/maven3</span><br></pre></td></tr></table></figure>\n<p>修改环境变量， 在<code>/etc/profile</code>中添加以下几行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MAVEN_HOME=/usr/local/maven3</span><br><span class=\"line\">export MAVEN_HOME</span><br><span class=\"line\">export PATH=$&#123;PATH&#125;:$&#123;MAVEN_HOME&#125;/bin</span><br></pre></td></tr></table></figure>\n<p>记得执行<code>source /etc/profile</code>使环境变量生效。</p>\n<p>输入<code>mvn -version</code> 返回版本信息则安装正常。</p>\n<blockquote>\n<p>这样整个构建环境就配置完成了。</p>\n</blockquote>\n<h2 id=\"使用-Docker-部署-Spring-Boot-项目\"><a href=\"#使用-Docker-部署-Spring-Boot-项目\" class=\"headerlink\" title=\"使用 Docker 部署 Spring Boot 项目\"></a>使用 Docker 部署 Spring Boot 项目</h2><p>将项目 <code>spring-boot-docker</code> 拷贝服务器中，进入项目路径下进行打包测试。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#打包</span><br><span class=\"line\">mvn package</span><br><span class=\"line\">#启动</span><br><span class=\"line\">java -jar target/spring-boot-docker-1.0.jar</span><br></pre></td></tr></table></figure>\n<p>看到 Spring Boot 的启动日志后表明环境配置没有问题，接下来我们使用 DockerFile 构建镜像。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn package docker:build</span><br></pre></td></tr></table></figure>\n<p>第一次构建可能有点慢，当看到以下内容的时候表明构建成功：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">Step 1 : FROM openjdk:8-jdk-alpine</span><br><span class=\"line\"> ---&gt; 224765a6bdbe</span><br><span class=\"line\">Step 2 : VOLUME /tmp</span><br><span class=\"line\"> ---&gt; Using cache</span><br><span class=\"line\"> ---&gt; b4e86cc8654e</span><br><span class=\"line\">Step 3 : ADD spring-boot-docker-1.0.jar app.jar</span><br><span class=\"line\"> ---&gt; a20fe75963ab</span><br><span class=\"line\">Removing intermediate container 593ee5e1ea51</span><br><span class=\"line\">Step 4 : ENTRYPOINT java -Djava.security.egd=file:/dev/./urandom -jar /app.jar</span><br><span class=\"line\"> ---&gt; Running in 85d558a10cd4</span><br><span class=\"line\"> ---&gt; 7102f08b5e95</span><br><span class=\"line\">Removing intermediate container 85d558a10cd4</span><br><span class=\"line\">Successfully built 7102f08b5e95</span><br><span class=\"line\">[INFO] Built springboot/spring-boot-docker</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] BUILD SUCCESS</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] Total time: 54.346 s</span><br><span class=\"line\">[INFO] Finished at: 2018-03-13T16:20:15+08:00</span><br><span class=\"line\">[INFO] Final Memory: 42M/182M</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>\n<p>使用<code>docker images</code>命令查看构建好的镜像：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">springboot/spring-boot-docker   latest              99ce9468da74        6 seconds ago       117.5 MB</span><br></pre></td></tr></table></figure>\n<p><code>springboot/spring-boot-docker</code> 就是我们构建好的镜像，下一步就是运行该镜像</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 8080:8080 -t springboot/spring-boot-docker</span><br></pre></td></tr></table></figure>\n<p>启动完成之后我们使用<code>docker ps</code>查看正在运行的镜像：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class=\"line\">049570da86a9        springboot/spring-boot-docker   &quot;java -Djava.security&quot;   30 seconds ago      Up 27 seconds       0.0.0.0:8080-&gt;8080/tcp   determined_mahavira</span><br></pre></td></tr></table></figure>\n<p>可以看到我们构建的容器正在在运行，访问浏览器：<code>http://192.168.0.x:8080/</code>, 返回</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello Docker!</span><br></pre></td></tr></table></figure>\n<p>说明使用 Docker 部署 Spring Boot 项目成功！</p>\n<p><strong><a href=\"https://github.com/ityouknow/spring-boot-examples\" target=\"_blank\" rel=\"noopener\">示例代码 - github</a></strong></p>\n<p><strong><a href=\"https://gitee.com/ityouknow/spring-boot-examples\" target=\"_blank\" rel=\"noopener\">示例代码 - 码云</a></strong></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://spring.io/guides/gs/spring-boot-docker/\" target=\"_blank\" rel=\"noopener\">Spring Boot with Docker</a><br><a href=\"https://lw900925.github.io/docker/docker-springboot.html\" target=\"_blank\" rel=\"noopener\">Docker：Spring Boot 应用发布到 Docker</a></p>\n<blockquote>\n<p>本文由 <a href=\"http://ksria.com/simpread/\" target=\"_blank\" rel=\"noopener\">简悦 SimpRead</a> 转码</p>\n<p>原文地址 <a href=\"https://www.cnblogs.com/ityouknow/p/8599093.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/ityouknow/p/8599093.html</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>Docker 技术发展为微服务落地提供了更加便利的环境，使用 Docker 部署 Spring Boot 其实非常简单，这篇文章我们就来简单学习下。</p>\n<p>首先构建一个简单的 Spring Boot 项目，然后给项目添加 Docker 支持，最后对项目进行部署。</p>\n<h2 id=\"一个简单-Spring-Boot-项目\"><a href=\"#一个简单-Spring-Boot-项目\" class=\"headerlink\" title=\"一个简单 Spring Boot 项目\"></a>一个简单 Spring Boot 项目</h2><p>在 <code>pom.xml</code> 中 ，使用 Spring Boot 2.0 相关依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.0.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>添加 web 和测试依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>创建一个 DockerController，在其中有一个<code>index()</code>方法，访问时返回：<code>Hello Docker!</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RestController</span><br><span class=\"line\">public class DockerController &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RequestMapping(&quot;/&quot;)</span><br><span class=\"line\">    public String index() &#123;</span><br><span class=\"line\">        return &quot;Hello Docker!&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动类</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SpringBootApplication</span><br><span class=\"line\">public class DockerApplication &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        SpringApplication.run(DockerApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>添加完毕后启动项目，启动成功后浏览器放问：<code>http://localhost:8080/</code>，页面返回：<code>Hello Docker!</code>，说明 Spring Boot 项目配置正常。</p>\n<h2 id=\"Spring-Boot-项目添加-Docker-支持\"><a href=\"#Spring-Boot-项目添加-Docker-支持\" class=\"headerlink\" title=\"Spring Boot 项目添加 Docker 支持\"></a>Spring Boot 项目添加 Docker 支持</h2><p>在 <code>pom.xml-properties</code>中添加 Docker 镜像名称</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;properties&gt;</span><br><span class=\"line\">    &lt;docker.image.prefix&gt;springboot&lt;/docker.image.prefix&gt;</span><br><span class=\"line\">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>\n<p>plugins 中添加 Docker 构建插件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">    &lt;plugins&gt;</span><br><span class=\"line\">        &lt;plugin&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;!-- Docker maven plugin --&gt;</span><br><span class=\"line\">        &lt;plugin&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class=\"line\">            &lt;configuration&gt;</span><br><span class=\"line\">                &lt;imageName&gt;$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;&lt;/imageName&gt;</span><br><span class=\"line\">                &lt;dockerDirectory&gt;src/main/docker&lt;/dockerDirectory&gt;</span><br><span class=\"line\">                &lt;resources&gt;</span><br><span class=\"line\">                    &lt;resource&gt;</span><br><span class=\"line\">                        &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class=\"line\">                        &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class=\"line\">                        &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt;</span><br><span class=\"line\">                    &lt;/resource&gt;</span><br><span class=\"line\">                &lt;/resources&gt;</span><br><span class=\"line\">            &lt;/configuration&gt;</span><br><span class=\"line\">        &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;!-- Docker maven plugin --&gt;</span><br><span class=\"line\">    &lt;/plugins&gt;</span><br><span class=\"line\">&lt;/build&gt;</span><br></pre></td></tr></table></figure>\n<p>在目录<code>src/main/docker</code>下创建 Dockerfile 文件，Dockerfile 文件用来说明如何来构建镜像。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM openjdk:8-jdk-alpine</span><br><span class=\"line\">VOLUME /tmp</span><br><span class=\"line\">ADD spring-boot-docker-1.0.jar app.jar</span><br><span class=\"line\">ENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure>\n<p>这个 Dockerfile 文件很简单，构建 Jdk 基础环境，添加 Spring Boot Jar 到镜像中，简单解释一下:</p>\n<ul>\n<li>FROM ，表示使用 Jdk8 环境 为基础镜像，如果镜像不是本地的会从 DockerHub 进行下载</li>\n<li>VOLUME ，VOLUME 指向了一个<code>/tmp</code>的目录，由于 Spring Boot 使用内置的 Tomcat 容器，Tomcat 默认使用<code>/tmp</code>作为工作目录。这个命令的效果是：在宿主机的<code>/var/lib/docker</code>目录下创建一个临时文件并把它链接到容器中的<code>/tmp</code>目录</li>\n<li>ADD ，拷贝文件并且重命名</li>\n<li>ENTRYPOINT ，为了缩短 Tomcat 的启动时间，添加<code>java.security.egd</code>的系统属性指向<code>/dev/urandom</code>作为 ENTRYPOINT</li>\n</ul>\n<blockquote>\n<p>这样 Spring Boot 项目添加 Docker 依赖就完成了。</p>\n</blockquote>\n<h2 id=\"构建打包环境\"><a href=\"#构建打包环境\" class=\"headerlink\" title=\"构建打包环境\"></a>构建打包环境</h2><p>我们需要有一个 Docker 环境来打包 Spring Boot 项目，在 Windows 搭建 Docker 环境很麻烦，因此我这里以 Centos 7 为例。</p>\n<h3 id=\"安装-Docker-环境\"><a href=\"#安装-Docker-环境\" class=\"headerlink\" title=\"安装 Docker 环境\"></a>安装 Docker 环境</h3><p>安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install docker</span><br></pre></td></tr></table></figure>\n<p>安装完成后，使用下面的命令来启动 docker 服务，并将其设置为开机启动：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ervice docker start</span><br><span class=\"line\">chkconfig docker on</span><br><span class=\"line\"></span><br><span class=\"line\">#LCTT 译注：此处采用了旧式的 sysv 语法，如采用CentOS 7中支持的新式 systemd 语法，如下：</span><br><span class=\"line\">systemctl  start docker.service</span><br><span class=\"line\">systemctl  enable docker.service</span><br></pre></td></tr></table></figure>\n<p>使用 Docker 中国加速器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi  /etc/docker/daemon.json</span><br><span class=\"line\"></span><br><span class=\"line\">#添加后：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;],</span><br><span class=\"line\">    &quot;live-restore&quot;: true</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>重新启动 docker</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n<p>输入<code>docker version</code> 返回版本信息则安装正常。</p>\n<h3 id=\"安装-JDK\"><a href=\"#安装-JDK\" class=\"headerlink\" title=\"安装 JDK\"></a>安装 JDK</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install java-1.8.0-openjdk*</span><br></pre></td></tr></table></figure>\n<p>配置环境变量<br>打开 <code>vim /etc/profile</code><br>添加一下内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64 </span><br><span class=\"line\">export PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure>\n<p>修改完成之后，使其生效</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n<p>输入<code>java -version</code> 返回版本信息则安装正常。</p>\n<h3 id=\"安装-MAVEN\"><a href=\"#安装-MAVEN\" class=\"headerlink\" title=\"安装 MAVEN\"></a>安装 MAVEN</h3><p>下载：<code>http://mirrors.shu.edu.cn/apache/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## 解压</span><br><span class=\"line\">tar vxf apache-maven-3.5.2-bin.tar.gz</span><br><span class=\"line\">## 移动</span><br><span class=\"line\">mv apache-maven-3.5.2 /usr/local/maven3</span><br></pre></td></tr></table></figure>\n<p>修改环境变量， 在<code>/etc/profile</code>中添加以下几行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MAVEN_HOME=/usr/local/maven3</span><br><span class=\"line\">export MAVEN_HOME</span><br><span class=\"line\">export PATH=$&#123;PATH&#125;:$&#123;MAVEN_HOME&#125;/bin</span><br></pre></td></tr></table></figure>\n<p>记得执行<code>source /etc/profile</code>使环境变量生效。</p>\n<p>输入<code>mvn -version</code> 返回版本信息则安装正常。</p>\n<blockquote>\n<p>这样整个构建环境就配置完成了。</p>\n</blockquote>\n<h2 id=\"使用-Docker-部署-Spring-Boot-项目\"><a href=\"#使用-Docker-部署-Spring-Boot-项目\" class=\"headerlink\" title=\"使用 Docker 部署 Spring Boot 项目\"></a>使用 Docker 部署 Spring Boot 项目</h2><p>将项目 <code>spring-boot-docker</code> 拷贝服务器中，进入项目路径下进行打包测试。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#打包</span><br><span class=\"line\">mvn package</span><br><span class=\"line\">#启动</span><br><span class=\"line\">java -jar target/spring-boot-docker-1.0.jar</span><br></pre></td></tr></table></figure>\n<p>看到 Spring Boot 的启动日志后表明环境配置没有问题，接下来我们使用 DockerFile 构建镜像。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn package docker:build</span><br></pre></td></tr></table></figure>\n<p>第一次构建可能有点慢，当看到以下内容的时候表明构建成功：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">Step 1 : FROM openjdk:8-jdk-alpine</span><br><span class=\"line\"> ---&gt; 224765a6bdbe</span><br><span class=\"line\">Step 2 : VOLUME /tmp</span><br><span class=\"line\"> ---&gt; Using cache</span><br><span class=\"line\"> ---&gt; b4e86cc8654e</span><br><span class=\"line\">Step 3 : ADD spring-boot-docker-1.0.jar app.jar</span><br><span class=\"line\"> ---&gt; a20fe75963ab</span><br><span class=\"line\">Removing intermediate container 593ee5e1ea51</span><br><span class=\"line\">Step 4 : ENTRYPOINT java -Djava.security.egd=file:/dev/./urandom -jar /app.jar</span><br><span class=\"line\"> ---&gt; Running in 85d558a10cd4</span><br><span class=\"line\"> ---&gt; 7102f08b5e95</span><br><span class=\"line\">Removing intermediate container 85d558a10cd4</span><br><span class=\"line\">Successfully built 7102f08b5e95</span><br><span class=\"line\">[INFO] Built springboot/spring-boot-docker</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] BUILD SUCCESS</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] Total time: 54.346 s</span><br><span class=\"line\">[INFO] Finished at: 2018-03-13T16:20:15+08:00</span><br><span class=\"line\">[INFO] Final Memory: 42M/182M</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>\n<p>使用<code>docker images</code>命令查看构建好的镜像：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">springboot/spring-boot-docker   latest              99ce9468da74        6 seconds ago       117.5 MB</span><br></pre></td></tr></table></figure>\n<p><code>springboot/spring-boot-docker</code> 就是我们构建好的镜像，下一步就是运行该镜像</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 8080:8080 -t springboot/spring-boot-docker</span><br></pre></td></tr></table></figure>\n<p>启动完成之后我们使用<code>docker ps</code>查看正在运行的镜像：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class=\"line\">049570da86a9        springboot/spring-boot-docker   &quot;java -Djava.security&quot;   30 seconds ago      Up 27 seconds       0.0.0.0:8080-&gt;8080/tcp   determined_mahavira</span><br></pre></td></tr></table></figure>\n<p>可以看到我们构建的容器正在在运行，访问浏览器：<code>http://192.168.0.x:8080/</code>, 返回</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello Docker!</span><br></pre></td></tr></table></figure>\n<p>说明使用 Docker 部署 Spring Boot 项目成功！</p>\n<p><strong><a href=\"https://github.com/ityouknow/spring-boot-examples\" target=\"_blank\" rel=\"noopener\">示例代码 - github</a></strong></p>\n<p><strong><a href=\"https://gitee.com/ityouknow/spring-boot-examples\" target=\"_blank\" rel=\"noopener\">示例代码 - 码云</a></strong></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://spring.io/guides/gs/spring-boot-docker/\" target=\"_blank\" rel=\"noopener\">Spring Boot with Docker</a><br><a href=\"https://lw900925.github.io/docker/docker-springboot.html\" target=\"_blank\" rel=\"noopener\">Docker：Spring Boot 应用发布到 Docker</a></p>\n<blockquote>\n<p>本文由 <a href=\"http://ksria.com/simpread/\" target=\"_blank\" rel=\"noopener\">简悦 SimpRead</a> 转码</p>\n<p>原文地址 <a href=\"https://www.cnblogs.com/ityouknow/p/8599093.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/ityouknow/p/8599093.html</a></p>\n</blockquote>\n"},{"title":"构建基于Electron技术的Angular桌面应用","date":"2018-10-15T09:06:30.000Z","_content":"\n\n\nIn this lesson, you will learn how to build native desktop apps with Angular and Electron. You might be surprised how easy it is to start building high-quality desktop apps for any platform, or even port your existing Angular app to native desktop platforms.\n通过本文，你可以学到如何使用Angular和Electron构建桌面应用。\n\nThis lesson covers the following topics:\n\n1. Configure Electron 1.7 with Angular 4.x.\n2. Build a simple timer app in Angular.\n3. Package the app for install on Windows 10, macOS, and Linux Ubuntu.\n\nYou can obtain the [source code](https://github.com/AngularFirebase/angular-electron) for this project on Github.\n\n![](https://angularfirebase.com/images/electron-angular-macos.gif)\n\n# Initial Setup\nLet’s kick things off by building a new angular app from scratch.\n\n# Generate the Angular App\nGenerate a default app with the Angular CLI.\n\n```\nnpm install -g @angular/cli\nng new angular-electron\ncd angular-electron\n```\n\n# Update index.html\n\nThe generated root page in Angular points the base href to `/` - this will cause problems with Electron later on, so let’s update it now. Just add a period in front of the slash in `src/index.html`.\n\n```\n<base href=\"./\">\n```\n# Install Electron\nYou can install Electron in the Angular development environment.\n\n```\nnpm install electron --save-dev\n```\n\n# Configure Electron\nThe next step is to configure Electron. There are all sorts of possibilities for customization and we’re just scratching the surface.\n\n# main.js\nCreate a new file named main.js in the root of your project - this is the Electron NodeJS backend. This is the entry point for Electron and defines how our desktop app will react to various events performed via the desktop operating system.\n\nThe createWindow function defines the properties of the program window that the user will see. There are many more window options that faciliate additional customization, child windows, modals, etc.\n\nNotice we are loading the window by pointing it to the index.html file in the dist/ folder. Do NOT confuse this with the index file in the src/ folder. At this point, this file does not exist, but it will be created automatically in the next step by running ng build --prod\n\n```typescript\nconst { app, BrowserWindow } = require('electron')\n\nlet win;\n\nfunction createWindow () {\n\n  win = new BrowserWindow({\n    width: 600,\n    height: 600,\n    backgroundColor: '#ffffff',\n    icon: `file://${__dirname}/dist/assets/logo.png`\n  })\n\n\n  win.loadURL(`file://${__dirname}/dist/index.html`)\n\n\n\n\n\n  win.on('closed', function () {\n    win = null\n  })\n}\n\n\napp.on('ready', createWindow)\n\n\napp.on('window-all-closed', function () {\n\n\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', function () {\n\n  if (win === null) {\n    createWindow()\n  }\n})\n```\nThat’s it for the Electron setup, all the desktop app magic is happens under the hood.\n\n# Custom Build Command\nThe deployed desktop app will be an Angular AOT build - this happens by default when you run ng build --prod. It’s useful to have a command that will run an AOT production build and start Electron at the same time. This can be easily configured in the package.json file.\n\n# package.json\n```json\n{\n  \"name\": \"angular-electron\",\n  \"version\": \"0.0.0\",\n  \"license\": \"MIT\",\n  \"main\": \"main.js\",\n  \"scripts\": {\n    \"ng\": \"ng\",\n    \"start\": \"ng serve\",\n    \"build\": \"ng build\",\n    \"test\": \"ng test\",\n    \"lint\": \"ng lint\",\n    \"e2e\": \"ng e2e\",\n    \"electron\": \"electron .\",\n    \"electron-build\": \"ng build --prod && electron .\"\n  },\n\n}\n```\n# Run the command\nYou can run your angular app as an native desktop app with the following command.\n\n```\nnpm run electron-build\n```\nAt this point, you can run the command (it will take a few seconds) and it will create the dist/ folder and will automatically bring up a window on your operating system with default Angular app.\n\nThis setup does not support hot code reloads. Whenever you change some Angular code, you need to rerun the electron-build command. It is possible to setup hot reloads by pointing the window to a remote URL (such as https://localhost:4200) and running ng serve in a separate terminal.\n\n\n# Building the Angular App\nNow we need to build an Angular App that’s worthy of being installed. I am building a single page timer that will animate a progress circle, then make a chime sound when complete.\n\n![](https://angularfirebase.com/images/angular-electron-timer.gif)\n\nTo keep things super simple, I am writing all the code in the app.component\n\n# Install Round Progress Bar\nTo get the progress timer looking good quickly, I installed the angular-svg-round-progressbar package. It gives us a pre-built component that we can animate based on the current state of the timer.\n\n```\nnpm install angular-svg-round-progressbar --save\n```\nThen add it to the app.module.ts (also add the FormsModule).\n\n```typescript\nimport { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\n\nimport { AppComponent } from './app.component';\n\nimport { FormsModule } from '@angular/forms';\nimport { RoundProgressModule } from 'angular-svg-round-progressbar';\n\n@NgModule({\n  declarations: [\n    AppComponent\n  ],\n  imports: [\n    BrowserModule,\n    FormsModule,\n    RoundProgressModule\n  ],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n```\n# app.component.ts\n\nThe app works by allowing the user to set the number of seconds the timer will run max. The timer progresses by running an RxJS Observable interval every 10th of a second and incrementing the current value.\n\nI also defined several getters help deal with NaN values that can cause errors in the progress circle. They also help keep the HTML logic clean and readable.\n\n```typescript\nimport { Component, OnInit } from '@angular/core';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/observable/interval';\nimport 'rxjs/add/operator/map';\nimport 'rxjs/add/operator/takeWhile';\nimport 'rxjs/add/operator/do';\n\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent {\n\n  max     = 1;\n  current = 0;\n\n\n  start() {\n    const interval = Observable.interval(100);\n\n        interval\n          .takeWhile(_ => !this.isFinished )\n          .do(i => this.current += 0.1)\n          .subscribe();\n  }\n\n\n  finish() {\n    this.current = this.max;\n  }\n\n\n  reset() {\n    this.current = 0;\n  }\n\n\n\n  get maxVal() {\n    return isNaN(this.max) || this.max < 0.1 ? 0.1 : this.max;\n  }\n\n  get currentVal() {\n    return isNaN(this.current) || this.current < 0 ? 0 : this.current;\n  }\n\n  get isFinished() {\n    return this.currentVal >= this.maxVal;\n  }\n\n}\n```\n\n# app.component.html\nIn the HTML, we can declare the progress component and display the user interface elements conditionally based on the state of the timer.\n\n```HTML\n<main class=\"content\">\n\n    <h1>Electron Timer</h1>\n\n    <div class=\"progress-wrapper\" *ngIf=\"maxVal\">\n\n        <div class=\"text\" *ngIf=\"!isFinished\">\n          {{ max - current | number: '1.1-1' }}\n        </div>\n\n        <div class=\"text\" *ngIf=\"isFinished\">\n            ding!\n            <audio src=\"assets/chime.mp3\" autoplay></audio>\n        </div>\n\n        <round-progress\n                [max]=\"max\"\n                [current]=\"current\"\n                [radius]=\"100\"\n                [stroke]=\"25\">\n        </round-progress>\n\n    </div>\n\n    <div class=\"controls-wrapper\">\n\n        <label>Seconds</label>\n        <input class=\"input\" placeholder=\"number of seconds\" type=\"text\"\n              [(ngModel)]=\"max\"\n              (keydown)=\"reset()\">\n\n\n        <button *ngIf=\"currentVal <= 0\" (click)=\"start()\">Start</button>\n        <button *ngIf=\"!isFinished\" (click)=\"finish()\">Finish</button>\n    </div>\n\n\n</main>\n```\n# Packaging for Desktop Operating Systems\nNow that we have a decent app ready for desktops, we need to package and distribute it. The electron packager tool will allow to package our code into an executable for desktop platforms - including Windows (win32), MacOS (darwin), and Linux. Keep in mind, there are several other electron packaging tools that might better fit your needs.\n\n```xml\nnpm install electron-packager -g\nnpm install electron-packager --save-dev\n```\n\nLinux and MacOS developers will need to install WineHQ if they plan on building desktop apps for Windows.\n\nIn this example, I am going to build an executable for Windows.\n\n```\nelectron-packager . --platform=win32\n```\nThis will generate a directory /angular-electron-win32-x64/ that contains the executable file.\n\nAnd why not build one for MacOS while we’re at it.\n\n```\nelectron-packager . --platform=darwin\n```\nThis will generate a directory /angular-electron-darwin-x64/ that contains the app. Zip it and extract it on a mac system and you should be able to run it natively. You will get warnings that it’s from an unknown developer, but this is expected and it’s perfectly safe to open - it’s your own code after all.\n\n# The End\nThat’s it for the basic setup with Electron with Angular. In the future, I will post some more advanced examples of these technologies in action.\n","source":"_posts/build-angular-desktop-apps-with-electron.md","raw":"---\ntitle: 构建基于Electron技术的Angular桌面应用\ndate: 2018-10-15 17:06:30\ntags:\n    - angular\n    - electron\n---\n\n\n\nIn this lesson, you will learn how to build native desktop apps with Angular and Electron. You might be surprised how easy it is to start building high-quality desktop apps for any platform, or even port your existing Angular app to native desktop platforms.\n通过本文，你可以学到如何使用Angular和Electron构建桌面应用。\n\nThis lesson covers the following topics:\n\n1. Configure Electron 1.7 with Angular 4.x.\n2. Build a simple timer app in Angular.\n3. Package the app for install on Windows 10, macOS, and Linux Ubuntu.\n\nYou can obtain the [source code](https://github.com/AngularFirebase/angular-electron) for this project on Github.\n\n![](https://angularfirebase.com/images/electron-angular-macos.gif)\n\n# Initial Setup\nLet’s kick things off by building a new angular app from scratch.\n\n# Generate the Angular App\nGenerate a default app with the Angular CLI.\n\n```\nnpm install -g @angular/cli\nng new angular-electron\ncd angular-electron\n```\n\n# Update index.html\n\nThe generated root page in Angular points the base href to `/` - this will cause problems with Electron later on, so let’s update it now. Just add a period in front of the slash in `src/index.html`.\n\n```\n<base href=\"./\">\n```\n# Install Electron\nYou can install Electron in the Angular development environment.\n\n```\nnpm install electron --save-dev\n```\n\n# Configure Electron\nThe next step is to configure Electron. There are all sorts of possibilities for customization and we’re just scratching the surface.\n\n# main.js\nCreate a new file named main.js in the root of your project - this is the Electron NodeJS backend. This is the entry point for Electron and defines how our desktop app will react to various events performed via the desktop operating system.\n\nThe createWindow function defines the properties of the program window that the user will see. There are many more window options that faciliate additional customization, child windows, modals, etc.\n\nNotice we are loading the window by pointing it to the index.html file in the dist/ folder. Do NOT confuse this with the index file in the src/ folder. At this point, this file does not exist, but it will be created automatically in the next step by running ng build --prod\n\n```typescript\nconst { app, BrowserWindow } = require('electron')\n\nlet win;\n\nfunction createWindow () {\n\n  win = new BrowserWindow({\n    width: 600,\n    height: 600,\n    backgroundColor: '#ffffff',\n    icon: `file://${__dirname}/dist/assets/logo.png`\n  })\n\n\n  win.loadURL(`file://${__dirname}/dist/index.html`)\n\n\n\n\n\n  win.on('closed', function () {\n    win = null\n  })\n}\n\n\napp.on('ready', createWindow)\n\n\napp.on('window-all-closed', function () {\n\n\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', function () {\n\n  if (win === null) {\n    createWindow()\n  }\n})\n```\nThat’s it for the Electron setup, all the desktop app magic is happens under the hood.\n\n# Custom Build Command\nThe deployed desktop app will be an Angular AOT build - this happens by default when you run ng build --prod. It’s useful to have a command that will run an AOT production build and start Electron at the same time. This can be easily configured in the package.json file.\n\n# package.json\n```json\n{\n  \"name\": \"angular-electron\",\n  \"version\": \"0.0.0\",\n  \"license\": \"MIT\",\n  \"main\": \"main.js\",\n  \"scripts\": {\n    \"ng\": \"ng\",\n    \"start\": \"ng serve\",\n    \"build\": \"ng build\",\n    \"test\": \"ng test\",\n    \"lint\": \"ng lint\",\n    \"e2e\": \"ng e2e\",\n    \"electron\": \"electron .\",\n    \"electron-build\": \"ng build --prod && electron .\"\n  },\n\n}\n```\n# Run the command\nYou can run your angular app as an native desktop app with the following command.\n\n```\nnpm run electron-build\n```\nAt this point, you can run the command (it will take a few seconds) and it will create the dist/ folder and will automatically bring up a window on your operating system with default Angular app.\n\nThis setup does not support hot code reloads. Whenever you change some Angular code, you need to rerun the electron-build command. It is possible to setup hot reloads by pointing the window to a remote URL (such as https://localhost:4200) and running ng serve in a separate terminal.\n\n\n# Building the Angular App\nNow we need to build an Angular App that’s worthy of being installed. I am building a single page timer that will animate a progress circle, then make a chime sound when complete.\n\n![](https://angularfirebase.com/images/angular-electron-timer.gif)\n\nTo keep things super simple, I am writing all the code in the app.component\n\n# Install Round Progress Bar\nTo get the progress timer looking good quickly, I installed the angular-svg-round-progressbar package. It gives us a pre-built component that we can animate based on the current state of the timer.\n\n```\nnpm install angular-svg-round-progressbar --save\n```\nThen add it to the app.module.ts (also add the FormsModule).\n\n```typescript\nimport { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\n\nimport { AppComponent } from './app.component';\n\nimport { FormsModule } from '@angular/forms';\nimport { RoundProgressModule } from 'angular-svg-round-progressbar';\n\n@NgModule({\n  declarations: [\n    AppComponent\n  ],\n  imports: [\n    BrowserModule,\n    FormsModule,\n    RoundProgressModule\n  ],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n```\n# app.component.ts\n\nThe app works by allowing the user to set the number of seconds the timer will run max. The timer progresses by running an RxJS Observable interval every 10th of a second and incrementing the current value.\n\nI also defined several getters help deal with NaN values that can cause errors in the progress circle. They also help keep the HTML logic clean and readable.\n\n```typescript\nimport { Component, OnInit } from '@angular/core';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/observable/interval';\nimport 'rxjs/add/operator/map';\nimport 'rxjs/add/operator/takeWhile';\nimport 'rxjs/add/operator/do';\n\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent {\n\n  max     = 1;\n  current = 0;\n\n\n  start() {\n    const interval = Observable.interval(100);\n\n        interval\n          .takeWhile(_ => !this.isFinished )\n          .do(i => this.current += 0.1)\n          .subscribe();\n  }\n\n\n  finish() {\n    this.current = this.max;\n  }\n\n\n  reset() {\n    this.current = 0;\n  }\n\n\n\n  get maxVal() {\n    return isNaN(this.max) || this.max < 0.1 ? 0.1 : this.max;\n  }\n\n  get currentVal() {\n    return isNaN(this.current) || this.current < 0 ? 0 : this.current;\n  }\n\n  get isFinished() {\n    return this.currentVal >= this.maxVal;\n  }\n\n}\n```\n\n# app.component.html\nIn the HTML, we can declare the progress component and display the user interface elements conditionally based on the state of the timer.\n\n```HTML\n<main class=\"content\">\n\n    <h1>Electron Timer</h1>\n\n    <div class=\"progress-wrapper\" *ngIf=\"maxVal\">\n\n        <div class=\"text\" *ngIf=\"!isFinished\">\n          {{ max - current | number: '1.1-1' }}\n        </div>\n\n        <div class=\"text\" *ngIf=\"isFinished\">\n            ding!\n            <audio src=\"assets/chime.mp3\" autoplay></audio>\n        </div>\n\n        <round-progress\n                [max]=\"max\"\n                [current]=\"current\"\n                [radius]=\"100\"\n                [stroke]=\"25\">\n        </round-progress>\n\n    </div>\n\n    <div class=\"controls-wrapper\">\n\n        <label>Seconds</label>\n        <input class=\"input\" placeholder=\"number of seconds\" type=\"text\"\n              [(ngModel)]=\"max\"\n              (keydown)=\"reset()\">\n\n\n        <button *ngIf=\"currentVal <= 0\" (click)=\"start()\">Start</button>\n        <button *ngIf=\"!isFinished\" (click)=\"finish()\">Finish</button>\n    </div>\n\n\n</main>\n```\n# Packaging for Desktop Operating Systems\nNow that we have a decent app ready for desktops, we need to package and distribute it. The electron packager tool will allow to package our code into an executable for desktop platforms - including Windows (win32), MacOS (darwin), and Linux. Keep in mind, there are several other electron packaging tools that might better fit your needs.\n\n```xml\nnpm install electron-packager -g\nnpm install electron-packager --save-dev\n```\n\nLinux and MacOS developers will need to install WineHQ if they plan on building desktop apps for Windows.\n\nIn this example, I am going to build an executable for Windows.\n\n```\nelectron-packager . --platform=win32\n```\nThis will generate a directory /angular-electron-win32-x64/ that contains the executable file.\n\nAnd why not build one for MacOS while we’re at it.\n\n```\nelectron-packager . --platform=darwin\n```\nThis will generate a directory /angular-electron-darwin-x64/ that contains the app. Zip it and extract it on a mac system and you should be able to run it natively. You will get warnings that it’s from an unknown developer, but this is expected and it’s perfectly safe to open - it’s your own code after all.\n\n# The End\nThat’s it for the basic setup with Electron with Angular. In the future, I will post some more advanced examples of these technologies in action.\n","slug":"build-angular-desktop-apps-with-electron","published":1,"updated":"2018-10-16T01:52:50.175Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t81003mgcoic5fnuv3u","content":"<p>In this lesson, you will learn how to build native desktop apps with Angular and Electron. You might be surprised how easy it is to start building high-quality desktop apps for any platform, or even port your existing Angular app to native desktop platforms.<br>通过本文，你可以学到如何使用Angular和Electron构建桌面应用。</p>\n<p>This lesson covers the following topics:</p>\n<ol>\n<li>Configure Electron 1.7 with Angular 4.x.</li>\n<li>Build a simple timer app in Angular.</li>\n<li>Package the app for install on Windows 10, macOS, and Linux Ubuntu.</li>\n</ol>\n<p>You can obtain the <a href=\"https://github.com/AngularFirebase/angular-electron\" target=\"_blank\" rel=\"noopener\">source code</a> for this project on Github.</p>\n<p><img src=\"https://angularfirebase.com/images/electron-angular-macos.gif\" alt=\"\"></p>\n<h1 id=\"Initial-Setup\"><a href=\"#Initial-Setup\" class=\"headerlink\" title=\"Initial Setup\"></a>Initial Setup</h1><p>Let’s kick things off by building a new angular app from scratch.</p>\n<h1 id=\"Generate-the-Angular-App\"><a href=\"#Generate-the-Angular-App\" class=\"headerlink\" title=\"Generate the Angular App\"></a>Generate the Angular App</h1><p>Generate a default app with the Angular CLI.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g @angular/cli</span><br><span class=\"line\">ng new angular-electron</span><br><span class=\"line\">cd angular-electron</span><br></pre></td></tr></table></figure>\n<h1 id=\"Update-index-html\"><a href=\"#Update-index-html\" class=\"headerlink\" title=\"Update index.html\"></a>Update index.html</h1><p>The generated root page in Angular points the base href to <code>/</code> - this will cause problems with Electron later on, so let’s update it now. Just add a period in front of the slash in <code>src/index.html</code>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;base href=&quot;./&quot;&gt;</span><br></pre></td></tr></table></figure>\n<h1 id=\"Install-Electron\"><a href=\"#Install-Electron\" class=\"headerlink\" title=\"Install Electron\"></a>Install Electron</h1><p>You can install Electron in the Angular development environment.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install electron --save-dev</span><br></pre></td></tr></table></figure>\n<h1 id=\"Configure-Electron\"><a href=\"#Configure-Electron\" class=\"headerlink\" title=\"Configure Electron\"></a>Configure Electron</h1><p>The next step is to configure Electron. There are all sorts of possibilities for customization and we’re just scratching the surface.</p>\n<h1 id=\"main-js\"><a href=\"#main-js\" class=\"headerlink\" title=\"main.js\"></a>main.js</h1><p>Create a new file named main.js in the root of your project - this is the Electron NodeJS backend. This is the entry point for Electron and defines how our desktop app will react to various events performed via the desktop operating system.</p>\n<p>The createWindow function defines the properties of the program window that the user will see. There are many more window options that faciliate additional customization, child windows, modals, etc.</p>\n<p>Notice we are loading the window by pointing it to the index.html file in the dist/ folder. Do NOT confuse this with the index file in the src/ folder. At this point, this file does not exist, but it will be created automatically in the next step by running ng build –prod</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; app, BrowserWindow &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> win;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createWindow</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  win = <span class=\"keyword\">new</span> BrowserWindow(&#123;</span><br><span class=\"line\">    width: <span class=\"number\">600</span>,</span><br><span class=\"line\">    height: <span class=\"number\">600</span>,</span><br><span class=\"line\">    backgroundColor: <span class=\"string\">'#ffffff'</span>,</span><br><span class=\"line\">    icon: <span class=\"string\">`file://<span class=\"subst\">$&#123;__dirname&#125;</span>/dist/assets/logo.png`</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  win.loadURL(<span class=\"string\">`file://<span class=\"subst\">$&#123;__dirname&#125;</span>/dist/index.html`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  win.on(<span class=\"string\">'closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    win = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'ready'</span>, createWindow)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'window-all-closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.platform !== <span class=\"string\">'darwin'</span>) &#123;</span><br><span class=\"line\">    app.quit()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'activate'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (win === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    createWindow()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>That’s it for the Electron setup, all the desktop app magic is happens under the hood.</p>\n<h1 id=\"Custom-Build-Command\"><a href=\"#Custom-Build-Command\" class=\"headerlink\" title=\"Custom Build Command\"></a>Custom Build Command</h1><p>The deployed desktop app will be an Angular AOT build - this happens by default when you run ng build –prod. It’s useful to have a command that will run an AOT production build and start Electron at the same time. This can be easily configured in the package.json file.</p>\n<h1 id=\"package-json\"><a href=\"#package-json\" class=\"headerlink\" title=\"package.json\"></a>package.json</h1><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"angular-electron\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"MIT\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"main\"</span>: <span class=\"string\">\"main.js\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"ng\"</span>: <span class=\"string\">\"ng\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"ng serve\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"ng build\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"test\"</span>: <span class=\"string\">\"ng test\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"lint\"</span>: <span class=\"string\">\"ng lint\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"e2e\"</span>: <span class=\"string\">\"ng e2e\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron\"</span>: <span class=\"string\">\"electron .\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron-build\"</span>: <span class=\"string\">\"ng build --prod &amp;&amp; electron .\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"Run-the-command\"><a href=\"#Run-the-command\" class=\"headerlink\" title=\"Run the command\"></a>Run the command</h1><p>You can run your angular app as an native desktop app with the following command.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run electron-build</span><br></pre></td></tr></table></figure>\n<p>At this point, you can run the command (it will take a few seconds) and it will create the dist/ folder and will automatically bring up a window on your operating system with default Angular app.</p>\n<p>This setup does not support hot code reloads. Whenever you change some Angular code, you need to rerun the electron-build command. It is possible to setup hot reloads by pointing the window to a remote URL (such as <a href=\"https://localhost:4200\" target=\"_blank\" rel=\"noopener\">https://localhost:4200</a>) and running ng serve in a separate terminal.</p>\n<h1 id=\"Building-the-Angular-App\"><a href=\"#Building-the-Angular-App\" class=\"headerlink\" title=\"Building the Angular App\"></a>Building the Angular App</h1><p>Now we need to build an Angular App that’s worthy of being installed. I am building a single page timer that will animate a progress circle, then make a chime sound when complete.</p>\n<p><img src=\"https://angularfirebase.com/images/angular-electron-timer.gif\" alt=\"\"></p>\n<p>To keep things super simple, I am writing all the code in the app.component</p>\n<h1 id=\"Install-Round-Progress-Bar\"><a href=\"#Install-Round-Progress-Bar\" class=\"headerlink\" title=\"Install Round Progress Bar\"></a>Install Round Progress Bar</h1><p>To get the progress timer looking good quickly, I installed the angular-svg-round-progressbar package. It gives us a pre-built component that we can animate based on the current state of the timer.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install angular-svg-round-progressbar --save</span><br></pre></td></tr></table></figure>\n<p>Then add it to the app.module.ts (also add the FormsModule).</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; BrowserModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/platform-browser'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; NgModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; AppComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./app.component'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; FormsModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/forms'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; RoundProgressModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'angular-svg-round-progressbar'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  declarations: [</span><br><span class=\"line\">    AppComponent</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  imports: [</span><br><span class=\"line\">    BrowserModule,</span><br><span class=\"line\">    FormsModule,</span><br><span class=\"line\">    RoundProgressModule</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  providers: [],</span><br><span class=\"line\">  bootstrap: [AppComponent]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"app-component-ts\"><a href=\"#app-component-ts\" class=\"headerlink\" title=\"app.component.ts\"></a>app.component.ts</h1><p>The app works by allowing the user to set the number of seconds the timer will run max. The timer progresses by running an RxJS Observable interval every 10th of a second and incrementing the current value.</p>\n<p>I also defined several getters help deal with NaN values that can cause errors in the progress circle. They also help keep the HTML logic clean and readable.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component, OnInit &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/observable/interval'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/map'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/takeWhile'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/do'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'app-root'</span>,</span><br><span class=\"line\">  templateUrl: <span class=\"string\">'./app.component.html'</span>,</span><br><span class=\"line\">  styleUrls: [<span class=\"string\">'./app.component.scss'</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppComponent &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  max     = <span class=\"number\">1</span>;</span><br><span class=\"line\">  current = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  start() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> interval = Observable.interval(<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        interval</span><br><span class=\"line\">          .takeWhile(_ =&gt; !<span class=\"keyword\">this</span>.isFinished )</span><br><span class=\"line\">          .do(<span class=\"function\"><span class=\"params\">i</span> =&gt;</span> <span class=\"keyword\">this</span>.current += <span class=\"number\">0.1</span>)</span><br><span class=\"line\">          .subscribe();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  finish() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.current = <span class=\"keyword\">this</span>.max;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  reset() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.current = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> maxVal() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">isNaN</span>(<span class=\"keyword\">this</span>.max) || <span class=\"keyword\">this</span>.max &lt; <span class=\"number\">0.1</span> ? <span class=\"number\">0.1</span> : <span class=\"keyword\">this</span>.max;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> currentVal() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">isNaN</span>(<span class=\"keyword\">this</span>.current) || <span class=\"keyword\">this</span>.current &lt; <span class=\"number\">0</span> ? <span class=\"number\">0</span> : <span class=\"keyword\">this</span>.current;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> isFinished() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.currentVal &gt;= <span class=\"keyword\">this</span>.maxVal;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"app-component-html\"><a href=\"#app-component-html\" class=\"headerlink\" title=\"app.component.html\"></a>app.component.html</h1><p>In the HTML, we can declare the progress component and display the user interface elements conditionally based on the state of the timer.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">main</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Electron Timer<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"progress-wrapper\"</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"maxVal\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"text\"</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"!isFinished\"</span>&gt;</span></span><br><span class=\"line\">          &#123;&#123; max - current | number: '1.1-1' &#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"text\"</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"isFinished\"</span>&gt;</span></span><br><span class=\"line\">            ding!</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">audio</span> <span class=\"attr\">src</span>=<span class=\"string\">\"assets/chime.mp3\"</span> <span class=\"attr\">autoplay</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">audio</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">round-progress</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">max</span>]=<span class=\"string\">\"max\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">current</span>]=<span class=\"string\">\"current\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">radius</span>]=<span class=\"string\">\"100\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">stroke</span>]=<span class=\"string\">\"25\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">round-progress</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"controls-wrapper\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Seconds<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">\"input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"number of seconds\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span></span></span><br><span class=\"line\"><span class=\"tag\">              [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">\"max\"</span></span></span><br><span class=\"line\"><span class=\"tag\">              (<span class=\"attr\">keydown</span>)=<span class=\"string\">\"reset()\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"currentVal &lt;= 0\"</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"start()\"</span>&gt;</span>Start<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"!isFinished\"</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"finish()\"</span>&gt;</span>Finish<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"Packaging-for-Desktop-Operating-Systems\"><a href=\"#Packaging-for-Desktop-Operating-Systems\" class=\"headerlink\" title=\"Packaging for Desktop Operating Systems\"></a>Packaging for Desktop Operating Systems</h1><p>Now that we have a decent app ready for desktops, we need to package and distribute it. The electron packager tool will allow to package our code into an executable for desktop platforms - including Windows (win32), MacOS (darwin), and Linux. Keep in mind, there are several other electron packaging tools that might better fit your needs.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install electron-packager -g</span><br><span class=\"line\">npm install electron-packager --save-dev</span><br></pre></td></tr></table></figure>\n<p>Linux and MacOS developers will need to install WineHQ if they plan on building desktop apps for Windows.</p>\n<p>In this example, I am going to build an executable for Windows.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">electron-packager . --platform=win32</span><br></pre></td></tr></table></figure>\n<p>This will generate a directory /angular-electron-win32-x64/ that contains the executable file.</p>\n<p>And why not build one for MacOS while we’re at it.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">electron-packager . --platform=darwin</span><br></pre></td></tr></table></figure>\n<p>This will generate a directory /angular-electron-darwin-x64/ that contains the app. Zip it and extract it on a mac system and you should be able to run it natively. You will get warnings that it’s from an unknown developer, but this is expected and it’s perfectly safe to open - it’s your own code after all.</p>\n<h1 id=\"The-End\"><a href=\"#The-End\" class=\"headerlink\" title=\"The End\"></a>The End</h1><p>That’s it for the basic setup with Electron with Angular. In the future, I will post some more advanced examples of these technologies in action.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>In this lesson, you will learn how to build native desktop apps with Angular and Electron. You might be surprised how easy it is to start building high-quality desktop apps for any platform, or even port your existing Angular app to native desktop platforms.<br>通过本文，你可以学到如何使用Angular和Electron构建桌面应用。</p>\n<p>This lesson covers the following topics:</p>\n<ol>\n<li>Configure Electron 1.7 with Angular 4.x.</li>\n<li>Build a simple timer app in Angular.</li>\n<li>Package the app for install on Windows 10, macOS, and Linux Ubuntu.</li>\n</ol>\n<p>You can obtain the <a href=\"https://github.com/AngularFirebase/angular-electron\" target=\"_blank\" rel=\"noopener\">source code</a> for this project on Github.</p>\n<p><img src=\"https://angularfirebase.com/images/electron-angular-macos.gif\" alt=\"\"></p>\n<h1 id=\"Initial-Setup\"><a href=\"#Initial-Setup\" class=\"headerlink\" title=\"Initial Setup\"></a>Initial Setup</h1><p>Let’s kick things off by building a new angular app from scratch.</p>\n<h1 id=\"Generate-the-Angular-App\"><a href=\"#Generate-the-Angular-App\" class=\"headerlink\" title=\"Generate the Angular App\"></a>Generate the Angular App</h1><p>Generate a default app with the Angular CLI.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g @angular/cli</span><br><span class=\"line\">ng new angular-electron</span><br><span class=\"line\">cd angular-electron</span><br></pre></td></tr></table></figure>\n<h1 id=\"Update-index-html\"><a href=\"#Update-index-html\" class=\"headerlink\" title=\"Update index.html\"></a>Update index.html</h1><p>The generated root page in Angular points the base href to <code>/</code> - this will cause problems with Electron later on, so let’s update it now. Just add a period in front of the slash in <code>src/index.html</code>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;base href=&quot;./&quot;&gt;</span><br></pre></td></tr></table></figure>\n<h1 id=\"Install-Electron\"><a href=\"#Install-Electron\" class=\"headerlink\" title=\"Install Electron\"></a>Install Electron</h1><p>You can install Electron in the Angular development environment.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install electron --save-dev</span><br></pre></td></tr></table></figure>\n<h1 id=\"Configure-Electron\"><a href=\"#Configure-Electron\" class=\"headerlink\" title=\"Configure Electron\"></a>Configure Electron</h1><p>The next step is to configure Electron. There are all sorts of possibilities for customization and we’re just scratching the surface.</p>\n<h1 id=\"main-js\"><a href=\"#main-js\" class=\"headerlink\" title=\"main.js\"></a>main.js</h1><p>Create a new file named main.js in the root of your project - this is the Electron NodeJS backend. This is the entry point for Electron and defines how our desktop app will react to various events performed via the desktop operating system.</p>\n<p>The createWindow function defines the properties of the program window that the user will see. There are many more window options that faciliate additional customization, child windows, modals, etc.</p>\n<p>Notice we are loading the window by pointing it to the index.html file in the dist/ folder. Do NOT confuse this with the index file in the src/ folder. At this point, this file does not exist, but it will be created automatically in the next step by running ng build –prod</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; app, BrowserWindow &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'electron'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> win;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createWindow</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  win = <span class=\"keyword\">new</span> BrowserWindow(&#123;</span><br><span class=\"line\">    width: <span class=\"number\">600</span>,</span><br><span class=\"line\">    height: <span class=\"number\">600</span>,</span><br><span class=\"line\">    backgroundColor: <span class=\"string\">'#ffffff'</span>,</span><br><span class=\"line\">    icon: <span class=\"string\">`file://<span class=\"subst\">$&#123;__dirname&#125;</span>/dist/assets/logo.png`</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  win.loadURL(<span class=\"string\">`file://<span class=\"subst\">$&#123;__dirname&#125;</span>/dist/index.html`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  win.on(<span class=\"string\">'closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    win = <span class=\"literal\">null</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'ready'</span>, createWindow)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'window-all-closed'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.platform !== <span class=\"string\">'darwin'</span>) &#123;</span><br><span class=\"line\">    app.quit()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(<span class=\"string\">'activate'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (win === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    createWindow()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>That’s it for the Electron setup, all the desktop app magic is happens under the hood.</p>\n<h1 id=\"Custom-Build-Command\"><a href=\"#Custom-Build-Command\" class=\"headerlink\" title=\"Custom Build Command\"></a>Custom Build Command</h1><p>The deployed desktop app will be an Angular AOT build - this happens by default when you run ng build –prod. It’s useful to have a command that will run an AOT production build and start Electron at the same time. This can be easily configured in the package.json file.</p>\n<h1 id=\"package-json\"><a href=\"#package-json\" class=\"headerlink\" title=\"package.json\"></a>package.json</h1><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"angular-electron\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"MIT\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"main\"</span>: <span class=\"string\">\"main.js\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"ng\"</span>: <span class=\"string\">\"ng\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"start\"</span>: <span class=\"string\">\"ng serve\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"ng build\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"test\"</span>: <span class=\"string\">\"ng test\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"lint\"</span>: <span class=\"string\">\"ng lint\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"e2e\"</span>: <span class=\"string\">\"ng e2e\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron\"</span>: <span class=\"string\">\"electron .\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"electron-build\"</span>: <span class=\"string\">\"ng build --prod &amp;&amp; electron .\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"Run-the-command\"><a href=\"#Run-the-command\" class=\"headerlink\" title=\"Run the command\"></a>Run the command</h1><p>You can run your angular app as an native desktop app with the following command.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run electron-build</span><br></pre></td></tr></table></figure>\n<p>At this point, you can run the command (it will take a few seconds) and it will create the dist/ folder and will automatically bring up a window on your operating system with default Angular app.</p>\n<p>This setup does not support hot code reloads. Whenever you change some Angular code, you need to rerun the electron-build command. It is possible to setup hot reloads by pointing the window to a remote URL (such as <a href=\"https://localhost:4200\" target=\"_blank\" rel=\"noopener\">https://localhost:4200</a>) and running ng serve in a separate terminal.</p>\n<h1 id=\"Building-the-Angular-App\"><a href=\"#Building-the-Angular-App\" class=\"headerlink\" title=\"Building the Angular App\"></a>Building the Angular App</h1><p>Now we need to build an Angular App that’s worthy of being installed. I am building a single page timer that will animate a progress circle, then make a chime sound when complete.</p>\n<p><img src=\"https://angularfirebase.com/images/angular-electron-timer.gif\" alt=\"\"></p>\n<p>To keep things super simple, I am writing all the code in the app.component</p>\n<h1 id=\"Install-Round-Progress-Bar\"><a href=\"#Install-Round-Progress-Bar\" class=\"headerlink\" title=\"Install Round Progress Bar\"></a>Install Round Progress Bar</h1><p>To get the progress timer looking good quickly, I installed the angular-svg-round-progressbar package. It gives us a pre-built component that we can animate based on the current state of the timer.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install angular-svg-round-progressbar --save</span><br></pre></td></tr></table></figure>\n<p>Then add it to the app.module.ts (also add the FormsModule).</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; BrowserModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/platform-browser'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; NgModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; AppComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./app.component'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; FormsModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/forms'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; RoundProgressModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">'angular-svg-round-progressbar'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  declarations: [</span><br><span class=\"line\">    AppComponent</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  imports: [</span><br><span class=\"line\">    BrowserModule,</span><br><span class=\"line\">    FormsModule,</span><br><span class=\"line\">    RoundProgressModule</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  providers: [],</span><br><span class=\"line\">  bootstrap: [AppComponent]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"app-component-ts\"><a href=\"#app-component-ts\" class=\"headerlink\" title=\"app.component.ts\"></a>app.component.ts</h1><p>The app works by allowing the user to set the number of seconds the timer will run max. The timer progresses by running an RxJS Observable interval every 10th of a second and incrementing the current value.</p>\n<p>I also defined several getters help deal with NaN values that can cause errors in the progress circle. They also help keep the HTML logic clean and readable.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Component, OnInit &#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Observable &#125; <span class=\"keyword\">from</span> <span class=\"string\">'rxjs/Observable'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/observable/interval'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/map'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/takeWhile'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'rxjs/add/operator/do'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'app-root'</span>,</span><br><span class=\"line\">  templateUrl: <span class=\"string\">'./app.component.html'</span>,</span><br><span class=\"line\">  styleUrls: [<span class=\"string\">'./app.component.scss'</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> AppComponent &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  max     = <span class=\"number\">1</span>;</span><br><span class=\"line\">  current = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  start() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> interval = Observable.interval(<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        interval</span><br><span class=\"line\">          .takeWhile(_ =&gt; !<span class=\"keyword\">this</span>.isFinished )</span><br><span class=\"line\">          .do(<span class=\"function\"><span class=\"params\">i</span> =&gt;</span> <span class=\"keyword\">this</span>.current += <span class=\"number\">0.1</span>)</span><br><span class=\"line\">          .subscribe();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  finish() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.current = <span class=\"keyword\">this</span>.max;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  reset() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.current = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> maxVal() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">isNaN</span>(<span class=\"keyword\">this</span>.max) || <span class=\"keyword\">this</span>.max &lt; <span class=\"number\">0.1</span> ? <span class=\"number\">0.1</span> : <span class=\"keyword\">this</span>.max;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> currentVal() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">isNaN</span>(<span class=\"keyword\">this</span>.current) || <span class=\"keyword\">this</span>.current &lt; <span class=\"number\">0</span> ? <span class=\"number\">0</span> : <span class=\"keyword\">this</span>.current;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">get</span> isFinished() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.currentVal &gt;= <span class=\"keyword\">this</span>.maxVal;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"app-component-html\"><a href=\"#app-component-html\" class=\"headerlink\" title=\"app.component.html\"></a>app.component.html</h1><p>In the HTML, we can declare the progress component and display the user interface elements conditionally based on the state of the timer.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">main</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Electron Timer<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"progress-wrapper\"</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"maxVal\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"text\"</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"!isFinished\"</span>&gt;</span></span><br><span class=\"line\">          &#123;&#123; max - current | number: '1.1-1' &#125;&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"text\"</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"isFinished\"</span>&gt;</span></span><br><span class=\"line\">            ding!</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">audio</span> <span class=\"attr\">src</span>=<span class=\"string\">\"assets/chime.mp3\"</span> <span class=\"attr\">autoplay</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">audio</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">round-progress</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">max</span>]=<span class=\"string\">\"max\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">current</span>]=<span class=\"string\">\"current\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">radius</span>]=<span class=\"string\">\"100\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                [<span class=\"attr\">stroke</span>]=<span class=\"string\">\"25\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">round-progress</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"controls-wrapper\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span>&gt;</span>Seconds<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">class</span>=<span class=\"string\">\"input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"number of seconds\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span></span></span><br><span class=\"line\"><span class=\"tag\">              [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">\"max\"</span></span></span><br><span class=\"line\"><span class=\"tag\">              (<span class=\"attr\">keydown</span>)=<span class=\"string\">\"reset()\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"currentVal &lt;= 0\"</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"start()\"</span>&gt;</span>Start<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">\"!isFinished\"</span> (<span class=\"attr\">click</span>)=<span class=\"string\">\"finish()\"</span>&gt;</span>Finish<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"Packaging-for-Desktop-Operating-Systems\"><a href=\"#Packaging-for-Desktop-Operating-Systems\" class=\"headerlink\" title=\"Packaging for Desktop Operating Systems\"></a>Packaging for Desktop Operating Systems</h1><p>Now that we have a decent app ready for desktops, we need to package and distribute it. The electron packager tool will allow to package our code into an executable for desktop platforms - including Windows (win32), MacOS (darwin), and Linux. Keep in mind, there are several other electron packaging tools that might better fit your needs.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install electron-packager -g</span><br><span class=\"line\">npm install electron-packager --save-dev</span><br></pre></td></tr></table></figure>\n<p>Linux and MacOS developers will need to install WineHQ if they plan on building desktop apps for Windows.</p>\n<p>In this example, I am going to build an executable for Windows.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">electron-packager . --platform=win32</span><br></pre></td></tr></table></figure>\n<p>This will generate a directory /angular-electron-win32-x64/ that contains the executable file.</p>\n<p>And why not build one for MacOS while we’re at it.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">electron-packager . --platform=darwin</span><br></pre></td></tr></table></figure>\n<p>This will generate a directory /angular-electron-darwin-x64/ that contains the app. Zip it and extract it on a mac system and you should be able to run it natively. You will get warnings that it’s from an unknown developer, but this is expected and it’s perfectly safe to open - it’s your own code after all.</p>\n<h1 id=\"The-End\"><a href=\"#The-End\" class=\"headerlink\" title=\"The End\"></a>The End</h1><p>That’s it for the basic setup with Electron with Angular. In the future, I will post some more advanced examples of these technologies in action.</p>\n"},{"title":"Spring常用Annotation详解","date":"2018-01-26T01:16:06.000Z","_content":"\n\n# Annotation介绍\n\n---\n\n\n# Spring项目开发常用Annotation\n\n## Java\n### @Resource\nResource 注释标记应用程序所需的资源。此注释可以应用于应用程序组件类，或者该组件类的字段或方法。如果将该注释应用于一个字段或方法，那么初始化应用程序组件时容器将把所请求资源的一个实例注入其中。如果将该注释应用于组件类，则该注释将声明一个应用程序在运行时将查找的资源。\n\n即使此注释没有被标记为Inherited，部署工具仍然需要检查任意组件类的所有超类，以发现这些超类中所有使用此注释的地方。所有此类注释实例都指定了应用程序组件所需的资源。注意，此注释可能出现在超类的 private 字段和方法上；在这种情况下容器也需要执行注入操作。\n\n在Spring中使用该注解，表示按name注入。\n\n\n## Spring\n### @Required\n此注解用于JavaBean的setter方法上，表示此属性是必须的，必须在配置阶段注入，否则会抛出`BeanInitializationException`。\n\n### @Autowired\n此注解用于构造方法、字段、setter方法和注解类型。显示声明依赖，根据type来autowiring, 默认注入是必须的。\n\n```java\n@Target({ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.ANNOTATION_TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Autowired {\n\n\t/**\n\t * Declares whether the annotated dependency is required.\n\t * <p>Defaults to {@code true}.\n\t */\n\tboolean required() default true;\n\n}\n```\n\n在构造方法上使用此注解时，需要注意的是，一个类只允许有一个构造方法使用此注解。==此外，在Spring4.3后，如果一个类仅仅只有一个构造方法，那么即使不使用此注解，spring也会自动注入相关的bean。==\n\n```\n@Componentpublic class User {\n    private Address address;\n    public User(Address address) {\n        this.address=address;     \n    }\n    \n}\n\n<bean id=\"user\" class=\"xx.User\"/>\n```\n\n\n### @Qualifier\n此注解是和`@Autowired`一起使用的。使用此注解可以让你对注入的过程有更多的控制，用@Qulifier指定要绑定的bean的名称。当一个type有多个bean时，使用@Autowired的时候需要配合上@Qulifier才能正常。\n\n\n```\n@Componentpublic class User {\n    @Autowired    \n    @Qualifier(\"address1\")    \n    private Address address;    \n    \n    ...\n    \n}\n```\n\n\n### @Configuration\n此注解一般和@Configuration注解一起使用，指定Spring扫描注解的package。如果没有指定包，那么默认会扫描此配置类所在的package。\n\n```\n@Configuartion\npublic class SpringCoreConfig {\n    @Bean    \n    public AdminUser adminUser() {\n        AdminUser adminUser = new AdminUser();\n        return adminUser;    \n        \n    }\n    \n}\n```\n\n### @Lazy\n此注解使用在Spring的组件类上。默认的，Spring中Bean的依赖一开始就被创建和配置。如果想要延迟初始化一个bean，那么可以在此类上使用Lazy注解，表示此bean只有在第一次被使用的时候才会被创建和初始化。此注解也可以使用在被@Configuration注解的类上，表示其中所有被@Bean注解的方法都会延迟初始化。\n\n### @Value\n此注解使用在字段、构造器参数和方法参数上。@Value可以指定属性取值的表达式，支持通过#{}使用SpringEL来取值，也支持使用${}来将属性来源中(Properties文件呢、本地环境变量、系统属性等)的值注入到bean的属性中。此注解的注入时发生在AutowiredAnnotationBeanPostProcessor中。\n\n## Stereotype注解\n### @Component\n此注解使用在class上来声明一个Spring组件(Bean), 将其加入到应用上下文中。\n### @Controller\n此注解使用在class上声明此类是一个Spring controller，是@Component注解的一种具体形式。\n### @Service\n此注解使用在class上，声明此类是一个服务类，执行业务逻辑、计算、调用内部api等。是@Component注解的一种具体形式。\n### @Repository\n此类使用在class上声明此类用于访问数据库，一般作为DAO的角色。\n此注解有自动翻译的特性，例如：当此种component抛出了一个异常，那么会有一个handler来处理此异常，无需使用try-catch块。\n\n## Spring Boot注解\n### @EnableAutoConfiguration\n此注解通常被用在主应用class上，告诉`Spring Boot` 自动基于当前包添加Bean、对bean的属性进行设置等。\n### @SpringBootApplication\n此注解用在Spring Boot项目的应用主类上（此类需要在base package中）。使用了此注解的类首先会让Spring Boot启动对base package下以及其sub-pacakages的类进行component scan。\n\n此注解同时添加了以下几个注解：\n- @Configuration\n- @EnableAutoConfiguration\n- @ComponentScan\n\n\n## Spring MVC和REST注解\n### @Controller\n上述已经提到过此注解。\n### @RequestMapping\n\n此注解可以用在class和method上，用来映射web请求到某一个handler类或者handler方法上。当此注解用在Class上时，就创造了一个基础url，其所有的方法上的@RequestMapping都是在此url之上的。\n\n可以使用其method属性来限制请求匹配的http method。\n\n此外，Spring4.3之后引入了一系列@RequestMapping的变种。如下：c\n- @GetMapping\n- @PostMapping\n- @PutMapping\n- @PatchMapping\n- @DeleteMapping\n\n分别对应了相应method的RequestMapping配置。\n\n### @CrossOrigin\n此注解用在class和method上用来支持跨域请求，是Spring 4.2后引入的。\n\n```\nCrossOrigin(maxAge = 3600)\n@RestController\n@RequestMapping(\"/users\")\npublic class AccountController {    \n    @CrossOrigin(origins = \"http://xx.com\")\n    @RequestMapping(\"/login\")\n    public Result userLogin() {\n        // ...    \n        \n    }\n    \n}\n```\n### @ExceptionHandler\n此注解使用在方法级别，声明对Exception的处理逻辑。可以指定目标Exception。\n### @InitBinder\n此注解使用在方法上，声明对WebDataBinder的初始化(绑定请求参数到JavaBean上的DataBinder)。在controller上使用此注解可以自定义请求参数的绑定。\n### @MatrixVariable\n此注解使用在请求handler方法的参数上，Spring可以注入matrix url中相关的值。这里的矩阵变量可以出现在url中的任何地方，变量之间用;分隔。如下：\n\n\n```\n// GET /pets/42;q=11;r=22@RequestMapping(value = \"/pets/{petId}\")public void findPet(@PathVariable String petId, @MatrixVariable int q) {    // petId == 42    // q == 11}\n```\n需要注意的是默认Spring mvc是不支持矩阵变量的，需要开启。\n\n```xml\n<mvc:annotation-driven enable-matrix-variables=\"true\" />\n```\n\n注解配置则需要如下开启：\n\n```\n@Configurationpublic class WebConfig extends WebMvcConfigurerAdapter {     @Override    public void configurePathMatch(PathMatchConfigurer configurer) {        UrlPathHelper urlPathHelper = new UrlPathHelper();        urlPathHelper.setRemoveSemicolonContent(false);        configurer.setUrlPathHelper(urlPathHelper);    }}\n```\n### @PathVariable\n此注解使用在请求handler方法的参数上。@RequestMapping可以定义动态路径，如:\n\n\n```\nRequestMapping(\"/users/{uid}\")\npublic String execute(@PathVariable(\"uid\") String uid){\n}\n```\n\n### @RequestAttribute\n此注解用在请求handler方法的参数上，用于将web请求中的属性(requst attributes，是服务器放入的属性值)绑定到方法参数上。\n### @RequestBody\n此注解用在请求handler方法的参数上，用于将http请求的Body映射绑定到此参数上。HttpMessageConverter负责将对象转换为http请求。\n### @RequestHeader\n此注解用在请求handler方法的参数上，用于将http请求头部的值绑定到参数上。\n### @RequestParam\n此注解用在请求handler方法的参数上，用于将http请求参数的值绑定到参数上。\n### @RequestPart\n此注解用在请求handler方法的参数上，用于将文件之类的multipart绑定到参数上。\n### @ResponseBody\n此注解用在请求handler方法上。和@RequestBody作用类似，用于将方法的返回对象直接输出到http响应中。\n### @ResponseStatus\n此注解用于方法和exception类上，声明此方法或者异常类返回的http状态码。可以在Controller上使用此注解，这样所有的@RequestMapping都会继承。\n### @ControllerAdvice\n此注解用于class上。前面说过可以对每一个controller声明一个ExceptionMethod。这里可以使用@ControllerAdvice来声明一个类来统一对所有@RequestMapping方法来做@ExceptionHandler, @InitBinder, and @ModelAttribute处理。\n### @RestController\n此注解用于class上，声明此controller返回的不是一个视图而是一个领域对象。其同时引入了@Controller and @ResponseBody两个注解。\n### @RestControllerAdvice\n此注解用于class上，同时引入了@ControllerAdvice and @ResponseBody两个注解。\n### @SessionAttribute\n此注解用于方法的参数上，用于将session中的属性绑定到参数。\n### @SessionAttributes\n此注解用于type级别，用于将JavaBean对象存储到session中。一般和@ModelAttribute注解一起使用。如下：\n\n```\n@ModelAttribute(\"user\")\npublic PUser getUser() {}\n\n// controller和上面的代码在同一controller中\n@Controller\n@SessionAttributes(value = \"user\", types = {\n    User.class\n})\npublic class UserController {}\n```\n\n\n## 数据访问注解\n### @Transactional\n此注解使用在接口定义、接口中的方法、类定义或者类中的public方法上。需要注意的是此注解并不激活事务行为，它仅仅是一个元数据，会被一些运行时基础设施来消费。\n## 任务执行、调度注解\n### @Scheduled\n此注解使用在方法上，声明此方法被定时调度。使用了此注解的方法返回类型需要是Void，并且不能接受任何参数。\n\n```\n@Scheduled(fixedDelay=1000)\npublic void schedule() {}\n\n@Scheduled(fixedRate=1000)\npublic void schedulg() {\n}\n```\n\n第二个与第一个不同之处在于其不会等待上一次的任务执行结束。\n### @Async\n此注解使用在方法上，声明此方法会在一个单独的线程中执行。不同于Scheduled注解，此注解可以接受参数。\n使用此注解的方法的返回类型可以是Void也可是返回值。但是返回值的类型必须是一个Future。\n## 测试注解\n### @ContextConfiguration\n此注解使用在Class上，声明测试使用的配置文件，此外，也可以指定加载上下文的类。\n\n此注解一般需要搭配SpringJUnit4ClassRunner使用。\n\n```\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(classes = SpringCoreConfig.class)\npublic class UserServiceTest {}\n```\n\n","source":"_posts/spring-annotation.md","raw":"---\ntitle: Spring常用Annotation详解\ndate: 2018-01-26 09:16:06\ntags: [spring]\n---\n\n\n# Annotation介绍\n\n---\n\n\n# Spring项目开发常用Annotation\n\n## Java\n### @Resource\nResource 注释标记应用程序所需的资源。此注释可以应用于应用程序组件类，或者该组件类的字段或方法。如果将该注释应用于一个字段或方法，那么初始化应用程序组件时容器将把所请求资源的一个实例注入其中。如果将该注释应用于组件类，则该注释将声明一个应用程序在运行时将查找的资源。\n\n即使此注释没有被标记为Inherited，部署工具仍然需要检查任意组件类的所有超类，以发现这些超类中所有使用此注释的地方。所有此类注释实例都指定了应用程序组件所需的资源。注意，此注释可能出现在超类的 private 字段和方法上；在这种情况下容器也需要执行注入操作。\n\n在Spring中使用该注解，表示按name注入。\n\n\n## Spring\n### @Required\n此注解用于JavaBean的setter方法上，表示此属性是必须的，必须在配置阶段注入，否则会抛出`BeanInitializationException`。\n\n### @Autowired\n此注解用于构造方法、字段、setter方法和注解类型。显示声明依赖，根据type来autowiring, 默认注入是必须的。\n\n```java\n@Target({ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.ANNOTATION_TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Autowired {\n\n\t/**\n\t * Declares whether the annotated dependency is required.\n\t * <p>Defaults to {@code true}.\n\t */\n\tboolean required() default true;\n\n}\n```\n\n在构造方法上使用此注解时，需要注意的是，一个类只允许有一个构造方法使用此注解。==此外，在Spring4.3后，如果一个类仅仅只有一个构造方法，那么即使不使用此注解，spring也会自动注入相关的bean。==\n\n```\n@Componentpublic class User {\n    private Address address;\n    public User(Address address) {\n        this.address=address;     \n    }\n    \n}\n\n<bean id=\"user\" class=\"xx.User\"/>\n```\n\n\n### @Qualifier\n此注解是和`@Autowired`一起使用的。使用此注解可以让你对注入的过程有更多的控制，用@Qulifier指定要绑定的bean的名称。当一个type有多个bean时，使用@Autowired的时候需要配合上@Qulifier才能正常。\n\n\n```\n@Componentpublic class User {\n    @Autowired    \n    @Qualifier(\"address1\")    \n    private Address address;    \n    \n    ...\n    \n}\n```\n\n\n### @Configuration\n此注解一般和@Configuration注解一起使用，指定Spring扫描注解的package。如果没有指定包，那么默认会扫描此配置类所在的package。\n\n```\n@Configuartion\npublic class SpringCoreConfig {\n    @Bean    \n    public AdminUser adminUser() {\n        AdminUser adminUser = new AdminUser();\n        return adminUser;    \n        \n    }\n    \n}\n```\n\n### @Lazy\n此注解使用在Spring的组件类上。默认的，Spring中Bean的依赖一开始就被创建和配置。如果想要延迟初始化一个bean，那么可以在此类上使用Lazy注解，表示此bean只有在第一次被使用的时候才会被创建和初始化。此注解也可以使用在被@Configuration注解的类上，表示其中所有被@Bean注解的方法都会延迟初始化。\n\n### @Value\n此注解使用在字段、构造器参数和方法参数上。@Value可以指定属性取值的表达式，支持通过#{}使用SpringEL来取值，也支持使用${}来将属性来源中(Properties文件呢、本地环境变量、系统属性等)的值注入到bean的属性中。此注解的注入时发生在AutowiredAnnotationBeanPostProcessor中。\n\n## Stereotype注解\n### @Component\n此注解使用在class上来声明一个Spring组件(Bean), 将其加入到应用上下文中。\n### @Controller\n此注解使用在class上声明此类是一个Spring controller，是@Component注解的一种具体形式。\n### @Service\n此注解使用在class上，声明此类是一个服务类，执行业务逻辑、计算、调用内部api等。是@Component注解的一种具体形式。\n### @Repository\n此类使用在class上声明此类用于访问数据库，一般作为DAO的角色。\n此注解有自动翻译的特性，例如：当此种component抛出了一个异常，那么会有一个handler来处理此异常，无需使用try-catch块。\n\n## Spring Boot注解\n### @EnableAutoConfiguration\n此注解通常被用在主应用class上，告诉`Spring Boot` 自动基于当前包添加Bean、对bean的属性进行设置等。\n### @SpringBootApplication\n此注解用在Spring Boot项目的应用主类上（此类需要在base package中）。使用了此注解的类首先会让Spring Boot启动对base package下以及其sub-pacakages的类进行component scan。\n\n此注解同时添加了以下几个注解：\n- @Configuration\n- @EnableAutoConfiguration\n- @ComponentScan\n\n\n## Spring MVC和REST注解\n### @Controller\n上述已经提到过此注解。\n### @RequestMapping\n\n此注解可以用在class和method上，用来映射web请求到某一个handler类或者handler方法上。当此注解用在Class上时，就创造了一个基础url，其所有的方法上的@RequestMapping都是在此url之上的。\n\n可以使用其method属性来限制请求匹配的http method。\n\n此外，Spring4.3之后引入了一系列@RequestMapping的变种。如下：c\n- @GetMapping\n- @PostMapping\n- @PutMapping\n- @PatchMapping\n- @DeleteMapping\n\n分别对应了相应method的RequestMapping配置。\n\n### @CrossOrigin\n此注解用在class和method上用来支持跨域请求，是Spring 4.2后引入的。\n\n```\nCrossOrigin(maxAge = 3600)\n@RestController\n@RequestMapping(\"/users\")\npublic class AccountController {    \n    @CrossOrigin(origins = \"http://xx.com\")\n    @RequestMapping(\"/login\")\n    public Result userLogin() {\n        // ...    \n        \n    }\n    \n}\n```\n### @ExceptionHandler\n此注解使用在方法级别，声明对Exception的处理逻辑。可以指定目标Exception。\n### @InitBinder\n此注解使用在方法上，声明对WebDataBinder的初始化(绑定请求参数到JavaBean上的DataBinder)。在controller上使用此注解可以自定义请求参数的绑定。\n### @MatrixVariable\n此注解使用在请求handler方法的参数上，Spring可以注入matrix url中相关的值。这里的矩阵变量可以出现在url中的任何地方，变量之间用;分隔。如下：\n\n\n```\n// GET /pets/42;q=11;r=22@RequestMapping(value = \"/pets/{petId}\")public void findPet(@PathVariable String petId, @MatrixVariable int q) {    // petId == 42    // q == 11}\n```\n需要注意的是默认Spring mvc是不支持矩阵变量的，需要开启。\n\n```xml\n<mvc:annotation-driven enable-matrix-variables=\"true\" />\n```\n\n注解配置则需要如下开启：\n\n```\n@Configurationpublic class WebConfig extends WebMvcConfigurerAdapter {     @Override    public void configurePathMatch(PathMatchConfigurer configurer) {        UrlPathHelper urlPathHelper = new UrlPathHelper();        urlPathHelper.setRemoveSemicolonContent(false);        configurer.setUrlPathHelper(urlPathHelper);    }}\n```\n### @PathVariable\n此注解使用在请求handler方法的参数上。@RequestMapping可以定义动态路径，如:\n\n\n```\nRequestMapping(\"/users/{uid}\")\npublic String execute(@PathVariable(\"uid\") String uid){\n}\n```\n\n### @RequestAttribute\n此注解用在请求handler方法的参数上，用于将web请求中的属性(requst attributes，是服务器放入的属性值)绑定到方法参数上。\n### @RequestBody\n此注解用在请求handler方法的参数上，用于将http请求的Body映射绑定到此参数上。HttpMessageConverter负责将对象转换为http请求。\n### @RequestHeader\n此注解用在请求handler方法的参数上，用于将http请求头部的值绑定到参数上。\n### @RequestParam\n此注解用在请求handler方法的参数上，用于将http请求参数的值绑定到参数上。\n### @RequestPart\n此注解用在请求handler方法的参数上，用于将文件之类的multipart绑定到参数上。\n### @ResponseBody\n此注解用在请求handler方法上。和@RequestBody作用类似，用于将方法的返回对象直接输出到http响应中。\n### @ResponseStatus\n此注解用于方法和exception类上，声明此方法或者异常类返回的http状态码。可以在Controller上使用此注解，这样所有的@RequestMapping都会继承。\n### @ControllerAdvice\n此注解用于class上。前面说过可以对每一个controller声明一个ExceptionMethod。这里可以使用@ControllerAdvice来声明一个类来统一对所有@RequestMapping方法来做@ExceptionHandler, @InitBinder, and @ModelAttribute处理。\n### @RestController\n此注解用于class上，声明此controller返回的不是一个视图而是一个领域对象。其同时引入了@Controller and @ResponseBody两个注解。\n### @RestControllerAdvice\n此注解用于class上，同时引入了@ControllerAdvice and @ResponseBody两个注解。\n### @SessionAttribute\n此注解用于方法的参数上，用于将session中的属性绑定到参数。\n### @SessionAttributes\n此注解用于type级别，用于将JavaBean对象存储到session中。一般和@ModelAttribute注解一起使用。如下：\n\n```\n@ModelAttribute(\"user\")\npublic PUser getUser() {}\n\n// controller和上面的代码在同一controller中\n@Controller\n@SessionAttributes(value = \"user\", types = {\n    User.class\n})\npublic class UserController {}\n```\n\n\n## 数据访问注解\n### @Transactional\n此注解使用在接口定义、接口中的方法、类定义或者类中的public方法上。需要注意的是此注解并不激活事务行为，它仅仅是一个元数据，会被一些运行时基础设施来消费。\n## 任务执行、调度注解\n### @Scheduled\n此注解使用在方法上，声明此方法被定时调度。使用了此注解的方法返回类型需要是Void，并且不能接受任何参数。\n\n```\n@Scheduled(fixedDelay=1000)\npublic void schedule() {}\n\n@Scheduled(fixedRate=1000)\npublic void schedulg() {\n}\n```\n\n第二个与第一个不同之处在于其不会等待上一次的任务执行结束。\n### @Async\n此注解使用在方法上，声明此方法会在一个单独的线程中执行。不同于Scheduled注解，此注解可以接受参数。\n使用此注解的方法的返回类型可以是Void也可是返回值。但是返回值的类型必须是一个Future。\n## 测试注解\n### @ContextConfiguration\n此注解使用在Class上，声明测试使用的配置文件，此外，也可以指定加载上下文的类。\n\n此注解一般需要搭配SpringJUnit4ClassRunner使用。\n\n```\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(classes = SpringCoreConfig.class)\npublic class UserServiceTest {}\n```\n\n","slug":"spring-annotation","published":1,"updated":"2018-01-26T03:24:33.008Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t83003ogcoi6s7lwr2t","content":"<h1 id=\"Annotation介绍\"><a href=\"#Annotation介绍\" class=\"headerlink\" title=\"Annotation介绍\"></a>Annotation介绍</h1><hr>\n<h1 id=\"Spring项目开发常用Annotation\"><a href=\"#Spring项目开发常用Annotation\" class=\"headerlink\" title=\"Spring项目开发常用Annotation\"></a>Spring项目开发常用Annotation</h1><h2 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h2><h3 id=\"Resource\"><a href=\"#Resource\" class=\"headerlink\" title=\"@Resource\"></a>@Resource</h3><p>Resource 注释标记应用程序所需的资源。此注释可以应用于应用程序组件类，或者该组件类的字段或方法。如果将该注释应用于一个字段或方法，那么初始化应用程序组件时容器将把所请求资源的一个实例注入其中。如果将该注释应用于组件类，则该注释将声明一个应用程序在运行时将查找的资源。</p>\n<p>即使此注释没有被标记为Inherited，部署工具仍然需要检查任意组件类的所有超类，以发现这些超类中所有使用此注释的地方。所有此类注释实例都指定了应用程序组件所需的资源。注意，此注释可能出现在超类的 private 字段和方法上；在这种情况下容器也需要执行注入操作。</p>\n<p>在Spring中使用该注解，表示按name注入。</p>\n<h2 id=\"Spring\"><a href=\"#Spring\" class=\"headerlink\" title=\"Spring\"></a>Spring</h2><h3 id=\"Required\"><a href=\"#Required\" class=\"headerlink\" title=\"@Required\"></a>@Required</h3><p>此注解用于JavaBean的setter方法上，表示此属性是必须的，必须在配置阶段注入，否则会抛出<code>BeanInitializationException</code>。</p>\n<h3 id=\"Autowired\"><a href=\"#Autowired\" class=\"headerlink\" title=\"@Autowired\"></a>@Autowired</h3><p>此注解用于构造方法、字段、setter方法和注解类型。显示声明依赖，根据type来autowiring, 默认注入是必须的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target</span>(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.ANNOTATION_TYPE&#125;)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Autowired &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Declares whether the annotated dependency is required.</span></span><br><span class=\"line\"><span class=\"comment\">\t * &lt;p&gt;Defaults to &#123;<span class=\"doctag\">@code</span> true&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">required</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"keyword\">true</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在构造方法上使用此注解时，需要注意的是，一个类只允许有一个构造方法使用此注解。==此外，在Spring4.3后，如果一个类仅仅只有一个构造方法，那么即使不使用此注解，spring也会自动注入相关的bean。==</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Componentpublic class User &#123;</span><br><span class=\"line\">    private Address address;</span><br><span class=\"line\">    public User(Address address) &#123;</span><br><span class=\"line\">        this.address=address;     </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;bean id=&quot;user&quot; class=&quot;xx.User&quot;/&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Qualifier\"><a href=\"#Qualifier\" class=\"headerlink\" title=\"@Qualifier\"></a>@Qualifier</h3><p>此注解是和<code>@Autowired</code>一起使用的。使用此注解可以让你对注入的过程有更多的控制，用@Qulifier指定要绑定的bean的名称。当一个type有多个bean时，使用@Autowired的时候需要配合上@Qulifier才能正常。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Componentpublic class User &#123;</span><br><span class=\"line\">    @Autowired    </span><br><span class=\"line\">    @Qualifier(&quot;address1&quot;)    </span><br><span class=\"line\">    private Address address;    </span><br><span class=\"line\">    </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Configuration\"><a href=\"#Configuration\" class=\"headerlink\" title=\"@Configuration\"></a>@Configuration</h3><p>此注解一般和@Configuration注解一起使用，指定Spring扫描注解的package。如果没有指定包，那么默认会扫描此配置类所在的package。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuartion</span><br><span class=\"line\">public class SpringCoreConfig &#123;</span><br><span class=\"line\">    @Bean    </span><br><span class=\"line\">    public AdminUser adminUser() &#123;</span><br><span class=\"line\">        AdminUser adminUser = new AdminUser();</span><br><span class=\"line\">        return adminUser;    </span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Lazy\"><a href=\"#Lazy\" class=\"headerlink\" title=\"@Lazy\"></a>@Lazy</h3><p>此注解使用在Spring的组件类上。默认的，Spring中Bean的依赖一开始就被创建和配置。如果想要延迟初始化一个bean，那么可以在此类上使用Lazy注解，表示此bean只有在第一次被使用的时候才会被创建和初始化。此注解也可以使用在被@Configuration注解的类上，表示其中所有被@Bean注解的方法都会延迟初始化。</p>\n<h3 id=\"Value\"><a href=\"#Value\" class=\"headerlink\" title=\"@Value\"></a>@Value</h3><p>此注解使用在字段、构造器参数和方法参数上。@Value可以指定属性取值的表达式，支持通过#{}使用SpringEL来取值，也支持使用${}来将属性来源中(Properties文件呢、本地环境变量、系统属性等)的值注入到bean的属性中。此注解的注入时发生在AutowiredAnnotationBeanPostProcessor中。</p>\n<h2 id=\"Stereotype注解\"><a href=\"#Stereotype注解\" class=\"headerlink\" title=\"Stereotype注解\"></a>Stereotype注解</h2><h3 id=\"Component\"><a href=\"#Component\" class=\"headerlink\" title=\"@Component\"></a>@Component</h3><p>此注解使用在class上来声明一个Spring组件(Bean), 将其加入到应用上下文中。</p>\n<h3 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"@Controller\"></a>@Controller</h3><p>此注解使用在class上声明此类是一个Spring controller，是@Component注解的一种具体形式。</p>\n<h3 id=\"Service\"><a href=\"#Service\" class=\"headerlink\" title=\"@Service\"></a>@Service</h3><p>此注解使用在class上，声明此类是一个服务类，执行业务逻辑、计算、调用内部api等。是@Component注解的一种具体形式。</p>\n<h3 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"@Repository\"></a>@Repository</h3><p>此类使用在class上声明此类用于访问数据库，一般作为DAO的角色。<br>此注解有自动翻译的特性，例如：当此种component抛出了一个异常，那么会有一个handler来处理此异常，无需使用try-catch块。</p>\n<h2 id=\"Spring-Boot注解\"><a href=\"#Spring-Boot注解\" class=\"headerlink\" title=\"Spring Boot注解\"></a>Spring Boot注解</h2><h3 id=\"EnableAutoConfiguration\"><a href=\"#EnableAutoConfiguration\" class=\"headerlink\" title=\"@EnableAutoConfiguration\"></a>@EnableAutoConfiguration</h3><p>此注解通常被用在主应用class上，告诉<code>Spring Boot</code> 自动基于当前包添加Bean、对bean的属性进行设置等。</p>\n<h3 id=\"SpringBootApplication\"><a href=\"#SpringBootApplication\" class=\"headerlink\" title=\"@SpringBootApplication\"></a>@SpringBootApplication</h3><p>此注解用在Spring Boot项目的应用主类上（此类需要在base package中）。使用了此注解的类首先会让Spring Boot启动对base package下以及其sub-pacakages的类进行component scan。</p>\n<p>此注解同时添加了以下几个注解：</p>\n<ul>\n<li>@Configuration</li>\n<li>@EnableAutoConfiguration</li>\n<li>@ComponentScan</li>\n</ul>\n<h2 id=\"Spring-MVC和REST注解\"><a href=\"#Spring-MVC和REST注解\" class=\"headerlink\" title=\"Spring MVC和REST注解\"></a>Spring MVC和REST注解</h2><h3 id=\"Controller-1\"><a href=\"#Controller-1\" class=\"headerlink\" title=\"@Controller\"></a>@Controller</h3><p>上述已经提到过此注解。</p>\n<h3 id=\"RequestMapping\"><a href=\"#RequestMapping\" class=\"headerlink\" title=\"@RequestMapping\"></a>@RequestMapping</h3><p>此注解可以用在class和method上，用来映射web请求到某一个handler类或者handler方法上。当此注解用在Class上时，就创造了一个基础url，其所有的方法上的@RequestMapping都是在此url之上的。</p>\n<p>可以使用其method属性来限制请求匹配的http method。</p>\n<p>此外，Spring4.3之后引入了一系列@RequestMapping的变种。如下：c</p>\n<ul>\n<li>@GetMapping</li>\n<li>@PostMapping</li>\n<li>@PutMapping</li>\n<li>@PatchMapping</li>\n<li>@DeleteMapping</li>\n</ul>\n<p>分别对应了相应method的RequestMapping配置。</p>\n<h3 id=\"CrossOrigin\"><a href=\"#CrossOrigin\" class=\"headerlink\" title=\"@CrossOrigin\"></a>@CrossOrigin</h3><p>此注解用在class和method上用来支持跨域请求，是Spring 4.2后引入的。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CrossOrigin(maxAge = 3600)</span><br><span class=\"line\">@RestController</span><br><span class=\"line\">@RequestMapping(&quot;/users&quot;)</span><br><span class=\"line\">public class AccountController &#123;    </span><br><span class=\"line\">    @CrossOrigin(origins = &quot;http://xx.com&quot;)</span><br><span class=\"line\">    @RequestMapping(&quot;/login&quot;)</span><br><span class=\"line\">    public Result userLogin() &#123;</span><br><span class=\"line\">        // ...    </span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ExceptionHandler\"><a href=\"#ExceptionHandler\" class=\"headerlink\" title=\"@ExceptionHandler\"></a>@ExceptionHandler</h3><p>此注解使用在方法级别，声明对Exception的处理逻辑。可以指定目标Exception。</p>\n<h3 id=\"InitBinder\"><a href=\"#InitBinder\" class=\"headerlink\" title=\"@InitBinder\"></a>@InitBinder</h3><p>此注解使用在方法上，声明对WebDataBinder的初始化(绑定请求参数到JavaBean上的DataBinder)。在controller上使用此注解可以自定义请求参数的绑定。</p>\n<h3 id=\"MatrixVariable\"><a href=\"#MatrixVariable\" class=\"headerlink\" title=\"@MatrixVariable\"></a>@MatrixVariable</h3><p>此注解使用在请求handler方法的参数上，Spring可以注入matrix url中相关的值。这里的矩阵变量可以出现在url中的任何地方，变量之间用;分隔。如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// GET /pets/42;q=11;r=22@RequestMapping(value = &quot;/pets/&#123;petId&#125;&quot;)public void findPet(@PathVariable String petId, @MatrixVariable int q) &#123;    // petId == 42    // q == 11&#125;</span><br></pre></td></tr></table></figure>\n<p>需要注意的是默认Spring mvc是不支持矩阵变量的，需要开启。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> <span class=\"attr\">enable-matrix-variables</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注解配置则需要如下开启：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configurationpublic class WebConfig extends WebMvcConfigurerAdapter &#123;     @Override    public void configurePathMatch(PathMatchConfigurer configurer) &#123;        UrlPathHelper urlPathHelper = new UrlPathHelper();        urlPathHelper.setRemoveSemicolonContent(false);        configurer.setUrlPathHelper(urlPathHelper);    &#125;&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"PathVariable\"><a href=\"#PathVariable\" class=\"headerlink\" title=\"@PathVariable\"></a>@PathVariable</h3><p>此注解使用在请求handler方法的参数上。@RequestMapping可以定义动态路径，如:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RequestMapping(&quot;/users/&#123;uid&#125;&quot;)</span><br><span class=\"line\">public String execute(@PathVariable(&quot;uid&quot;) String uid)&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"RequestAttribute\"><a href=\"#RequestAttribute\" class=\"headerlink\" title=\"@RequestAttribute\"></a>@RequestAttribute</h3><p>此注解用在请求handler方法的参数上，用于将web请求中的属性(requst attributes，是服务器放入的属性值)绑定到方法参数上。</p>\n<h3 id=\"RequestBody\"><a href=\"#RequestBody\" class=\"headerlink\" title=\"@RequestBody\"></a>@RequestBody</h3><p>此注解用在请求handler方法的参数上，用于将http请求的Body映射绑定到此参数上。HttpMessageConverter负责将对象转换为http请求。</p>\n<h3 id=\"RequestHeader\"><a href=\"#RequestHeader\" class=\"headerlink\" title=\"@RequestHeader\"></a>@RequestHeader</h3><p>此注解用在请求handler方法的参数上，用于将http请求头部的值绑定到参数上。</p>\n<h3 id=\"RequestParam\"><a href=\"#RequestParam\" class=\"headerlink\" title=\"@RequestParam\"></a>@RequestParam</h3><p>此注解用在请求handler方法的参数上，用于将http请求参数的值绑定到参数上。</p>\n<h3 id=\"RequestPart\"><a href=\"#RequestPart\" class=\"headerlink\" title=\"@RequestPart\"></a>@RequestPart</h3><p>此注解用在请求handler方法的参数上，用于将文件之类的multipart绑定到参数上。</p>\n<h3 id=\"ResponseBody\"><a href=\"#ResponseBody\" class=\"headerlink\" title=\"@ResponseBody\"></a>@ResponseBody</h3><p>此注解用在请求handler方法上。和@RequestBody作用类似，用于将方法的返回对象直接输出到http响应中。</p>\n<h3 id=\"ResponseStatus\"><a href=\"#ResponseStatus\" class=\"headerlink\" title=\"@ResponseStatus\"></a>@ResponseStatus</h3><p>此注解用于方法和exception类上，声明此方法或者异常类返回的http状态码。可以在Controller上使用此注解，这样所有的@RequestMapping都会继承。</p>\n<h3 id=\"ControllerAdvice\"><a href=\"#ControllerAdvice\" class=\"headerlink\" title=\"@ControllerAdvice\"></a>@ControllerAdvice</h3><p>此注解用于class上。前面说过可以对每一个controller声明一个ExceptionMethod。这里可以使用@ControllerAdvice来声明一个类来统一对所有@RequestMapping方法来做@ExceptionHandler, @InitBinder, and @ModelAttribute处理。</p>\n<h3 id=\"RestController\"><a href=\"#RestController\" class=\"headerlink\" title=\"@RestController\"></a>@RestController</h3><p>此注解用于class上，声明此controller返回的不是一个视图而是一个领域对象。其同时引入了@Controller and @ResponseBody两个注解。</p>\n<h3 id=\"RestControllerAdvice\"><a href=\"#RestControllerAdvice\" class=\"headerlink\" title=\"@RestControllerAdvice\"></a>@RestControllerAdvice</h3><p>此注解用于class上，同时引入了@ControllerAdvice and @ResponseBody两个注解。</p>\n<h3 id=\"SessionAttribute\"><a href=\"#SessionAttribute\" class=\"headerlink\" title=\"@SessionAttribute\"></a>@SessionAttribute</h3><p>此注解用于方法的参数上，用于将session中的属性绑定到参数。</p>\n<h3 id=\"SessionAttributes\"><a href=\"#SessionAttributes\" class=\"headerlink\" title=\"@SessionAttributes\"></a>@SessionAttributes</h3><p>此注解用于type级别，用于将JavaBean对象存储到session中。一般和@ModelAttribute注解一起使用。如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ModelAttribute(&quot;user&quot;)</span><br><span class=\"line\">public PUser getUser() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// controller和上面的代码在同一controller中</span><br><span class=\"line\">@Controller</span><br><span class=\"line\">@SessionAttributes(value = &quot;user&quot;, types = &#123;</span><br><span class=\"line\">    User.class</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">public class UserController &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据访问注解\"><a href=\"#数据访问注解\" class=\"headerlink\" title=\"数据访问注解\"></a>数据访问注解</h2><h3 id=\"Transactional\"><a href=\"#Transactional\" class=\"headerlink\" title=\"@Transactional\"></a>@Transactional</h3><p>此注解使用在接口定义、接口中的方法、类定义或者类中的public方法上。需要注意的是此注解并不激活事务行为，它仅仅是一个元数据，会被一些运行时基础设施来消费。</p>\n<h2 id=\"任务执行、调度注解\"><a href=\"#任务执行、调度注解\" class=\"headerlink\" title=\"任务执行、调度注解\"></a>任务执行、调度注解</h2><h3 id=\"Scheduled\"><a href=\"#Scheduled\" class=\"headerlink\" title=\"@Scheduled\"></a>@Scheduled</h3><p>此注解使用在方法上，声明此方法被定时调度。使用了此注解的方法返回类型需要是Void，并且不能接受任何参数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Scheduled(fixedDelay=1000)</span><br><span class=\"line\">public void schedule() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@Scheduled(fixedRate=1000)</span><br><span class=\"line\">public void schedulg() &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>第二个与第一个不同之处在于其不会等待上一次的任务执行结束。</p>\n<h3 id=\"Async\"><a href=\"#Async\" class=\"headerlink\" title=\"@Async\"></a>@Async</h3><p>此注解使用在方法上，声明此方法会在一个单独的线程中执行。不同于Scheduled注解，此注解可以接受参数。<br>使用此注解的方法的返回类型可以是Void也可是返回值。但是返回值的类型必须是一个Future。</p>\n<h2 id=\"测试注解\"><a href=\"#测试注解\" class=\"headerlink\" title=\"测试注解\"></a>测试注解</h2><h3 id=\"ContextConfiguration\"><a href=\"#ContextConfiguration\" class=\"headerlink\" title=\"@ContextConfiguration\"></a>@ContextConfiguration</h3><p>此注解使用在Class上，声明测试使用的配置文件，此外，也可以指定加载上下文的类。</p>\n<p>此注解一般需要搭配SpringJUnit4ClassRunner使用。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class=\"line\">@ContextConfiguration(classes = SpringCoreConfig.class)</span><br><span class=\"line\">public class UserServiceTest &#123;&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Annotation介绍\"><a href=\"#Annotation介绍\" class=\"headerlink\" title=\"Annotation介绍\"></a>Annotation介绍</h1><hr>\n<h1 id=\"Spring项目开发常用Annotation\"><a href=\"#Spring项目开发常用Annotation\" class=\"headerlink\" title=\"Spring项目开发常用Annotation\"></a>Spring项目开发常用Annotation</h1><h2 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h2><h3 id=\"Resource\"><a href=\"#Resource\" class=\"headerlink\" title=\"@Resource\"></a>@Resource</h3><p>Resource 注释标记应用程序所需的资源。此注释可以应用于应用程序组件类，或者该组件类的字段或方法。如果将该注释应用于一个字段或方法，那么初始化应用程序组件时容器将把所请求资源的一个实例注入其中。如果将该注释应用于组件类，则该注释将声明一个应用程序在运行时将查找的资源。</p>\n<p>即使此注释没有被标记为Inherited，部署工具仍然需要检查任意组件类的所有超类，以发现这些超类中所有使用此注释的地方。所有此类注释实例都指定了应用程序组件所需的资源。注意，此注释可能出现在超类的 private 字段和方法上；在这种情况下容器也需要执行注入操作。</p>\n<p>在Spring中使用该注解，表示按name注入。</p>\n<h2 id=\"Spring\"><a href=\"#Spring\" class=\"headerlink\" title=\"Spring\"></a>Spring</h2><h3 id=\"Required\"><a href=\"#Required\" class=\"headerlink\" title=\"@Required\"></a>@Required</h3><p>此注解用于JavaBean的setter方法上，表示此属性是必须的，必须在配置阶段注入，否则会抛出<code>BeanInitializationException</code>。</p>\n<h3 id=\"Autowired\"><a href=\"#Autowired\" class=\"headerlink\" title=\"@Autowired\"></a>@Autowired</h3><p>此注解用于构造方法、字段、setter方法和注解类型。显示声明依赖，根据type来autowiring, 默认注入是必须的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target</span>(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.ANNOTATION_TYPE&#125;)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Autowired &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Declares whether the annotated dependency is required.</span></span><br><span class=\"line\"><span class=\"comment\">\t * &lt;p&gt;Defaults to &#123;<span class=\"doctag\">@code</span> true&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">required</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"keyword\">true</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在构造方法上使用此注解时，需要注意的是，一个类只允许有一个构造方法使用此注解。==此外，在Spring4.3后，如果一个类仅仅只有一个构造方法，那么即使不使用此注解，spring也会自动注入相关的bean。==</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Componentpublic class User &#123;</span><br><span class=\"line\">    private Address address;</span><br><span class=\"line\">    public User(Address address) &#123;</span><br><span class=\"line\">        this.address=address;     </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;bean id=&quot;user&quot; class=&quot;xx.User&quot;/&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Qualifier\"><a href=\"#Qualifier\" class=\"headerlink\" title=\"@Qualifier\"></a>@Qualifier</h3><p>此注解是和<code>@Autowired</code>一起使用的。使用此注解可以让你对注入的过程有更多的控制，用@Qulifier指定要绑定的bean的名称。当一个type有多个bean时，使用@Autowired的时候需要配合上@Qulifier才能正常。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Componentpublic class User &#123;</span><br><span class=\"line\">    @Autowired    </span><br><span class=\"line\">    @Qualifier(&quot;address1&quot;)    </span><br><span class=\"line\">    private Address address;    </span><br><span class=\"line\">    </span><br><span class=\"line\">    ...</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Configuration\"><a href=\"#Configuration\" class=\"headerlink\" title=\"@Configuration\"></a>@Configuration</h3><p>此注解一般和@Configuration注解一起使用，指定Spring扫描注解的package。如果没有指定包，那么默认会扫描此配置类所在的package。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuartion</span><br><span class=\"line\">public class SpringCoreConfig &#123;</span><br><span class=\"line\">    @Bean    </span><br><span class=\"line\">    public AdminUser adminUser() &#123;</span><br><span class=\"line\">        AdminUser adminUser = new AdminUser();</span><br><span class=\"line\">        return adminUser;    </span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Lazy\"><a href=\"#Lazy\" class=\"headerlink\" title=\"@Lazy\"></a>@Lazy</h3><p>此注解使用在Spring的组件类上。默认的，Spring中Bean的依赖一开始就被创建和配置。如果想要延迟初始化一个bean，那么可以在此类上使用Lazy注解，表示此bean只有在第一次被使用的时候才会被创建和初始化。此注解也可以使用在被@Configuration注解的类上，表示其中所有被@Bean注解的方法都会延迟初始化。</p>\n<h3 id=\"Value\"><a href=\"#Value\" class=\"headerlink\" title=\"@Value\"></a>@Value</h3><p>此注解使用在字段、构造器参数和方法参数上。@Value可以指定属性取值的表达式，支持通过#{}使用SpringEL来取值，也支持使用${}来将属性来源中(Properties文件呢、本地环境变量、系统属性等)的值注入到bean的属性中。此注解的注入时发生在AutowiredAnnotationBeanPostProcessor中。</p>\n<h2 id=\"Stereotype注解\"><a href=\"#Stereotype注解\" class=\"headerlink\" title=\"Stereotype注解\"></a>Stereotype注解</h2><h3 id=\"Component\"><a href=\"#Component\" class=\"headerlink\" title=\"@Component\"></a>@Component</h3><p>此注解使用在class上来声明一个Spring组件(Bean), 将其加入到应用上下文中。</p>\n<h3 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"@Controller\"></a>@Controller</h3><p>此注解使用在class上声明此类是一个Spring controller，是@Component注解的一种具体形式。</p>\n<h3 id=\"Service\"><a href=\"#Service\" class=\"headerlink\" title=\"@Service\"></a>@Service</h3><p>此注解使用在class上，声明此类是一个服务类，执行业务逻辑、计算、调用内部api等。是@Component注解的一种具体形式。</p>\n<h3 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"@Repository\"></a>@Repository</h3><p>此类使用在class上声明此类用于访问数据库，一般作为DAO的角色。<br>此注解有自动翻译的特性，例如：当此种component抛出了一个异常，那么会有一个handler来处理此异常，无需使用try-catch块。</p>\n<h2 id=\"Spring-Boot注解\"><a href=\"#Spring-Boot注解\" class=\"headerlink\" title=\"Spring Boot注解\"></a>Spring Boot注解</h2><h3 id=\"EnableAutoConfiguration\"><a href=\"#EnableAutoConfiguration\" class=\"headerlink\" title=\"@EnableAutoConfiguration\"></a>@EnableAutoConfiguration</h3><p>此注解通常被用在主应用class上，告诉<code>Spring Boot</code> 自动基于当前包添加Bean、对bean的属性进行设置等。</p>\n<h3 id=\"SpringBootApplication\"><a href=\"#SpringBootApplication\" class=\"headerlink\" title=\"@SpringBootApplication\"></a>@SpringBootApplication</h3><p>此注解用在Spring Boot项目的应用主类上（此类需要在base package中）。使用了此注解的类首先会让Spring Boot启动对base package下以及其sub-pacakages的类进行component scan。</p>\n<p>此注解同时添加了以下几个注解：</p>\n<ul>\n<li>@Configuration</li>\n<li>@EnableAutoConfiguration</li>\n<li>@ComponentScan</li>\n</ul>\n<h2 id=\"Spring-MVC和REST注解\"><a href=\"#Spring-MVC和REST注解\" class=\"headerlink\" title=\"Spring MVC和REST注解\"></a>Spring MVC和REST注解</h2><h3 id=\"Controller-1\"><a href=\"#Controller-1\" class=\"headerlink\" title=\"@Controller\"></a>@Controller</h3><p>上述已经提到过此注解。</p>\n<h3 id=\"RequestMapping\"><a href=\"#RequestMapping\" class=\"headerlink\" title=\"@RequestMapping\"></a>@RequestMapping</h3><p>此注解可以用在class和method上，用来映射web请求到某一个handler类或者handler方法上。当此注解用在Class上时，就创造了一个基础url，其所有的方法上的@RequestMapping都是在此url之上的。</p>\n<p>可以使用其method属性来限制请求匹配的http method。</p>\n<p>此外，Spring4.3之后引入了一系列@RequestMapping的变种。如下：c</p>\n<ul>\n<li>@GetMapping</li>\n<li>@PostMapping</li>\n<li>@PutMapping</li>\n<li>@PatchMapping</li>\n<li>@DeleteMapping</li>\n</ul>\n<p>分别对应了相应method的RequestMapping配置。</p>\n<h3 id=\"CrossOrigin\"><a href=\"#CrossOrigin\" class=\"headerlink\" title=\"@CrossOrigin\"></a>@CrossOrigin</h3><p>此注解用在class和method上用来支持跨域请求，是Spring 4.2后引入的。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CrossOrigin(maxAge = 3600)</span><br><span class=\"line\">@RestController</span><br><span class=\"line\">@RequestMapping(&quot;/users&quot;)</span><br><span class=\"line\">public class AccountController &#123;    </span><br><span class=\"line\">    @CrossOrigin(origins = &quot;http://xx.com&quot;)</span><br><span class=\"line\">    @RequestMapping(&quot;/login&quot;)</span><br><span class=\"line\">    public Result userLogin() &#123;</span><br><span class=\"line\">        // ...    </span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ExceptionHandler\"><a href=\"#ExceptionHandler\" class=\"headerlink\" title=\"@ExceptionHandler\"></a>@ExceptionHandler</h3><p>此注解使用在方法级别，声明对Exception的处理逻辑。可以指定目标Exception。</p>\n<h3 id=\"InitBinder\"><a href=\"#InitBinder\" class=\"headerlink\" title=\"@InitBinder\"></a>@InitBinder</h3><p>此注解使用在方法上，声明对WebDataBinder的初始化(绑定请求参数到JavaBean上的DataBinder)。在controller上使用此注解可以自定义请求参数的绑定。</p>\n<h3 id=\"MatrixVariable\"><a href=\"#MatrixVariable\" class=\"headerlink\" title=\"@MatrixVariable\"></a>@MatrixVariable</h3><p>此注解使用在请求handler方法的参数上，Spring可以注入matrix url中相关的值。这里的矩阵变量可以出现在url中的任何地方，变量之间用;分隔。如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// GET /pets/42;q=11;r=22@RequestMapping(value = &quot;/pets/&#123;petId&#125;&quot;)public void findPet(@PathVariable String petId, @MatrixVariable int q) &#123;    // petId == 42    // q == 11&#125;</span><br></pre></td></tr></table></figure>\n<p>需要注意的是默认Spring mvc是不支持矩阵变量的，需要开启。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> <span class=\"attr\">enable-matrix-variables</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注解配置则需要如下开启：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configurationpublic class WebConfig extends WebMvcConfigurerAdapter &#123;     @Override    public void configurePathMatch(PathMatchConfigurer configurer) &#123;        UrlPathHelper urlPathHelper = new UrlPathHelper();        urlPathHelper.setRemoveSemicolonContent(false);        configurer.setUrlPathHelper(urlPathHelper);    &#125;&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"PathVariable\"><a href=\"#PathVariable\" class=\"headerlink\" title=\"@PathVariable\"></a>@PathVariable</h3><p>此注解使用在请求handler方法的参数上。@RequestMapping可以定义动态路径，如:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RequestMapping(&quot;/users/&#123;uid&#125;&quot;)</span><br><span class=\"line\">public String execute(@PathVariable(&quot;uid&quot;) String uid)&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"RequestAttribute\"><a href=\"#RequestAttribute\" class=\"headerlink\" title=\"@RequestAttribute\"></a>@RequestAttribute</h3><p>此注解用在请求handler方法的参数上，用于将web请求中的属性(requst attributes，是服务器放入的属性值)绑定到方法参数上。</p>\n<h3 id=\"RequestBody\"><a href=\"#RequestBody\" class=\"headerlink\" title=\"@RequestBody\"></a>@RequestBody</h3><p>此注解用在请求handler方法的参数上，用于将http请求的Body映射绑定到此参数上。HttpMessageConverter负责将对象转换为http请求。</p>\n<h3 id=\"RequestHeader\"><a href=\"#RequestHeader\" class=\"headerlink\" title=\"@RequestHeader\"></a>@RequestHeader</h3><p>此注解用在请求handler方法的参数上，用于将http请求头部的值绑定到参数上。</p>\n<h3 id=\"RequestParam\"><a href=\"#RequestParam\" class=\"headerlink\" title=\"@RequestParam\"></a>@RequestParam</h3><p>此注解用在请求handler方法的参数上，用于将http请求参数的值绑定到参数上。</p>\n<h3 id=\"RequestPart\"><a href=\"#RequestPart\" class=\"headerlink\" title=\"@RequestPart\"></a>@RequestPart</h3><p>此注解用在请求handler方法的参数上，用于将文件之类的multipart绑定到参数上。</p>\n<h3 id=\"ResponseBody\"><a href=\"#ResponseBody\" class=\"headerlink\" title=\"@ResponseBody\"></a>@ResponseBody</h3><p>此注解用在请求handler方法上。和@RequestBody作用类似，用于将方法的返回对象直接输出到http响应中。</p>\n<h3 id=\"ResponseStatus\"><a href=\"#ResponseStatus\" class=\"headerlink\" title=\"@ResponseStatus\"></a>@ResponseStatus</h3><p>此注解用于方法和exception类上，声明此方法或者异常类返回的http状态码。可以在Controller上使用此注解，这样所有的@RequestMapping都会继承。</p>\n<h3 id=\"ControllerAdvice\"><a href=\"#ControllerAdvice\" class=\"headerlink\" title=\"@ControllerAdvice\"></a>@ControllerAdvice</h3><p>此注解用于class上。前面说过可以对每一个controller声明一个ExceptionMethod。这里可以使用@ControllerAdvice来声明一个类来统一对所有@RequestMapping方法来做@ExceptionHandler, @InitBinder, and @ModelAttribute处理。</p>\n<h3 id=\"RestController\"><a href=\"#RestController\" class=\"headerlink\" title=\"@RestController\"></a>@RestController</h3><p>此注解用于class上，声明此controller返回的不是一个视图而是一个领域对象。其同时引入了@Controller and @ResponseBody两个注解。</p>\n<h3 id=\"RestControllerAdvice\"><a href=\"#RestControllerAdvice\" class=\"headerlink\" title=\"@RestControllerAdvice\"></a>@RestControllerAdvice</h3><p>此注解用于class上，同时引入了@ControllerAdvice and @ResponseBody两个注解。</p>\n<h3 id=\"SessionAttribute\"><a href=\"#SessionAttribute\" class=\"headerlink\" title=\"@SessionAttribute\"></a>@SessionAttribute</h3><p>此注解用于方法的参数上，用于将session中的属性绑定到参数。</p>\n<h3 id=\"SessionAttributes\"><a href=\"#SessionAttributes\" class=\"headerlink\" title=\"@SessionAttributes\"></a>@SessionAttributes</h3><p>此注解用于type级别，用于将JavaBean对象存储到session中。一般和@ModelAttribute注解一起使用。如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ModelAttribute(&quot;user&quot;)</span><br><span class=\"line\">public PUser getUser() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// controller和上面的代码在同一controller中</span><br><span class=\"line\">@Controller</span><br><span class=\"line\">@SessionAttributes(value = &quot;user&quot;, types = &#123;</span><br><span class=\"line\">    User.class</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">public class UserController &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据访问注解\"><a href=\"#数据访问注解\" class=\"headerlink\" title=\"数据访问注解\"></a>数据访问注解</h2><h3 id=\"Transactional\"><a href=\"#Transactional\" class=\"headerlink\" title=\"@Transactional\"></a>@Transactional</h3><p>此注解使用在接口定义、接口中的方法、类定义或者类中的public方法上。需要注意的是此注解并不激活事务行为，它仅仅是一个元数据，会被一些运行时基础设施来消费。</p>\n<h2 id=\"任务执行、调度注解\"><a href=\"#任务执行、调度注解\" class=\"headerlink\" title=\"任务执行、调度注解\"></a>任务执行、调度注解</h2><h3 id=\"Scheduled\"><a href=\"#Scheduled\" class=\"headerlink\" title=\"@Scheduled\"></a>@Scheduled</h3><p>此注解使用在方法上，声明此方法被定时调度。使用了此注解的方法返回类型需要是Void，并且不能接受任何参数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Scheduled(fixedDelay=1000)</span><br><span class=\"line\">public void schedule() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@Scheduled(fixedRate=1000)</span><br><span class=\"line\">public void schedulg() &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>第二个与第一个不同之处在于其不会等待上一次的任务执行结束。</p>\n<h3 id=\"Async\"><a href=\"#Async\" class=\"headerlink\" title=\"@Async\"></a>@Async</h3><p>此注解使用在方法上，声明此方法会在一个单独的线程中执行。不同于Scheduled注解，此注解可以接受参数。<br>使用此注解的方法的返回类型可以是Void也可是返回值。但是返回值的类型必须是一个Future。</p>\n<h2 id=\"测试注解\"><a href=\"#测试注解\" class=\"headerlink\" title=\"测试注解\"></a>测试注解</h2><h3 id=\"ContextConfiguration\"><a href=\"#ContextConfiguration\" class=\"headerlink\" title=\"@ContextConfiguration\"></a>@ContextConfiguration</h3><p>此注解使用在Class上，声明测试使用的配置文件，此外，也可以指定加载上下文的类。</p>\n<p>此注解一般需要搭配SpringJUnit4ClassRunner使用。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class=\"line\">@ContextConfiguration(classes = SpringCoreConfig.class)</span><br><span class=\"line\">public class UserServiceTest &#123;&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"SpringBoot整合SpringSecurity简单实现登入登出从零搭建","date":"2018-11-12T02:24:30.000Z","_content":"\n技术栈 : SpringBoot + SpringSecurity + jpa + freemark ，完整项目地址 : <https://github.com/EalenXie/spring-security-login>\n\n1 . 新建一个spring-security-login的maven项目 ，pom.xml添加基本依赖 :\n\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>com.wuxicloud</groupId>\n    <artifactId>spring-security-login</artifactId>\n    <version>1.0</version>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>1.5.6.RELEASE</version>\n    </parent>\n    <properties>\n        <author>EalenXie</author>\n        <description>SpringBoot整合SpringSecurity实现简单登入登出</description>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-jpa</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-security</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-freemarker</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-aop</artifactId>\n        </dependency>\n        <!--alibaba-->\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>druid</artifactId>\n            <version>1.0.24</version>\n        </dependency>\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>fastjson</artifactId>\n            <version>1.2.31</version>\n        </dependency>\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n            <scope>runtime</scope>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n2 . 准备你的数据库，设计表结构，要用户使用登入登出，新建用户表。\n\n```\nDROP TABLE IF EXISTS `user`;\nCREATE TABLE `user`  (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `user_uuid` varchar(70) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `username` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `password` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `email` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `telephone` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `role` int(10) DEFAULT NULL,\n  `image` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `last_ip` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `last_time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  PRIMARY KEY (`id`) USING BTREE\n) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;\n\nSET FOREIGN_KEY_CHECKS = 1;\n```\n\n3 . 用户对象User.java :\n\n```\nimport javax.persistence.*;\n\n/**\n * Created by EalenXie on 2018/7/5 15:17\n */\n@Entity\n@Table(name = \"USER\")\npublic class User {\n    @Id\n    @GeneratedValue(strategy = GenerationType.AUTO)\n    private Integer id;\n    private String user_uuid;   //用户UUID\n    private String username;    //用户名\n    private String password;    //用户密码\n    private String email;       //用户邮箱\n    private String telephone;   //电话号码\n    private String role;        //用户角色\n    private String image;       //用户头像\n    private String last_ip;     //上次登录IP\n    private String last_time;   //上次登录时间\n\n    public Integer getId() {\n        return id;\n    }\n\n    public String getRole() {\n        return role;\n    }\n\n    public void setRole(String role) {\n        this.role = role;\n    }\n\n    public String getImage() {\n        return image;\n    }\n\n    public void setImage(String image) {\n        this.image = image;\n    }\n\n    public void setId(Integer id) {\n        this.id = id;\n    }\n\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getEmail() {\n        return email;\n    }\n\n    public void setEmail(String email) {\n        this.email = email;\n    }\n\n    public String getTelephone() {\n        return telephone;\n    }\n\n    public void setTelephone(String telephone) {\n        this.telephone = telephone;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getUser_uuid() {\n        return user_uuid;\n    }\n\n    public void setUser_uuid(String user_uuid) {\n        this.user_uuid = user_uuid;\n    }\n\n    public String getLast_ip() {\n        return last_ip;\n    }\n\n    public void setLast_ip(String last_ip) {\n        this.last_ip = last_ip;\n    }\n\n    public String getLast_time() {\n        return last_time;\n    }\n\n    public void setLast_time(String last_time) {\n        this.last_time = last_time;\n    }\n\n    @Override\n    public String toString() {\n        return \"User{\" +\n                \"id=\" + id +\n                \", user_uuid='\" + user_uuid + '\\'' +\n                \", username='\" + username + '\\'' +\n                \", password='\" + password + '\\'' +\n                \", email='\" + email + '\\'' +\n                \", telephone='\" + telephone + '\\'' +\n                \", role='\" + role + '\\'' +\n                \", image='\" + image + '\\'' +\n                \", last_ip='\" + last_ip + '\\'' +\n                \", last_time='\" + last_time + '\\'' +\n                '}';\n    }\n}\n```\n\n4 . application.yml配置一些基本属性\n\n```\nspring:\n  resources:\n    static-locations: classpath:/\n  freemarker:\n    template-loader-path: classpath:/templates/\n    suffix: .html\n    content-type: text/html\n    charset: UTF-8\n  datasource:\n      url: jdbc:mysql://localhost:3306/yourdatabase\n      username: yourname\n      password: yourpass\n      driver-class-name: com.mysql.jdbc.Driver\n      type: com.alibaba.druid.pool.DruidDataSource\nserver:\n  port: 8083\n  error:\n    whitelabel:\n      enabled: true\n```\n\n5 . 考虑我们应用的效率 , 可以配置数据源和线程池 :\n\n```\npackage com.wuxicloud.config;\n\nimport com.alibaba.druid.pool.DruidDataSource;\nimport com.alibaba.druid.pool.DruidDataSourceFactory;\nimport com.alibaba.druid.support.http.StatViewServlet;\nimport com.alibaba.druid.support.http.WebStatFilter;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.boot.web.servlet.ServletRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.env.*;\n\nimport javax.sql.DataSource;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Properties;\n\n@Configuration\npublic class DruidConfig {\n    private static final String DB_PREFIX = \"spring.datasource.\";\n\n    @Autowired\n    private Environment environment;\n\n    @Bean\n    @ConfigurationProperties(prefix = DB_PREFIX)\n    public DataSource druidDataSource() {\n        Properties dbProperties = new Properties();\n        Map<String, Object> map = new HashMap<>();\n        for (PropertySource<?> propertySource : ((AbstractEnvironment) environment).getPropertySources()) {\n            getPropertiesFromSource(propertySource, map);\n        }\n        dbProperties.putAll(map);\n        DruidDataSource dds;\n        try {\n            dds = (DruidDataSource) DruidDataSourceFactory.createDataSource(dbProperties);\n            dds.init();\n        } catch (Exception e) {\n            throw new RuntimeException(\"load datasource error, dbProperties is :\" + dbProperties, e);\n        }\n        return dds;\n    }\n\n    private void getPropertiesFromSource(PropertySource<?> propertySource, Map<String, Object> map) {\n        if (propertySource instanceof MapPropertySource) {\n            for (String key : ((MapPropertySource) propertySource).getPropertyNames()) {\n                if (key.startsWith(DB_PREFIX))\n                    map.put(key.replaceFirst(DB_PREFIX, \"\"), propertySource.getProperty(key));\n                else if (key.startsWith(DB_PREFIX))\n                    map.put(key.replaceFirst(DB_PREFIX, \"\"), propertySource.getProperty(key));\n            }\n        }\n\n        if (propertySource instanceof CompositePropertySource) {\n            for (PropertySource<?> s : ((CompositePropertySource) propertySource).getPropertySources()) {\n                getPropertiesFromSource(s, map);\n            }\n        }\n    }\n\n    @Bean\n    public ServletRegistrationBean druidServlet() {\n        return new ServletRegistrationBean(new StatViewServlet(), \"/druid/*\");\n    }\n\n    @Bean\n    public FilterRegistrationBean filterRegistrationBean() {\n        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();\n        filterRegistrationBean.setFilter(new WebStatFilter());\n        filterRegistrationBean.addUrlPatterns(\"/*\");\n        filterRegistrationBean.addInitParameter(\"exclusions\", \"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*\");\n        return filterRegistrationBean;\n    }\n}\n```\n\n配置线程池 :\n\n```\npackage com.wuxicloud.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.scheduling.annotation.EnableAsync;\nimport org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;\n\nimport java.util.concurrent.Executor;\nimport java.util.concurrent.ThreadPoolExecutor;\n\n@Configuration\n@EnableAsync\npublic class ThreadPoolConfig {\n    @Bean\n    public Executor getExecutor() {\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        executor.setCorePoolSize(5);//线程池维护线程的最少数量\n        executor.setMaxPoolSize(30);//线程池维护线程的最大数量\n        executor.setQueueCapacity(8); //缓存队列\n        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); //对拒绝task的处理策略\n        executor.setKeepAliveSeconds(60);//允许的空闲时间\n        executor.initialize();\n        return executor;\n    }\n}\n```\n\n6.用户需要根据用户名进行登录，访问数据库 :\n\n```\nimport com.wuxicloud.model.User;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\n/**\n * Created by EalenXie on 2018/7/11 14:23\n */\npublic interface UserRepository extends JpaRepository<User, Integer> {\n\n    User findByUsername(String username);\n\n}\n```\n\n7.构建真正用于SpringSecurity登录的安全用户(UserDetails)，我这里使用新建了一个POJO来实现 :\n\n```\npackage com.wuxicloud.security;\n\nimport com.wuxicloud.model.User;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\n\nimport java.util.ArrayList;\nimport java.util.Collection;\n\npublic class SecurityUser extends User implements UserDetails {\n    private static final long serialVersionUID = 1L;\n\n    public SecurityUser(User user) {\n        if (user != null) {\n            this.setUser_uuid(user.getUser_uuid());\n            this.setUsername(user.getUsername());\n            this.setPassword(user.getPassword());\n            this.setEmail(user.getEmail());\n            this.setTelephone(user.getTelephone());\n            this.setRole(user.getRole());\n            this.setImage(user.getImage());\n            this.setLast_ip(user.getLast_ip());\n            this.setLast_time(user.getLast_time());\n        }\n    }\n\n    @Override\n    public Collection<? extends GrantedAuthority> getAuthorities() {\n        Collection<GrantedAuthority> authorities = new ArrayList<>();\n        String username = this.getUsername();\n        if (username != null) {\n            SimpleGrantedAuthority authority = new SimpleGrantedAuthority(username);\n            authorities.add(authority);\n        }\n        return authorities;\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n}\n```\n\n8 . 核心配置，配置SpringSecurity访问策略，包括登录处理，登出处理，资源访问，密码基本加密。\n\n```\npackage com.wuxicloud.config;\n\nimport com.wuxicloud.dao.UserRepository;\nimport com.wuxicloud.model.User;\nimport com.wuxicloud.security.SecurityUser;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;\nimport org.springframework.security.web.authentication.logout.LogoutSuccessHandler;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n\n/**\n * Created by EalenXie on 2018/1/11.\n */\n@Configuration\n@EnableWebSecurity\npublic class WebSecurityConfig extends WebSecurityConfigurerAdapter {\n    private static final Logger logger = LoggerFactory.getLogger(WebSecurityConfig.class);\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception { //配置策略\n        http.csrf().disable();\n        http.authorizeRequests().\n                antMatchers(\"/static/**\").permitAll().anyRequest().authenticated().\n                and().formLogin().loginPage(\"/login\").permitAll().successHandler(loginSuccessHandler()).\n                and().logout().permitAll().invalidateHttpSession(true).\n                deleteCookies(\"JSESSIONID\").logoutSuccessHandler(logoutSuccessHandler()).\n                and().sessionManagement().maximumSessions(10).expiredUrl(\"/login\");\n    }\n\n    @Autowired\n    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {\n        auth.userDetailsService(userDetailsService()).passwordEncoder(passwordEncoder());\n        auth.eraseCredentials(false);\n    }\n\n    @Bean\n    public BCryptPasswordEncoder passwordEncoder() { //密码加密\n        return new BCryptPasswordEncoder(4);\n    }\n\n    @Bean\n    public LogoutSuccessHandler logoutSuccessHandler() { //登出处理\n        return new LogoutSuccessHandler() {\n            @Override\n            public void onLogoutSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException {\n                try {\n                    SecurityUser user = (SecurityUser) authentication.getPrincipal();\n                    logger.info(\"USER : \" + user.getUsername() + \" LOGOUT SUCCESS !  \");\n                } catch (Exception e) {\n                    logger.info(\"LOGOUT EXCEPTION , e : \" + e.getMessage());\n                }\n                httpServletResponse.sendRedirect(\"/login\");\n            }\n        };\n    }\n\n    @Bean\n    public SavedRequestAwareAuthenticationSuccessHandler loginSuccessHandler() { //登入处理\n        return new SavedRequestAwareAuthenticationSuccessHandler() {\n            @Override\n            public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n                User userDetails = (User) authentication.getPrincipal();\n                logger.info(\"USER : \" + userDetails.getUsername() + \" LOGIN SUCCESS !  \");\n                super.onAuthenticationSuccess(request, response, authentication);\n            }\n        };\n    }\n    @Bean\n    public UserDetailsService userDetailsService() {    //用户登录实现\n        return new UserDetailsService() {\n            @Autowired\n            private UserRepository userRepository;\n\n            @Override\n            public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {\n                User user = userRepository.findByUsername(s);\n                if (user == null) throw new UsernameNotFoundException(\"Username \" + s + \" not found\");\n                return new SecurityUser(user);\n            }\n        };\n    }\n}\n```\n\n9.至此，已经基本将配置搭建好了，从上面核心可以看出，配置的登录页的url 为/login，可以创建基本的Controller来验证登录了。\n\n```\npackage com.wuxicloud.web;\n\nimport com.wuxicloud.model.User;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContext;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestMethod;\nimport org.springframework.web.context.request.RequestContextHolder;\nimport org.springframework.web.context.request.ServletRequestAttributes;\n\nimport javax.servlet.http.HttpServletRequest;\n\n/**\n * Created by EalenXie on 2018/1/11.\n */\n@Controller\npublic class LoginController {\n\n    @RequestMapping(value = \"/login\", method = RequestMethod.GET)\n    public String login() {\n        return \"login\";\n    }\n\n    @RequestMapping(\"/\")\n    public String root() {\n        return \"index\";\n    }\n\n    public User getUser() { //为了session从获取用户信息,可以配置如下\n        User user = new User();\n        SecurityContext ctx = SecurityContextHolder.getContext();\n        Authentication auth = ctx.getAuthentication();\n        if (auth.getPrincipal() instanceof UserDetails) user = (User) auth.getPrincipal();\n        return user;\n    }\n\n    public HttpServletRequest getRequest() {\n        return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();\n    }\n}\n```\n\n11 . SpringBoot基本的启动类 Application.class\n\n```\npackage com.wuxicloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n/**\n * Created by EalenXie on 2018/7/11 15:01\n */\n@SpringBootApplication\npublic class Application {\n\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n```\n\n11.根据Freemark和Controller里面可看出配置的视图为 /templates/index.html和/templates/index.login。所以创建基本的登录页面和登录成功页面。\n\nlogin.html\n\n```\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>用户登录</title>\n</head>\n<body>\n<form action=\"/login\" method=\"post\">\n    用户名 : <input type=\"text\" name=\"username\"/>\n    密码 : <input type=\"password\" name=\"password\"/>\n    <input type=\"submit\" value=\"登录\">\n</form>\n</body>\n</html>\n```\n\n注意 : 这里方法必须是POST，因为GET在controller被重写了，用户名的name属性必须是username，密码的name属性必须是password\n\nindex.html\n\n```\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>首页</title>\n    <#assign  user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/>\n</head>\n<body>\n欢迎你,${user.username}<br/>\n<a href=\"/logout\">注销</a>\n</body>\n</html>\n```\n\n注意 : 为了从session中获取到登录的用户信息，根据配置SpringSecurity的用户信息会放在Session.SPRING_SECURITY_CONTEXT.authentication.principal里面，根据FreeMarker模板引擎的特点，可以通过这种方式进行获取 : <#assign user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/>\n\n12 . 为了方便测试，我们在数据库中插入一条记录，注意，从WebSecurity.java配置可以知道密码会被加密，所以我们插入的用户密码应该是被加密的。\n\n这里假如我们使用的密码为admin，则加密过后的字符串是 $2a$04$1OiUa3yEchBXQBJI8JaMyuKZNlwzWvfeQjKAHnwAEQwnacjt6ukqu\n\n　测试类如下 :\n\n```\npackage com.wuxicloud.security;\n\nimport org.junit.Test;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\n\n/**\n * Created by EalenXie on 2018/7/11 15:13\n */\npublic class TestEncoder {\n\n    @Test\n    public void encoder() {\n        String password = \"admin\";\n        BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(4);\n        String enPassword = encoder.encode(password);\n        System.out.println(enPassword);\n    }\n}\n```\n\n测试登录，从上面的加密的密码我们插入一条数据到数据库中。\n\n```\nINSERT INTO `USER` VALUES (1, 'd242ae49-4734-411e-8c8d-d2b09e87c3c8', 'EalenXie', '$2a$04$petEXpgcLKfdLN4TYFxK0u8ryAzmZDHLASWLX/XXm8hgQar1C892W', 'SSSSS', 'ssssssssss', 1, 'g', '0:0:0:0:0:0:0:1', '2018-07-11 11:26:27');\n```\n\n13 . 启动项目进行测试 ，访问 localhost:8083\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154124007-1732228495.png)\n\n点击登录，登录失败会留在当前页面重新登录，成功则进入index.html\n\n登录如果成功，可以看到后台打印登录成功的日志 :\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154258208-1381186085.png)\n\n页面进入index.html :\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154337891-1871092340.png)\n\n点击注销 ，则回重新跳转到login.html，后台也会打印登出成功的日志 :\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154539312-15547252.png)\n\n\n\n```\n\n```\n","source":"_posts/0007-spring-boot-integrate-security.md","raw":"---\ntitle: SpringBoot整合SpringSecurity简单实现登入登出从零搭建\ndate: 2018-11-12 10:24:30\ntags:\n    - Security\n---\n\n技术栈 : SpringBoot + SpringSecurity + jpa + freemark ，完整项目地址 : <https://github.com/EalenXie/spring-security-login>\n\n1 . 新建一个spring-security-login的maven项目 ，pom.xml添加基本依赖 :\n\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>com.wuxicloud</groupId>\n    <artifactId>spring-security-login</artifactId>\n    <version>1.0</version>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>1.5.6.RELEASE</version>\n    </parent>\n    <properties>\n        <author>EalenXie</author>\n        <description>SpringBoot整合SpringSecurity实现简单登入登出</description>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-jpa</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-security</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-freemarker</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-aop</artifactId>\n        </dependency>\n        <!--alibaba-->\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>druid</artifactId>\n            <version>1.0.24</version>\n        </dependency>\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>fastjson</artifactId>\n            <version>1.2.31</version>\n        </dependency>\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n            <scope>runtime</scope>\n        </dependency>\n    </dependencies>\n</project>\n```\n\n2 . 准备你的数据库，设计表结构，要用户使用登入登出，新建用户表。\n\n```\nDROP TABLE IF EXISTS `user`;\nCREATE TABLE `user`  (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `user_uuid` varchar(70) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `username` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `password` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `email` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `telephone` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `role` int(10) DEFAULT NULL,\n  `image` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `last_ip` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  `last_time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,\n  PRIMARY KEY (`id`) USING BTREE\n) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;\n\nSET FOREIGN_KEY_CHECKS = 1;\n```\n\n3 . 用户对象User.java :\n\n```\nimport javax.persistence.*;\n\n/**\n * Created by EalenXie on 2018/7/5 15:17\n */\n@Entity\n@Table(name = \"USER\")\npublic class User {\n    @Id\n    @GeneratedValue(strategy = GenerationType.AUTO)\n    private Integer id;\n    private String user_uuid;   //用户UUID\n    private String username;    //用户名\n    private String password;    //用户密码\n    private String email;       //用户邮箱\n    private String telephone;   //电话号码\n    private String role;        //用户角色\n    private String image;       //用户头像\n    private String last_ip;     //上次登录IP\n    private String last_time;   //上次登录时间\n\n    public Integer getId() {\n        return id;\n    }\n\n    public String getRole() {\n        return role;\n    }\n\n    public void setRole(String role) {\n        this.role = role;\n    }\n\n    public String getImage() {\n        return image;\n    }\n\n    public void setImage(String image) {\n        this.image = image;\n    }\n\n    public void setId(Integer id) {\n        this.id = id;\n    }\n\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getEmail() {\n        return email;\n    }\n\n    public void setEmail(String email) {\n        this.email = email;\n    }\n\n    public String getTelephone() {\n        return telephone;\n    }\n\n    public void setTelephone(String telephone) {\n        this.telephone = telephone;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getUser_uuid() {\n        return user_uuid;\n    }\n\n    public void setUser_uuid(String user_uuid) {\n        this.user_uuid = user_uuid;\n    }\n\n    public String getLast_ip() {\n        return last_ip;\n    }\n\n    public void setLast_ip(String last_ip) {\n        this.last_ip = last_ip;\n    }\n\n    public String getLast_time() {\n        return last_time;\n    }\n\n    public void setLast_time(String last_time) {\n        this.last_time = last_time;\n    }\n\n    @Override\n    public String toString() {\n        return \"User{\" +\n                \"id=\" + id +\n                \", user_uuid='\" + user_uuid + '\\'' +\n                \", username='\" + username + '\\'' +\n                \", password='\" + password + '\\'' +\n                \", email='\" + email + '\\'' +\n                \", telephone='\" + telephone + '\\'' +\n                \", role='\" + role + '\\'' +\n                \", image='\" + image + '\\'' +\n                \", last_ip='\" + last_ip + '\\'' +\n                \", last_time='\" + last_time + '\\'' +\n                '}';\n    }\n}\n```\n\n4 . application.yml配置一些基本属性\n\n```\nspring:\n  resources:\n    static-locations: classpath:/\n  freemarker:\n    template-loader-path: classpath:/templates/\n    suffix: .html\n    content-type: text/html\n    charset: UTF-8\n  datasource:\n      url: jdbc:mysql://localhost:3306/yourdatabase\n      username: yourname\n      password: yourpass\n      driver-class-name: com.mysql.jdbc.Driver\n      type: com.alibaba.druid.pool.DruidDataSource\nserver:\n  port: 8083\n  error:\n    whitelabel:\n      enabled: true\n```\n\n5 . 考虑我们应用的效率 , 可以配置数据源和线程池 :\n\n```\npackage com.wuxicloud.config;\n\nimport com.alibaba.druid.pool.DruidDataSource;\nimport com.alibaba.druid.pool.DruidDataSourceFactory;\nimport com.alibaba.druid.support.http.StatViewServlet;\nimport com.alibaba.druid.support.http.WebStatFilter;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.boot.web.servlet.ServletRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.env.*;\n\nimport javax.sql.DataSource;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Properties;\n\n@Configuration\npublic class DruidConfig {\n    private static final String DB_PREFIX = \"spring.datasource.\";\n\n    @Autowired\n    private Environment environment;\n\n    @Bean\n    @ConfigurationProperties(prefix = DB_PREFIX)\n    public DataSource druidDataSource() {\n        Properties dbProperties = new Properties();\n        Map<String, Object> map = new HashMap<>();\n        for (PropertySource<?> propertySource : ((AbstractEnvironment) environment).getPropertySources()) {\n            getPropertiesFromSource(propertySource, map);\n        }\n        dbProperties.putAll(map);\n        DruidDataSource dds;\n        try {\n            dds = (DruidDataSource) DruidDataSourceFactory.createDataSource(dbProperties);\n            dds.init();\n        } catch (Exception e) {\n            throw new RuntimeException(\"load datasource error, dbProperties is :\" + dbProperties, e);\n        }\n        return dds;\n    }\n\n    private void getPropertiesFromSource(PropertySource<?> propertySource, Map<String, Object> map) {\n        if (propertySource instanceof MapPropertySource) {\n            for (String key : ((MapPropertySource) propertySource).getPropertyNames()) {\n                if (key.startsWith(DB_PREFIX))\n                    map.put(key.replaceFirst(DB_PREFIX, \"\"), propertySource.getProperty(key));\n                else if (key.startsWith(DB_PREFIX))\n                    map.put(key.replaceFirst(DB_PREFIX, \"\"), propertySource.getProperty(key));\n            }\n        }\n\n        if (propertySource instanceof CompositePropertySource) {\n            for (PropertySource<?> s : ((CompositePropertySource) propertySource).getPropertySources()) {\n                getPropertiesFromSource(s, map);\n            }\n        }\n    }\n\n    @Bean\n    public ServletRegistrationBean druidServlet() {\n        return new ServletRegistrationBean(new StatViewServlet(), \"/druid/*\");\n    }\n\n    @Bean\n    public FilterRegistrationBean filterRegistrationBean() {\n        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();\n        filterRegistrationBean.setFilter(new WebStatFilter());\n        filterRegistrationBean.addUrlPatterns(\"/*\");\n        filterRegistrationBean.addInitParameter(\"exclusions\", \"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*\");\n        return filterRegistrationBean;\n    }\n}\n```\n\n配置线程池 :\n\n```\npackage com.wuxicloud.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.scheduling.annotation.EnableAsync;\nimport org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;\n\nimport java.util.concurrent.Executor;\nimport java.util.concurrent.ThreadPoolExecutor;\n\n@Configuration\n@EnableAsync\npublic class ThreadPoolConfig {\n    @Bean\n    public Executor getExecutor() {\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        executor.setCorePoolSize(5);//线程池维护线程的最少数量\n        executor.setMaxPoolSize(30);//线程池维护线程的最大数量\n        executor.setQueueCapacity(8); //缓存队列\n        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); //对拒绝task的处理策略\n        executor.setKeepAliveSeconds(60);//允许的空闲时间\n        executor.initialize();\n        return executor;\n    }\n}\n```\n\n6.用户需要根据用户名进行登录，访问数据库 :\n\n```\nimport com.wuxicloud.model.User;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\n/**\n * Created by EalenXie on 2018/7/11 14:23\n */\npublic interface UserRepository extends JpaRepository<User, Integer> {\n\n    User findByUsername(String username);\n\n}\n```\n\n7.构建真正用于SpringSecurity登录的安全用户(UserDetails)，我这里使用新建了一个POJO来实现 :\n\n```\npackage com.wuxicloud.security;\n\nimport com.wuxicloud.model.User;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\n\nimport java.util.ArrayList;\nimport java.util.Collection;\n\npublic class SecurityUser extends User implements UserDetails {\n    private static final long serialVersionUID = 1L;\n\n    public SecurityUser(User user) {\n        if (user != null) {\n            this.setUser_uuid(user.getUser_uuid());\n            this.setUsername(user.getUsername());\n            this.setPassword(user.getPassword());\n            this.setEmail(user.getEmail());\n            this.setTelephone(user.getTelephone());\n            this.setRole(user.getRole());\n            this.setImage(user.getImage());\n            this.setLast_ip(user.getLast_ip());\n            this.setLast_time(user.getLast_time());\n        }\n    }\n\n    @Override\n    public Collection<? extends GrantedAuthority> getAuthorities() {\n        Collection<GrantedAuthority> authorities = new ArrayList<>();\n        String username = this.getUsername();\n        if (username != null) {\n            SimpleGrantedAuthority authority = new SimpleGrantedAuthority(username);\n            authorities.add(authority);\n        }\n        return authorities;\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n}\n```\n\n8 . 核心配置，配置SpringSecurity访问策略，包括登录处理，登出处理，资源访问，密码基本加密。\n\n```\npackage com.wuxicloud.config;\n\nimport com.wuxicloud.dao.UserRepository;\nimport com.wuxicloud.model.User;\nimport com.wuxicloud.security.SecurityUser;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;\nimport org.springframework.security.web.authentication.logout.LogoutSuccessHandler;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n\n/**\n * Created by EalenXie on 2018/1/11.\n */\n@Configuration\n@EnableWebSecurity\npublic class WebSecurityConfig extends WebSecurityConfigurerAdapter {\n    private static final Logger logger = LoggerFactory.getLogger(WebSecurityConfig.class);\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception { //配置策略\n        http.csrf().disable();\n        http.authorizeRequests().\n                antMatchers(\"/static/**\").permitAll().anyRequest().authenticated().\n                and().formLogin().loginPage(\"/login\").permitAll().successHandler(loginSuccessHandler()).\n                and().logout().permitAll().invalidateHttpSession(true).\n                deleteCookies(\"JSESSIONID\").logoutSuccessHandler(logoutSuccessHandler()).\n                and().sessionManagement().maximumSessions(10).expiredUrl(\"/login\");\n    }\n\n    @Autowired\n    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {\n        auth.userDetailsService(userDetailsService()).passwordEncoder(passwordEncoder());\n        auth.eraseCredentials(false);\n    }\n\n    @Bean\n    public BCryptPasswordEncoder passwordEncoder() { //密码加密\n        return new BCryptPasswordEncoder(4);\n    }\n\n    @Bean\n    public LogoutSuccessHandler logoutSuccessHandler() { //登出处理\n        return new LogoutSuccessHandler() {\n            @Override\n            public void onLogoutSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException {\n                try {\n                    SecurityUser user = (SecurityUser) authentication.getPrincipal();\n                    logger.info(\"USER : \" + user.getUsername() + \" LOGOUT SUCCESS !  \");\n                } catch (Exception e) {\n                    logger.info(\"LOGOUT EXCEPTION , e : \" + e.getMessage());\n                }\n                httpServletResponse.sendRedirect(\"/login\");\n            }\n        };\n    }\n\n    @Bean\n    public SavedRequestAwareAuthenticationSuccessHandler loginSuccessHandler() { //登入处理\n        return new SavedRequestAwareAuthenticationSuccessHandler() {\n            @Override\n            public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n                User userDetails = (User) authentication.getPrincipal();\n                logger.info(\"USER : \" + userDetails.getUsername() + \" LOGIN SUCCESS !  \");\n                super.onAuthenticationSuccess(request, response, authentication);\n            }\n        };\n    }\n    @Bean\n    public UserDetailsService userDetailsService() {    //用户登录实现\n        return new UserDetailsService() {\n            @Autowired\n            private UserRepository userRepository;\n\n            @Override\n            public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {\n                User user = userRepository.findByUsername(s);\n                if (user == null) throw new UsernameNotFoundException(\"Username \" + s + \" not found\");\n                return new SecurityUser(user);\n            }\n        };\n    }\n}\n```\n\n9.至此，已经基本将配置搭建好了，从上面核心可以看出，配置的登录页的url 为/login，可以创建基本的Controller来验证登录了。\n\n```\npackage com.wuxicloud.web;\n\nimport com.wuxicloud.model.User;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContext;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestMethod;\nimport org.springframework.web.context.request.RequestContextHolder;\nimport org.springframework.web.context.request.ServletRequestAttributes;\n\nimport javax.servlet.http.HttpServletRequest;\n\n/**\n * Created by EalenXie on 2018/1/11.\n */\n@Controller\npublic class LoginController {\n\n    @RequestMapping(value = \"/login\", method = RequestMethod.GET)\n    public String login() {\n        return \"login\";\n    }\n\n    @RequestMapping(\"/\")\n    public String root() {\n        return \"index\";\n    }\n\n    public User getUser() { //为了session从获取用户信息,可以配置如下\n        User user = new User();\n        SecurityContext ctx = SecurityContextHolder.getContext();\n        Authentication auth = ctx.getAuthentication();\n        if (auth.getPrincipal() instanceof UserDetails) user = (User) auth.getPrincipal();\n        return user;\n    }\n\n    public HttpServletRequest getRequest() {\n        return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();\n    }\n}\n```\n\n11 . SpringBoot基本的启动类 Application.class\n\n```\npackage com.wuxicloud;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n/**\n * Created by EalenXie on 2018/7/11 15:01\n */\n@SpringBootApplication\npublic class Application {\n\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n```\n\n11.根据Freemark和Controller里面可看出配置的视图为 /templates/index.html和/templates/index.login。所以创建基本的登录页面和登录成功页面。\n\nlogin.html\n\n```\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>用户登录</title>\n</head>\n<body>\n<form action=\"/login\" method=\"post\">\n    用户名 : <input type=\"text\" name=\"username\"/>\n    密码 : <input type=\"password\" name=\"password\"/>\n    <input type=\"submit\" value=\"登录\">\n</form>\n</body>\n</html>\n```\n\n注意 : 这里方法必须是POST，因为GET在controller被重写了，用户名的name属性必须是username，密码的name属性必须是password\n\nindex.html\n\n```\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>首页</title>\n    <#assign  user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/>\n</head>\n<body>\n欢迎你,${user.username}<br/>\n<a href=\"/logout\">注销</a>\n</body>\n</html>\n```\n\n注意 : 为了从session中获取到登录的用户信息，根据配置SpringSecurity的用户信息会放在Session.SPRING_SECURITY_CONTEXT.authentication.principal里面，根据FreeMarker模板引擎的特点，可以通过这种方式进行获取 : <#assign user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/>\n\n12 . 为了方便测试，我们在数据库中插入一条记录，注意，从WebSecurity.java配置可以知道密码会被加密，所以我们插入的用户密码应该是被加密的。\n\n这里假如我们使用的密码为admin，则加密过后的字符串是 $2a$04$1OiUa3yEchBXQBJI8JaMyuKZNlwzWvfeQjKAHnwAEQwnacjt6ukqu\n\n　测试类如下 :\n\n```\npackage com.wuxicloud.security;\n\nimport org.junit.Test;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\n\n/**\n * Created by EalenXie on 2018/7/11 15:13\n */\npublic class TestEncoder {\n\n    @Test\n    public void encoder() {\n        String password = \"admin\";\n        BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(4);\n        String enPassword = encoder.encode(password);\n        System.out.println(enPassword);\n    }\n}\n```\n\n测试登录，从上面的加密的密码我们插入一条数据到数据库中。\n\n```\nINSERT INTO `USER` VALUES (1, 'd242ae49-4734-411e-8c8d-d2b09e87c3c8', 'EalenXie', '$2a$04$petEXpgcLKfdLN4TYFxK0u8ryAzmZDHLASWLX/XXm8hgQar1C892W', 'SSSSS', 'ssssssssss', 1, 'g', '0:0:0:0:0:0:0:1', '2018-07-11 11:26:27');\n```\n\n13 . 启动项目进行测试 ，访问 localhost:8083\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154124007-1732228495.png)\n\n点击登录，登录失败会留在当前页面重新登录，成功则进入index.html\n\n登录如果成功，可以看到后台打印登录成功的日志 :\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154258208-1381186085.png)\n\n页面进入index.html :\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154337891-1871092340.png)\n\n点击注销 ，则回重新跳转到login.html，后台也会打印登出成功的日志 :\n\n![img](https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154539312-15547252.png)\n\n\n\n```\n\n```\n","slug":"0007-spring-boot-integrate-security","published":1,"updated":"2018-11-12T06:04:48.700Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvg26t8p003ugcoi4lw5fttz","content":"<p>技术栈 : SpringBoot + SpringSecurity + jpa + freemark ，完整项目地址 : <a href=\"https://github.com/EalenXie/spring-security-login\" target=\"_blank\" rel=\"noopener\">https://github.com/EalenXie/spring-security-login</a></p>\n<p>1 . 新建一个spring-security-login的maven项目 ，pom.xml添加基本依赖 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class=\"line\">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class=\"line\">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class=\"line\">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;groupId&gt;com.wuxicloud&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-security-login&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class=\"line\">    &lt;parent&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;1.5.6.RELEASE&lt;/version&gt;</span><br><span class=\"line\">    &lt;/parent&gt;</span><br><span class=\"line\">    &lt;properties&gt;</span><br><span class=\"line\">        &lt;author&gt;EalenXie&lt;/author&gt;</span><br><span class=\"line\">        &lt;description&gt;SpringBoot整合SpringSecurity实现简单登入登出&lt;/description&gt;</span><br><span class=\"line\">    &lt;/properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;!--alibaba--&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.0.24&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.2.31&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n<p>2 . 准备你的数据库，设计表结构，要用户使用登入登出，新建用户表。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP TABLE IF EXISTS `user`;</span><br><span class=\"line\">CREATE TABLE `user`  (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `user_uuid` varchar(70) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `username` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `password` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `email` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `telephone` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `role` int(10) DEFAULT NULL,</span><br><span class=\"line\">  `image` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `last_ip` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `last_time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`) USING BTREE</span><br><span class=\"line\">) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span><br><span class=\"line\"></span><br><span class=\"line\">SET FOREIGN_KEY_CHECKS = 1;</span><br></pre></td></tr></table></figure>\n<p>3 . 用户对象User.java :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import javax.persistence.*;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/5 15:17</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Entity</span><br><span class=\"line\">@Table(name = &quot;USER&quot;)</span><br><span class=\"line\">public class User &#123;</span><br><span class=\"line\">    @Id</span><br><span class=\"line\">    @GeneratedValue(strategy = GenerationType.AUTO)</span><br><span class=\"line\">    private Integer id;</span><br><span class=\"line\">    private String user_uuid;   //用户UUID</span><br><span class=\"line\">    private String username;    //用户名</span><br><span class=\"line\">    private String password;    //用户密码</span><br><span class=\"line\">    private String email;       //用户邮箱</span><br><span class=\"line\">    private String telephone;   //电话号码</span><br><span class=\"line\">    private String role;        //用户角色</span><br><span class=\"line\">    private String image;       //用户头像</span><br><span class=\"line\">    private String last_ip;     //上次登录IP</span><br><span class=\"line\">    private String last_time;   //上次登录时间</span><br><span class=\"line\"></span><br><span class=\"line\">    public Integer getId() &#123;</span><br><span class=\"line\">        return id;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getRole() &#123;</span><br><span class=\"line\">        return role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setRole(String role) &#123;</span><br><span class=\"line\">        this.role = role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getImage() &#123;</span><br><span class=\"line\">        return image;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setImage(String image) &#123;</span><br><span class=\"line\">        this.image = image;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setId(Integer id) &#123;</span><br><span class=\"line\">        this.id = id;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    public String getUsername() &#123;</span><br><span class=\"line\">        return username;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setUsername(String username) &#123;</span><br><span class=\"line\">        this.username = username;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getEmail() &#123;</span><br><span class=\"line\">        return email;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setEmail(String email) &#123;</span><br><span class=\"line\">        this.email = email;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getTelephone() &#123;</span><br><span class=\"line\">        return telephone;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setTelephone(String telephone) &#123;</span><br><span class=\"line\">        this.telephone = telephone;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getPassword() &#123;</span><br><span class=\"line\">        return password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setPassword(String password) &#123;</span><br><span class=\"line\">        this.password = password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getUser_uuid() &#123;</span><br><span class=\"line\">        return user_uuid;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setUser_uuid(String user_uuid) &#123;</span><br><span class=\"line\">        this.user_uuid = user_uuid;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getLast_ip() &#123;</span><br><span class=\"line\">        return last_ip;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setLast_ip(String last_ip) &#123;</span><br><span class=\"line\">        this.last_ip = last_ip;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getLast_time() &#123;</span><br><span class=\"line\">        return last_time;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setLast_time(String last_time) &#123;</span><br><span class=\"line\">        this.last_time = last_time;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public String toString() &#123;</span><br><span class=\"line\">        return &quot;User&#123;&quot; +</span><br><span class=\"line\">                &quot;id=&quot; + id +</span><br><span class=\"line\">                &quot;, user_uuid=&apos;&quot; + user_uuid + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, username=&apos;&quot; + username + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, password=&apos;&quot; + password + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, email=&apos;&quot; + email + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, telephone=&apos;&quot; + telephone + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, role=&apos;&quot; + role + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, image=&apos;&quot; + image + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, last_ip=&apos;&quot; + last_ip + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, last_time=&apos;&quot; + last_time + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &apos;&#125;&apos;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4 . application.yml配置一些基本属性</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  resources:</span><br><span class=\"line\">    static-locations: classpath:/</span><br><span class=\"line\">  freemarker:</span><br><span class=\"line\">    template-loader-path: classpath:/templates/</span><br><span class=\"line\">    suffix: .html</span><br><span class=\"line\">    content-type: text/html</span><br><span class=\"line\">    charset: UTF-8</span><br><span class=\"line\">  datasource:</span><br><span class=\"line\">      url: jdbc:mysql://localhost:3306/yourdatabase</span><br><span class=\"line\">      username: yourname</span><br><span class=\"line\">      password: yourpass</span><br><span class=\"line\">      driver-class-name: com.mysql.jdbc.Driver</span><br><span class=\"line\">      type: com.alibaba.druid.pool.DruidDataSource</span><br><span class=\"line\">server:</span><br><span class=\"line\">  port: 8083</span><br><span class=\"line\">  error:</span><br><span class=\"line\">    whitelabel:</span><br><span class=\"line\">      enabled: true</span><br></pre></td></tr></table></figure>\n<p>5 . 考虑我们应用的效率 , 可以配置数据源和线程池 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.config;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.alibaba.druid.pool.DruidDataSource;</span><br><span class=\"line\">import com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class=\"line\">import com.alibaba.druid.support.http.StatViewServlet;</span><br><span class=\"line\">import com.alibaba.druid.support.http.WebStatFilter;</span><br><span class=\"line\">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\">import org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class=\"line\">import org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.core.env.*;</span><br><span class=\"line\"></span><br><span class=\"line\">import javax.sql.DataSource;</span><br><span class=\"line\">import java.util.HashMap;</span><br><span class=\"line\">import java.util.Map;</span><br><span class=\"line\">import java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">public class DruidConfig &#123;</span><br><span class=\"line\">    private static final String DB_PREFIX = &quot;spring.datasource.&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private Environment environment;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    @ConfigurationProperties(prefix = DB_PREFIX)</span><br><span class=\"line\">    public DataSource druidDataSource() &#123;</span><br><span class=\"line\">        Properties dbProperties = new Properties();</span><br><span class=\"line\">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class=\"line\">        for (PropertySource&lt;?&gt; propertySource : ((AbstractEnvironment) environment).getPropertySources()) &#123;</span><br><span class=\"line\">            getPropertiesFromSource(propertySource, map);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        dbProperties.putAll(map);</span><br><span class=\"line\">        DruidDataSource dds;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            dds = (DruidDataSource) DruidDataSourceFactory.createDataSource(dbProperties);</span><br><span class=\"line\">            dds.init();</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            throw new RuntimeException(&quot;load datasource error, dbProperties is :&quot; + dbProperties, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return dds;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private void getPropertiesFromSource(PropertySource&lt;?&gt; propertySource, Map&lt;String, Object&gt; map) &#123;</span><br><span class=\"line\">        if (propertySource instanceof MapPropertySource) &#123;</span><br><span class=\"line\">            for (String key : ((MapPropertySource) propertySource).getPropertyNames()) &#123;</span><br><span class=\"line\">                if (key.startsWith(DB_PREFIX))</span><br><span class=\"line\">                    map.put(key.replaceFirst(DB_PREFIX, &quot;&quot;), propertySource.getProperty(key));</span><br><span class=\"line\">                else if (key.startsWith(DB_PREFIX))</span><br><span class=\"line\">                    map.put(key.replaceFirst(DB_PREFIX, &quot;&quot;), propertySource.getProperty(key));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        if (propertySource instanceof CompositePropertySource) &#123;</span><br><span class=\"line\">            for (PropertySource&lt;?&gt; s : ((CompositePropertySource) propertySource).getPropertySources()) &#123;</span><br><span class=\"line\">                getPropertiesFromSource(s, map);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public ServletRegistrationBean druidServlet() &#123;</span><br><span class=\"line\">        return new ServletRegistrationBean(new StatViewServlet(), &quot;/druid/*&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public FilterRegistrationBean filterRegistrationBean() &#123;</span><br><span class=\"line\">        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();</span><br><span class=\"line\">        filterRegistrationBean.setFilter(new WebStatFilter());</span><br><span class=\"line\">        filterRegistrationBean.addUrlPatterns(&quot;/*&quot;);</span><br><span class=\"line\">        filterRegistrationBean.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);</span><br><span class=\"line\">        return filterRegistrationBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>配置线程池 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.config;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.scheduling.annotation.EnableAsync;</span><br><span class=\"line\">import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.util.concurrent.Executor;</span><br><span class=\"line\">import java.util.concurrent.ThreadPoolExecutor;</span><br><span class=\"line\"></span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">@EnableAsync</span><br><span class=\"line\">public class ThreadPoolConfig &#123;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public Executor getExecutor() &#123;</span><br><span class=\"line\">        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br><span class=\"line\">        executor.setCorePoolSize(5);//线程池维护线程的最少数量</span><br><span class=\"line\">        executor.setMaxPoolSize(30);//线程池维护线程的最大数量</span><br><span class=\"line\">        executor.setQueueCapacity(8); //缓存队列</span><br><span class=\"line\">        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); //对拒绝task的处理策略</span><br><span class=\"line\">        executor.setKeepAliveSeconds(60);//允许的空闲时间</span><br><span class=\"line\">        executor.initialize();</span><br><span class=\"line\">        return executor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>6.用户需要根据用户名进行登录，访问数据库 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import org.springframework.data.jpa.repository.JpaRepository;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/11 14:23</span><br><span class=\"line\"> */</span><br><span class=\"line\">public interface UserRepository extends JpaRepository&lt;User, Integer&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    User findByUsername(String username);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>7.构建真正用于SpringSecurity登录的安全用户(UserDetails)，我这里使用新建了一个POJO来实现 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.security;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import org.springframework.security.core.GrantedAuthority;</span><br><span class=\"line\">import org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.util.ArrayList;</span><br><span class=\"line\">import java.util.Collection;</span><br><span class=\"line\"></span><br><span class=\"line\">public class SecurityUser extends User implements UserDetails &#123;</span><br><span class=\"line\">    private static final long serialVersionUID = 1L;</span><br><span class=\"line\"></span><br><span class=\"line\">    public SecurityUser(User user) &#123;</span><br><span class=\"line\">        if (user != null) &#123;</span><br><span class=\"line\">            this.setUser_uuid(user.getUser_uuid());</span><br><span class=\"line\">            this.setUsername(user.getUsername());</span><br><span class=\"line\">            this.setPassword(user.getPassword());</span><br><span class=\"line\">            this.setEmail(user.getEmail());</span><br><span class=\"line\">            this.setTelephone(user.getTelephone());</span><br><span class=\"line\">            this.setRole(user.getRole());</span><br><span class=\"line\">            this.setImage(user.getImage());</span><br><span class=\"line\">            this.setLast_ip(user.getLast_ip());</span><br><span class=\"line\">            this.setLast_time(user.getLast_time());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class=\"line\">        Collection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();</span><br><span class=\"line\">        String username = this.getUsername();</span><br><span class=\"line\">        if (username != null) &#123;</span><br><span class=\"line\">            SimpleGrantedAuthority authority = new SimpleGrantedAuthority(username);</span><br><span class=\"line\">            authorities.add(authority);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return authorities;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isAccountNonExpired() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isAccountNonLocked() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isCredentialsNonExpired() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isEnabled() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>8 . 核心配置，配置SpringSecurity访问策略，包括登录处理，登出处理，资源访问，密码基本加密。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.config;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.wuxicloud.dao.UserRepository;</span><br><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import com.wuxicloud.security.SecurityUser;</span><br><span class=\"line\">import org.slf4j.Logger;</span><br><span class=\"line\">import org.slf4j.LoggerFactory;</span><br><span class=\"line\">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class=\"line\">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class=\"line\">import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class=\"line\">import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class=\"line\">import org.springframework.security.core.Authentication;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class=\"line\">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class=\"line\">import org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;</span><br><span class=\"line\">import org.springframework.security.web.authentication.logout.LogoutSuccessHandler;</span><br><span class=\"line\"></span><br><span class=\"line\">import javax.servlet.ServletException;</span><br><span class=\"line\">import javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\">import javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\">import java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/1/11.</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">@EnableWebSecurity</span><br><span class=\"line\">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class=\"line\">    private static final Logger logger = LoggerFactory.getLogger(WebSecurityConfig.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void configure(HttpSecurity http) throws Exception &#123; //配置策略</span><br><span class=\"line\">        http.csrf().disable();</span><br><span class=\"line\">        http.authorizeRequests().</span><br><span class=\"line\">                antMatchers(&quot;/static/**&quot;).permitAll().anyRequest().authenticated().</span><br><span class=\"line\">                and().formLogin().loginPage(&quot;/login&quot;).permitAll().successHandler(loginSuccessHandler()).</span><br><span class=\"line\">                and().logout().permitAll().invalidateHttpSession(true).</span><br><span class=\"line\">                deleteCookies(&quot;JSESSIONID&quot;).logoutSuccessHandler(logoutSuccessHandler()).</span><br><span class=\"line\">                and().sessionManagement().maximumSessions(10).expiredUrl(&quot;/login&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class=\"line\">        auth.userDetailsService(userDetailsService()).passwordEncoder(passwordEncoder());</span><br><span class=\"line\">        auth.eraseCredentials(false);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public BCryptPasswordEncoder passwordEncoder() &#123; //密码加密</span><br><span class=\"line\">        return new BCryptPasswordEncoder(4);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public LogoutSuccessHandler logoutSuccessHandler() &#123; //登出处理</span><br><span class=\"line\">        return new LogoutSuccessHandler() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onLogoutSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException &#123;</span><br><span class=\"line\">                try &#123;</span><br><span class=\"line\">                    SecurityUser user = (SecurityUser) authentication.getPrincipal();</span><br><span class=\"line\">                    logger.info(&quot;USER : &quot; + user.getUsername() + &quot; LOGOUT SUCCESS !  &quot;);</span><br><span class=\"line\">                &#125; catch (Exception e) &#123;</span><br><span class=\"line\">                    logger.info(&quot;LOGOUT EXCEPTION , e : &quot; + e.getMessage());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                httpServletResponse.sendRedirect(&quot;/login&quot;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public SavedRequestAwareAuthenticationSuccessHandler loginSuccessHandler() &#123; //登入处理</span><br><span class=\"line\">        return new SavedRequestAwareAuthenticationSuccessHandler() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException &#123;</span><br><span class=\"line\">                User userDetails = (User) authentication.getPrincipal();</span><br><span class=\"line\">                logger.info(&quot;USER : &quot; + userDetails.getUsername() + &quot; LOGIN SUCCESS !  &quot;);</span><br><span class=\"line\">                super.onAuthenticationSuccess(request, response, authentication);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public UserDetailsService userDetailsService() &#123;    //用户登录实现</span><br><span class=\"line\">        return new UserDetailsService() &#123;</span><br><span class=\"line\">            @Autowired</span><br><span class=\"line\">            private UserRepository userRepository;</span><br><span class=\"line\"></span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException &#123;</span><br><span class=\"line\">                User user = userRepository.findByUsername(s);</span><br><span class=\"line\">                if (user == null) throw new UsernameNotFoundException(&quot;Username &quot; + s + &quot; not found&quot;);</span><br><span class=\"line\">                return new SecurityUser(user);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>9.至此，已经基本将配置搭建好了，从上面核心可以看出，配置的登录页的url 为/login，可以创建基本的Controller来验证登录了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.web;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import org.springframework.security.core.Authentication;</span><br><span class=\"line\">import org.springframework.security.core.context.SecurityContext;</span><br><span class=\"line\">import org.springframework.security.core.context.SecurityContextHolder;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class=\"line\">import org.springframework.stereotype.Controller;</span><br><span class=\"line\">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class=\"line\">import org.springframework.web.context.request.RequestContextHolder;</span><br><span class=\"line\">import org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class=\"line\"></span><br><span class=\"line\">import javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/1/11.</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Controller</span><br><span class=\"line\">public class LoginController &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RequestMapping(value = &quot;/login&quot;, method = RequestMethod.GET)</span><br><span class=\"line\">    public String login() &#123;</span><br><span class=\"line\">        return &quot;login&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RequestMapping(&quot;/&quot;)</span><br><span class=\"line\">    public String root() &#123;</span><br><span class=\"line\">        return &quot;index&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public User getUser() &#123; //为了session从获取用户信息,可以配置如下</span><br><span class=\"line\">        User user = new User();</span><br><span class=\"line\">        SecurityContext ctx = SecurityContextHolder.getContext();</span><br><span class=\"line\">        Authentication auth = ctx.getAuthentication();</span><br><span class=\"line\">        if (auth.getPrincipal() instanceof UserDetails) user = (User) auth.getPrincipal();</span><br><span class=\"line\">        return user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public HttpServletRequest getRequest() &#123;</span><br><span class=\"line\">        return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>11 . SpringBoot基本的启动类 Application.class</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.springframework.boot.SpringApplication;</span><br><span class=\"line\">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/11 15:01</span><br><span class=\"line\"> */</span><br><span class=\"line\">@SpringBootApplication</span><br><span class=\"line\">public class Application &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        SpringApplication.run(Application.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>11.根据Freemark和Controller里面可看出配置的视图为 /templates/index.html和/templates/index.login。所以创建基本的登录页面和登录成功页面。</p>\n<p>login.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;用户登录&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span><br><span class=\"line\">    用户名 : &lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt;</span><br><span class=\"line\">    密码 : &lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;</span><br><span class=\"line\">    &lt;input type=&quot;submit&quot; value=&quot;登录&quot;&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>注意 : 这里方法必须是POST，因为GET在controller被重写了，用户名的name属性必须是username，密码的name属性必须是password</p>\n<p>index.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;首页&lt;/title&gt;</span><br><span class=\"line\">    &lt;#assign  user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">欢迎你,$&#123;user.username&#125;&lt;br/&gt;</span><br><span class=\"line\">&lt;a href=&quot;/logout&quot;&gt;注销&lt;/a&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>注意 : 为了从session中获取到登录的用户信息，根据配置SpringSecurity的用户信息会放在Session.SPRING_SECURITY_CONTEXT.authentication.principal里面，根据FreeMarker模板引擎的特点，可以通过这种方式进行获取 : &lt;#assign user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/&gt;</p>\n<p>12 . 为了方便测试，我们在数据库中插入一条记录，注意，从WebSecurity.java配置可以知道密码会被加密，所以我们插入的用户密码应该是被加密的。</p>\n<p>这里假如我们使用的密码为admin，则加密过后的字符串是 $2a$04$1OiUa3yEchBXQBJI8JaMyuKZNlwzWvfeQjKAHnwAEQwnacjt6ukqu</p>\n<p>　测试类如下 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.security;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.junit.Test;</span><br><span class=\"line\">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/11 15:13</span><br><span class=\"line\"> */</span><br><span class=\"line\">public class TestEncoder &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void encoder() &#123;</span><br><span class=\"line\">        String password = &quot;admin&quot;;</span><br><span class=\"line\">        BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(4);</span><br><span class=\"line\">        String enPassword = encoder.encode(password);</span><br><span class=\"line\">        System.out.println(enPassword);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>测试登录，从上面的加密的密码我们插入一条数据到数据库中。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT INTO `USER` VALUES (1, &apos;d242ae49-4734-411e-8c8d-d2b09e87c3c8&apos;, &apos;EalenXie&apos;, &apos;$2a$04$petEXpgcLKfdLN4TYFxK0u8ryAzmZDHLASWLX/XXm8hgQar1C892W&apos;, &apos;SSSSS&apos;, &apos;ssssssssss&apos;, 1, &apos;g&apos;, &apos;0:0:0:0:0:0:0:1&apos;, &apos;2018-07-11 11:26:27&apos;);</span><br></pre></td></tr></table></figure>\n<p>13 . 启动项目进行测试 ，访问 localhost:8083</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154124007-1732228495.png\" alt=\"img\"></p>\n<p>点击登录，登录失败会留在当前页面重新登录，成功则进入index.html</p>\n<p>登录如果成功，可以看到后台打印登录成功的日志 :</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154258208-1381186085.png\" alt=\"img\"></p>\n<p>页面进入index.html :</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154337891-1871092340.png\" alt=\"img\"></p>\n<p>点击注销 ，则回重新跳转到login.html，后台也会打印登出成功的日志 :</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154539312-15547252.png\" alt=\"img\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>技术栈 : SpringBoot + SpringSecurity + jpa + freemark ，完整项目地址 : <a href=\"https://github.com/EalenXie/spring-security-login\" target=\"_blank\" rel=\"noopener\">https://github.com/EalenXie/spring-security-login</a></p>\n<p>1 . 新建一个spring-security-login的maven项目 ，pom.xml添加基本依赖 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class=\"line\">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class=\"line\">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class=\"line\">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;groupId&gt;com.wuxicloud&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-security-login&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class=\"line\">    &lt;parent&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;1.5.6.RELEASE&lt;/version&gt;</span><br><span class=\"line\">    &lt;/parent&gt;</span><br><span class=\"line\">    &lt;properties&gt;</span><br><span class=\"line\">        &lt;author&gt;EalenXie&lt;/author&gt;</span><br><span class=\"line\">        &lt;description&gt;SpringBoot整合SpringSecurity实现简单登入登出&lt;/description&gt;</span><br><span class=\"line\">    &lt;/properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;!--alibaba--&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.0.24&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.2.31&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n<p>2 . 准备你的数据库，设计表结构，要用户使用登入登出，新建用户表。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP TABLE IF EXISTS `user`;</span><br><span class=\"line\">CREATE TABLE `user`  (</span><br><span class=\"line\">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class=\"line\">  `user_uuid` varchar(70) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `username` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `password` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `email` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `telephone` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `role` int(10) DEFAULT NULL,</span><br><span class=\"line\">  `image` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `last_ip` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  `last_time` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`id`) USING BTREE</span><br><span class=\"line\">) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span><br><span class=\"line\"></span><br><span class=\"line\">SET FOREIGN_KEY_CHECKS = 1;</span><br></pre></td></tr></table></figure>\n<p>3 . 用户对象User.java :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import javax.persistence.*;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/5 15:17</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Entity</span><br><span class=\"line\">@Table(name = &quot;USER&quot;)</span><br><span class=\"line\">public class User &#123;</span><br><span class=\"line\">    @Id</span><br><span class=\"line\">    @GeneratedValue(strategy = GenerationType.AUTO)</span><br><span class=\"line\">    private Integer id;</span><br><span class=\"line\">    private String user_uuid;   //用户UUID</span><br><span class=\"line\">    private String username;    //用户名</span><br><span class=\"line\">    private String password;    //用户密码</span><br><span class=\"line\">    private String email;       //用户邮箱</span><br><span class=\"line\">    private String telephone;   //电话号码</span><br><span class=\"line\">    private String role;        //用户角色</span><br><span class=\"line\">    private String image;       //用户头像</span><br><span class=\"line\">    private String last_ip;     //上次登录IP</span><br><span class=\"line\">    private String last_time;   //上次登录时间</span><br><span class=\"line\"></span><br><span class=\"line\">    public Integer getId() &#123;</span><br><span class=\"line\">        return id;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getRole() &#123;</span><br><span class=\"line\">        return role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setRole(String role) &#123;</span><br><span class=\"line\">        this.role = role;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getImage() &#123;</span><br><span class=\"line\">        return image;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setImage(String image) &#123;</span><br><span class=\"line\">        this.image = image;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setId(Integer id) &#123;</span><br><span class=\"line\">        this.id = id;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    public String getUsername() &#123;</span><br><span class=\"line\">        return username;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setUsername(String username) &#123;</span><br><span class=\"line\">        this.username = username;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getEmail() &#123;</span><br><span class=\"line\">        return email;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setEmail(String email) &#123;</span><br><span class=\"line\">        this.email = email;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getTelephone() &#123;</span><br><span class=\"line\">        return telephone;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setTelephone(String telephone) &#123;</span><br><span class=\"line\">        this.telephone = telephone;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getPassword() &#123;</span><br><span class=\"line\">        return password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setPassword(String password) &#123;</span><br><span class=\"line\">        this.password = password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getUser_uuid() &#123;</span><br><span class=\"line\">        return user_uuid;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setUser_uuid(String user_uuid) &#123;</span><br><span class=\"line\">        this.user_uuid = user_uuid;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getLast_ip() &#123;</span><br><span class=\"line\">        return last_ip;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setLast_ip(String last_ip) &#123;</span><br><span class=\"line\">        this.last_ip = last_ip;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getLast_time() &#123;</span><br><span class=\"line\">        return last_time;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setLast_time(String last_time) &#123;</span><br><span class=\"line\">        this.last_time = last_time;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public String toString() &#123;</span><br><span class=\"line\">        return &quot;User&#123;&quot; +</span><br><span class=\"line\">                &quot;id=&quot; + id +</span><br><span class=\"line\">                &quot;, user_uuid=&apos;&quot; + user_uuid + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, username=&apos;&quot; + username + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, password=&apos;&quot; + password + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, email=&apos;&quot; + email + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, telephone=&apos;&quot; + telephone + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, role=&apos;&quot; + role + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, image=&apos;&quot; + image + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, last_ip=&apos;&quot; + last_ip + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &quot;, last_time=&apos;&quot; + last_time + &apos;\\&apos;&apos; +</span><br><span class=\"line\">                &apos;&#125;&apos;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4 . application.yml配置一些基本属性</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  resources:</span><br><span class=\"line\">    static-locations: classpath:/</span><br><span class=\"line\">  freemarker:</span><br><span class=\"line\">    template-loader-path: classpath:/templates/</span><br><span class=\"line\">    suffix: .html</span><br><span class=\"line\">    content-type: text/html</span><br><span class=\"line\">    charset: UTF-8</span><br><span class=\"line\">  datasource:</span><br><span class=\"line\">      url: jdbc:mysql://localhost:3306/yourdatabase</span><br><span class=\"line\">      username: yourname</span><br><span class=\"line\">      password: yourpass</span><br><span class=\"line\">      driver-class-name: com.mysql.jdbc.Driver</span><br><span class=\"line\">      type: com.alibaba.druid.pool.DruidDataSource</span><br><span class=\"line\">server:</span><br><span class=\"line\">  port: 8083</span><br><span class=\"line\">  error:</span><br><span class=\"line\">    whitelabel:</span><br><span class=\"line\">      enabled: true</span><br></pre></td></tr></table></figure>\n<p>5 . 考虑我们应用的效率 , 可以配置数据源和线程池 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.config;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.alibaba.druid.pool.DruidDataSource;</span><br><span class=\"line\">import com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class=\"line\">import com.alibaba.druid.support.http.StatViewServlet;</span><br><span class=\"line\">import com.alibaba.druid.support.http.WebStatFilter;</span><br><span class=\"line\">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\">import org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class=\"line\">import org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.core.env.*;</span><br><span class=\"line\"></span><br><span class=\"line\">import javax.sql.DataSource;</span><br><span class=\"line\">import java.util.HashMap;</span><br><span class=\"line\">import java.util.Map;</span><br><span class=\"line\">import java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">public class DruidConfig &#123;</span><br><span class=\"line\">    private static final String DB_PREFIX = &quot;spring.datasource.&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private Environment environment;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    @ConfigurationProperties(prefix = DB_PREFIX)</span><br><span class=\"line\">    public DataSource druidDataSource() &#123;</span><br><span class=\"line\">        Properties dbProperties = new Properties();</span><br><span class=\"line\">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class=\"line\">        for (PropertySource&lt;?&gt; propertySource : ((AbstractEnvironment) environment).getPropertySources()) &#123;</span><br><span class=\"line\">            getPropertiesFromSource(propertySource, map);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        dbProperties.putAll(map);</span><br><span class=\"line\">        DruidDataSource dds;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            dds = (DruidDataSource) DruidDataSourceFactory.createDataSource(dbProperties);</span><br><span class=\"line\">            dds.init();</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            throw new RuntimeException(&quot;load datasource error, dbProperties is :&quot; + dbProperties, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return dds;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private void getPropertiesFromSource(PropertySource&lt;?&gt; propertySource, Map&lt;String, Object&gt; map) &#123;</span><br><span class=\"line\">        if (propertySource instanceof MapPropertySource) &#123;</span><br><span class=\"line\">            for (String key : ((MapPropertySource) propertySource).getPropertyNames()) &#123;</span><br><span class=\"line\">                if (key.startsWith(DB_PREFIX))</span><br><span class=\"line\">                    map.put(key.replaceFirst(DB_PREFIX, &quot;&quot;), propertySource.getProperty(key));</span><br><span class=\"line\">                else if (key.startsWith(DB_PREFIX))</span><br><span class=\"line\">                    map.put(key.replaceFirst(DB_PREFIX, &quot;&quot;), propertySource.getProperty(key));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        if (propertySource instanceof CompositePropertySource) &#123;</span><br><span class=\"line\">            for (PropertySource&lt;?&gt; s : ((CompositePropertySource) propertySource).getPropertySources()) &#123;</span><br><span class=\"line\">                getPropertiesFromSource(s, map);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public ServletRegistrationBean druidServlet() &#123;</span><br><span class=\"line\">        return new ServletRegistrationBean(new StatViewServlet(), &quot;/druid/*&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public FilterRegistrationBean filterRegistrationBean() &#123;</span><br><span class=\"line\">        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();</span><br><span class=\"line\">        filterRegistrationBean.setFilter(new WebStatFilter());</span><br><span class=\"line\">        filterRegistrationBean.addUrlPatterns(&quot;/*&quot;);</span><br><span class=\"line\">        filterRegistrationBean.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);</span><br><span class=\"line\">        return filterRegistrationBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>配置线程池 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.config;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.scheduling.annotation.EnableAsync;</span><br><span class=\"line\">import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.util.concurrent.Executor;</span><br><span class=\"line\">import java.util.concurrent.ThreadPoolExecutor;</span><br><span class=\"line\"></span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">@EnableAsync</span><br><span class=\"line\">public class ThreadPoolConfig &#123;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public Executor getExecutor() &#123;</span><br><span class=\"line\">        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span><br><span class=\"line\">        executor.setCorePoolSize(5);//线程池维护线程的最少数量</span><br><span class=\"line\">        executor.setMaxPoolSize(30);//线程池维护线程的最大数量</span><br><span class=\"line\">        executor.setQueueCapacity(8); //缓存队列</span><br><span class=\"line\">        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); //对拒绝task的处理策略</span><br><span class=\"line\">        executor.setKeepAliveSeconds(60);//允许的空闲时间</span><br><span class=\"line\">        executor.initialize();</span><br><span class=\"line\">        return executor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>6.用户需要根据用户名进行登录，访问数据库 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import org.springframework.data.jpa.repository.JpaRepository;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/11 14:23</span><br><span class=\"line\"> */</span><br><span class=\"line\">public interface UserRepository extends JpaRepository&lt;User, Integer&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    User findByUsername(String username);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>7.构建真正用于SpringSecurity登录的安全用户(UserDetails)，我这里使用新建了一个POJO来实现 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.security;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import org.springframework.security.core.GrantedAuthority;</span><br><span class=\"line\">import org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.util.ArrayList;</span><br><span class=\"line\">import java.util.Collection;</span><br><span class=\"line\"></span><br><span class=\"line\">public class SecurityUser extends User implements UserDetails &#123;</span><br><span class=\"line\">    private static final long serialVersionUID = 1L;</span><br><span class=\"line\"></span><br><span class=\"line\">    public SecurityUser(User user) &#123;</span><br><span class=\"line\">        if (user != null) &#123;</span><br><span class=\"line\">            this.setUser_uuid(user.getUser_uuid());</span><br><span class=\"line\">            this.setUsername(user.getUsername());</span><br><span class=\"line\">            this.setPassword(user.getPassword());</span><br><span class=\"line\">            this.setEmail(user.getEmail());</span><br><span class=\"line\">            this.setTelephone(user.getTelephone());</span><br><span class=\"line\">            this.setRole(user.getRole());</span><br><span class=\"line\">            this.setImage(user.getImage());</span><br><span class=\"line\">            this.setLast_ip(user.getLast_ip());</span><br><span class=\"line\">            this.setLast_time(user.getLast_time());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class=\"line\">        Collection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();</span><br><span class=\"line\">        String username = this.getUsername();</span><br><span class=\"line\">        if (username != null) &#123;</span><br><span class=\"line\">            SimpleGrantedAuthority authority = new SimpleGrantedAuthority(username);</span><br><span class=\"line\">            authorities.add(authority);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return authorities;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isAccountNonExpired() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isAccountNonLocked() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isCredentialsNonExpired() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean isEnabled() &#123;</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>8 . 核心配置，配置SpringSecurity访问策略，包括登录处理，登出处理，资源访问，密码基本加密。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.config;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.wuxicloud.dao.UserRepository;</span><br><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import com.wuxicloud.security.SecurityUser;</span><br><span class=\"line\">import org.slf4j.Logger;</span><br><span class=\"line\">import org.slf4j.LoggerFactory;</span><br><span class=\"line\">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class=\"line\">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class=\"line\">import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class=\"line\">import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class=\"line\">import org.springframework.security.core.Authentication;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class=\"line\">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class=\"line\">import org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;</span><br><span class=\"line\">import org.springframework.security.web.authentication.logout.LogoutSuccessHandler;</span><br><span class=\"line\"></span><br><span class=\"line\">import javax.servlet.ServletException;</span><br><span class=\"line\">import javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\">import javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\">import java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/1/11.</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">@EnableWebSecurity</span><br><span class=\"line\">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class=\"line\">    private static final Logger logger = LoggerFactory.getLogger(WebSecurityConfig.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    protected void configure(HttpSecurity http) throws Exception &#123; //配置策略</span><br><span class=\"line\">        http.csrf().disable();</span><br><span class=\"line\">        http.authorizeRequests().</span><br><span class=\"line\">                antMatchers(&quot;/static/**&quot;).permitAll().anyRequest().authenticated().</span><br><span class=\"line\">                and().formLogin().loginPage(&quot;/login&quot;).permitAll().successHandler(loginSuccessHandler()).</span><br><span class=\"line\">                and().logout().permitAll().invalidateHttpSession(true).</span><br><span class=\"line\">                deleteCookies(&quot;JSESSIONID&quot;).logoutSuccessHandler(logoutSuccessHandler()).</span><br><span class=\"line\">                and().sessionManagement().maximumSessions(10).expiredUrl(&quot;/login&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class=\"line\">        auth.userDetailsService(userDetailsService()).passwordEncoder(passwordEncoder());</span><br><span class=\"line\">        auth.eraseCredentials(false);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public BCryptPasswordEncoder passwordEncoder() &#123; //密码加密</span><br><span class=\"line\">        return new BCryptPasswordEncoder(4);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public LogoutSuccessHandler logoutSuccessHandler() &#123; //登出处理</span><br><span class=\"line\">        return new LogoutSuccessHandler() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onLogoutSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException &#123;</span><br><span class=\"line\">                try &#123;</span><br><span class=\"line\">                    SecurityUser user = (SecurityUser) authentication.getPrincipal();</span><br><span class=\"line\">                    logger.info(&quot;USER : &quot; + user.getUsername() + &quot; LOGOUT SUCCESS !  &quot;);</span><br><span class=\"line\">                &#125; catch (Exception e) &#123;</span><br><span class=\"line\">                    logger.info(&quot;LOGOUT EXCEPTION , e : &quot; + e.getMessage());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                httpServletResponse.sendRedirect(&quot;/login&quot;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public SavedRequestAwareAuthenticationSuccessHandler loginSuccessHandler() &#123; //登入处理</span><br><span class=\"line\">        return new SavedRequestAwareAuthenticationSuccessHandler() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException &#123;</span><br><span class=\"line\">                User userDetails = (User) authentication.getPrincipal();</span><br><span class=\"line\">                logger.info(&quot;USER : &quot; + userDetails.getUsername() + &quot; LOGIN SUCCESS !  &quot;);</span><br><span class=\"line\">                super.onAuthenticationSuccess(request, response, authentication);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public UserDetailsService userDetailsService() &#123;    //用户登录实现</span><br><span class=\"line\">        return new UserDetailsService() &#123;</span><br><span class=\"line\">            @Autowired</span><br><span class=\"line\">            private UserRepository userRepository;</span><br><span class=\"line\"></span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException &#123;</span><br><span class=\"line\">                User user = userRepository.findByUsername(s);</span><br><span class=\"line\">                if (user == null) throw new UsernameNotFoundException(&quot;Username &quot; + s + &quot; not found&quot;);</span><br><span class=\"line\">                return new SecurityUser(user);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>9.至此，已经基本将配置搭建好了，从上面核心可以看出，配置的登录页的url 为/login，可以创建基本的Controller来验证登录了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.web;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.wuxicloud.model.User;</span><br><span class=\"line\">import org.springframework.security.core.Authentication;</span><br><span class=\"line\">import org.springframework.security.core.context.SecurityContext;</span><br><span class=\"line\">import org.springframework.security.core.context.SecurityContextHolder;</span><br><span class=\"line\">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class=\"line\">import org.springframework.stereotype.Controller;</span><br><span class=\"line\">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class=\"line\">import org.springframework.web.context.request.RequestContextHolder;</span><br><span class=\"line\">import org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class=\"line\"></span><br><span class=\"line\">import javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/1/11.</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Controller</span><br><span class=\"line\">public class LoginController &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RequestMapping(value = &quot;/login&quot;, method = RequestMethod.GET)</span><br><span class=\"line\">    public String login() &#123;</span><br><span class=\"line\">        return &quot;login&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @RequestMapping(&quot;/&quot;)</span><br><span class=\"line\">    public String root() &#123;</span><br><span class=\"line\">        return &quot;index&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public User getUser() &#123; //为了session从获取用户信息,可以配置如下</span><br><span class=\"line\">        User user = new User();</span><br><span class=\"line\">        SecurityContext ctx = SecurityContextHolder.getContext();</span><br><span class=\"line\">        Authentication auth = ctx.getAuthentication();</span><br><span class=\"line\">        if (auth.getPrincipal() instanceof UserDetails) user = (User) auth.getPrincipal();</span><br><span class=\"line\">        return user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public HttpServletRequest getRequest() &#123;</span><br><span class=\"line\">        return ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>11 . SpringBoot基本的启动类 Application.class</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.springframework.boot.SpringApplication;</span><br><span class=\"line\">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/11 15:01</span><br><span class=\"line\"> */</span><br><span class=\"line\">@SpringBootApplication</span><br><span class=\"line\">public class Application &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        SpringApplication.run(Application.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>11.根据Freemark和Controller里面可看出配置的视图为 /templates/index.html和/templates/index.login。所以创建基本的登录页面和登录成功页面。</p>\n<p>login.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;用户登录&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span><br><span class=\"line\">    用户名 : &lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt;</span><br><span class=\"line\">    密码 : &lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;</span><br><span class=\"line\">    &lt;input type=&quot;submit&quot; value=&quot;登录&quot;&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>注意 : 这里方法必须是POST，因为GET在controller被重写了，用户名的name属性必须是username，密码的name属性必须是password</p>\n<p>index.html</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;首页&lt;/title&gt;</span><br><span class=\"line\">    &lt;#assign  user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">欢迎你,$&#123;user.username&#125;&lt;br/&gt;</span><br><span class=\"line\">&lt;a href=&quot;/logout&quot;&gt;注销&lt;/a&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>注意 : 为了从session中获取到登录的用户信息，根据配置SpringSecurity的用户信息会放在Session.SPRING_SECURITY_CONTEXT.authentication.principal里面，根据FreeMarker模板引擎的特点，可以通过这种方式进行获取 : &lt;#assign user=Session.SPRING_SECURITY_CONTEXT.authentication.principal/&gt;</p>\n<p>12 . 为了方便测试，我们在数据库中插入一条记录，注意，从WebSecurity.java配置可以知道密码会被加密，所以我们插入的用户密码应该是被加密的。</p>\n<p>这里假如我们使用的密码为admin，则加密过后的字符串是 $2a$04$1OiUa3yEchBXQBJI8JaMyuKZNlwzWvfeQjKAHnwAEQwnacjt6ukqu</p>\n<p>　测试类如下 :</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.wuxicloud.security;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.junit.Test;</span><br><span class=\"line\">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by EalenXie on 2018/7/11 15:13</span><br><span class=\"line\"> */</span><br><span class=\"line\">public class TestEncoder &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void encoder() &#123;</span><br><span class=\"line\">        String password = &quot;admin&quot;;</span><br><span class=\"line\">        BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(4);</span><br><span class=\"line\">        String enPassword = encoder.encode(password);</span><br><span class=\"line\">        System.out.println(enPassword);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>测试登录，从上面的加密的密码我们插入一条数据到数据库中。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT INTO `USER` VALUES (1, &apos;d242ae49-4734-411e-8c8d-d2b09e87c3c8&apos;, &apos;EalenXie&apos;, &apos;$2a$04$petEXpgcLKfdLN4TYFxK0u8ryAzmZDHLASWLX/XXm8hgQar1C892W&apos;, &apos;SSSSS&apos;, &apos;ssssssssss&apos;, 1, &apos;g&apos;, &apos;0:0:0:0:0:0:0:1&apos;, &apos;2018-07-11 11:26:27&apos;);</span><br></pre></td></tr></table></figure>\n<p>13 . 启动项目进行测试 ，访问 localhost:8083</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154124007-1732228495.png\" alt=\"img\"></p>\n<p>点击登录，登录失败会留在当前页面重新登录，成功则进入index.html</p>\n<p>登录如果成功，可以看到后台打印登录成功的日志 :</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154258208-1381186085.png\" alt=\"img\"></p>\n<p>页面进入index.html :</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154337891-1871092340.png\" alt=\"img\"></p>\n<p>点击注销 ，则回重新跳转到login.html，后台也会打印登出成功的日志 :</p>\n<p><img src=\"https://images2018.cnblogs.com/blog/994599/201807/994599-20180711154539312-15547252.png\" alt=\"img\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjvg26t7x003hgcoivcsbyacf","category_id":"cjvg26t80003kgcoid578a6xj","_id":"cjvg26t85003rgcoied314wlg"}],"PostTag":[{"post_id":"cjvg26t170002gcoigwoviy89","tag_id":"cjvg26t1e0005gcoiwag9uj4d","_id":"cjvg26t1k000agcoi37b86kuk"},{"post_id":"cjvg26t1c0004gcoi3jt4jyf0","tag_id":"cjvg26t1j0009gcoi2rthw2o9","_id":"cjvg26t1o000fgcoihvwkdvd7"},{"post_id":"cjvg26t1g0006gcoipkzpx8x9","tag_id":"cjvg26t1j0009gcoi2rthw2o9","_id":"cjvg26t1q000jgcoimrnio08q"},{"post_id":"cjvg26t1o000ggcoi2tsa3s24","tag_id":"cjvg26t1j0009gcoi2rthw2o9","_id":"cjvg26t1r000lgcoivwbe04z2"},{"post_id":"cjvg26t1q000igcoi6pd41z6l","tag_id":"cjvg26t1j0009gcoi2rthw2o9","_id":"cjvg26t1s000ogcoi4iemcsw8"},{"post_id":"cjvg26t1h0007gcoij78tkikh","tag_id":"cjvg26t1p000hgcoi2k5udqlf","_id":"cjvg26t1t000qgcoir887bxc1"},{"post_id":"cjvg26t1i0008gcoi10qb3fnv","tag_id":"cjvg26t1r000mgcoizemkfh8v","_id":"cjvg26t1v000tgcoiwdm1t2i0"},{"post_id":"cjvg26t1k000bgcoimu0cmkjf","tag_id":"cjvg26t1u000rgcoiepdxagqn","_id":"cjvg26t1x000xgcoitdjy4duw"},{"post_id":"cjvg26t1l000cgcoiq4olvuy1","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t200012gcoi7pbu9tbn"},{"post_id":"cjvg26t1n000egcoiexnzkab5","tag_id":"cjvg26t1z0010gcoiryao3nsp","_id":"cjvg26t240019gcoilvh2c9yh"},{"post_id":"cjvg26t1n000egcoiexnzkab5","tag_id":"cjvg26t210014gcoid3z07t7e","_id":"cjvg26t25001bgcoiivzcx6h3"},{"post_id":"cjvg26t230018gcoi8m3mskeg","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t26001egcoiccbia21f"},{"post_id":"cjvg26t24001agcoisffax5em","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t27001ggcoiz8vlitni"},{"post_id":"cjvg26t1q000kgcoi06de6c1c","tag_id":"cjvg26t230017gcoifzi53xf9","_id":"cjvg26t29001kgcoik1m17t8i"},{"post_id":"cjvg26t1q000kgcoi06de6c1c","tag_id":"cjvg26t26001dgcoiwhe9y15y","_id":"cjvg26t2a001mgcoiwnfer31k"},{"post_id":"cjvg26t27001hgcoixofb30b3","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t2b001pgcoinbmadpq6"},{"post_id":"cjvg26t28001jgcoiebnet75x","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t2c001rgcoi9bfj8o3j"},{"post_id":"cjvg26t1s000ngcoi1kuwpsej","tag_id":"cjvg26t28001igcoizzcf245k","_id":"cjvg26t2e001ugcoievreyywm"},{"post_id":"cjvg26t1u000sgcoilepbpcm2","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t2f001wgcoippodafaq"},{"post_id":"cjvg26t1w000vgcoi60dwpuz6","tag_id":"cjvg26t2d001sgcoir213kftf","_id":"cjvg26t2l0026gcoiqmqv1hal"},{"post_id":"cjvg26t1w000vgcoi60dwpuz6","tag_id":"cjvg26t2f001xgcoingilkyfo","_id":"cjvg26t2m0028gcoiq5zb97ob"},{"post_id":"cjvg26t1w000vgcoi60dwpuz6","tag_id":"cjvg26t2i0021gcoinbpg4t6h","_id":"cjvg26t2m002agcoijp3w1pw6"},{"post_id":"cjvg26t1y000zgcoi7x18y3n5","tag_id":"cjvg26t2j0024gcoivlq5oj2k","_id":"cjvg26t2n002cgcoi2x6z3tsb"},{"post_id":"cjvg26t1y000zgcoi7x18y3n5","tag_id":"cjvg26t2m0029gcoifs0pzfzv","_id":"cjvg26t2n002dgcois942jhr0"},{"post_id":"cjvg26t1z0011gcoi75d2w47w","tag_id":"cjvg26t2n002bgcoiyd3c1eou","_id":"cjvg26t2o002ggcoi3dvakbe0"},{"post_id":"cjvg26t1z0011gcoi75d2w47w","tag_id":"cjvg26t2n002egcoi0rrpdu5m","_id":"cjvg26t2p002hgcoin47k6jz8"},{"post_id":"cjvg26t200013gcoih2vpjbb0","tag_id":"cjvg26t2d001sgcoir213kftf","_id":"cjvg26t2p002jgcoi4d8hpruz"},{"post_id":"cjvg26t210015gcoii007fprg","tag_id":"cjvg26t2p002igcoizksterw6","_id":"cjvg26t2q002lgcoiy19i0euk"},{"post_id":"cjvg26t220016gcoicr586x6s","tag_id":"cjvg26t2p002kgcoi8i13vl6w","_id":"cjvg26t2q002ngcoiso2bfno1"},{"post_id":"cjvg26t25001cgcoik62pyvlm","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t2r002pgcoir21pk658"},{"post_id":"cjvg26t25001cgcoik62pyvlm","tag_id":"cjvg26t2q002mgcoi66qcke5e","_id":"cjvg26t2r002qgcoiltktunt2"},{"post_id":"cjvg26t2b001ogcoi7b6pfe77","tag_id":"cjvg26t2p002igcoizksterw6","_id":"cjvg26t2s002sgcoitunqnghw"},{"post_id":"cjvg26t2c001qgcoikwndk104","tag_id":"cjvg26t2p002igcoizksterw6","_id":"cjvg26t2s002ugcoi9nkxdupd"},{"post_id":"cjvg26t2d001tgcoiwy637okl","tag_id":"cjvg26t2s002tgcoi546ejxtu","_id":"cjvg26t2t002wgcoik3a0qb1n"},{"post_id":"cjvg26t2e001vgcoikef45wv9","tag_id":"cjvg26t2t002vgcoiv661304w","_id":"cjvg26t2u002zgcoi0tehj43b"},{"post_id":"cjvg26t2e001vgcoikef45wv9","tag_id":"cjvg26t2t002xgcoivulpf9ur","_id":"cjvg26t2u0030gcoie7wex8un"},{"post_id":"cjvg26t2h0020gcoiy3zykav2","tag_id":"cjvg26t2t002ygcoid3gjh01k","_id":"cjvg26t2v0033gcoipezxdqby"},{"post_id":"cjvg26t2h0020gcoiy3zykav2","tag_id":"cjvg26t2u0031gcoi6vtisbwl","_id":"cjvg26t2v0034gcoi6cim09by"},{"post_id":"cjvg26t2i0022gcoiehrbeye4","tag_id":"cjvg26t2v0032gcoi9higivcu","_id":"cjvg26t2w0036gcoiosj2kkbl"},{"post_id":"cjvg26t2k0025gcoi932xvuve","tag_id":"cjvg26t2v0035gcoinj1p2w0q","_id":"cjvg26t2w0038gcoihkit02e4"},{"post_id":"cjvg26t2k0025gcoi932xvuve","tag_id":"cjvg26t2w0037gcoih07rhh6o","_id":"cjvg26t2w0039gcoi4x39l90t"},{"post_id":"cjvg26t7u003dgcoi2dps2g5v","tag_id":"cjvg26t2t002vgcoiv661304w","_id":"cjvg26t7x003ggcoi8jejsyzn"},{"post_id":"cjvg26t7w003fgcoitisca145","tag_id":"cjvg26t2d001sgcoir213kftf","_id":"cjvg26t7z003igcoi8lqq2spw"},{"post_id":"cjvg26t7x003hgcoivcsbyacf","tag_id":"cjvg26t1x000wgcoi0pruy94l","_id":"cjvg26t81003lgcoiqs9dr2oy"},{"post_id":"cjvg26t7s003bgcoimrd2s5c7","tag_id":"cjvg26t7w003egcoiv84a0cuo","_id":"cjvg26t82003ngcoih5rtdii2"},{"post_id":"cjvg26t83003ogcoi6s7lwr2t","tag_id":"cjvg26t2v0032gcoi9higivcu","_id":"cjvg26t84003qgcoit7hsj6gi"},{"post_id":"cjvg26t81003mgcoic5fnuv3u","tag_id":"cjvg26t1j0009gcoi2rthw2o9","_id":"cjvg26t85003sgcoiui6cdvhy"},{"post_id":"cjvg26t81003mgcoic5fnuv3u","tag_id":"cjvg26t84003pgcoikldz3d7n","_id":"cjvg26t86003tgcoiycwul03v"},{"post_id":"cjvg26t8p003ugcoi4lw5fttz","tag_id":"cjvg26t1p000hgcoi2k5udqlf","_id":"cjvg26t8q003vgcoiqlwg8m1b"}],"Tag":[{"name":"idea","_id":"cjvg26t1e0005gcoiwag9uj4d"},{"name":"angular","_id":"cjvg26t1j0009gcoi2rthw2o9"},{"name":"Security","_id":"cjvg26t1p000hgcoi2k5udqlf"},{"name":"IDE","_id":"cjvg26t1r000mgcoizemkfh8v"},{"name":"mysql","_id":"cjvg26t1u000rgcoiepdxagqn"},{"name":"Java","_id":"cjvg26t1x000wgcoi0pruy94l"},{"name":"zuul","_id":"cjvg26t1z0010gcoiryao3nsp"},{"name":"spring cloud","_id":"cjvg26t210014gcoid3z07t7e"},{"name":"npm","_id":"cjvg26t230017gcoifzi53xf9"},{"name":"Nexus","_id":"cjvg26t26001dgcoiwhe9y15y"},{"name":"Augular","_id":"cjvg26t28001igcoizzcf245k"},{"name":"Angular","_id":"cjvg26t2d001sgcoir213kftf"},{"name":"VS Code","_id":"cjvg26t2f001xgcoingilkyfo"},{"name":"Chrome","_id":"cjvg26t2i0021gcoinbpg4t6h"},{"name":"travis","_id":"cjvg26t2j0024gcoivlq5oj2k"},{"name":"github","_id":"cjvg26t2m0029gcoifs0pzfzv"},{"name":"Spring","_id":"cjvg26t2n002bgcoiyd3c1eou"},{"name":"gradle","_id":"cjvg26t2n002egcoi0rrpdu5m"},{"name":"Linux","_id":"cjvg26t2p002igcoizksterw6"},{"name":"framework","_id":"cjvg26t2p002kgcoi8i13vl6w"},{"name":"GC","_id":"cjvg26t2q002mgcoi66qcke5e"},{"name":"Log","_id":"cjvg26t2s002tgcoi546ejxtu"},{"name":"nginx","_id":"cjvg26t2t002vgcoiv661304w"},{"name":"tomcat","_id":"cjvg26t2t002xgcoivulpf9ur"},{"name":"mq","_id":"cjvg26t2t002ygcoid3gjh01k"},{"name":"分布式","_id":"cjvg26t2u0031gcoi6vtisbwl"},{"name":"spring","_id":"cjvg26t2v0032gcoi9higivcu"},{"name":"bootstrap","_id":"cjvg26t2v0035gcoinj1p2w0q"},{"name":"webuploader","_id":"cjvg26t2w0037gcoih07rhh6o"},{"name":"Oauth","_id":"cjvg26t7w003egcoiv84a0cuo"},{"name":"electron","_id":"cjvg26t84003pgcoikldz3d7n"}]}}